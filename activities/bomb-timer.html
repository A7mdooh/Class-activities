<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>💣 لعبة القنبلة المؤقتة - نشاط تعليمي تفاعلي</title>
    
    <!-- الخطوط والأيقونات -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- المكتبات الخارجية -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- الأنماط الموحدة -->
    <link rel="stylesheet" href="../assets/css/style.css?v=clean">
    
    <style>
        /* ===== متغيرات CSS ===== */
        :root {
            /* الألوان الأساسية */
            --oman-red: #DC143C;
            --oman-green: #228B22;
            --oman-white: #FFFFFF;
            --accent-gold: #FFD700;
            
            /* ألوان القنبلة */
            --bomb-primary: #1A1A1A;
            --bomb-secondary: #2D2D2D;
            --danger-red: #FF0000;
            --warning-orange: #FF8C00;
            --safe-green: #00FF00;
            --explosive-yellow: #FFD700;
            
            /* التدرجات */
            --gradient-danger: linear-gradient(135deg, var(--oman-red) 0%, #B22222 100%);
            --gradient-safe: linear-gradient(135deg, var(--oman-green) 0%, #32CD32 100%);
            --gradient-warning: linear-gradient(135deg, var(--warning-orange) 0%, #FF6347 100%);
            --gradient-gold: linear-gradient(135deg, var(--accent-gold) 0%, #FFA500 100%);
            --gradient-dark: linear-gradient(135deg, var(--bomb-primary) 0%, var(--bomb-secondary) 100%);
            --gradient-background: linear-gradient(135deg, #0F172A 0%, #1E293B 25%, #334155 50%, #475569 75%, #64748B 100%);
            
            /* الظلال والتأثيرات */
            --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.25);
            --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.35);
            --shadow-glow-red: 0 0 24px rgba(220, 20, 60, 0.4);
            --shadow-glow-green: 0 0 24px rgba(34, 139, 34, 0.4);
            --shadow-glow-gold: 0 0 24px rgba(255, 215, 0, 0.4);
            
            /* النصوص */
            --text-primary: #FFFFFF;
            --text-secondary: #E2E8F0;
            --text-muted: #94A3B8;
            --text-dark: #1E293B;
            
            /* الخلفيات */
            --background-primary: #0F172A;
            --background-secondary: #1E293B;
            --surface-elevated: rgba(255, 255, 255, 0.1);
            --surface-glass: rgba(255, 255, 255, 0.05);
            
            /* أنصاف الأقطار والانتقالات */
            --border-radius-small: 8px;
            --border-radius-medium: 12px;
            --border-radius-large: 16px;
            --border-radius-xl: 24px;
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* ===== الإعدادات العامة ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--gradient-background);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* الخلفية المتحركة */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(220, 20, 60, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(255, 140, 0, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 60%),
                radial-gradient(circle at 60% 70%, rgba(34, 139, 34, 0.05) 0%, transparent 60%);
            animation: backgroundPulse 6s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 0.4; filter: hue-rotate(0deg); }
            33% { opacity: 0.7; filter: hue-rotate(10deg); }
            66% { opacity: 0.5; filter: hue-rotate(-10deg); }
        }

        /* ===== أزرار التحكم ===== */
        .control-btn {
            position: fixed;
            top: 15px;
            font-size: 20px;
            background: var(--surface-glass);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-normal);
            padding: 12px;
            z-index: 2147483647;
            border-radius: 50%;
            backdrop-filter: blur(16px);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-medium);
            font-weight: 600;
        }
        
        .control-btn:hover {
            transform: translateY(-3px) scale(1.1);
            background: var(--gradient-danger);
            color: var(--oman-white);
            border-color: var(--oman-red);
            box-shadow: var(--shadow-glow-red);
        }

        .control-btn:active {
            transform: translateY(-1px) scale(1.05);
        }
        
        #homeBtn { right: 15px; }
        #refreshBtn { right: 80px; }
        #instructionsBtn { right: 145px; }
        #fullscreenBtn { left: 15px; }
        #soundBtn { left: 80px; }
        #teacherGuideBtn { left: 145px; }

        /* ===== رأس الصفحة ===== */
        header {
            background: var(--gradient-dark);
            color: var(--oman-red);
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
            border-bottom: 4px solid var(--oman-red);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 20, 60, 0.1), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        header h1 {
            margin: 0 0 12px 0;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            text-shadow: 
                0 0 10px rgba(220, 20, 60, 0.8),
                0 0 20px rgba(220, 20, 60, 0.6),
                0 0 30px rgba(220, 20, 60, 0.4);
            animation: titlePulse 2.5s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
        }

        @keyframes titlePulse {
            from { 
                text-shadow: 
                    0 0 10px rgba(220, 20, 60, 0.8),
                    0 0 20px rgba(220, 20, 60, 0.6);
            }
            to { 
                text-shadow: 
                    0 0 15px rgba(220, 20, 60, 1),
                    0 0 25px rgba(220, 20, 60, 0.8),
                    0 0 35px rgba(220, 20, 60, 0.6);
            }
        }

        .header-controls {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 10;
        }

        .settings-btn {
            background: var(--gradient-gold);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            color: var(--text-dark);
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-medium);
            position: relative;
            overflow: hidden;
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-glow-gold);
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
        }

        .settings-btn:active {
            transform: scale(0.95);
        }

        .settings-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .settings-btn:hover::before {
            left: 100%;
        }

        .game-ready-indicator {
            background: var(--gradient-safe);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius-medium);
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
            box-shadow: var(--shadow-glow-green);
            animation: pulseGreen 2s infinite;
        }

        @keyframes pulseGreen {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        .game-ready-indicator i {
            margin-left: 8px;
            font-size: 18px;
        }

        .subtitle {
            font-size: 1.3rem;
            font-weight: 600;
            opacity: 0.95;
            color: var(--explosive-yellow);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            position: relative;
            z-index: 1;
        }

        /* ===== الحاوي الرئيسي ===== */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: minmax(280px, 1fr) minmax(400px, 2fr) minmax(280px, 1fr);
            gap: 25px;
            min-height: 75vh;
            align-items: start;
        }

        /* ===== الأقسام الجانبية ===== */
        .game-info, .teacher-controls {
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid var(--oman-red);
            border-radius: var(--border-radius-large);
            padding: 25px;
            backdrop-filter: blur(15px);
            box-shadow: var(--shadow-medium);
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .game-info::before, .teacher-controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: var(--border-radius-large) var(--border-radius-large) 0 0;
        }

        .game-info::before {
            background: var(--gradient-danger);
        }

        .teacher-controls {
            border-color: var(--oman-green);
        }

        .teacher-controls::before {
            background: var(--gradient-safe);
        }

        .game-info:hover, .teacher-controls:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-large);
        }

        /* ===== بطاقات المعلومات ===== */
        .info-card {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--explosive-yellow);
            border-radius: var(--border-radius-medium);
            padding: 18px;
            margin: 15px 0;
            text-align: center;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--gradient-gold);
            transition: var(--transition-normal);
        }

        .info-card:hover::before {
            left: 0;
        }

        .info-card:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.15);
            border-color: var(--accent-gold);
            box-shadow: var(--shadow-glow-gold);
        }

        .info-label {
            font-size: 0.95rem;
            color: var(--explosive-yellow);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--oman-white);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* ===== منطقة القنبلة ===== */
        .bomb-area {
            background: rgba(26, 26, 26, 0.95);
            border: 4px solid var(--oman-red);
            border-radius: var(--border-radius-large);
            padding: 35px;
            text-align: center;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-glow-red), var(--shadow-large);
            overflow: hidden;
        }

        .bomb-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(220, 20, 60, 0.1), transparent);
            animation: rotate 10s linear infinite;
            z-index: -1;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .bomb-container {
            position: relative;
            margin: 25px auto;
            width: 320px;
            height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* القنبلة */
        .bomb {
            width: 220px;
            height: 220px;
            background: radial-gradient(circle at 30% 30%, #555 0%, #222 50%, #111 100%);
            border-radius: 50%;
            position: relative;
            border: 6px solid #666;
            box-shadow: 
                inset 0 0 30px rgba(0,0,0,0.9),
                inset 10px 10px 20px rgba(255,255,255,0.1),
                0 0 40px rgba(220, 20, 60, 0.4),
                0 0 60px rgba(220, 20, 60, 0.2);
            transition: var(--transition-normal);
        }

        .bomb::before {
            content: '💣';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            animation: bombPulse 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(220, 20, 60, 0.8));
        }

        @keyframes bombPulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                filter: drop-shadow(0 0 10px rgba(220, 20, 60, 0.8));
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1);
                filter: drop-shadow(0 0 20px rgba(220, 20, 60, 1));
            }
        }

        /* الفتيل */
        .fuse {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 45px;
            background: linear-gradient(to top, #8B4513 0%, #CD853F 50%, #D2691E 100%);
            border-radius: 3px;
            box-shadow: 0 0 5px rgba(139, 69, 19, 0.8);
        }

        .fuse::after {
            content: '🔥';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            animation: fireFlicker 0.3s ease-in-out infinite alternate;
            filter: drop-shadow(0 0 8px #FF4500);
        }

        @keyframes fireFlicker {
            from { 
                opacity: 0.8;
                transform: translateX(-50%) scale(0.9);
            }
            to { 
                opacity: 1;
                transform: translateX(-50%) scale(1.1);
            }
        }

        /* العداد */
        .timer-display {
            background: rgba(0,0,0,0.95);
            border: 4px solid var(--oman-red);
            border-radius: var(--border-radius-medium);
            padding: 20px 25px;
            margin: 25px auto;
            width: fit-content;
            box-shadow: 
                0 0 30px rgba(220, 20, 60, 0.6),
                inset 0 0 20px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
        }

        .timer-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 20, 60, 0.2), transparent);
            animation: timerScan 2s linear infinite;
        }

        @keyframes timerScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .timer-text {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 900;
            color: var(--oman-red);
            font-family: 'Courier New', monospace;
            text-shadow: 
                0 0 15px rgba(220, 20, 60, 1),
                0 0 25px rgba(220, 20, 60, 0.8),
                0 0 35px rgba(220, 20, 60, 0.6);
            animation: timerPulse 1s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
            letter-spacing: 2px;
        }

        @keyframes timerPulse {
            from { 
                text-shadow: 
                    0 0 15px rgba(220, 20, 60, 1),
                    0 0 25px rgba(220, 20, 60, 0.8);
                transform: scale(1);
            }
            to { 
                text-shadow: 
                    0 0 20px rgba(220, 20, 60, 1),
                    0 0 30px rgba(220, 20, 60, 1),
                    0 0 40px rgba(220, 20, 60, 0.8);
                transform: scale(1.05);
            }
        }

        /* ===== أقسام التحكم ===== */
        .control-section {
            margin: 20px 0;
            padding: 18px;
            background: rgba(255,255,255,0.08);
            border-radius: var(--border-radius-medium);
            border: 1px solid var(--oman-green);
            transition: var(--transition-normal);
            position: relative;
        }

        .control-section:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--oman-green);
            transform: translateX(5px);
        }

        .control-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--oman-green);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* ===== الأزرار ===== */
        .btn {
            background: var(--gradient-danger);
            color: var(--oman-white);
            border: none;
            padding: 14px 24px;
            margin: 8px;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition-bounce);
            box-shadow: var(--shadow-small);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 120px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition-normal);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
            transition: var(--transition-fast);
        }

        .btn-success {
            background: var(--gradient-safe);
        }

        .btn-success:hover {
            box-shadow: var(--shadow-glow-green), var(--shadow-medium);
        }

        .btn-warning {
            background: var(--gradient-warning);
        }

        .btn-gold {
            background: var(--gradient-gold);
            color: var(--bomb-primary);
            font-weight: 700;
        }

        .btn-gold:hover {
            box-shadow: var(--shadow-glow-gold), var(--shadow-medium);
            color: var(--bomb-primary);
        }

        /* ===== حالات اللعبة ===== */
        .game-state {
            text-align: center;
            padding: 25px;
            margin: 25px 0;
            border-radius: var(--border-radius-large);
            font-size: 1.3rem;
            font-weight: 700;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
        }

        .state-waiting {
            background: rgba(255, 193, 7, 0.15);
            border-color: var(--explosive-yellow);
            color: var(--explosive-yellow);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .state-active {
            background: rgba(220, 20, 60, 0.15);
            border-color: var(--oman-red);
            color: var(--oman-red);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            animation: stateActivePulse 1s ease-in-out infinite alternate;
        }

        @keyframes stateActivePulse {
            from { 
                box-shadow: 0 0 20px rgba(220, 20, 60, 0.4);
                transform: scale(1);
            }
            to { 
                box-shadow: 0 0 30px rgba(220, 20, 60, 0.6);
                transform: scale(1.02);
            }
        }

        .state-success {
            background: rgba(34, 139, 34, 0.15);
            border-color: var(--oman-green);
            color: var(--oman-green);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .state-explosion {
            background: rgba(220, 20, 60, 0.2);
            border-color: var(--oman-red);
            color: var(--oman-red);
            animation: explosionShake 0.5s ease-in-out infinite;
        }

        @keyframes explosionShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ===== النوافذ المنبثقة ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid var(--oman-red);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--oman-red) 0%, #c41e3a 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }

        .modal-body {
            padding: 20px;
            color: white;
        }

        .close {
            color: white;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close:hover {
            opacity: 0.7;
        }

        /* أنماط نوافذ الاختيار */
        .class-selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .class-btn {
            background: var(--gradient-gold);
            color: var(--text-dark);
            border: none;
            padding: 15px 20px;
            border-radius: var(--border-radius-medium);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            box-shadow: var(--shadow-medium);
        }

        .class-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-glow-gold);
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .selection-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .method-card {
            background: var(--surface-glass);
            border: 2px solid transparent;
            border-radius: var(--border-radius-large);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-normal);
            backdrop-filter: blur(10px);
        }

        .method-card:hover {
            border-color: var(--accent-gold);
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow-gold);
        }

        .method-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .method-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent-gold);
        }

        .method-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* أنماط الإعدادات الصوتية */
        .audio-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .audio-control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--surface-glass);
            padding: 15px;
            border-radius: var(--border-radius-medium);
            backdrop-filter: blur(10px);
        }

        .audio-control-group label {
            min-width: 150px;
            font-weight: 600;
            color: var(--accent-gold);
        }

        .audio-control-group input[type="range"] {
            flex: 1;
            height: 8px;
            background: var(--surface-elevated);
            border-radius: 5px;
            outline: none;
            appearance: none;
        }

        .audio-control-group input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-gold);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-medium);
        }

        .audio-control-group span {
            min-width: 50px;
            text-align: center;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .audio-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: var(--surface-glass);
            padding: 20px;
            border-radius: var(--border-radius-medium);
            backdrop-filter: blur(10px);
        }

        .option-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent-gold);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .audio-presets {
            text-align: center;
        }

        .audio-presets h4 {
            margin-bottom: 15px;
            color: var(--accent-gold);
        }

        .preset-btn {
            background: var(--surface-elevated);
            color: var(--text-primary);
            border: 2px solid transparent;
            padding: 10px 15px;
            margin: 5px;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
            transition: var(--transition-normal);
            font-weight: 600;
        }

        .preset-btn:hover {
            border-color: var(--accent-gold);
            background: var(--accent-gold);
            color: var(--text-dark);
            transform: translateY(-2px);
        }

        /* ===== تحسينات الواجهة الاحترافية ===== */
        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--border-radius-large);
            padding: 30px;
            margin: 30px 0;
        }

        .bomb-display {
            position: relative;
            margin: 40px 0;
            text-align: center;
        }

        .timer-circle {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
        }

        .bomb-visual {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            animation: bombPulse 2s ease-in-out infinite;
        }

        @keyframes bombPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .sparks {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            animation: sparkle 1.5s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.5; transform: translateX(-50%) rotate(0deg); }
            50% { opacity: 1; transform: translateX(-50%) rotate(180deg); }
        }

        .timer-text {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            font-weight: bold;
            color: var(--accent-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        /* ===== أزرار التحكم المحسنة ===== */
        .game-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--surface-elevated) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid transparent;
            border-radius: var(--border-radius-medium);
            padding: 20px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .control-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover:before {
            left: 100%;
        }

        .control-btn:hover {
            border-color: var(--accent-gold);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .control-btn.primary:hover {
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }

        .control-btn.danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .control-btn.danger:hover {
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.4);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .control-btn:disabled:hover {
            border-color: transparent;
            box-shadow: none;
        }

        /* ===== منطقة المعلومات ===== */
        .game-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--border-radius-medium);
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .student-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
            margin: 10px 0;
        }

        .game-status {
            font-size: 1.2rem;
            margin: 15px 0;
            padding: 10px;
            border-radius: var(--border-radius-small);
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== إعدادات الوقت ===== */
        .timer-settings {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .timer-settings label {
            color: var(--text-primary);
            font-weight: 600;
        }

        .timer-settings input {
            background: var(--surface-elevated);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--border-radius-small);
            color: var(--text-primary);
            padding: 10px 15px;
            font-size: 1.1rem;
            width: 80px;
            text-align: center;
        }

        .timer-settings input:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        /* ===== نظام الإشعارات ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-elevated);
            border: 2px solid var(--accent-gold);
            border-radius: var(--border-radius-medium);
            padding: 15px 20px;
            color: var(--text-primary);
            font-weight: 600;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
        }

        .notification.success {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.danger {
            border-color: #dc3545;
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }

        .notification.warning {
            border-color: #ffc107;
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== تأثيرات إضافية ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.9); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes glow {
            0%, 100% { 
                text-shadow: 0 0 5px currentColor, 0 0 10px currentColor; 
            }
            50% { 
                text-shadow: 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor; 
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* ===== شريط التقدم الدائري المحسن ===== */
        .circular-progress {
            position: relative;
            width: 300px;
            height: 300px;
        }

        .progress-ring {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            r: 110;
            cx: 150;
            cy: 150;
        }

        .progress-ring .background {
            stroke: rgba(255, 255, 255, 0.2);
        }

        .progress-ring .progress {
            stroke: var(--accent-gold);
            stroke-dasharray: 692;
            stroke-dashoffset: 692;
            transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;
            stroke-linecap: round;
        }

        /* ===== تأثيرات التحويم للعناصر التفاعلية ===== */
        .interactive-element {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .interactive-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* ===== تأثيرات الألوان الديناميكية ===== */
        .dynamic-color {
            transition: color 0.3s ease, background-color 0.3s ease;
        }

        .success-state {
            color: #28a745 !important;
            border-color: #28a745 !important;
        }

        .warning-state {
            color: #ffc107 !important;
            border-color: #ffc107 !important;
        }

        .danger-state {
            color: #dc3545 !important;
            border-color: #dc3545 !important;
        }

        /* ===== تحسينات الأداء ===== */
        * {
            will-change: auto;
        }

        .animated-element {
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* ===== استجابة للشاشات الصغيرة ===== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .game-title h1 {
                font-size: 2rem;
            }

            .timer-circle {
                width: 250px;
                height: 250px;
            }

            .bomb-visual {
                font-size: 60px;
            }

            .timer-text {
                font-size: 2.5rem;
            }

            .game-controls {
                grid-template-columns: 1fr;
            }

            .timer-settings {
                flex-direction: column;
                gap: 10px;
            }
        }
        .modern-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-bottom: 3px solid var(--accent-gold);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .game-title h1 {
            margin: 0;
            font-size: 2.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-title .icon {
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        .game-subtitle {
            margin: 5px 0 0 0;
            color: var(--accent-gold);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .settings-icon {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .settings-icon:hover {
            background: var(--accent-gold);
            color: #1e3c72;
            transform: rotate(90deg) scale(1.1);
        }

        .game-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .main-display {
            background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .student-display {
            margin-bottom: 40px;
        }

        .student-name {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .student-class {
            font-size: 1.3rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .bomb-timer-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            margin: 40px 0;
        }

        .bomb-visual {
            position: relative;
        }

        .bomb-body {
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #2c2c2c 0%, #1a1a1a 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 0 20px rgba(220, 20, 60, 0.5),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            animation: bombPulse 2s ease-in-out infinite;
        }

        @keyframes bombPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .bomb-fuse {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 30px;
            background: linear-gradient(to bottom, #8B4513 0%, #654321 100%);
            border-radius: 2px;
        }

        .bomb-sparks {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #FFD700 0%, #FF6B35 100%);
            border-radius: 50%;
            animation: sparkle 0.5s ease-in-out infinite alternate;
        }

        @keyframes sparkle {
            0% { opacity: 0.3; transform: translateX(-50%) scale(0.8); }
            100% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        .timer-circle {
            position: relative;
            width: 240px;
            height: 240px;
        }

        .timer-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .timer-track {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }

        .timer-progress {
            fill: none;
            stroke: var(--accent-gold);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 692;
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-status {
            margin-top: 30px;
        }

        .status-text {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .status-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .status-dots span {
            width: 12px;
            height: 12px;
            background: var(--accent-gold);
            border-radius: 50%;
            animation: dotPulse 1.5s ease-in-out infinite;
        }

        .status-dots span:nth-child(2) { animation-delay: 0.2s; }
        .status-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotPulse {
            0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1); }
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border: 2px solid transparent;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .control-btn i {
            font-size: 1.5rem;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .control-btn.primary {
            border-color: #007bff;
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.2) 0%, rgba(0, 86, 179, 0.2) 100%);
        }

        .control-btn.primary:hover {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }

        .control-btn.secondary {
            border-color: #6c757d;
            background: linear-gradient(135deg, rgba(108, 117, 125, 0.2) 0%, rgba(73, 80, 87, 0.2) 100%);
        }

        .control-btn.secondary:hover {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .control-btn.success {
            border-color: #28a745;
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.2) 0%, rgba(25, 135, 84, 0.2) 100%);
        }

        .control-btn.success:hover {
            background: linear-gradient(135deg, #28a745 0%, #198754 100%);
        }

        .control-btn.danger {
            border-color: #dc3545;
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.2) 0%, rgba(176, 42, 55, 0.2) 100%);
        }

        .control-btn.danger:hover {
            background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* التصميم المتجاوب */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .game-title h1 {
                font-size: 2rem;
            }

            .bomb-timer-section {
                flex-direction: column;
                gap: 30px;
            }

            .timer-circle {
                width: 180px;
                height: 180px;
            }

            .timer-text {
                font-size: 2.5rem;
            }

            .control-group {
                grid-template-columns: 1fr;
            }
        }

        /* ===== التصميم المتجاوب ===== */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 15px;
            }
            
            .bomb {
                width: 150px;
                height: 150px;
            }
            
            .bomb-container {
                width: 250px;
                height: 250px;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            .timer-text {
                font-size: 2.5rem;
            }
            
            .bomb::before {
                font-size: 3rem;
            }

            .control-btn {
                font-size: 18px;
                width: 42px;
                height: 42px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding-top: 70px;
            }
            
            header {
                padding: 1rem 0.5rem;
                margin-bottom: 15px;
            }
            
            header h1 {
                font-size: 1.8rem;
                margin-bottom: 8px;
            }
            
            .main-container {
                padding: 10px;
                gap: 10px;
            }
            
            .bomb-container {
                width: 200px;
                height: 200px;
                margin: 15px auto;
            }
            
            .bomb {
                width: 120px;
                height: 120px;
            }
            
            .bomb::before {
                font-size: 2.5rem;
            }
            
            .timer-text {
                font-size: 1.8rem;
            }
            
            .control-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }

        /* تحسينات إمكانية الوصول */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ===== نظام الإشعارات التفاعلية المتقدم ===== */
        .advanced-notification-system {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            pointer-events: none;
        }

        .notification-item {
            background: linear-gradient(135deg, 
                rgba(26, 26, 26, 0.95) 0%, 
                rgba(45, 45, 45, 0.95) 100%);
            border: 2px solid var(--oman-red);
            border-radius: var(--border-radius-large);
            padding: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(220, 20, 60, 0.3);
            transform: translateX(450px);
            opacity: 0;
            transition: all var(--transition-slow);
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }

        .notification-item.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-item.success {
            border-color: var(--oman-green);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(34, 139, 34, 0.3);
        }

        .notification-item.warning {
            border-color: var(--warning-orange);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(255, 140, 0, 0.3);
        }

        .notification-item.info {
            border-color: var(--explosive-yellow);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(255, 215, 0, 0.3);
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .notification-icon {
            font-size: 1.5rem;
            margin-left: 12px;
        }

        .notification-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px;
            border-radius: 50%;
            transition: var(--transition-fast);
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .notification-content {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--oman-red);
            transition: width linear;
            border-radius: 0 0 var(--border-radius-large) var(--border-radius-large);
        }

        .notification-item.success .notification-progress {
            background: var(--oman-green);
        }

        .notification-item.warning .notification-progress {
            background: var(--warning-orange);
        }

        .notification-item.info .notification-progress {
            background: var(--explosive-yellow);
        }

        /* ===== تحدي الذكاء التفاعلي ===== */
        .intelligence-challenge {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 8888;
            display: none;
            align-items: center;
            justify-content: center;
            animation: challengeAppear 0.5s ease-out;
        }

        .intelligence-challenge.active {
            display: flex;
        }

        @keyframes challengeAppear {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .challenge-container {
            background: linear-gradient(135deg, 
                rgba(26, 26, 26, 0.98) 0%, 
                rgba(45, 45, 45, 0.98) 100%);
            border: 3px solid var(--explosive-yellow);
            border-radius: var(--border-radius-xl);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                0 0 100px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .challenge-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: rotate 8s linear infinite;
            z-index: -1;
        }

        .challenge-header {
            font-size: 2rem;
            font-weight: 800;
            color: var(--explosive-yellow);
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: challengeGlow 2s ease-in-out infinite alternate;
        }

        @keyframes challengeGlow {
            from {
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            to {
                text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.4);
            }
        }

        .challenge-question {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .challenge-timer {
            font-size: 3rem;
            font-weight: 900;
            color: var(--oman-red);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(220, 20, 60, 0.8);
            animation: challengeTimerPulse 1s ease-in-out infinite;
        }

        @keyframes challengeTimerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .challenge-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* ===== شريط التقدم التنافسي ===== */
        .competitive-progress-bar {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            z-index: 7777;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                var(--oman-red) 0%, 
                var(--warning-orange) 50%, 
                var(--oman-green) 100%);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-label {
            position: fixed;
            top: 82px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: var(--text-primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 7778;
            backdrop-filter: blur(10px);
        }

        /* ===== النوافذ المبسطة ===== */
        .simple-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .simple-modal .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 15px;
            padding: 0;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--accent-gold);
        }

        .simple-modal .modal-header {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
        }

        .simple-modal .modal-header h3 {
            margin: 0;
            color: var(--accent-gold);
            font-size: 1.5rem;
        }

        .simple-modal .close {
            color: white;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .simple-modal .close:hover {
            color: var(--accent-gold);
            transform: scale(1.2);
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .class-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .class-btn:hover {
            border-color: var(--accent-gold);
            background: var(--accent-gold);
            color: #1e3c72;
            transform: translateY(-2px);
        }

        .settings-content {
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            color: white;
        }

        .setting-item label {
            font-weight: 600;
            color: var(--accent-gold);
        }

        .setting-item select,
        .setting-item input[type="range"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .toggle-btn {
            background: var(--accent-gold);
            border: none;
            color: #1e3c72;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .toggle-btn.off {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
    </style>
</head>
<body>
    <!-- نظام الإشعارات -->
    <div id="advancedNotificationSystem" class="advanced-notification-system"></div>

    <!-- رأس الصفحة الجديد -->
    <header class="modern-header">
        <div class="header-content">
            <div class="game-title">
                <h1><span class="icon">💣</span>لعبة القنبلة الذكية</h1>
                <p class="game-subtitle">تحدي الوقت والذكاء</p>
            </div>
            <button class="settings-icon" onclick="toggleSettings()" title="الإعدادات">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </header>

    <!-- الحاوي الرئيسي المحدث -->
    <div class="game-container">
        <!-- منطقة العرض الرئيسية -->
        <div class="main-display">
            <!-- شاشة الطالب المختار -->
            <div class="student-display">
                <div class="student-name" id="studentName">اختر صفاً لبدء اللعبة</div>
                <div class="student-class" id="studentClass"></div>
            </div>
            
            <!-- القنبلة والمؤقت -->
            <div class="bomb-timer-section">
                <div class="bomb-visual">
                    <div class="bomb-body">
                        <div class="bomb-fuse"></div>
                        <div class="bomb-sparks"></div>
                    </div>
                </div>
                
                <div class="timer-circle">
                    <div class="timer-text" id="timerText">30</div>
                    <svg class="timer-svg">
                        <circle class="timer-track" cx="120" cy="120" r="110"></circle>
                        <circle class="timer-progress" cx="120" cy="120" r="110" id="timerProgress"></circle>
                    </svg>
                </div>
            </div>
            
            <!-- حالة اللعبة -->
            <div class="game-status">
                <div class="status-text" id="gameStatusText">في انتظار بدء اللعبة</div>
                <div class="status-dots">
                    <span></span><span></span><span></span>
                </div>
            </div>
        </div>
        
        <!-- لوحة التحكم -->
        <div class="control-panel">
            <div class="control-group">
                <button class="control-btn primary" id="classBtn" onclick="showClassSelection()">
                    <i class="fas fa-school"></i>
                    <span>اختيار الصف</span>
                </button>
                <button class="control-btn secondary" id="playBtn" onclick="startNewGame()" disabled>
                    <i class="fas fa-play"></i>
                    <span>بدء اللعبة</span>
                </button>
                <button class="control-btn success" id="defuseBtn" onclick="defuseBomb()" disabled>
                    <i class="fas fa-shield-alt"></i>
                    <span>إبطال القنبلة</span>
                </button>
                <button class="control-btn danger" id="resetBtn" onclick="resetGame()">
                    <i class="fas fa-redo"></i>
                    <span>إعادة تعيين</span>
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة التعليمات -->
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('instructionsModal')">&times;</span>
                <h2>🎯 كيفية لعب القنبلة المؤقتة</h2>
            </div>
            <div class="modal-body">
                <h3>📖 فكرة اللعبة:</h3>
                <p>لعبة تعليمية مثيرة حيث يتم اختيار طالب ويطرح عليه سؤال، وعليه الإجابة قبل انتهاء الوقت المحدد لتجنب "انفجار القنبلة".</p>
                
                <h3>🎮 خطوات اللعب:</h3>
                <ol>
                    <li>اضغط على "بدء اللعبة" أو "اختيار عشوائي"</li>
                    <li>سيتم اختيار طالب عشوائياً وعرض اسمه</li>
                    <li>اطرح السؤال على الطالب المختار</li>
                    <li>راقب العداد التنازلي وشريط التقدم</li>
                    <li>استخدم "تحديات الذكاء" لإضافة المزيد من الإثارة</li>
                    <li>إذا أجاب الطالب بشكل صحيح، اضغط "إبطال القنبلة" قبل انتهاء الوقت</li>
                    <li>إذا لم يجب أو أجاب خطأ، ستنفجر القنبلة عند انتهاء الوقت</li>
                    <li>تابع التقدم والإحصائيات من خلال الإشعارات</li>
                </ol>
                
                <h3>🚀 الميزات الجديدة:</h3>
                <ul>
                    <li><strong>🧠 تحديات الذكاء:</strong> أسئلة سريعة إضافية لزيادة النقاط</li>
                    <li><strong>🏆 شريط التقدم:</strong> متابعة بصرية لإنجازات اللعبة</li>
                    <li><strong>🔔 الإشعارات الذكية:</strong> تنبيهات تفاعلية ومعلومات مفيدة</li>
                    <li><strong>📊 إحصائيات متقدمة:</strong> تحليل شامل للأداء والتقدم</li>
                    <li><strong>⌨️ اختصارات سريعة:</strong> تحكم أسرع باستخدام لوحة المفاتيح</li>
                </ul>
                
                <h3>⚙️ نصائح للمعلم:</h3>
                <ul>
                    <li>🎯 استخدم أسئلة متنوعة ومناسبة لمستوى الطلاب</li>
                    <li>⏰ اضبط الوقت حسب صعوبة السؤال</li>
                    <li>🎪 اجعل الجو مرحاً ومثيراً</li>
                    <li>👏 شجع المشاركة حتى في حالة الخطأ</li>
                    <li>🏆 استخدم النقاط لتحفيز المنافسة الإيجابية</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- نافذة دليل المعلم -->
    <div id="teacherGuideModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('teacherGuideModal')">&times;</span>
                <h2>👨‍🏫 دليل المعلم المتطور</h2>
            </div>
            <div class="modal-body">
                <h3>🎯 الهدف التعليمي:</h3>
                <p>تعزيز التفاعل الصفي وتحفيز الطلاب على المشاركة الفعالة في عملية التعلم من خلال عنصر الإثارة والتشويق.</p>
                
                <h3>📚 استراتيجيات الاستخدام:</h3>
                <ul>
                    <li><strong>📖 المراجعة:</strong> استخدم اللعبة لمراجعة المواد السابقة</li>
                    <li><strong>🔍 التقييم التكويني:</strong> اختبر فهم الطلاب للمفاهيم الجديدة</li>
                    <li><strong>🎪 كسر الجليد:</strong> ابدأ الحصة بجو مرح ونشط</li>
                    <li><strong>⚡ تنشيط الذهن:</strong> استخدمها بين الفقرات لإعادة التركيز</li>
                    <li><strong>🧠 تحديات الذكاء:</strong> أضف تحديات سريعة لزيادة التفاعل</li>
                    <li><strong>🏆 التقدم التنافسي:</strong> راقب تقدم الطلاب بصرياً</li>
                </ul>
                
                <h3>🚀 الميزات الثورية الجديدة:</h3>
                <ul>
                    <li><strong>🧠 الذكاء الاصطناعي:</strong> نظام اختيار ذكي يراعي أداء كل طالب وحالة تحفيزه</li>
                    <li><strong>🔊 النظام الصوتي التفاعلي:</strong> أكثر من 80 مؤثر صوتي لتجربة غامرة</li>
                    <li><strong>� العروض المثيرة:</strong> اختيار درامي مع تأثيرات بصرية وصوتية مبهرة</li>
                    <li><strong>📊 التحليل المتقدم:</strong> إحصائيات شاملة وتتبع عادل للطلاب</li>
                    <li><strong>⚖️ العدالة الذكية:</strong> ضمان إعطاء الفرص بشكل متوازن</li>
                    <li><strong>🎯 التخصيص المرن:</strong> إمكانية تعديل كل شيء حسب احتياجات الصف</li>
                </ul>
                
                <h3>🎭 أنواع الاختيار المتوفرة:</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <strong>🎲 الاختيار الذكي:</strong> يوازن بين العدالة والأداء والتحفيز<br>
                    <strong>🎪 الاختيار المثير:</strong> عرض درامي مع أصوات وتأثيرات خاصة<br>
                    <strong>🏆 حسب الأداء:</strong> يركز على مستوى أداء الطلاب<br>
                    <strong>💪 للتحفيز:</strong> يعطي فرص أكبر للطلاب الذين يحتاجون دفعة<br>
                    <strong>⚖️ الاختيار العادل:</strong> يضمن المساواة في الفرص
                </div>
                
                <h3>⌨️ اختصارات لوحة المفاتيح:</h3>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <strong>الأساسية:</strong><br>
                    • Space: بدء/إبطال القنبلة<br>
                    • Enter: اختيار طالب جديد<br>
                    • Escape: إعادة تعيين<br>
                    • P: إيقاف مؤقت<br>
                    • F: ملء الشاشة<br>
                    • M: تبديل الصوت<br><br>
                    
                    <strong>المتقدمة:</strong><br>
                    • Ctrl+C: تحدي ذكاء عشوائي<br>
                    • Ctrl+Q: تحدي متقدم<br>
                    • Ctrl+S: عرض الإحصائيات<br>
                    • Ctrl+N: مسح الإشعارات<br>
                    • Ctrl+1-5: تعيين مؤقت سريع<br>
                    • H: عرض التعليمات<br>
                    • G: دليل المعلم
                </div>
                
                <h3>🏆 نظام النقاط والتحفيز:</h3>
                <ul>
                    <li>100 نقطة للإجابة الصحيحة</li>
                    <li>50 نقطة للمحاولة الجيدة</li>
                    <li>مكافأة إضافية للإجابة السريعة</li>
                    <li>تشجيع المشاركة حتى في حالة الخطأ</li>
                </ul>
                
                <h3>⚙️ نصائح متقدمة:</h3>
                <ul>
                    <li>🎭 نوّع في طرق طرح الأسئلة</li>
                    <li>📊 استخدم مستويات صعوبة مختلفة</li>
                    <li>🎪 أضف عنصر المفاجأة</li>
                    <li>👥 شجع التعاون أحياناً</li>
                    <li>📱 اربط المحتوى بالواقع</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- نافذة اختيار الصف -->
    <div id="classSelectionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('classSelectionModal')">&times;</span>
                <h2>📚 اختيار الصف</h2>
            </div>
            <div class="modal-body">
                <div class="class-selection-grid">
                    <button class="class-btn" onclick="selectClass('الأول')">الصف الأول</button>
                    <button class="class-btn" onclick="selectClass('الثاني')">الصف الثاني</button>
                    <button class="class-btn" onclick="selectClass('الثالث')">الصف الثالث</button>
                    <button class="class-btn" onclick="selectClass('الرابع')">الصف الرابع</button>
                    <button class="class-btn" onclick="selectClass('الخامس')">الصف الخامس</button>
                    <button class="class-btn" onclick="selectClass('السادس')">الصف السادس</button>
                    <button class="class-btn" onclick="selectClass('السابع')">الصف السابع</button>
                    <button class="class-btn" onclick="selectClass('الثامن')">الصف الثامن</button>
                    <button class="class-btn" onclick="selectClass('التاسع')">الصف التاسع</button>
                    <button class="class-btn" onclick="selectClass('العاشر')">الصف العاشر</button>
                    <button class="class-btn" onclick="selectClass('الحادي عشر')">الصف الحادي عشر</button>
                    <button class="class-btn" onclick="selectClass('الثاني عشر')">الصف الثاني عشر</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة اختيار طريقة الاختيار -->
    <div id="selectionMethodModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('selectionMethodModal')">&times;</span>
                <h2>🎯 طريقة اختيار الأعبين</h2>
            </div>
            <div class="modal-body">
                <div class="selection-methods">
                    <div class="method-card" onclick="selectMethod('random')">
                        <div class="method-icon">🎲</div>
                        <div class="method-title">اختيار عشوائي</div>
                        <div class="method-description">اختيار الطلاب بطريقة عشوائية تماماً</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('sequence')">
                        <div class="method-icon">📋</div>
                        <div class="method-title">اختيار تسلسلي</div>
                        <div class="method-description">اختيار الطلاب بترتيب القائمة</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('smart')">
                        <div class="method-icon">🧠</div>
                        <div class="method-title">اختيار ذكي</div>
                        <div class="method-description">اختيار يراعي العدالة والتنوع</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('performance')">
                        <div class="method-icon">🏆</div>
                        <div class="method-title">حسب الأداء</div>
                        <div class="method-description">اختيار بناءً على مستوى الأداء</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة الإعدادات الصوتية -->
    <div id="audioSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('audioSettingsModal')">&times;</span>
                <h2>🎵 إعدادات النظام الصوتي</h2>
            </div>
            <div class="modal-body">
                <div class="audio-controls">
                    <div class="audio-control-group">
                        <label>🔊 مستوى الصوت العام</label>
                        <input type="range" id="masterVolume" min="0" max="100" value="70" onchange="adjustMasterVolume(this.value)">
                        <span id="volumeValue">70%</span>
                    </div>
                    
                    <div class="audio-control-group">
                        <label>🎵 تأثيرات اللعبة</label>
                        <input type="range" id="gameEffectsVolume" min="0" max="100" value="80" onchange="adjustGameEffectsVolume(this.value)">
                        <span id="effectsVolumeValue">80%</span>
                    </div>
                    
                    <div class="audio-control-group">
                        <label>🎶 موسيقى الخلفية</label>
                        <input type="range" id="backgroundMusicVolume" min="0" max="100" value="30" onchange="adjustBackgroundMusicVolume(this.value)">
                        <span id="musicVolumeValue">30%</span>
                    </div>
                    
                    <div class="audio-options">
                        <div class="option-toggle">
                            <label class="switch">
                                <input type="checkbox" id="soundEnabled" checked onchange="toggleSound()">
                                <span class="slider"></span>
                            </label>
                            <span>تفعيل الأصوات</span>
                        </div>
                        
                        <div class="option-toggle">
                            <label class="switch">
                                <input type="checkbox" id="dramaticMode" checked onchange="toggleDramaticMode()">
                                <span class="slider"></span>
                            </label>
                            <span>الوضع الدرامي</span>
                        </div>
                        
                        <div class="option-toggle">
                            <label class="switch">
                                <input type="checkbox" id="smartAudio" checked onchange="toggleSmartAudio()">
                                <span class="slider"></span>
                            </label>
                            <span>الصوت الذكي</span>
                        </div>
                    </div>
                    
                    <div class="audio-presets">
                        <h4>🎛️ إعدادات سريعة</h4>
                        <button class="preset-btn" onclick="applyAudioPreset('silent')">🔇 صامت</button>
                        <button class="preset-btn" onclick="applyAudioPreset('low')">🔉 منخفض</button>
                        <button class="preset-btn" onclick="applyAudioPreset('normal')">🔊 عادي</button>
                        <button class="preset-btn" onclick="applyAudioPreset('high')">📢 عالي</button>
                        <button class="preset-btn" onclick="applyAudioPreset('dramatic')">🎭 درامي</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== متغيرات اللعبة المبسطة =====
        let gameActive = false;
        let currentTimer;
        let timeLeft = 30;
        let selectedClass = null;
        let currentStudent = '';
        let notificationSystem;

        // إعداد نظام الإشعارات المبسط
        class SimpleNotificationSystem {
            show(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                // إضافة للصفحة
                document.body.appendChild(notification);
                
                // إخفاء تلقائي
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        // دوال اللعبة الأساسية المحسنة
        function showClassSelection() {
            const modal = document.getElementById('classModal');
            modal.style.display = 'block';
            modal.style.animation = 'fadeIn 0.3s ease';
        }

        function closeClassModal() {
            const modal = document.getElementById('classModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function selectClass(className) {
            selectedClass = className;
            document.getElementById('selectedClass').textContent = className;
            closeClassModal();
            
            document.getElementById('playBtn').disabled = false;
            notificationSystem.show('تم اختيار الصف: ' + className, 'success');
            
            // تأثير بصري لتأكيد الاختيار
            const selectedClassElement = document.getElementById('selectedClass');
            selectedClassElement.style.animation = 'pulse 0.5s ease';
        }

        function selectRandomStudent() {
            const students = [
                'أحمد محمد العلي', 'فاطمة سالم أحمد', 'محمد عبدالله سالم', 'عائشة حسن علي', 
                'سالم أحمد محمد', 'مريم علي حسن', 'علي محمد سالم', 'نور الهدى فاطمة', 
                'حسن سالم أحمد', 'آمنة محمد علي', 'يوسف أحمد حسن', 'زينب علي سالم',
                'عبدالله سالم محمد', 'خديجة أحمد علي', 'إبراهيم حسن سالم', 'ليلى محمد أحمد'
            ];
            
            // إضافة تأثير تشويق
            let animationCount = 0;
            const animationInterval = setInterval(() => {
                currentStudent = students[Math.floor(Math.random() * students.length)];
                document.getElementById('studentName').textContent = currentStudent;
                animationCount++;
                
                if (animationCount >= 10) {
                    clearInterval(animationInterval);
                    // الاختيار النهائي
                    currentStudent = students[Math.floor(Math.random() * students.length)];
                    document.getElementById('studentName').textContent = currentStudent;
                    
                    // تأثيرات بصرية
                    const studentElement = document.getElementById('studentName');
                    studentElement.style.animation = 'glow 1s ease';
                    setTimeout(() => {
                        studentElement.style.animation = '';
                    }, 1000);
                }
            }, 100);
            
            return currentStudent;
        }

        function startNewGame() {
            if (!selectedClass) {
                notificationSystem.show('يرجى اختيار الصف أولاً', 'warning');
                showClassSelection();
                return;
            }

            // اختيار طالب عشوائي مع تأثيرات
            selectRandomStudent();
            
            // بدء اللعبة
            gameActive = true;
            timeLeft = parseInt(document.getElementById('timerDuration').value);
            
            document.getElementById('timerText').textContent = timeLeft;
            document.getElementById('gameStatusText').textContent = 'اللعبة نشطة - أجب لإبطال القنبلة!';
            document.getElementById('playBtn').disabled = true;
            document.getElementById('defuseBtn').disabled = false;
            
            // تأثيرات بصرية لبداية اللعبة
            const bombVisual = document.querySelector('.bomb-visual');
            bombVisual.style.animation = 'bombPulse 1s ease-in-out infinite';
            
            startTimer();
            notificationSystem.show('بدأت اللعبة! الطالب: ' + currentStudent, 'info');
        }

        function startTimer() {
            updateTimerProgress();
            
            currentTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timerText').textContent = timeLeft;
                updateTimerProgress();
                
                // تأثيرات التحذير
                if (timeLeft === 10) {
                    notificationSystem.show('⚠️ 10 ثوانٍ متبقية!', 'warning');
                    document.querySelector('.bomb-visual').style.animation = 'bombPulse 0.5s ease-in-out infinite';
                } else if (timeLeft === 5) {
                    notificationSystem.show('⚠️ 5 ثوانٍ متبقية!', 'danger');
                    document.querySelector('.bomb-visual').style.animation = 'bombPulse 0.3s ease-in-out infinite';
                } else if (timeLeft <= 3) {
                    document.querySelector('.timer-text').style.color = '#dc3545';
                    document.querySelector('.timer-text').style.animation = 'pulse 0.5s infinite';
                }

                if (timeLeft <= 0) {
                    explodeBomb();
                }
            }, 1000);
        }

        // تحديث شريط التقدم مع تأثيرات
        function updateTimerProgress() {
            const totalTime = parseInt(document.getElementById('timerDuration').value);
            const progress = (timeLeft / totalTime) * 692;
            const progressElement = document.getElementById('timerProgress');
            
            progressElement.style.strokeDashoffset = 692 - progress;
            
            // تغيير اللون حسب الوقت المتبقي
            if (timeLeft <= 5) {
                progressElement.style.stroke = '#dc3545';
            } else if (timeLeft <= 10) {
                progressElement.style.stroke = '#ffc107';
            } else {
                progressElement.style.stroke = 'var(--accent-gold)';
            }
        }

        // إبطال القنبلة مع تأثيرات احتفالية
        function defuseBomb() {
            if (!gameActive) return;
            
            gameActive = false;
            clearInterval(currentTimer);
            
            document.getElementById('gameStatusText').textContent = 'تم إبطال القنبلة! إجابة ممتازة!';
            document.getElementById('playBtn').disabled = false;
            document.getElementById('defuseBtn').disabled = true;
            
            // تأثيرات النجاح
            document.querySelector('.timer-progress').style.stroke = '#28a745';
            document.querySelector('.bomb-visual').style.animation = 'none';
            document.querySelector('.timer-text').style.color = '#28a745';
            document.querySelector('.timer-text').style.animation = 'glow 2s ease';
            
            notificationSystem.show(`ممتاز ${currentStudent}! تم إبطال القنبلة بنجاح!`, 'success');
            
            // كونفيتي احتفالي
            if (typeof confetti !== 'undefined') {
                confetti({
                    particleCount: 150,
                    spread: 80,
                    origin: { y: 0.6 },
                    colors: ['#28a745', '#ffc107', '#17a2b8']
                });
                
                // موجة ثانية من الكونفيتي
                setTimeout(() => {
                    confetti({
                        particleCount: 100,
                        spread: 120,
                        origin: { y: 0.7 },
                        colors: ['#fd7e14', '#dc3545', '#6f42c1']
                    });
                }, 500);
            }
        }

        // انفجار القنبلة مع تأثيرات درامية
        function explodeBomb() {
            gameActive = false;
            clearInterval(currentTimer);
            
            document.getElementById('gameStatusText').textContent = '💥 انفجرت القنبلة! حاول مرة أخرى';
            document.getElementById('playBtn').disabled = false;
            document.getElementById('defuseBtn').disabled = true;
            
            // تأثيرات الانفجار
            document.querySelector('.timer-progress').style.stroke = '#dc3545';
            document.querySelector('.bomb-visual').style.animation = 'none';
            document.querySelector('.bomb-visual').textContent = '💥';
            document.querySelector('.timer-text').style.color = '#dc3545';
            
            notificationSystem.show(`انتهى الوقت! لا بأس ${currentStudent}، حاول مرة أخرى`, 'danger');
            
            // تأثير اهتزاز للشاشة
            document.body.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => {
                document.body.style.animation = '';
                document.querySelector('.bomb-visual').textContent = '💣';
            }, 500);
        }

        // إضافة المزيد من التأثيرات والتحسينات
        
        // إعادة تعيين اللعبة مع تأثيرات
        function resetGame() {
            gameActive = false;
            if (currentTimer) clearInterval(currentTimer);
            
            timeLeft = parseInt(document.getElementById('timerDuration').value);
            document.getElementById('timerText').textContent = timeLeft;
            document.getElementById('gameStatusText').textContent = 'في انتظار بدء اللعبة';
            
            if (selectedClass) {
                document.getElementById('studentName').textContent = 'اضغط "بدء اللعبة" لاختيار طالب';
                document.getElementById('playBtn').disabled = false;
            } else {
                document.getElementById('studentName').textContent = 'اختر صفاً لبدء اللعبة';
                document.getElementById('playBtn').disabled = true;
            }
            
            document.getElementById('defuseBtn').disabled = true;
            
            // إعادة تعيين التأثيرات البصرية
            document.querySelector('.timer-progress').style.stroke = 'var(--accent-gold)';
            document.querySelector('.bomb-visual').style.animation = 'bombPulse 2s ease-in-out infinite';
            document.querySelector('.bomb-visual').textContent = '💣';
            document.querySelector('.timer-text').style.color = 'var(--accent-gold)';
            document.querySelector('.timer-text').style.animation = '';
            
            updateTimerProgress();
            notificationSystem.show('تم إعادة تعيين اللعبة', 'info');
        }

        // إعدادات الصوت والتحكم
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal.style.display === 'block') {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            } else {
                modal.style.display = 'block';
                modal.style.animation = 'fadeIn 0.3s ease';
            }
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // دالة لإضافة تأثيرات الأزرار
        function addButtonEffects() {
            document.querySelectorAll('.control-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // تأثير النقر
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });

                button.addEventListener('mouseenter', function() {
                    // تأثير التحويم
                    this.style.boxShadow = '0 15px 35px rgba(0, 0, 0, 0.4)';
                });

                button.addEventListener('mouseleave', function() {
                    // إزالة تأثير التحويم
                    this.style.boxShadow = '';
                });
            });
        }

        // إضافة تأثيرات الاهتزاز
        function addShakeEffect(element, duration = 500) {
            element.style.animation = `shake ${duration}ms ease-in-out`;
            setTimeout(() => {
                element.style.animation = '';
            }, duration);
        }

        // إضافة تأثيرات التوهج
        function addGlowEffect(element, duration = 1000) {
            element.style.animation = `glow ${duration}ms ease-in-out`;
            setTimeout(() => {
                element.style.animation = '';
            }, duration);
        }

        // دالة لتحديث الوقت في الوقت الفعلي
        function updateTimerDisplay() {
            const input = document.getElementById('timerDuration');
            const newTime = parseInt(input.value);
            
            if (!gameActive) {
                timeLeft = newTime;
                document.getElementById('timerText').textContent = timeLeft;
                updateTimerProgress();
            }
        }

        // دالة لإضافة اختصارات لوحة المفاتيح المتقدمة
        function setupAdvancedKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                // منع التشغيل إذا كان المستخدم يكتب في حقل نص
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    return;
                }

                switch(event.code) {
                    case 'Space':
                        event.preventDefault();
                        if (gameActive) {
                            defuseBomb();
                        } else if (selectedClass) {
                            startNewGame();
                        }
                        break;
                    
                    case 'Enter':
                        event.preventDefault();
                        if (!gameActive && selectedClass) {
                            startNewGame();
                        }
                        break;
                    
                    case 'Escape':
                        event.preventDefault();
                        resetGame();
                        break;
                    
                    case 'KeyC':
                        if (event.ctrlKey) {
                            event.preventDefault();
                            showClassSelection();
                        }
                        break;
                    
                    case 'KeyS':
                        if (event.ctrlKey) {
                            event.preventDefault();
                            toggleSettings();
                        }
                        break;
                    
                    case 'KeyR':
                        if (event.ctrlKey) {
                            event.preventDefault();
                            resetGame();
                        }
                        break;
                }
            });
        }

        // إغلاق النوافذ عند النقر خارجها
        window.onclick = function(event) {
            const classModal = document.getElementById('classModal');
            const settingsModal = document.getElementById('settingsModal');
            
            if (event.target === classModal) {
                closeClassModal();
            }
            if (event.target === settingsModal) {
                closeSettingsModal();
            }
        }

        // تهيئة اللعبة مع جميع التحسينات
        document.addEventListener('DOMContentLoaded', function() {
            notificationSystem = new SimpleNotificationSystem();
            
            // إعداد تأثيرات الأزرار
            addButtonEffects();
            
            // إعداد اختصارات لوحة المفاتيح المتقدمة
            setupAdvancedKeyboardShortcuts();
            
            // ربط تحديث الوقت بحقل الإدخال
            document.getElementById('timerDuration').addEventListener('input', updateTimerDisplay);
            
            // إعداد اللعبة
            resetGame();
            
            // رسالة ترحيب
            setTimeout(() => {
                notificationSystem.show('🎮 مرحباً بك في لعبة القنبلة المؤقتة الاحترافية!', 'info');
            }, 1000);
            
            console.log('🎮 لعبة القنبلة الذكية جاهزة بتصميم احترافي!');
            console.log('⌨️ اختصارات المفاتيح:');
            console.log('   Space: بدء/إبطال القنبلة');
            console.log('   Enter: بدء لعبة جديدة');
            console.log('   Escape: إعادة تعيين');
            console.log('   Ctrl+C: اختيار الصف');
            console.log('   Ctrl+S: الإعدادات');
            console.log('   Ctrl+R: إعادة تعيين');
        });
    </script>
</body>
</html>
