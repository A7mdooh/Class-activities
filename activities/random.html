<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#00796B"/>
  <meta name="description" content="نشاط الاختيار العشوائي للطلاب - مدرسة أبو القاسم الزهراوي"/>
  <meta name="keywords" content="اختيار عشوائي, طلاب, تفاعلي, تعليم, مدرسة, عُمان"/>
  <meta name="author" content="الأستاذ أحمد بن عبدالله الضامري"/>

  <title>الاسم العشوائي - الأنشطة الصفية</title>

  <!-- الخطوط والأيقونات -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- فافيكون -->
  <link rel="icon" type="image/png" href="../assets/media/images/school-logo.png">

  <style>
    :root {
      /* نظام ألوان عُماني متطور */
      --primary-color: #00796B;
      --primary-light: #4DB6AC;
      --primary-dark: #004D40;
      --secondary-color: #FF5722;
      --accent-color: #FFD700;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --error-color: #F44336;
      --text-primary: #212121;
      --text-secondary: #757575;
      --background-light: #FAFAFA;
      --surface-color: #FFFFFF;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.2);
      --shadow-dark: rgba(0, 0, 0, 0.3);

      /* متغيرات التخطيط */
      --border-radius: 16px;
      --border-radius-small: 8px;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;

      /* الانتقالات */
      --transition-fast: 0.2s ease-out;
      --transition-normal: 0.3s ease-out;
      --transition-slow: 0.5s ease-out;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg,
        #e0f7fa 0%,
        #b2dfdb 25%,
        #80cbc4 50%,
        #4db6ac 75%,
        #26a69a 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* خلفية متحركة */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 121, 107, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 60%, rgba(255, 87, 34, 0.1) 0%, transparent 50%);
      animation: backgroundShift 20s ease-in-out infinite;
      z-index: -1;
    }

    @keyframes backgroundShift {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(-20px, 20px) rotate(1deg); }
      50% { transform: translate(20px, -20px) rotate(-1deg); }
      75% { transform: translate(-10px, -10px) rotate(0.5deg); }
    }

    /* أزرار التحكم */
    .control-buttons {
      position: fixed;
      top: var(--spacing-md);
      display: flex;
      gap: var(--spacing-sm);
      z-index: 1000;
    }

    .control-buttons.left {
      left: var(--spacing-md);
    }

    .control-buttons.right {
      right: var(--spacing-md);
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-color);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-medium);
      transition: all var(--transition-normal);
      backdrop-filter: blur(10px);
    }

    .control-btn:hover {
      transform: translateY(-3px) scale(1.05);
      background: var(--primary-color);
      color: white;
      box-shadow: 0 8px 20px var(--shadow-dark);
    }

    .control-btn:active {
      transform: translateY(0) scale(0.95);
    }

    /* الحاوي الرئيسي */
    .main-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: var(--spacing-xl) var(--spacing-lg);
      position: relative;
      z-index: 10;
    }

    /* رأس الصفحة */
    .header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      animation: slideDown 0.8s ease-out;
    }

    .header-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .header-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
    }

    .header-title {
      font-size: clamp(2rem, 5vw, 2.5rem);
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--primary-color);
      text-shadow: 2px 2px 4px var(--shadow-light);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .header-subtitle {
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: var(--text-secondary);
      font-weight: 400;
      line-height: 1.5;
    }

    /* اختيار الصف */
    .class-selector {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 4px 20px var(--shadow-light);
      backdrop-filter: blur(10px);
      animation: slideUp 0.8s ease-out 0.2s both;
    }

    .class-selector h3 {
      font-size: 1.3rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-md);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .class-select {
      width: 100%;
      padding: var(--spacing-md);
      border: 2px solid rgba(0, 121, 107, 0.2);
      border-radius: var(--border-radius-small);
      font-size: 1.1rem;
      background: var(--surface-color);
      color: var(--text-primary);
      transition: all var(--transition-normal);
      font-family: 'Cairo', sans-serif;
      text-align: center;
    }

    .class-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 121, 107, 0.1);
      transform: scale(1.02);
    }

    /* منطقة عرض النتيجة */
    .result-display {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 8px 32px var(--shadow-medium);
      backdrop-filter: blur(15px);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.8s ease-out 0.4s both;
    }

    .result-display::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, 
        transparent 30%, 
        rgba(255, 215, 0, 0.1) 50%, 
        transparent 70%);
      animation: shimmer 4s infinite;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .rolling-animation {
      position: relative;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .rolling-names {
      position: absolute;
      font-size: clamp(1.5rem, 5vw, 2.5rem);
      font-weight: 600;
      color: var(--secondary-color);
      opacity: 0.7;
      animation: roll 0.1s infinite;
    }

    @keyframes roll {
      0% { transform: translateY(-30px); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: translateY(30px); opacity: 0; }
    }

    .selected-name {
      font-size: clamp(2rem, 7vw, 3.5rem);
      font-weight: 700;
      color: var(--primary-color);
      text-shadow: 3px 3px 6px var(--shadow-medium);
      z-index: 10;
      position: relative;
      text-align: center;
      animation: nameAppear 0.8s ease-out;
    }

    @keyframes nameAppear {
      0% { 
        opacity: 0; 
        transform: scale(0.5) rotate(-10deg); 
      }
      50% { 
        transform: scale(1.1) rotate(5deg); 
      }
      100% { 
        opacity: 1; 
        transform: scale(1) rotate(0deg); 
      }
    }

    .welcome-message {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      color: var(--text-secondary);
      text-align: center;
      line-height: 1.6;
      animation: fadeIn 1s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* أزرار التحكم الرئيسية */
    .main-controls {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      justify-content: center;
      margin-bottom: var(--spacing-xl);
      animation: slideUp 0.8s ease-out 0.6s both;
    }

    .main-btn {
      padding: var(--spacing-md) var(--spacing-xl);
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 600;
      border: none;
      border-radius: var(--border-radius-small);
      cursor: pointer;
      transition: all var(--transition-normal);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      min-width: 140px;
      justify-content: center;
      box-shadow: 0 4px 12px var(--shadow-light);
      font-family: 'Cairo', sans-serif;
    }

    .main-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .start-btn {
      background: linear-gradient(45deg, var(--success-color), #66BB6A);
      color: white;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
    }

    .stop-btn {
      background: linear-gradient(45deg, var(--error-color), #EF5350);
      color: white;
    }

    .stop-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
    }

    .remove-btn {
      background: linear-gradient(45deg, var(--warning-color), #FFB74D);
      color: white;
    }

    .remove-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
    }

    .reset-btn {
      background: linear-gradient(45deg, var(--text-secondary), #9E9E9E);
      color: white;
    }

    .reset-btn:hover:not(:disabled) {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(158, 158, 158, 0.4);
    }

    /* إعدادات الاختيار */
    .settings-panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      box-shadow: 0 4px 20px var(--shadow-light);
      backdrop-filter: blur(10px);
      animation: slideUp 0.8s ease-out 0.8s both;
    }

    .settings-panel h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-md);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }

    .setting-item {
      text-align: center;
    }

    .setting-label {
      display: block;
      margin-bottom: var(--spacing-sm);
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 0.9rem;
    }

    .speed-slider {
      width: 100%;
      -webkit-appearance: none;
      appearance: none;
      height: 8px;
      background: linear-gradient(to right, var(--error-color), var(--warning-color), var(--success-color));
      border-radius: var(--border-radius-small);
      outline: none;
      transition: all var(--transition-normal);
    }

    .speed-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px var(--shadow-medium);
      transition: all var(--transition-fast);
    }

    .speed-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 4px 12px var(--shadow-dark);
    }

    .speed-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px var(--shadow-medium);
      transition: all var(--transition-fast);
    }

    .speed-value {
      margin-top: var(--spacing-sm);
      font-weight: 600;
      color: var(--primary-color);
      font-size: 0.9rem;
    }

    /* معلومات الطلاب */
    .student-info {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius);
      padding: var(--spacing-lg);
      box-shadow: 0 4px 20px var(--shadow-light);
      backdrop-filter: blur(10px);
      animation: slideUp 0.8s ease-out 1s both;
    }

    .student-info h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: var(--spacing-md);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .student-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: var(--spacing-md);
      text-align: center;
    }

    .stat-item {
      background: linear-gradient(135deg, rgba(0, 121, 107, 0.1), rgba(77, 182, 172, 0.1));
      padding: var(--spacing-md);
      border-radius: var(--border-radius-small);
      border: 2px solid rgba(0, 121, 107, 0.2);
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: var(--spacing-xs);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* تأثيرات الحركة */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* التجاوب مع الشاشات المختلفة */
    @media (max-width: 768px) {
      .main-container {
        padding: var(--spacing-lg) var(--spacing-md);
      }
      
      .main-controls {
        flex-direction: column;
        align-items: center;
      }
      
      .main-btn {
        width: 100%;
        max-width: 300px;
      }
      
      .control-btn {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }
      
      .settings-grid {
        grid-template-columns: 1fr;
      }
      
      .student-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .header-card {
        padding: var(--spacing-lg);
      }
      
      .result-display {
        padding: var(--spacing-lg);
        min-height: 250px;
      }
      
      .student-stats {
        grid-template-columns: 1fr;
      }
    }

    /* تحسينات إضافية للأداء */
    .main-btn,
    .control-btn {
      will-change: transform;
    }

    /* تأثيرات التركيز للوصولية */
    .main-btn:focus,
    .control-btn:focus,
    .class-select:focus,
    .speed-slider:focus {
      outline: 3px solid rgba(0, 121, 107, 0.5);
      outline-offset: 2px;
    }

    /* تأثير النقر */
    .click-effect {
      position: relative;
      overflow: hidden;
    }

    .click-effect::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(0, 121, 107, 0.3);
      transform: translate(-50%, -50%);
      animation: ripple 0.6s ease-out;
    }

    @keyframes ripple {
      to {
        width: 300px;
        height: 300px;
        opacity: 0;
      }
    }

    /* حالات خاصة */
    .pulsing {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .celebration {
      animation: celebrate 1s ease-out;
    }

    @keyframes celebrate {
      0% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      50% { transform: scale(1.2) rotate(5deg); }
      75% { transform: scale(1.1) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
  </style>
</head>

<body>
  <!-- أزرار التحكم -->
  <div class="control-buttons right">
    <button class="control-btn" id="backBtn" title="العودة للقائمة الرئيسية" aria-label="العودة للقائمة الرئيسية">
      🏠
    </button>
  </div>

  <div class="control-buttons left">
    <button class="control-btn" id="fullscreenBtn" title="ملء الشاشة" aria-label="ملء الشاشة">
      ⛶
    </button>
  </div>

  <!-- المحتوى الرئيسي -->
  <div class="main-container">
    <!-- رأس الصفحة -->
    <header class="header">
      <div class="header-card">
        <h1 class="header-title">
          <span>🎯</span>
          <span>الاختيار العشوائي للطلاب</span>
        </h1>
        <p class="header-subtitle">
          اختر طالباً بشكل عشوائي وعادل لبدء المشاركة أو تنفيذ النشاط الصفي
        </p>
      </div>
    </header>

    <!-- اختيار الصف -->
    <div class="class-selector">
      <h3>
        <span>🎓</span>
        <span>اختر الصف الدراسي</span>
      </h3>
      <select class="class-select" id="classSelect">
        <option value="">-- اختر الصف --</option>
      </select>
    </div>

    <!-- منطقة عرض النتيجة -->
    <div class="result-display" id="resultDisplay">
      <div class="rolling-animation" id="rollingAnimation">
        <div class="welcome-message" id="welcomeMessage">
          👋 مرحباً بك في نشاط الاختيار العشوائي<br>
          اختر الصف الدراسي أولاً لبدء المتعة!
        </div>
      </div>
    </div>

    <!-- أزرار التحكم الرئيسية -->
    <div class="main-controls">
      <button class="main-btn start-btn" id="startBtn" disabled>
        <span>🚀</span>
        <span>ابدأ الاختيار</span>
      </button>
      <button class="main-btn stop-btn" id="stopBtn" disabled>
        <span>⏹️</span>
        <span>توقف</span>
      </button>
      <button class="main-btn remove-btn" id="removeBtn" disabled>
        <span>❌</span>
        <span>استبعاد الطالب</span>
      </button>
      <button class="main-btn reset-btn" id="resetBtn" disabled>
        <span>🔄</span>
        <span>إعادة تعيين</span>
      </button>
    </div>

    <!-- إعدادات الاختيار -->
    <div class="settings-panel">
      <h3>
        <span>⚙️</span>
        <span>إعدادات الاختيار</span>
      </h3>
      <div class="settings-grid">
        <div class="setting-item">
          <label class="setting-label" for="speedSlider">سرعة التدوير</label>
          <input type="range" id="speedSlider" class="speed-slider" min="50" max="300" value="150">
          <div class="speed-value" id="speedValue">متوسط</div>
        </div>
        <div class="setting-item">
          <label class="setting-label" for="durationSlider">مدة التدوير</label>
          <input type="range" id="durationSlider" class="speed-slider" min="1" max="10" value="3">
          <div class="speed-value" id="durationValue">3 ثوان</div>
        </div>
      </div>
    </div>

    <!-- معلومات الطلاب -->
    <div class="student-info" id="studentInfo" style="display: none;">
      <h3>
        <span>📊</span>
        <span>إحصائيات الطلاب</span>
      </h3>
      <div class="student-stats">
        <div class="stat-item">
          <div class="stat-number" id="totalStudents">0</div>
          <div class="stat-label">إجمالي الطلاب</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="remainingStudents">0</div>
          <div class="stat-label">طلاب متبقون</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="selectedCount">0</div>
          <div class="stat-label">تم اختيارهم</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="removedCount">0</div>
          <div class="stat-label">تم استبعادهم</div>
        </div>
      </div>
    </div>
  </div>

  <!-- الأصوات -->
  <audio id="rollingSound" src="../assets/media/sounds/name-start.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="selectSound" src="../assets/media/sounds/name-stop.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="clickSound" src="../assets/media/sounds/Click.mp3" preload="auto" aria-hidden="true"></audio>
  <audio id="celebrationSound" src="../assets/media/sounds/clap.mp3" preload="auto" aria-hidden="true"></audio>

  <script>
    console.log('🎯 بدء تحميل نشاط الاختيار العشوائي...');

    // متغيرات النشاط
    let currentStudents = [];
    let availableStudents = [];
    let removedStudents = [];
    let selectedStudents = [];
    let isRolling = false;
    let rollingInterval = null;
    let currentSelectedName = '';
    let rollingSpeed = 150;
    let rollingDuration = 3000;

    // عناصر DOM
    const elements = {
      classSelect: document.getElementById('classSelect'),
      resultDisplay: document.getElementById('resultDisplay'),
      rollingAnimation: document.getElementById('rollingAnimation'),
      welcomeMessage: document.getElementById('welcomeMessage'),
      startBtn: document.getElementById('startBtn'),
      stopBtn: document.getElementById('stopBtn'),
      removeBtn: document.getElementById('removeBtn'),
      resetBtn: document.getElementById('resetBtn'),
      speedSlider: document.getElementById('speedSlider'),
      durationSlider: document.getElementById('durationSlider'),
      speedValue: document.getElementById('speedValue'),
      durationValue: document.getElementById('durationValue'),
      studentInfo: document.getElementById('studentInfo'),
      totalStudents: document.getElementById('totalStudents'),
      remainingStudents: document.getElementById('remainingStudents'),
      selectedCount: document.getElementById('selectedCount'),
      removedCount: document.getElementById('removedCount'),
      backBtn: document.getElementById('backBtn'),
      fullscreenBtn: document.getElementById('fullscreenBtn'),
      rollingSound: document.getElementById('rollingSound'),
      selectSound: document.getElementById('selectSound'),
      clickSound: document.getElementById('clickSound'),
      celebrationSound: document.getElementById('celebrationSound')
    };

    // تشغيل الصوت مع معالجة الأخطاء
    function playSound(soundElement) {
      try {
        if (soundElement && soundElement.readyState >= 2) {
          soundElement.currentTime = 0;
          const playPromise = soundElement.play();
          if (playPromise !== undefined) {
            playPromise.catch(() => {
              console.log('🔇 تعذر تشغيل الصوت (يتطلب تفاعل المستخدم)');
            });
          }
        }
      } catch (error) {
        console.log('🔇 خطأ في تشغيل الصوت:', error);
      }
    }

    // تأثيرات بصرية للنقر
    function addClickEffect(element) {
      element.style.transform = 'scale(0.95)';
      setTimeout(() => {
        element.style.transform = '';
      }, 150);
    }

    // وظيفة ملء الشاشة
    async function toggleFullScreen() {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
          console.log('🖥️ تم تفعيل ملء الشاشة');
        } else {
          await document.exitFullscreen();
          console.log('🖥️ تم إلغاء ملء الشاشة');
        }
      } catch (error) {
        console.warn('⚠️ فشل في تغيير وضع ملء الشاشة:', error);
      }
    }

    // تحميل بيانات الطلاب
    async function loadStudentData() {
      try {
        console.log('📚 جاري تحميل بيانات الطلاب...');
        const response = await fetch('../data/studentData.json');
        
        if (!response.ok) {
          throw new Error('فشل في تحميل بيانات الطلاب');
        }
        
        const data = await response.json();
        console.log('✅ تم تحميل بيانات الطلاب:', data);
        
        // تعبئة قائمة الصفوف من البنية الجديدة
        if (data && typeof data === 'object') {
          Object.keys(data).forEach(className => {
            if (Array.isArray(data[className]) && data[className].length > 0) {
              const option = document.createElement('option');
              option.value = className;
              option.textContent = `الصف ${className}`;
              elements.classSelect.appendChild(option);
            }
          });
        }
        
        return data;
        
      } catch (error) {
        console.error('❌ خطأ في تحميل بيانات الطلاب:', error);
        // إنشاء بيانات تجريبية
        createDemoData();
        return null;
      }
    }

    // إنشاء بيانات تجريبية
    function createDemoData() {
      console.log('🎭 إنشاء بيانات تجريبية...');
      
      const demoData = {
        'الخامس أ': ['أحمد محمد', 'فاطمة علي', 'يوسف سالم', 'مريم خالد', 'عبدالله سعيد', 'نور الدين', 'هند عبدالله', 'محمد يوسف'],
        'الخامس ب': ['سارة أحمد', 'علي محمد', 'لينا سالم', 'حمزة علي', 'زينب محمد', 'عمر خالد', 'ريم سعيد', 'خالد أحمد'],
        'السادس أ': ['منى علي', 'محمود سالم', 'دينا محمد', 'طارق أحمد', 'ريما خالد', 'سلطان علي', 'نوال محمد', 'فيصل سعيد']
      };

      Object.keys(demoData).forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = `الصف ${className}`;
        elements.classSelect.appendChild(option);
      });

      // حفظ البيانات التجريبية
      window.demoStudentData = demoData;
    }

    // تحديث قائمة الطلاب عند تغيير الصف
    async function updateStudentList(className) {
      if (!className) {
        currentStudents = [];
        availableStudents = [];
        resetActivity();
        return;
      }

      try {
        let studentData = null;
        
        // محاولة تحميل البيانات الحقيقية
        try {
          const response = await fetch('../data/studentData.json');
          if (response.ok) {
            studentData = await response.json();
          }
        } catch (error) {
          console.log('استخدام البيانات التجريبية');
        }
        
        // استخدام البيانات التجريبية إذا لم تتوفر البيانات الحقيقية
        if (!studentData && window.demoStudentData) {
          studentData = window.demoStudentData;
        }
        
        if (studentData) {
          // التعامل مع البنية الجديدة للبيانات
          let studentsArray = null;
          
          if (studentData[className] && Array.isArray(studentData[className])) {
            // البنية الجديدة: مفتاح مباشر للصف
            studentsArray = studentData[className];
          } else if (studentData.classes) {
            // البنية القديمة: classes array (للبيانات التجريبية القديمة)
            const selectedClass = studentData.classes.find(cls => cls.className === className);
            if (selectedClass && selectedClass.students) {
              studentsArray = selectedClass.students;
            }
          }
          
          if (studentsArray && studentsArray.length > 0) {
            currentStudents = [...studentsArray];
            availableStudents = [...studentsArray];
            removedStudents = [];
            selectedStudents = [];
            
            updateUI();
            updateStats();
            showStudentInfo();
            
            console.log(`✅ تم تحميل ${currentStudents.length} طالب من الصف ${className}`);
          } else {
            console.warn(`⚠️ لم يتم العثور على طلاب في الصف ${className}`);
            alert(`⚠️ لم يتم العثور على طلاب في الصف ${className}!`);
          }
        }
        
      } catch (error) {
        console.error('❌ خطأ في تحديث قائمة الطلاب:', error);
      }
    }

    // تحديث واجهة المستخدم
    function updateUI() {
      const hasStudents = availableStudents.length > 0;
      
      elements.startBtn.disabled = !hasStudents || isRolling;
      elements.stopBtn.disabled = !isRolling;
      elements.removeBtn.disabled = !currentSelectedName || isRolling;
      elements.resetBtn.disabled = currentStudents.length === 0;
      
      if (hasStudents && !currentSelectedName) {
        showWelcomeMessage();
      }
    }

    // عرض رسالة الترحيب
    function showWelcomeMessage() {
      elements.rollingAnimation.innerHTML = `
        <div class="welcome-message">
          🎯 الصف محدد ونحن جاهزون!<br>
          ${availableStudents.length} طالب متاح للاختيار
        </div>
      `;
    }

    // بدء عملية الاختيار العشوائي
    function startSelection() {
      if (availableStudents.length === 0) {
        alert('⚠️ لا يوجد طلاب متاحون للاختيار!');
        return;
      }

      isRolling = true;
      currentSelectedName = '';
      updateUI();
      
      playSound(elements.rollingSound);
      
      // إزالة أي محتوى سابق
      elements.rollingAnimation.innerHTML = '';
      
      // إنشاء عنصر التدوير
      const rollingElement = document.createElement('div');
      rollingElement.className = 'rolling-names';
      elements.rollingAnimation.appendChild(rollingElement);
      
      // بدء التدوير
      rollingInterval = setInterval(() => {
        const randomIndex = Math.floor(Math.random() * availableStudents.length);
        rollingElement.textContent = availableStudents[randomIndex];
      }, rollingSpeed);
      
      // إيقاف التدوير بعد المدة المحددة
      setTimeout(() => {
        if (isRolling) {
          stopSelection();
        }
      }, rollingDuration);
      
      console.log('🎲 بدء عملية الاختيار العشوائي');
    }

    // إيقاف عملية الاختيار
    function stopSelection() {
      if (!isRolling || availableStudents.length === 0) return;
      
      clearInterval(rollingInterval);
      isRolling = false;
      
      // اختيار طالب عشوائي نهائي
      const randomIndex = Math.floor(Math.random() * availableStudents.length);
      currentSelectedName = availableStudents[randomIndex];
      
      // إضافة إلى قائمة المختارين
      selectedStudents.push(currentSelectedName);
      
      // عرض النتيجة
      showSelectedName(currentSelectedName);
      
      playSound(elements.selectSound);
      setTimeout(() => {
        playSound(elements.celebrationSound);
      }, 500);
      
      updateUI();
      updateStats();
      
      console.log(`✅ تم اختيار: ${currentSelectedName}`);
    }

    // عرض الاسم المختار
    function showSelectedName(name) {
      elements.rollingAnimation.innerHTML = `
        <div class="selected-name celebration">
          🎉 ${name} 🎉
        </div>
      `;
      
      // إضافة تأثير الاحتفال
      elements.resultDisplay.classList.add('pulsing');
      setTimeout(() => {
        elements.resultDisplay.classList.remove('pulsing');
      }, 2000);
    }

    // استبعاد الطالب المختار
    function removeSelectedStudent() {
      if (!currentSelectedName) return;
      
      // إضافة إلى قائمة المستبعدين
      removedStudents.push(currentSelectedName);
      
      // إزالة من قائمة المتاحين
      const index = availableStudents.indexOf(currentSelectedName);
      if (index > -1) {
        availableStudents.splice(index, 1);
      }
      
      // إزالة من قائمة المختارين
      const selectedIndex = selectedStudents.indexOf(currentSelectedName);
      if (selectedIndex > -1) {
        selectedStudents.splice(selectedIndex, 1);
      }
      
      currentSelectedName = '';
      
      if (availableStudents.length > 0) {
        showWelcomeMessage();
      } else {
        elements.rollingAnimation.innerHTML = `
          <div class="welcome-message">
            🏁 تم استبعاد جميع الطلاب!<br>
            استخدم زر "إعادة تعيين" لبدء من جديد
          </div>
        `;
      }
      
      updateUI();
      updateStats();
      
      console.log(`❌ تم استبعاد: ${removedStudents[removedStudents.length - 1]}`);
    }

    // إعادة تعيين النشاط
    function resetActivity() {
      clearInterval(rollingInterval);
      isRolling = false;
      currentSelectedName = '';
      
      if (currentStudents.length > 0) {
        availableStudents = [...currentStudents];
        removedStudents = [];
        selectedStudents = [];
        showWelcomeMessage();
        showStudentInfo();
      } else {
        hideStudentInfo();
        elements.rollingAnimation.innerHTML = `
          <div class="welcome-message">
            👋 مرحباً بك في نشاط الاختيار العشوائي<br>
            اختر الصف الدراسي أولاً لبدء المتعة!
          </div>
        `;
      }
      
      updateUI();
      updateStats();
      
      console.log('🔄 تم إعادة تعيين النشاط');
    }

    // تحديث الإحصائيات
    function updateStats() {
      elements.totalStudents.textContent = currentStudents.length;
      elements.remainingStudents.textContent = availableStudents.length;
      elements.selectedCount.textContent = selectedStudents.length;
      elements.removedCount.textContent = removedStudents.length;
    }

    // إظهار معلومات الطلاب
    function showStudentInfo() {
      elements.studentInfo.style.display = 'block';
    }

    // إخفاء معلومات الطلاب
    function hideStudentInfo() {
      elements.studentInfo.style.display = 'none';
    }

    // تحديث إعدادات السرعة
    function updateSpeedSettings() {
      rollingSpeed = parseInt(elements.speedSlider.value);
      rollingDuration = parseInt(elements.durationSlider.value) * 1000;
      
      // تحديث النصوص
      const speedLabels = {
        50: 'سريع جداً',
        100: 'سريع',
        150: 'متوسط',
        200: 'بطيء',
        250: 'بطيء جداً',
        300: 'بطيء للغاية'
      };
      
      const closestSpeed = Object.keys(speedLabels).reduce((prev, curr) => 
        Math.abs(curr - rollingSpeed) < Math.abs(prev - rollingSpeed) ? curr : prev
      );
      
      elements.speedValue.textContent = speedLabels[closestSpeed];
      elements.durationValue.textContent = `${rollingDuration / 1000} ثوان`;
    }

    // تهيئة النشاط
    async function initializeActivity() {
      console.log('⚡ جاري تهيئة نشاط الاختيار العشوائي...');
      
      await loadStudentData();
      updateSpeedSettings();
      updateUI();
      
      console.log('🎉 تم تحميل النشاط بنجاح!');
    }

    // معالجة الأحداث
    document.addEventListener('DOMContentLoaded', () => {
      console.log('📄 تم تحميل DOM - بدء تهيئة الأحداث...');
      
      // تهيئة النشاط
      initializeActivity();

      // اختيار الصف
      elements.classSelect.addEventListener('change', (e) => {
        console.log(`🎓 تم اختيار الصف: ${e.target.value}`);
        updateStudentList(e.target.value);
      });

      // أزرار التحكم الرئيسية
      elements.startBtn.addEventListener('click', (e) => {
        console.log('🚀 تم النقر على زر البدء');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        startSelection();
      });

      elements.stopBtn.addEventListener('click', (e) => {
        console.log('⏹️ تم النقر على زر التوقف');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        stopSelection();
      });

      elements.removeBtn.addEventListener('click', (e) => {
        console.log('❌ تم النقر على زر الاستبعاد');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        
        if (confirm(`هل تريد استبعاد "${currentSelectedName}" من القائمة؟`)) {
          removeSelectedStudent();
        }
      });

      elements.resetBtn.addEventListener('click', (e) => {
        console.log('🔄 تم النقر على زر إعادة التعيين');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        
        if (confirm('هل تريد إعادة تعيين النشاط وإرجاع جميع الطلاب؟')) {
          resetActivity();
        }
      });

      // إعدادات السرعة والمدة
      elements.speedSlider.addEventListener('input', updateSpeedSettings);
      elements.durationSlider.addEventListener('input', updateSpeedSettings);

      // أزرار التحكم العلوية
      elements.fullscreenBtn.addEventListener('click', (e) => {
        console.log('🖥️ تم النقر على زر ملء الشاشة');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        toggleFullScreen();
      });

      elements.backBtn.addEventListener('click', (e) => {
        console.log('🏠 تم النقر على زر العودة');
        addClickEffect(e.target);
        playSound(elements.clickSound);
        
        // تأثير انتقال سلس
        document.body.style.opacity = '0';
        document.body.style.transform = 'scale(0.95)';
        
        setTimeout(() => {
          window.location.href = '../main.html';
        }, 300);
      });

      // اختصارات لوحة المفاتيح
      document.addEventListener('keydown', (e) => {
        switch(e.key) {
          case 'Enter':
          case ' ':
            if (!isRolling && !elements.startBtn.disabled) {
              e.preventDefault();
              elements.startBtn.click();
            } else if (isRolling) {
              e.preventDefault();
              elements.stopBtn.click();
            }
            break;
          case 'Escape':
            if (isRolling) {
              elements.stopBtn.click();
            } else if (document.fullscreenElement) {
              document.exitFullscreen();
            }
            break;
          case 'F11':
            e.preventDefault();
            toggleFullScreen();
            break;
          case 'r':
          case 'R':
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              elements.resetBtn.click();
            }
            break;
          case 'Delete':
          case 'Backspace':
            if (!isRolling && currentSelectedName) {
              e.preventDefault();
              elements.removeBtn.click();
            }
            break;
        }
      });

      console.log('✅ تم تهيئة جميع الأحداث بنجاح!');
    });

    // معالجة الأخطاء العامة
    window.addEventListener('error', (e) => {
      console.error('💥 خطأ عام في النشاط:', e.error);
    });

    window.addEventListener('unhandledrejection', (e) => {
      console.error('💥 خطأ غير معالج في Promise:', e.reason);
    });

    console.log('📝 تم تحميل جميع النصوص البرمجية للنشاط!');
  </script>
</body>
</html>
