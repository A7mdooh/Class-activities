<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>سباق المعرفة التفاعلي</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    body { background: linear-gradient(135deg, #23243a 0%, #18192b 100%); color: #FFD700; font-family: 'Cairo', sans-serif; }
    .main-container { max-width: 700px; margin: 40px auto; background: rgba(35,36,58,0.97); border-radius: 18px; box-shadow: 0 4px 32px #FFD70022; padding: 32px 24px; }
    .title { text-align: center; font-size: 2.2rem; font-weight: bold; color: #FFD700; margin-bottom: 18px; }
    .subtitle { text-align: center; color: #DC143C; font-size: 1.1rem; margin-bottom: 24px; }
    .select-row { display: flex; gap: 12px; margin-bottom: 18px; justify-content: center; }
    select, button { font-family: inherit; font-size: 1.1rem; border-radius: 10px; border: 2px solid #FFD70055; padding: 10px 18px; margin: 0 4px; }
    button { background: var(--gradient-gold, linear-gradient(90deg,#FFD700,#fffbe6 80%,#FFD700)); color: #23243a; font-weight: bold; cursor: pointer; transition: background .2s; }
    button:active { filter: brightness(0.95); }
    .student-list { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 18px; }
    .student-chip { background: #FFD70022; color: #FFD700; border-radius: 8px; padding: 8px 16px; font-weight: 700; cursor: pointer; border: 2px solid #FFD70055; transition: background .2s, color .2s; }
    .student-chip.selected, .student-chip:hover { background: #FFD700; color: #23243a; }
    .big-student { text-align: center; font-size: 2.1rem; font-weight: bold; color: #FFD700; margin: 24px 0 12px 0; }
    .scoreboard { margin: 24px auto 0 auto; max-width: 400px; background: #18192b; border-radius: 14px; padding: 18px; box-shadow: 0 2px 8px #FFD70022; }
    .score-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 1.1rem; }
    .score-row .name { font-weight: bold; }
    .score-row .score { color: #228B22; font-weight: bold; }
    .notif { text-align: center; background: linear-gradient(90deg,#FFD700,#DC143C); color: #23243a; font-size: 1.3rem; font-weight: 900; padding: 14px 32px; border-radius: 18px; box-shadow: 0 8px 32px #000a,0 0 24px #FFD70099; margin-bottom: 18px; display: none; }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="title">🏆 سباق المعرفة التفاعلي</div>
    <div class="subtitle">اختر الصف، ثم اختر طالبًا عشوائيًا أو يدويًا، واسأل سؤالًا شفويًا وقيّم الإجابة!</div>
    <div class="notif" id="notif"></div>
    <div class="select-row">
      <label for="classSelect">الصف:</label>
      <select id="classSelect"><option value="">— اختر الصف —</option></select>
      <button id="loadStudents">تحميل الطلاب</button>
    </div>
    <div class="student-list" id="studentList"></div>
    <div style="text-align:center; margin-bottom:18px;">
      <button id="randomPick" style="font-size:1.1rem;">اختيار عشوائي 👀</button>
    </div>
    <div class="big-student" id="currentStudent"></div>
    <div style="text-align:center; margin-bottom:18px;">
      <button id="correctBtn" style="background:linear-gradient(90deg,#228B22,#FFD700);color:#fff;">إجابة صحيحة ✅</button>
      <button id="wrongBtn" style="background:linear-gradient(90deg,#DC143C,#FFD700);color:#fff;">إجابة خاطئة ❌</button>
    </div>
    <div class="scoreboard" id="scoreboard"></div>
  </div>
  <script>
    let studentsData = {};
    let currentClass = null;
    let students = [];
    let scores = {};
    let picked = null;

    // تحميل بيانات الطلاب من JSON
    async function loadStudentsData() {
      try {
        const res = await fetch('../data/studentData.json');
        studentsData = await res.json();
      } catch {
        studentsData = { 'الصف الأول': ['طالب1','طالب2'], 'الصف الثاني': ['طالب3','طالب4'] };
      }
    }

    function showNotif(msg, color) {
      const n = document.getElementById('notif');
      n.textContent = msg;
      n.style.display = 'block';
      n.style.background = color || 'linear-gradient(90deg,#FFD700,#DC143C)';
      setTimeout(()=>{ n.style.display = 'none'; }, 2000);
    }

    function fillClassSelect() {
      const sel = document.getElementById('classSelect');
      sel.innerHTML = '<option value="">— اختر الصف —</option>';
      Object.keys(studentsData).forEach(cls => {
        const opt = document.createElement('option');
        opt.value = cls; opt.textContent = cls;
        sel.appendChild(opt);
      });
    }

    function renderStudentList() {
      const list = document.getElementById('studentList');
      list.innerHTML = '';
      students.forEach((name,i)=>{
        const chip = document.createElement('div');
        chip.className = 'student-chip';
        chip.textContent = name;
        chip.onclick = ()=>pickStudent(i);
        list.appendChild(chip);
      });
    }

    function pickStudent(idx) {
      picked = idx;
      document.querySelectorAll('.student-chip').forEach((el,i)=>{
        el.classList.toggle('selected', i===idx);
      });
      document.getElementById('currentStudent').textContent = students[idx];
    }

    function pickRandomStudent() {
      if(!students.length) return;
      let idx;
      do { idx = Math.floor(Math.random()*students.length); } while(idx===picked && students.length>1);
      pickStudent(idx);
      showNotif('تم اختيار الطالب عشوائيًا!','linear-gradient(90deg,#6aa6ff,#FFD700)');
    }

    function updateScoreboard() {
      const board = document.getElementById('scoreboard');
      if(!students.length) { board.innerHTML = ''; return; }
      let arr = students.map((name,i)=>({name,score:scores[name]||0}));
      arr.sort((a,b)=>b.score-a.score);
      board.innerHTML = arr.map(s=>`<div class='score-row'><span class='name'>${s.name}</span><span class='score'>${s.score} نقطة</span></div>`).join('');
    }

    document.getElementById('loadStudents').onclick = async ()=>{
      await loadStudentsData();
      fillClassSelect();
      showNotif('تم تحميل بيانات الطلاب!','linear-gradient(90deg,#228B22,#FFD700)');
    };
    document.getElementById('classSelect').onchange = function() {
      currentClass = this.value;
      students = studentsData[currentClass]||[];
      scores = {};
      picked = null;
      renderStudentList();
      document.getElementById('currentStudent').textContent = '';
      updateScoreboard();
    };
    document.getElementById('randomPick').onclick = pickRandomStudent;
    document.getElementById('correctBtn').onclick = ()=>{
      if(picked==null) return showNotif('اختر طالبًا أولاً!','#DC143C');
      const name = students[picked];
      scores[name] = (scores[name]||0)+1;
      showNotif('أحسنت! نقطة للطالب','linear-gradient(90deg,#228B22,#FFD700)');
      updateScoreboard();
      pickRandomStudent();
    };
    document.getElementById('wrongBtn').onclick = ()=>{
      if(picked==null) return showNotif('اختر طالبًا أولاً!','#DC143C');
      showNotif('حظًا أوفر!','linear-gradient(90deg,#DC143C,#FFD700)');
      pickRandomStudent();
    };
    // تحميل تلقائي عند الفتح
    loadStudentsData().then(fillClassSelect);
  </script>
</body>
</html>
