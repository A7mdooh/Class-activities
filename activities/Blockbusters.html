<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุณุงุจูุฉ ุงูุญุฑูู - Blockbusters</title>
  
  <!-- ุงูุฎุทูุท ูุงูุฃููููุงุช -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- ุงูููุชุจุงุช ุงูุฎุงุฑุฌูุฉ -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  
  <!-- ุงูุฃููุงุท ูุงูุณูุฑูุจุช ุงูููุญุฏ -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <script src="../assets/css/style.css" type="text/javascript"></script>
</head>
<body>
  <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู ุงูููุญุฏุฉ -->
  <div class="control-buttons-container">
    <button class="control-btn" id="backBtn" title="ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ">
      <i class="fas fa-home"></i>
    </button>
    <button class="control-btn" id="muteBtn" title="ูุชู ุงูุตูุช">
      <i class="fas fa-volume-up"></i>
    </button>
    <button class="control-btn" id="instructionsBtn" title="ุชุนูููุงุช ุงููุนุจุฉ">
      <i class="fas fa-question-circle"></i>
    </button>
    <button class="control-btn" id="fullscreenBtn" title="ููุก ุงูุดุงุดุฉ">
      <i class="fas fa-expand"></i>
    </button>
  </div>

  <!-- ูุงูุฐุฉ ุชุนูููุงุช ุงููุนุจุฉ -->
  <div class="instructions-overlay" id="instructionsModal">
    <div class="instructions-content">
      <button class="close-btn" onclick="closeInstructions()" title="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
      <div class="instructions-title">
        <i class="fas fa-book-open"></i> ุชุนูููุงุช ุงููุนุจุฉ
      </div>
      <ul class="instructions-list">
        <li>ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู ูููุน ุงููุณุงุจูุฉ ูู ุงููุงุฆูุฉ.</li>
        <li>ุญุฏุฏ ุฃุณูุงุก ุงูุทูุงุจ ุงููุดุงุฑููู ุฃู ุงุฎุชุฑ ุงููุถุน ุงูุนุดูุงุฆู.</li>
        <li>ุงุถุบุท ุนูู ุฒุฑ <strong>ุงุจุฏุฃ</strong> ูุจุฏุก ุงููุนุจุฉ.</li>
        <li>ุงููุฑ ุนูู ุฃู ุฎููุฉ ูู ููุญุฉ ุงูุญุฑููุ ุซู ุงุฎุชุฑ ุงููุฑูู ุงูููุงุณุจ (ุฃุฎุถุฑ ุฃู ุฃุญูุฑ).</li>
        <li>ุงููุฑูู ุงูุฃุฎุถุฑ ูููุฒ ุนูุฏ ุฅููุงู ุตู ุฃููู ุจุงููุงูู.</li>
        <li>ุงููุฑูู ุงูุฃุญูุฑ ูููุฒ ุนูุฏ ุฅููุงู ุนููุฏ ุฑุฃุณู ุจุงููุงูู.</li>
        <li>ุฅุฐุง ุงูุชูุฃุช ุฌููุน ุงูุฎูุงูุง ููู ููุฒ ุฃุญุฏุ ูุชู ุชุญุฏูุฏ ุงููุงุฆุฒ ุญุณุจ ุงูููุงุท.</li>
        <li>ุนูุฏ ููุฒ ุฃุญุฏ ุงููุฑู ุณุชุธูุฑ ูุงูุฐุฉ ุงุญุชูุงููุฉ ูุน ููุญุฉ ุงูุดุฑู.</li>
        <li>ููููู ุฅุนุงุฏุฉ ุชุนููู ุงููุนุจุฉ ูู ุฃู ููุช ุจุงูุถุบุท ุนูู ุฒุฑ "ุฅุนุงุฏุฉ ุชุนููู".</li>
      </ul>
      <button class="btn btn-primary" onclick="closeInstructions()">
        <i class="fas fa-check"></i> ูููุช
      </button>
    </div>
  </div>

  <!-- ูุงูุฐุฉ ุงูููุฒ -->
  <div class="victory-modal" id="victoryModal">
    <div class="victory-content">
      <button class="close-btn" id="closeVictoryModal" title="ุฅุบูุงู">
        <i class="fas fa-times"></i>
      </button>
      <div class="victory-fireworks" id="fireworksAnimation">
        <i class="fas fa-star"></i> <i class="fas fa-star"></i> <i class="fas fa-star"></i>
      </div>
      <div class="victory-trophy">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="victory-team" id="victoryTeamName"></div>
      <div class="victory-names" id="victoryPlayerNames"></div>
      <div class="honor-board-section" id="honorBoardSection">
        <h4><i class="fas fa-medal"></i> ููุญุฉ ุงูุดุฑู</h4>
        <ul class="honor-list" id="honorList"></ul>
      </div>
      <button class="btn btn-primary" onclick="closeVictoryModal()">
        <i class="fas fa-times"></i> ุฅุบูุงู
      </button>
    </div>
  </div>

  <!-- ุงูููุญุฉ ุงูุฑุฆูุณูุฉ ููุนุจุฉ -->
  <div class="game-main-panel" id="gameMainPanel">
    <!-- ููุญุฉ ุงููุฑูู ุงูุฃุฎุถุฑ -->
    <div class="team-score-panel green-team" id="greenTeamPanel">
      <div class="team-title">
        <i class="fas fa-users"></i> ุงููุฑูู ุงูุฃุฎุถุฑ
      </div>
      <div class="team-points" id="greenTeamPoints">0</div>
      <div class="team-strategy">ุฃููู ุตูุงู ุฃูููุงู ููููุฒ</div>
      <div class="team-members" id="greenTeamMembers"></div>
    </div>

    <!-- ุงูููุทูุฉ ุงููุณุทู -->
    <div class="game-center-area">
      <div class="game-board-title">
        <i class="fas fa-puzzle-piece"></i> ูุณุงุจูุฉ ุงูุญุฑูู
      </div>
      
      <!-- ุฅุนุฏุงุฏุงุช ุงููุนุจุฉ -->
      <form class="game-settings" id="gameSettingsForm" autocomplete="off">
        <select id="classSelect" class="form-input" required>
          <option value="">-- ุงุฎุชุฑ ุงูุตู --</option>
        </select>
        
        <select id="modeSelect" class="form-input" required>
          <option value="">-- ููุน ุงููุณุงุจูุฉ --</option>
          <option value="team2-manual">ุทุงูุจ ูููุฑูู ุงูุฃุญูุฑ / ุทุงูุจ ูููุฑูู ุงูุฃุฎุถุฑ</option>
          <option value="team4-manual">ุทุงูุจุงู ูููุฑูู ุงูุฃุญูุฑ / ุทุงูุจุงู ูููุฑูู ุงูุฃุฎุถุฑ</option>
          <option value="team2-random">ุฌูุงุนู ุนุดูุงุฆู (ุทุงูุจุงู ููู ูุฑูู)</option>
          <option value="team-free">ูุฑูู ุถุฏ ูุฑูู (ุจุฏูู ุชุญุฏูุฏ ุฃุณูุงุก)</option>
        </select>
        
        <span id="playersInputsContainer"></span>
        
        <div class="button-group">
          <button type="submit" class="btn btn-primary" id="startGameBtn">
            <i class="fas fa-play"></i> ุงุจุฏุฃ
          </button>
          <button type="button" class="btn btn-secondary" onclick="resetGame()">
            <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุชุนููู
          </button>
        </div>
      </form>
      
      <!-- ููุญุฉ ุงูุญุฑูู ุงูุณุฏุงุณูุฉ -->
      <div class="hexagon-board" id="hexagonBoard"></div>
    </div>

    <!-- ููุญุฉ ุงููุฑูู ุงูุฃุญูุฑ -->
    <div class="team-score-panel red-team" id="redTeamPanel">
      <div class="team-title">
        <i class="fas fa-users"></i> ุงููุฑูู ุงูุฃุญูุฑ
      </div>
      <div class="team-points" id="redTeamPoints">0</div>
      <div class="team-strategy">ุฃููู ุนููุฏุงู ุฑุฃุณูุงู ููููุฒ</div>
      <div class="team-members" id="redTeamMembers"></div>
    </div>
  </div>

  <script>
    // ูุธุงู ุงูุฃููุงู ุงูุนูุงูู ุงููุชูุฏู
    const OmaniColors = {
      red: '#DC143C',
      green: '#228B22', 
      gold: '#FFD700',
      white: '#F8F9FA',
      black: '#1A1A1A'
    };

    let ActivityManager;
    
    // ุชููุฆุฉ ุงููุดุงุท
    document.addEventListener('DOMContentLoaded', function() {
      ActivityManager = new ActivityUtils({
        activityName: 'blockbusters-game',
        primaryColor: OmaniColors.red,
        secondaryColor: OmaniColors.green,
        sounds: {
          click: '../assets/media/sounds/Click.mp3',
          success: '../assets/media/sounds/name-start.mp3',
          win: '../assets/media/sounds/win.mp3',
          greenPoint: '../assets/media/sounds/g.mp3',
          redPoint: '../assets/media/sounds/r.mp3'
        }
      });

      initializeGame();
    });

    // ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
    let students = [];
    let currentMode = '';
    let gameStarted = false;
    let greenTeam = [];
    let redTeam = [];
    let greenScore = 0;
    let redScore = 0;
    let honorBoard = JSON.parse(localStorage.getItem('blockbusters-honor') || '[]');

    // ุฃุญุฑู ุงูููุญุฉ ุงูุณุฏุงุณูุฉ
    const hexagonLetters = [
      ['ุฃ', 'ุจ', 'ุช', 'ุซ', 'ุฌ'],
      ['ุญ', 'ุฎ', 'ุฏ', 'ุฐ', 'ุฑ'],
      ['ุฒ', 'ุณ', 'ุด', 'ุต', 'ุถ'],
      ['ุท', 'ุธ', 'ุน', 'ุบ', 'ู'],
      ['ู', 'ู', 'ู', 'ู', 'ู']
    ];

    // ุชุญููู ุจูุงูุงุช ุงูุทูุงุจ
    async function loadStudentData() {
      try {
        const response = await fetch('../data/studentData.json');
        const data = await response.json();
        students = data.students || [];
        populateClassSelect();
      } catch (error) {
        console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุทูุงุจ:', error);
        ActivityManager.showNotification('ูุดู ูู ุชุญููู ุจูุงูุงุช ุงูุทูุงุจ', 'error');
      }
    }

    // ููุก ูุงุฆูุฉ ุงูุตููู
    function populateClassSelect() {
      const classSelect = document.getElementById('classSelect');
      const classes = [...new Set(students.map(s => s.class))];
      
      classSelect.innerHTML = '<option value="">-- ุงุฎุชุฑ ุงูุตู --</option>';
      classes.forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = className;
        classSelect.appendChild(option);
      });
    }

    // ุชููุฆุฉ ุงูุดุจูุฉ ุงูุณุฏุงุณูุฉ
    function initializeHexBoard() {
      const board = document.getElementById('hexagonBoard');
      board.innerHTML = '';
      
      hexagonLetters.forEach((row, rowIndex) => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'hex-row';
        
        row.forEach((letter, colIndex) => {
          const hexCell = document.createElement('div');
          hexCell.className = 'hex-cell';
          hexCell.setAttribute('data-row', rowIndex);
          hexCell.setAttribute('data-col', colIndex);
          hexCell.innerHTML = `<span class="hex-letter">${letter}</span>`;
          
          hexCell.addEventListener('click', () => handleHexClick(rowIndex, colIndex, hexCell));
          rowDiv.appendChild(hexCell);
        });
        
        board.appendChild(rowDiv);
      });
    }

    // ูุนุงูุฌุฉ ุงูููุฑ ุนูู ุงูุฎููุฉ ุงูุณุฏุงุณูุฉ
    function handleHexClick(row, col, element) {
      if (!gameStarted || element.classList.contains('selected')) return;
      
      ActivityManager.playSound('click');
      
      // ุฅุธูุงุฑ ูุงูุฐุฉ ุงุฎุชูุงุฑ ุงููุฑูู
      const modal = document.createElement('div');
      modal.className = 'team-selection-modal';
      modal.innerHTML = `
        <div class="modal-content">
          <h3>ุฃู ูุฑูู ูุฑูุฏ ุงูุฅุฌุงุจุฉ ุนูู ุญุฑู "${hexagonLetters[row][col]}"ุ</h3>
          <div class="team-buttons">
            <button class="btn btn-success" onclick="selectTeamForHex(${row}, ${col}, 'green'); closeTeamModal()">
              <i class="fas fa-users"></i> ุงููุฑูู ุงูุฃุฎุถุฑ
            </button>
            <button class="btn btn-danger" onclick="selectTeamForHex(${row}, ${col}, 'red'); closeTeamModal()">
              <i class="fas fa-users"></i> ุงููุฑูู ุงูุฃุญูุฑ
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      modal.style.display = 'flex';
      
      window.currentHexElement = element;
    }

    // ุชุนููู ุงูุฎููุฉ ูููุฑูู
    function selectTeamForHex(row, col, team) {
      const element = window.currentHexElement;
      element.classList.add('selected', team);
      
      if (team === 'green') {
        greenScore++;
        document.getElementById('greenTeamPoints').textContent = greenScore;
        ActivityManager.playSound('greenPoint');
      } else {
        redScore++;
        document.getElementById('redTeamPoints').textContent = redScore;
        ActivityManager.playSound('redPoint');
      }
      
      // ุงูุชุญูู ูู ุงูููุฒ
      setTimeout(() => checkForWin(), 500);
    }

    // ุฅุบูุงู ูุงูุฐุฉ ุงุฎุชูุงุฑ ุงููุฑูู
    function closeTeamModal() {
      const modal = document.querySelector('.team-selection-modal');
      if (modal) modal.remove();
    }

    // ุงูุชุญูู ูู ุญุงูุฉ ุงูููุฒ
    function checkForWin() {
      const greenCells = document.querySelectorAll('.hex-cell.green');
      const redCells = document.querySelectorAll('.hex-cell.red');
      
      // ุงูุชุญูู ูู ููุฒ ุงููุฑูู ุงูุฃุฎุถุฑ (ุตู ุฃููู)
      for (let row = 0; row < 5; row++) {
        let greenRowCount = 0;
        for (let col = 0; col < 5; col++) {
          const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
          if (cell && cell.classList.contains('green')) greenRowCount++;
        }
        if (greenRowCount === 5) {
          declareWinner('green');
          return;
        }
      }
      
      // ุงูุชุญูู ูู ููุฒ ุงููุฑูู ุงูุฃุญูุฑ (ุนููุฏ ุฑุฃุณู)
      for (let col = 0; col < 5; col++) {
        let redColCount = 0;
        for (let row = 0; row < 5; row++) {
          const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
          if (cell && cell.classList.contains('red')) redColCount++;
        }
        if (redColCount === 5) {
          declareWinner('red');
          return;
        }
      }
      
      // ุงูุชุญูู ูู ุงูุชูุงุก ุงูุดุจูุฉ
      if (greenCells.length + redCells.length === 25) {
        if (greenScore > redScore) {
          declareWinner('green');
        } else if (redScore > greenScore) {
          declareWinner('red');
        } else {
          declareTie();
        }
      }
    }

    // ุฅุนูุงู ุงููุงุฆุฒ
    function declareWinner(team) {
      gameStarted = false;
      const teamName = team === 'green' ? 'ุงููุฑูู ุงูุฃุฎุถุฑ' : 'ุงููุฑูู ุงูุฃุญูุฑ';
      const teamMembers = team === 'green' ? greenTeam : redTeam;
      
      ActivityManager.playSound('win');
      
      // ุชุฃุซูุฑุงุช ุงูุงุญุชูุงู
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
        colors: [team === 'green' ? OmaniColors.green : OmaniColors.red, OmaniColors.gold]
      });
      
      // ุญูุธ ูู ููุญุฉ ุงูุดุฑู
      saveToHonorBoard(teamName, teamMembers.join(' ู '));
      
      // ุฅุธูุงุฑ ูุงูุฐุฉ ุงูููุฒ
      showVictoryModal(teamName, teamMembers);
    }

    // ุฅุนูุงู ุงูุชุนุงุฏู
    function declareTie() {
      gameStarted = false;
      ActivityManager.showNotification('ุชุนุงุฏู! ูุง ููุฌุฏ ูุงุฆุฒ', 'info');
    }

    // ุญูุธ ุงููุชูุฌุฉ ูู ููุญุฉ ุงูุดุฑู
    function saveToHonorBoard(teamName, memberNames) {
      honorBoard.unshift({
        team: teamName,
        names: memberNames,
        date: new Date().toLocaleDateString('ar-SA'),
        score: teamName.includes('ุฃุฎุถุฑ') ? greenScore : redScore
      });
      
      // ุงูุงุญุชูุงุธ ุจุขุฎุฑ 10 ูุชุงุฆุฌ
      honorBoard = honorBoard.slice(0, 10);
      localStorage.setItem('blockbusters-honor', JSON.stringify(honorBoard));
    }

    // ุฅุธูุงุฑ ูุงูุฐุฉ ุงูููุฒ
    function showVictoryModal(teamName, members) {
      const modal = document.getElementById('victoryModal');
      const teamNameElement = document.getElementById('victoryTeamName');
      const playerNamesElement = document.getElementById('victoryPlayerNames');
      const honorListElement = document.getElementById('honorList');
      
      teamNameElement.textContent = `๐ ${teamName} ูุงุฒ! ๐`;
      teamNameElement.style.color = teamName.includes('ุฃุฎุถุฑ') ? OmaniColors.green : OmaniColors.red;
      
      if (members.length > 0) {
        playerNamesElement.innerHTML = `<i class="fas fa-star"></i> ${members.join(' ู ')}`;
      } else {
        playerNamesElement.textContent = '';
      }
      
      // ููุก ููุญุฉ ุงูุดุฑู
      honorListElement.innerHTML = '';
      honorBoard.slice(0, 5).forEach((entry, index) => {
        const li = document.createElement('li');
        li.className = 'honor-item';
        li.innerHTML = `
          <span class="honor-rank">${index + 1}</span>
          <span class="honor-team" style="color: ${entry.team.includes('ุฃุฎุถุฑ') ? OmaniColors.green : OmaniColors.red}">
            ${entry.team}
          </span>
          <span class="honor-names">${entry.names}</span>
          <span class="honor-date">${entry.date}</span>
        `;
        honorListElement.appendChild(li);
      });
      
      modal.style.display = 'flex';
    }

    // ุฅุบูุงู ูุงูุฐุฉ ุงูููุฒ
    function closeVictoryModal() {
      document.getElementById('victoryModal').style.display = 'none';
    }

    // ุฅุนุงุฏุฉ ุชุนููู ุงููุนุจุฉ
    function resetGame() {
      gameStarted = false;
      greenScore = 0;
      redScore = 0;
      greenTeam = [];
      redTeam = [];
      
      document.getElementById('greenTeamPoints').textContent = '0';
      document.getElementById('redTeamPoints').textContent = '0';
      document.getElementById('greenTeamMembers').textContent = '';
      document.getElementById('redTeamMembers').textContent = '';
      
      // ุฅุนุงุฏุฉ ุชุนููู ุงูุดุจูุฉ
      document.querySelectorAll('.hex-cell').forEach(cell => {
        cell.classList.remove('selected', 'green', 'red');
      });
      
      // ุฅุธูุงุฑ ูููุฐุฌ ุงูุฅุนุฏุงุฏุงุช
      document.getElementById('gameSettingsForm').style.display = 'block';
      
      ActivityManager.showNotification('ุชู ุฅุนุงุฏุฉ ุชุนููู ุงููุนุจุฉ', 'success');
    }

    // ุชููุฆุฉ ุงููุนุจุฉ
    function initializeGame() {
      loadStudentData();
      initializeHexBoard();
      
      // ูุนุงูุฌ ุฃุฒุฑุงุฑ ุงูุชุญูู
      document.getElementById('backBtn').addEventListener('click', () => {
        ActivityManager.goBack();
      });
      
      document.getElementById('muteBtn').addEventListener('click', () => {
        ActivityManager.toggleMute();
        const icon = document.querySelector('#muteBtn i');
        icon.className = ActivityManager.isMuted() ? 'fas fa-volume-mute' : 'fas fa-volume-up';
      });
      
      document.getElementById('instructionsBtn').addEventListener('click', () => {
        document.getElementById('instructionsModal').style.display = 'flex';
      });
      
      document.getElementById('fullscreenBtn').addEventListener('click', () => {
        ActivityManager.toggleFullscreen();
      });
      
      // ูุนุงูุฌ ูููุฐุฌ ุงูุฅุนุฏุงุฏุงุช
      document.getElementById('gameSettingsForm').addEventListener('submit', startGame);
      
      // ูุนุงูุฌ ุฅุบูุงู ุงูููุงูุฐ
      document.getElementById('closeVictoryModal').addEventListener('click', closeVictoryModal);
      
      // ููุก ุฎูุงุฑุงุช ุงููุถุน ุญุณุจ ุงูุตู ุงููุฎุชุงุฑ
      document.getElementById('classSelect').addEventListener('change', updatePlayerInputs);
      document.getElementById('modeSelect').addEventListener('change', updatePlayerInputs);
    }

    // ุจุฏุก ุงููุนุจุฉ
    function startGame(e) {
      e.preventDefault();
      
      const classValue = document.getElementById('classSelect').value;
      const modeValue = document.getElementById('modeSelect').value;
      
      if (!classValue || !modeValue) {
        ActivityManager.showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุตู ูููุน ุงููุณุงุจูุฉ', 'warning');
        return;
      }
      
      const classStudents = students.filter(s => s.class === classValue);
      currentMode = modeValue;
      
      // ุชุญุฏูุฏ ุฃุนุถุงุก ุงููุฑู ุญุณุจ ุงููุถุน
      if (modeValue === 'team2-random') {
        const shuffled = [...classStudents].sort(() => 0.5 - Math.random());
        greenTeam = shuffled.slice(0, 2).map(s => s.name);
        redTeam = shuffled.slice(2, 4).map(s => s.name);
      } else if (modeValue === 'team-free') {
        greenTeam = ['ูุฑูู ุฃุฎุถุฑ'];
        redTeam = ['ูุฑูู ุฃุญูุฑ'];
      } else {
        // ุงูุญุตูู ุนูู ุงูุฃุณูุงุก ูู ุงููุฏุฎูุงุช
        const inputs = document.querySelectorAll('#playersInputsContainer input');
        greenTeam = [];
        redTeam = [];
        
        inputs.forEach(input => {
          if (input.value.trim()) {
            if (input.dataset.team === 'green') {
              greenTeam.push(input.value.trim());
            } else {
              redTeam.push(input.value.trim());
            }
          }
        });
      }
      
      // ุชุญุฏูุซ ุนุฑุถ ุฃุนุถุงุก ุงููุฑู
      document.getElementById('greenTeamMembers').textContent = greenTeam.join(' ู ');
      document.getElementById('redTeamMembers').textContent = redTeam.join(' ู ');
      
      // ุฅุฎูุงุก ูููุฐุฌ ุงูุฅุนุฏุงุฏุงุช ูุจุฏุก ุงููุนุจุฉ
      document.getElementById('gameSettingsForm').style.display = 'none';
      gameStarted = true;
      
      ActivityManager.playSound('success');
      ActivityManager.showNotification('ุจุฏุฃุช ุงููุนุจุฉ! ุงุฎุชุฑ ุงูุญุฑูู', 'success');
    }

    // ุชุญุฏูุซ ูุฏุฎูุงุช ุงูุฃุณูุงุก
    function updatePlayerInputs() {
      const classValue = document.getElementById('classSelect').value;
      const modeValue = document.getElementById('modeSelect').value;
      const container = document.getElementById('playersInputsContainer');
      
      container.innerHTML = '';
      
      if (!classValue || !modeValue) return;
      
      const classStudents = students.filter(s => s.class === classValue);
      
      if (modeValue === 'team2-manual') {
        container.innerHTML = `
          <input type="text" class="form-input" placeholder="ุงุณู ุทุงูุจ ุงููุฑูู ุงูุฃุฎุถุฑ" data-team="green" list="students-${classValue}" required>
          <input type="text" class="form-input" placeholder="ุงุณู ุทุงูุจ ุงููุฑูู ุงูุฃุญูุฑ" data-team="red" list="students-${classValue}" required>
        `;
      } else if (modeValue === 'team4-manual') {
        container.innerHTML = `
          <input type="text" class="form-input" placeholder="ุงูุทุงูุจ ุงูุฃูู - ุงููุฑูู ุงูุฃุฎุถุฑ" data-team="green" list="students-${classValue}" required>
          <input type="text" class="form-input" placeholder="ุงูุทุงูุจ ุงูุซุงูู - ุงููุฑูู ุงูุฃุฎุถุฑ" data-team="green" list="students-${classValue}" required>
          <input type="text" class="form-input" placeholder="ุงูุทุงูุจ ุงูุฃูู - ุงููุฑูู ุงูุฃุญูุฑ" data-team="red" list="students-${classValue}" required>
          <input type="text" class="form-input" placeholder="ุงูุทุงูุจ ุงูุซุงูู - ุงููุฑูู ุงูุฃุญูุฑ" data-team="red" list="students-${classValue}" required>
        `;
      }
      
      // ุฅุถุงูุฉ ูุงุฆูุฉ ุงูุทูุงุจ ููุงูุชุฑุงุญ ุงูุชููุงุฆู
      if (container.innerHTML) {
        const datalist = document.createElement('datalist');
        datalist.id = `students-${classValue}`;
        classStudents.forEach(student => {
          const option = document.createElement('option');
          option.value = student.name;
          datalist.appendChild(option);
        });
        container.appendChild(datalist);
      }
    }

    // ุฅุบูุงู ูุงูุฐุฉ ุงูุชุนูููุงุช
    function closeInstructions() {
      document.getElementById('instructionsModal').style.display = 'none';
    }

    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูููุญุฉ ุงูููุงุชูุญ
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeInstructions();
        closeVictoryModal();
        closeTeamModal();
      }
    });
  </script>
</body>
</html>
