<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙØ§Ø¹Ù„ÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <link rel="stylesheet" href="../assets/css/style.css">
  <style>
    /* ØªØ®ØµÙŠØµØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© */
    
    /* Ø­Ø§ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø³Ù† */
    .setup-container {
      background: var(--surface-glass);
      border-radius: var(--border-radius-xl);
      padding: var(--spacing-2xl);
      max-width: 600px;
      margin: 0 auto var(--spacing-2xl);
      box-shadow: var(--shadow-large);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }

    .setup-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-secondary);
    }

    .setup-container h2 {
      color: var(--accent-gold);
      margin-bottom: var(--spacing-xl);
      font-size: var(--font-size-2xl);
      font-weight: 600;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Ø­Ø§ÙˆÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…Ø­Ø³Ù† */
    .quiz-main-container {
      background: var(--surface-glass);
      border-radius: var(--border-radius-xl);
      padding: var(--spacing-2xl);
      max-width: 900px;
      margin: 0 auto;
      box-shadow: var(--shadow-large);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }

    .quiz-main-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-accent);
    }

    /* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
    .turn-display {
      background: var(--gradient-primary);
      color: var(--oman-white);
      padding: var(--spacing-xl);
      border-radius: var(--border-radius-large);
      margin-bottom: var(--spacing-2xl);
      text-align: center;
      box-shadow: var(--shadow-medium);
      position: relative;
      overflow: hidden;
    }

    .turn-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shimmer 3s infinite;
    }

    .turn-display h2 {
      margin: 0 0 var(--spacing-md) 0;
      font-size: var(--font-size-2xl);
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .turn-display p {
      margin: 0;
      font-size: var(--font-size-lg);
      opacity: 0.95;
      font-weight: 500;
    }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø­Ø³Ù† */
    .question-display {
      background: var(--surface-elevated);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: var(--border-radius-large);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-2xl);
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-medium);
      position: relative;
      overflow: hidden;
    }

    .question-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-accent);
    }

    .question-display h3 {
      margin: 0;
      font-size: var(--font-size-xl);
      line-height: 1.6;
      color: var(--text-primary);
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
    .choices-layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-2xl);
    }

    .choice-option {
      background: var(--surface-elevated);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: var(--text-primary);
      padding: var(--spacing-lg) var(--spacing-xl);
      border-radius: var(--border-radius-large);
      font-size: var(--font-size-base);
      cursor: pointer;
      transition: var(--transition-normal);
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-small);
      position: relative;
      overflow: hidden;
      text-align: center;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .choice-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: var(--transition-normal);
    }

    .choice-option:hover {
      transform: translateY(-4px) scale(1.02);
      border-color: var(--accent-gold);
      box-shadow: var(--shadow-medium);
      background: var(--surface-glass);
    }

    .choice-option:hover::before {
      left: 100%;
    }

    .choice-option:active {
      transform: translateY(-2px) scale(1.01);
    }

    .choice-option.correct {
      background: var(--gradient-secondary);
      border-color: var(--oman-green);
      color: var(--oman-white);
      animation: correctPulse 0.8s ease;
      box-shadow: var(--shadow-success);
    }

    .choice-option.wrong {
      background: var(--gradient-primary);
      border-color: var(--oman-red);
      color: var(--oman-white);
      animation: wrongShake 0.6s ease;
      box-shadow: var(--shadow-glow);
    }

    @keyframes correctPulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: var(--shadow-success);
      }
      50% { 
        transform: scale(1.08);
        box-shadow: 0 0 32px rgba(34, 197, 94, 0.6);
      }
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
    }

    /* Ø­Ø§ÙˆÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø­Ø³Ù† */
    .results-container {
      background: var(--gradient-accent);
      color: var(--text-dark);
      padding: var(--spacing-2xl);
      border-radius: var(--border-radius-xl);
      text-align: center;
      box-shadow: var(--shadow-large);
      margin-top: var(--spacing-2xl);
      position: relative;
      overflow: hidden;
    }

    .results-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .results-container h2 {
      margin: 0 0 var(--spacing-xl) 0;
      font-size: var(--font-size-3xl);
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªØ¬Ø§ÙˆØ¨Ø© Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© */
    @media (max-width: 768px) {
      .choices-layout {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }

      .choice-option {
        padding: var(--spacing-md);
        font-size: var(--font-size-sm);
        min-height: 50px;
      }

      .setup-container, 
      .quiz-main-container {
        margin: 0 auto var(--spacing-xl);
        padding: var(--spacing-xl);
      }

      .turn-display {
        padding: var(--spacing-lg);
      }

      .turn-display h2 {
        font-size: var(--font-size-xl);
      }

      .question-display {
        padding: var(--spacing-lg);
      }

      .question-display h3 {
        font-size: var(--font-size-lg);
      }
    }

    @media (max-width: 480px) {
      .choice-option {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--font-size-xs);
        min-height: 45px;
      }

      .setup-container,
      .quiz-main-container {
        padding: var(--spacing-lg);
        margin: 0 auto var(--spacing-lg);
      }

      .setup-container h2,
      .results-container h2 {
        font-size: var(--font-size-xl);
      }

      .turn-display h2 {
        font-size: var(--font-size-lg);
      }

      .turn-display p {
        font-size: var(--font-size-base);
      }

      .question-display h3 {
        font-size: var(--font-size-base);
        line-height: 1.4;
      }

      .results-container {
        padding: var(--spacing-lg);
      }
    }
  </style>
</head>
<body>
  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ­Ø¯Ø© -->
  <div class="control-buttons-container">
    <button class="control-btn" id="backBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
      <i class="fas fa-home"></i>
    </button>
    <button class="control-btn" id="muteBtn" title="ÙƒØªÙ… Ø§Ù„ØµÙˆØª">
      <i class="fas fa-volume-up"></i>
    </button>
    <button class="control-btn" id="fullscreenBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
      <i class="fas fa-expand"></i>
    </button>
  </div>

  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø³Ù† -->
  <div class="page-header">
    <h1><i class="fas fa-brain"></i> Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h1>
    <p>Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø´ÙŠÙ‚Ø© ÙˆÙ…ÙÙŠØ¯Ø©</p>
  </div>

  <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ -->
  <div class="setup-container" id="setupContainer">
    <h2><i class="fas fa-cogs"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h2>
    
    <div class="form-section">
      <div class="input-group">
        <label for="classSelect"><i class="fas fa-users"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
        <select id="classSelect" class="form-input">
          <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>
        </select>
      </div>

      <div class="input-group">
        <label for="gameMode"><i class="fas fa-gamepad"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label>
        <select id="gameMode" class="form-input">
          <option value="individual">ÙØ±Ø¯ÙŠ - Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯</option>
          <option value="team">ÙØ±Ù‚ - ÙØ±ÙŠÙ‚Ø§Ù†</option>
          <option value="class">Ø¬Ù…Ø§Ø¹ÙŠ - Ø§Ù„ØµÙ ÙƒØ§Ù…Ù„Ø§Ù‹</option>
        </select>
      </div>

      <div class="input-group">
        <label for="questionCount"><i class="fas fa-list-ol"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</label>
        <select id="questionCount" class="form-input">
          <option value="5">5 Ø£Ø³Ø¦Ù„Ø©</option>
          <option value="10" selected>10 Ø£Ø³Ø¦Ù„Ø©</option>
          <option value="15">15 Ø³Ø¤Ø§Ù„</option>
          <option value="20">20 Ø³Ø¤Ø§Ù„</option>
        </select>
      </div>
    </div>

    <div class="button-group">
      <button class="btn btn-primary" onclick="startQuiz()">
        <i class="fas fa-rocket"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
      </button>
    </div>
  </div>

  <!-- Ø­Ø§ÙˆÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© -->
  <div class="quiz-main-container" id="quizMainContainer" style="display: none;">
    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ± -->
    <div class="turn-display" id="turnDisplay">
      <h2 id="currentPlayer"><i class="fas fa-user"></i> Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„</h2>
      <p id="questionCounter">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 10</p>
    </div>

    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø¤Ø§Ù„ -->
    <div class="question-display">
      <h3 id="questionText">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„...</h3>
    </div>

    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© -->
    <div class="choices-layout" id="choicesLayout">
      <!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="button-group">
      <button class="btn btn-secondary" onclick="skipQuestion()">
        <i class="fas fa-forward"></i> ØªØ®Ø·ÙŠ
      </button>
      <button class="btn btn-warning" onclick="pauseQuiz()">
        <i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
      </button>
      <button class="btn btn-primary" onclick="nextQuestion()">
        <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
      </button>
    </div>
  </div>

  <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="results-container" id="resultsContainer" style="display: none;">
    <h2><i class="fas fa-trophy"></i> Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!</h2>
    <div id="finalResults"></div>
    <div class="button-group">
      <button class="btn btn-primary" onclick="restartQuiz()">
        <i class="fas fa-redo"></i> Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
    </div>
  </div>

  <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„ -->
  <div id="fireworks" class="fireworks-container" style="display: none;">
    <div class="firework"></div>
    <div class="firework"></div>
    <div class="firework"></div>
  </div>
<script src="../config/unified-scripts-template.js"></script>
<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ActivityUtils
  const activity = new ActivityUtils('Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©', '../assets/media/sounds/');
  
  // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
  let gameState = {
    isActive: false,
    isPaused: false,
    currentQuestionIndex: 0,
    totalQuestions: 10,
    gameMode: 'individual',
    selectedClass: null,
    students: [],
    teamA: [],
    teamB: [],
    currentTeam: 'A',
    currentPlayer: null,
    questions: [],
    answers: [],
    correctCount: 0,
    startTime: null
  };

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
  let studentsData = {};

  // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†
  const questionBank = [
    {
      question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø³Ù„Ø·Ù†Ø© Ø¹ÙÙ…Ø§Ù†ØŸ",
      choices: ["Ù…Ø³Ù‚Ø·", "ØµÙ„Ø§Ù„Ø©", "Ù†Ø²ÙˆÙ‰", "ØµØ­Ø§Ø±"],
      correct: 0
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©ØŸ",
      choices: ["360", "365", "366", "364"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡Ùˆ Ø£ÙƒØ¨Ø± Ø§Ù„Ù…Ø­ÙŠØ·Ø§Øª ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
      choices: ["Ø§Ù„Ø£Ø·Ù„Ø³ÙŠ", "Ø§Ù„Ù‡Ù†Ø¯ÙŠ", "Ø§Ù„Ù‡Ø§Ø¯Ø¦", "Ø§Ù„Ù…ØªØ¬Ù…Ø¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠ"],
      correct: 2
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ù„ÙˆØ§Ù† Ù‚ÙˆØ³ Ù‚Ø²Ø­ØŸ",
      choices: ["5", "6", "7", "8"],
      correct: 2
    },
    {
      question: "Ù…Ø§ Ù‡Ùˆ Ø£Ù‚Ø±Ø¨ Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ù…Ø³ØŸ",
      choices: ["Ø§Ù„Ø²Ù‡Ø±Ø©", "Ø¹Ø·Ø§Ø±Ø¯", "Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ø£Ø±Ø¶"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
      choices: ["5", "6", "7", "8"],
      correct: 2
    },
    {
      question: "Ù…Ø§ Ù‡ÙŠ Ø£Ø·ÙˆÙ„ Ø¢ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ",
      choices: ["Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ", "Ø¢ÙŠØ© Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†", "Ø¢ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ù‡Ù„Ø©", "Ø¢ÙŠØ© Ø§Ù„Ù†ÙˆØ±"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø³Ù†Ø§Ù† Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø§Ù„Ø¨Ø§Ù„ØºØŸ",
      choices: ["28", "30", "32", "34"],
      correct: 2
    },
    {
      question: "Ù…Ø§ Ù‡Ùˆ Ø£ØµØºØ± Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
      choices: ["Ù…ÙˆÙ†Ø§ÙƒÙˆ", "Ø§Ù„ÙØ§ØªÙŠÙƒØ§Ù†", "Ù„ÙŠØ®ØªÙ†Ø´ØªØ§ÙŠÙ†", "Ù…Ø§Ù„Ø·Ø§"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¹Ø¶Ù„Ø§Øª Ø¬Ø³Ù… Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ØŸ",
      choices: ["600", "650", "700", "750"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡ÙŠ Ø£ÙƒØ¨Ø± Ù‚Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
      choices: ["Ø£ÙØ±ÙŠÙ‚ÙŠØ§", "Ø¢Ø³ÙŠØ§", "Ø£ÙˆØ±ÙˆØ¨Ø§", "Ø£Ù…Ø±ÙŠÙƒØ§ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙØµÙˆÙ„ Ø§Ù„Ø³Ù†Ø©ØŸ",
      choices: ["3", "4", "5", "6"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡Ùˆ Ø±Ù…Ø² Ø§Ù„Ø°Ù‡Ø¨ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØŸ",
      choices: ["Go", "Au", "Ag", "Gd"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£Ø¶Ù„Ø§Ø¹ Ø§Ù„Ù…Ø«Ù„Ø«ØŸ",
      choices: ["2", "3", "4", "5"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡ÙŠ Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ",
      choices: ["Ø§Ù„Ø¯Ø±Ù‡Ù…", "Ø§Ù„Ø±ÙŠØ§Ù„", "Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±", "Ø§Ù„Ù„ÙŠØ±Ø©"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø´Ù‡Ø± ÙØ¨Ø±Ø§ÙŠØ± ÙÙŠ Ø§Ù„Ø³Ù†Ø© Ø§Ù„ÙƒØ¨ÙŠØ³Ø©ØŸ",
      choices: ["28", "29", "30", "31"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡Ùˆ Ø£Ø·ÙˆÙ„ Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ",
      choices: ["Ø§Ù„Ù†ÙŠÙ„", "Ø§Ù„Ø£Ù…Ø§Ø²ÙˆÙ†", "Ø§Ù„Ù…Ø³ÙŠØ³ÙŠØ¨ÙŠ", "Ø§Ù„ÙŠØ§Ù†ØºØªØ³ÙŠ"],
      correct: 0
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŸ",
      choices: ["50", "60", "70", "80"],
      correct: 1
    },
    {
      question: "Ù…Ø§ Ù‡ÙŠ Ø£ØµØºØ± ÙˆØ­Ø¯Ø© ÙÙŠ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±ØŸ",
      choices: ["Ø§Ù„Ø¨Ø§ÙŠØª", "Ø§Ù„Ø¨Øª", "Ø§Ù„ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª", "Ø§Ù„Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª"],
      correct: 1
    },
    {
      question: "ÙƒÙ… Ø¹Ø¯Ø¯ ÙƒÙˆØ§ÙƒØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©ØŸ",
      choices: ["7", "8", "9", "10"],
      correct: 1
    }
  ];

  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
  async function loadStudentsData() {
    try {
      const response = await fetch('../data/studentData.json');
      if (response.ok) {
        studentsData = await response.json();
        populateClassSelect();
        activity.showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } else {
        throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      }
    } catch (error) {
      console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø©
      studentsData = {
        "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³": ["Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", "ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ", "Ø¹Ù…Ø± Ø³Ø§Ù„Ù…", "Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ†"],
        "Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³": ["Ù…Ø±ÙŠÙ… Ø£Ø­Ù…Ø¯", "Ø®Ø§Ù„Ø¯ Ø³Ø§Ù„Ù…", "Ø¹Ø§Ø¦Ø´Ø© Ø¹Ù„ÙŠ", "ÙŠÙˆØ³Ù Ù…Ø­Ù…Ø¯"]
      };
      populateClassSelect();
      activity.showNotification('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©', 'info');
    }
  }

  // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ
  function populateClassSelect() {
    const classSelect = document.getElementById('classSelect');
    classSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>';
    
    Object.keys(studentsData).forEach(className => {
      const option = document.createElement('option');
      option.value = className;
      option.textContent = className;
      classSelect.appendChild(option);
    });
  }

  // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
  function startQuiz() {
    const classSelect = document.getElementById('classSelect');
    const gameMode = document.getElementById('gameMode');
    const questionCount = document.getElementById('questionCount');

    if (!classSelect.value) {
      activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹!', false);
      return;
    }

    activity.playSound('start-timer.mp3');

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    gameState.selectedClass = classSelect.value;
    gameState.gameMode = gameMode.value;
    gameState.totalQuestions = parseInt(questionCount.value);
    gameState.students = studentsData[gameState.selectedClass] || [];
    gameState.currentQuestionIndex = 0;
    gameState.correctCount = 0;
    gameState.answers = [];
    gameState.startTime = new Date();
    gameState.isActive = true;

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    setupTeams();

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    gameState.questions = questionBank
      .sort(() => Math.random() - 0.5)
      .slice(0, gameState.totalQuestions);

    // Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
    document.getElementById('setupContainer').style.display = 'none';
    document.getElementById('quizMainContainer').style.display = 'block';

    // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„
    displayQuestion();
    
    activity.showNotification('Ø¨Ø¯Ø£Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! Ø­Ø¸Ø§Ù‹ Ù…ÙˆÙÙ‚Ø§Ù‹', 'success');
  }

  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚
  function setupTeams() {
    if (gameState.gameMode === 'team') {
      const shuffled = [...gameState.students].sort(() => Math.random() - 0.5);
      const half = Math.ceil(shuffled.length / 2);
      gameState.teamA = shuffled.slice(0, half);
      gameState.teamB = shuffled.slice(half);
      gameState.currentTeam = 'A';
    } else if (gameState.gameMode === 'individual') {
      gameState.currentPlayer = gameState.students[Math.floor(Math.random() * gameState.students.length)];
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„
  function displayQuestion() {
    const currentQ = gameState.questions[gameState.currentQuestionIndex];
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±
    updateTurnInfo();
    
    // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
    document.getElementById('questionText').textContent = currentQ.question;
    document.getElementById('questionCounter').textContent = 
      `Ø§Ù„Ø³Ø¤Ø§Ù„ ${gameState.currentQuestionIndex + 1} Ù…Ù† ${gameState.totalQuestions}`;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    const choicesContainer = document.getElementById('choicesLayout');
    choicesContainer.innerHTML = '';

    currentQ.choices.forEach((choice, index) => {
      const button = document.createElement('button');
      button.className = 'choice-option';
      button.innerHTML = `<i class="fas fa-circle-dot"></i> ${choice}`;
      button.onclick = () => selectAnswer(index);
      choicesContainer.appendChild(button);
    });

    activity.playSound('name-start.mp3');
  }

  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±
  function updateTurnInfo() {
    const currentPlayerElement = document.getElementById('currentPlayer');
    
    switch (gameState.gameMode) {
      case 'individual':
        currentPlayerElement.innerHTML = `<i class="fas fa-user"></i> ${gameState.currentPlayer}`;
        break;
      case 'team':
        const currentTeamName = gameState.currentTeam === 'A' ? 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„' : 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ';
        currentPlayerElement.innerHTML = `<i class="fas fa-users"></i> Ø¯ÙˆØ± ${currentTeamName}`;
        break;
      case 'class':
        currentPlayerElement.innerHTML = `<i class="fas fa-users"></i> ${gameState.selectedClass}`;
        break;
    }
  }

  // Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø©
  function selectAnswer(selectedIndex) {
    const currentQ = gameState.questions[gameState.currentQuestionIndex];
    const isCorrect = selectedIndex === currentQ.correct;
    
    activity.playSound('Click.mp3');
    
    // ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.querySelectorAll('.choice-option').forEach((btn, index) => {
      btn.disabled = true;
      btn.style.pointerEvents = 'none';
      
      if (index === currentQ.correct) {
        btn.classList.add('correct');
      } else if (index === selectedIndex && !isCorrect) {
        btn.classList.add('wrong');
      }
    });

    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    gameState.answers.push({
      questionIndex: gameState.currentQuestionIndex,
      selectedAnswer: selectedIndex,
      correctAnswer: currentQ.correct,
      isCorrect: isCorrect,
      player: getCurrentPlayer()
    });

    if (isCorrect) {
      gameState.correctCount++;
      activity.playSound('win.mp3');
      activity.showNotification('Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª!', 'success');
    } else {
      activity.playSound('draw.mp3');
      activity.showNotification('Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!', 'error');
    }

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¹Ø¯ ØªÙˆÙ‚ÙŠØª Ù‚ØµÙŠØ±
    setTimeout(() => {
      nextQuestion();
    }, 2000);
  }

  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
  function getCurrentPlayer() {
    switch (gameState.gameMode) {
      case 'individual':
        return gameState.currentPlayer;
      case 'team':
        return gameState.currentTeam === 'A' ? 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„' : 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ';
      case 'class':
        return gameState.selectedClass;
      default:
        return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    }
  }

  // Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
  function nextQuestion() {
    gameState.currentQuestionIndex++;

    if (gameState.currentQuestionIndex >= gameState.totalQuestions) {
      endQuiz();
      return;
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
    updateCurrentPlayer();
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
    displayQuestion();
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
  function updateCurrentPlayer() {
    switch (gameState.gameMode) {
      case 'individual':
        gameState.currentPlayer = gameState.students[Math.floor(Math.random() * gameState.students.length)];
        break;
      case 'team':
        gameState.currentTeam = gameState.currentTeam === 'A' ? 'B' : 'A';
        break;
      case 'class':
        // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
        break;
    }
  }

  // ØªØ®Ø·ÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„
  function skipQuestion() {
    activity.showModal('ØªØ£ÙƒÙŠØ¯', 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ®Ø·ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ', true, () => {
      gameState.answers.push({
        questionIndex: gameState.currentQuestionIndex,
        selectedAnswer: -1,
        correctAnswer: gameState.questions[gameState.currentQuestionIndex].correct,
        isCorrect: false,
        player: getCurrentPlayer(),
        skipped: true
      });

      activity.playSound('Click.mp3');
      activity.showNotification('ØªÙ… ØªØ®Ø·ÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„', 'info');
      nextQuestion();
    });
  }

  // Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
  function pauseQuiz() {
    gameState.isPaused = !gameState.isPaused;
    
    const pauseBtn = document.querySelector('[onclick="pauseQuiz()"]');
    if (gameState.isPaused) {
      pauseBtn.innerHTML = '<i class="fas fa-play"></i> Ø§Ø³ØªØ¦Ù†Ø§Ù';
      activity.showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¤Ù‚ØªØ§Ù‹', 'info');
    } else {
      pauseBtn.innerHTML = '<i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
      activity.showNotification('ØªÙ… Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', 'success');
    }
    
    activity.playSound('Click.mp3');
  }

  // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
  function endQuiz() {
    gameState.isActive = false;
    
    // Ø¥Ø®ÙØ§Ø¡ Ø­Ø§ÙˆÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    document.getElementById('quizMainContainer').style.display = 'none';
    document.getElementById('resultsContainer').style.display = 'block';

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    const percentage = Math.round((gameState.correctCount / gameState.totalQuestions) * 100);
    const duration = Math.round((new Date() - gameState.startTime) / 1000);

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    document.getElementById('finalResults').innerHTML = `
      <div class="results-stats">
        <div class="stat-item">
          <i class="fas fa-chart-bar"></i>
          <span class="stat-label">Ø§Ù„Ù†ØªÙŠØ¬Ø©:</span>
          <span class="stat-value">${gameState.correctCount} Ù…Ù† ${gameState.totalQuestions} (${percentage}%)</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-clock"></i>
          <span class="stat-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</span>
          <span class="stat-value">${Math.floor(duration / 60)}:${(duration % 60).toString().padStart(2, '0')}</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-medal"></i>
          <span class="stat-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
          <span class="stat-value">${getGrade(percentage)}</span>
        </div>
      </div>
    `;

    // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
    showCelebration(percentage);
    
    activity.playSound('clap.mp3');
    activity.showNotification('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!', 'success');
  }

  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
  function getGrade(percentage) {
    if (percentage >= 90) return 'ğŸŒŸ Ù…Ù…ØªØ§Ø²';
    if (percentage >= 80) return 'ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
    if (percentage >= 70) return 'âœ… Ø¬ÙŠØ¯';
    if (percentage >= 60) return 'ğŸ“ Ù…Ù‚Ø¨ÙˆÙ„';
    return 'ğŸ“š ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©';
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
  function showCelebration(percentage) {
    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // Ø¥Ø¶Ø§ÙØ© ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    if (window.confetti) {
      const particleCount = percentage >= 80 ? 200 : percentage >= 60 ? 100 : 50;
      confetti({ 
        particleCount: particleCount, 
        spread: 120, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700']
      });
    }

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 4000);
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
  function restartQuiz() {
    activity.playSound('Click.mp3');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
    gameState = {
      isActive: false,
      isPaused: false,
      currentQuestionIndex: 0,
      totalQuestions: 10,
      gameMode: 'individual',
      selectedClass: null,
      students: [],
      teamA: [],
      teamB: [],
      currentTeam: 'A',
      currentPlayer: null,
      questions: [],
      answers: [],
      correctCount: 0,
      startTime: null
    };

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
    document.getElementById('setupContainer').style.display = 'block';
    document.getElementById('resultsContainer').style.display = 'none';
    
    activity.showNotification('Ø¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©!', 'info');
  }

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.onload = async () => {
    activity.init();
    await loadStudentsData();
  };
</script>
</body>
</html>