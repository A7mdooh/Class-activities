<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ğŸ”¥</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="../config/unified-styles-template.css">
<style>
    /* ØªØ®ØµÙŠØµ Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª */
    .activity-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .challenge-header {
      background: var(--gradient-primary);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: var(--shadow-large);
    }

    .challenge-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .challenge-controls {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      margin-bottom: 2rem;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .control-group label {
      font-weight: 600;
      color: var(--text-color);
      min-width: 100px;
    }

    .control-group select,
    .control-group button {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      border: 2px solid var(--primary-color);
      font-size: 1rem;
      font-weight: 600;
    }

    .control-group select {
      background: white;
      color: var(--primary-color);
      min-width: 150px;
    }

    .challenge-area {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      display: none;
      text-align: center;
    }

    .turn-display {
      background: var(--gradient-accent);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-medium);
    }

    .timer-container {
      position: relative;
      width: 150px;
      height: 150px;
      margin: 2rem auto;
    }

    .timer-circle {
      width: 150px;
      height: 150px;
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
    }

    .timer-container.shake {
      animation: shake 0.5s infinite;
    }

    .teams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      border: 3px solid var(--primary-color);
      transition: all 0.3s ease;
    }

    .team-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-large);
    }

    .team-card h3 {
      color: var(--primary-color);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .team-score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent-color);
      margin: 1rem 0;
    }

    .score-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .score-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .score-btn.plus {
      background: var(--gradient-success);
      color: white;
    }

    .score-btn.minus {
      background: var(--gradient-danger);
      color: white;
    }

    .score-btn:hover {
      transform: scale(1.1);
    }

    .challenge-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .winner-display {
      background: var(--gradient-accent);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      font-size: 2rem;
      font-weight: 700;
      margin-top: 2rem;
      box-shadow: var(--shadow-large);
      display: none;
    }

    .manual-selection {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .multi-team-options {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .instruction-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: var(--shadow-extra-large);
      position: relative;
    }

    .modal-content h2 {
      color: var(--primary-color);
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }

    .modal-content p {
      font-size: 1.3rem;
      line-height: 1.8;
      color: var(--text-color);
      margin-bottom: 2rem;
    }

    .time-up-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 2rem 3rem;
      border-radius: 20px;
      box-shadow: var(--shadow-extra-large);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
      z-index: 10000;
      display: none;
      border: 4px solid var(--accent-color);
    }

    .fireworks-effect {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('../assets/media/sounds/firework.gif') center center no-repeat;
      background-size: cover;
      z-index: 9999;
      display: none;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
    @media (max-width: 768px) {
      .challenge-header h1 {
        font-size: 2rem;
      }

      .control-group {
        flex-direction: column;
        text-align: center;
      }

      .teams-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .timer-container {
        width: 120px;
        height: 120px;
      }

      .timer-circle {
        width: 120px;
        height: 120px;
      }

      .challenge-actions {
        flex-direction: column;
        align-items: center;
      }
    }

    @media (max-width: 480px) {
      .activity-container {
        padding: 10px;
      }

      .challenge-header,
      .challenge-controls,
      .challenge-area {
        padding: 1rem;
      }

      .team-score {
        font-size: 2.5rem;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(5px, 0); }
      50% { transform: translate(0, 5px); }
      75% { transform: translate(-5px, 0); }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
    .advanced-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 15px;
      padding: 1rem 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index: 10000;
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
      min-width: 300px;
      border-left: 5px solid var(--primary-color);
    }

    .advanced-notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .advanced-notification.success { border-left-color: #28a745; }
    .advanced-notification.warning { border-left-color: #ffc107; }
    .advanced-notification.error { border-left-color: #dc3545; }
    .advanced-notification.challenge { border-left-color: #ff6b35; }
    .advanced-notification.timer { border-left-color: #17a2b8; }
    .advanced-notification.trophy { border-left-color: #ffd700; }
    .advanced-notification.loading { border-left-color: #6f42c1; }
    .advanced-notification.celebration { border-left-color: #fd7e14; }

    .notification-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .notification-close {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      padding: 0.2rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .notification-close:hover {
      background: #f0f0f0;
      color: #666;
    }

    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: var(--primary-color);
      border-radius: 0 0 15px 15px;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ø§Ø¦Ù…Ø© */
    .floating-tip {
      position: fixed;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-size: 0.9rem;
      z-index: 10001;
      transform: translateY(10px);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .floating-tip.show {
      transform: translateY(0);
      opacity: 1;
    }

    .tip-content {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tip-content i {
      color: #ffd700;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© */
    .control-group button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .team-card:hover .team-avatar {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
    }

    .score-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ© Ù…Ø­Ø³Ù†Ø© */
    .challenge-area {
      animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
    @media (max-width: 768px) {
      .floating-tip {
        position: fixed;
        top: 20px !important;
        left: 20px !important;
        right: 20px !important;
        width: auto !important;
      }
    }

    .notification-icon {
      font-size: 1.2rem;
    }

    .notification-message {
      color: var(--text-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© */
    .star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: fallingStar 3s linear forwards;
      text-shadow: 0 0 10px #ffd700;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙØ±Ù‚ */
    .team-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .team-status {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      padding: 0.3rem 0.8rem;
      background: #f8f9fa;
      border-radius: 15px;
      text-align: center;
    }

    .vs-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 1rem;
    }

    .vs-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--gradient-accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
    }

    .vs-circle i {
      font-size: 1.2rem;
      margin-bottom: 0.2rem;
    }

    .multi-team {
      position: relative;
      overflow: hidden;
    }

    .multi-team::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-color);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @media (max-width: 768px) {
      .vs-divider {
        margin: 1rem 0;
      }
      
      .vs-circle {
        width: 60px;
        height: 60px;
        font-size: 0.8rem;
      }
      
      .advanced-notification {
        right: 10px;
        left: 10px;
        min-width: auto;
        transform: translateY(-100px);
      }
      
      .advanced-notification.show {
        transform: translateY(0);
      }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
    @keyframes scoreFloat {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-30px) scale(1.2);
        opacity: 0;
      }
    }

    .final-results {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .result-item {
      padding: 0.5rem;
      margin: 0.3rem 0;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
    }

    .result-item.winner {
      background: rgba(255,215,0,0.3);
      border: 2px solid #ffd700;
    }

    .match-summary {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .score-breakdown {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .player-result {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .player-result.winner {
      background: rgba(40,167,69,0.2);
      border: 2px solid #28a745;
      color: #28a745;
    }

    .player-result.loser {
      background: rgba(220,53,69,0.2);
      border: 2px solid #dc3545;
      color: #dc3545;
    }

    .player-result.tie {
      background: rgba(255,193,7,0.2);
      border: 2px solid #ffc107;
      color: #856404;
    }

    .stats-container {
      text-align: left;
      margin: 1rem 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid #eee;
    }

    .stat-value {
      font-weight: 700;
      color: var(--accent-color);
    }

    .winner-stat {
      padding: 0.8rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      background: #f8f9fa;
      border-left: 4px solid var(--primary-color);
    }

    .winner-stat.top-winner {
      background: rgba(255,215,0,0.1);
      border-left-color: #ffd700;
      font-weight: 700;
    }

    /* Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… */
    .teacher-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #eee;
    }

    .tab-btn {
      padding: 0.8rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-color);
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: var(--primary-color);
      color: white;
      transform: translateY(2px);
    }

    .tab-content {
      display: none;
      padding: 1rem 0;
    }

    .tab-content.active {
      display: block;
    }

    .rule-card, .tip-card, .strategy-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1rem 0;
      border-left: 4px solid var(--primary-color);
    }

    .rule-card h4, .tip-card h4, .strategy-card h4 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .rule-card ul, .tip-card ul, .strategy-card ul {
      padding-right: 1.5rem;
      line-height: 1.6;
    }

    .rule-card li, .tip-card li, .strategy-card li {
      margin: 0.5rem 0;
    }

    .question-type {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border: 1px solid #ddd;
    }

    .question-type h5 {
      color: var(--accent-color);
      margin-bottom: 0.5rem;
    }

    .question-type p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-indicator.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-content {
      text-align: center;
      color: white;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      margin: 0 auto 2rem;
      animation: spin 1s linear infinite;
    }

    .loading-content h3 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .loading-content p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes fallingStar {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
</style>
</head>
<body>
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ­Ø¯Ø© -->
<div class="control-buttons">
  <button class="control-btn" id="backBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
    <i class="fas fa-home"></i>
  </button>
  <button class="control-btn" id="fullscreenBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
    <i class="fas fa-expand"></i>
  </button>
  <button class="control-btn" id="muteBtn" title="ÙƒØªÙ…/ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª">
    <i class="fas fa-volume-up"></i>
  </button>
</div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
<div id="notification-container"></div>

<!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
<div id="loadingIndicator" class="loading-indicator">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h3><i class="fas fa-fire"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h3>
    <p id="loadingText">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
  </div>
</div>

<div class="activity-container">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ­Ø¯ÙŠ -->
  <div class="challenge-header">
    <h1><i class="fas fa-fire"></i> Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª <i class="fas fa-fire"></i></h1>
    <p>Ø§Ø®ØªØ¨Ø± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ÙˆØªÙ†Ø§ÙØ³ Ù…Ø¹ Ø²Ù…Ù„Ø§Ø¦Ùƒ ÙÙŠ ØªØ­Ø¯ÙŠØ§Øª Ù…Ø«ÙŠØ±Ø©!</p>
  </div>

  <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="challenge-controls">
    <div class="control-group">
      <label><i class="fas fa-users"></i> Ø§Ø®ØªØ± Ø§Ù„ØµÙ:</label>
      <select id="classSelect">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
      </select>
    </div>

    <div class="control-group">
      <label><i class="fas fa-gamepad"></i> Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ:</label>
      <select id="mode" onchange="handleModeChange()">
        <option value="random">Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</option>
        <option value="manual">Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
        <option value="teams">ÙØ±ÙŠÙ‚ Ø¶Ø¯ ÙØ±ÙŠÙ‚</option>
        <option value="multiTeams">ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† ÙØ±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø©</option>
      </select>
    </div>

    <div id="manualSelection" class="manual-selection">
      <h4><i class="fas fa-hand-pointer"></i> Ø§Ø®ØªØ± Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ†</h4>
      <div class="control-group">
        <label>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„:</label>
        <select id="student1Select"></select>
      </div>
      <div class="control-group">
        <label>Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
        <select id="student2Select"></select>
      </div>
    </div>

    <div id="multiTeamOptions" class="multi-team-options">
      <h4><i class="fas fa-users-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©</h4>
      <div class="control-group">
        <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚:</label>
        <select id="teamCountSelect">
          <option value="3">3 ÙØ±Ù‚</option>
          <option value="4">4 ÙØ±Ù‚</option>
          <option value="5">5 ÙØ±Ù‚</option>
          <option value="6">6 ÙØ±Ù‚</option>
          <option value="7">7 ÙØ±Ù‚</option>
          <option value="8">8 ÙØ±Ù‚</option>
        </select>
      </div>
    </div>

    <div class="control-group">
      <label><i class="fas fa-clock"></i> Ø§Ù„Ù…Ø¯Ø©:</label>
      <select id="duration">
        <option value="30">30 Ø«Ø§Ù†ÙŠØ©</option>
        <option value="60">1 Ø¯Ù‚ÙŠÙ‚Ø©</option>
        <option value="120">2 Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="180">3 Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="240">4 Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="300">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
        <option value="600">10 Ø¯Ù‚Ø§Ø¦Ù‚</option>
      </select>
    </div>

    <div class="control-group">
      <button onclick="prepareChallenge()" class="btn btn-accent">
        <i class="fas fa-rocket"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
      </button>
      <button onclick="showTeacherGuide()" class="btn btn-info">
        <i class="fas fa-chalkboard-teacher"></i> Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…
      </button>
    </div>
  </div>

  <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ­Ø¯ÙŠ -->
  <div id="challengeArea" class="challenge-area">
    <div id="turnLabel" class="turn-display">
      <i class="fas fa-user-clock"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...
    </div>

    <div id="timerWrapper" class="timer-container">
      <svg class="timer-circle" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="50" fill="none" stroke="#eee" stroke-width="8"></circle>
        <circle cx="60" cy="60" r="50" fill="none" id="progress" stroke="var(--accent-color)" 
                stroke-dasharray="314" stroke-dashoffset="0" stroke-width="8" 
                transform="rotate(-90 60 60)"></circle>
      </svg>
      <div id="timerTextSec" class="timer-text">0s</div>
    </div>

    <div class="teams-grid" id="teamsContainer"></div>

    <div class="challenge-actions">
      <button onclick="nextTurn()" class="btn btn-primary">
        <i class="fas fa-arrow-right"></i> Ø§Ù„ØªØ§Ù„ÙŠ
      </button>
      <button onclick="endChallenge()" class="btn btn-success">
        <i class="fas fa-trophy"></i> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
      </button>
      <button onclick="resetChallenge()" class="btn btn-secondary">
        <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
      </button>
    </div>

    <div id="winnerDisplay" class="winner-display"></div>
  </div>
</div>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="instructionModal" class="instruction-modal">
  <div class="modal-content">
    <h2><i class="fas fa-info-circle"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠ</h2>
    <p id="instructionText"></p>
    <button onclick="closeInstructionModal()" class="btn btn-primary">
      <i class="fas fa-check"></i> ÙÙ‡Ù…Øª
    </button>
  </div>
</div>

<!-- Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ -->
<div id="teacherGuideModal" class="instruction-modal">
  <div class="modal-content" style="max-width: 800px;">
    <h2><i class="fas fa-chalkboard-teacher"></i> Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… - Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h2>
    
    <div class="teacher-tabs">
      <button class="tab-btn active" data-tab="rules">Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø§Ø·</button>
      <button class="tab-btn" data-tab="management">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ</button>
      <button class="tab-btn" data-tab="strategies">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
    </div>
    
    <div id="rules-content" class="tab-content active">
      <h3><i class="fas fa-list-ol"></i> Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù†Ø´Ø§Ø·</h3>
      <div class="rule-card">
        <h4>ğŸ¯ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ù†Ø´Ø§Ø·</h4>
        <p>ØªØ­ÙÙŠØ² Ø§Ù„ØªÙ†Ø§ÙØ³ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ.</p>
      </div>
      
      <div class="rule-card">
        <h4>âš™ï¸ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h4>
        <ul>
          <li><strong>Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ):</strong> Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</li>
          <li><strong>Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</strong> Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø·Ù„Ø§Ø¨ Ù…Ø­Ø¯Ø¯ÙŠÙ†</li>
          <li><strong>ÙØ±ÙŠÙ‚ Ø¶Ø¯ ÙØ±ÙŠÙ‚:</strong> Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</li>
          <li><strong>ÙØ±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø©:</strong> Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</li>
        </ul>
      </div>
      
      <div class="rule-card">
        <h4>ğŸ•’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª</h4>
        <p>ÙŠÙ…ÙƒÙ† ØªØ®ØµÙŠØµ Ù…Ø¯Ø© ÙƒÙ„ Ø¯ÙˆØ± Ù…Ù† 30 Ø«Ø§Ù†ÙŠØ© Ø¥Ù„Ù‰ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.</p>
      </div>
    </div>
    
    <div id="management-content" class="tab-content">
      <h3><i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</h3>
      
      <div class="tip-card">
        <h4>ğŸ“‹ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø³Ø¨Ù‚</h4>
        <ul>
          <li>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø­Ø¬Ù… Ø§Ù„ØµÙ</li>
          <li>Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</li>
          <li>Ø¬Ù‡Ø² Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© ÙˆÙ…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ù„Ø§Ø¨</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>ğŸ® Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ</h4>
        <ul>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± +/- Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙˆØ±Ø§Ù‹</li>
          <li>Ø´Ø¬Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø§Ù„ØªØµÙÙŠÙ‚</li>
          <li>Ø±Ø§Ù‚Ø¨ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ø³ØªÙØ¯ Ù…Ù† Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</li>
          <li>Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù…Ø§Ø³ ÙˆØ§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>âš–ï¸ Ø§Ù„Ø¹Ø¯Ø§Ù„Ø© ÙˆØ§Ù„ØªÙˆØ§Ø²Ù†</h4>
        <ul>
          <li>Ø§Ù…Ù†Ø­ ÙØ±Øµ Ù…ØªØ³Ø§ÙˆÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</li>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</li>
          <li>Ø§Ø¹Ø¯Ù„ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</li>
        </ul>
      </div>
    </div>
    
    <div id="strategies-content" class="tab-content">
      <h3><i class="fas fa-clipboard-check"></i> Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
      
      <div class="strategy-card">
        <h4>ğŸ¥‡ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
        <ul>
          <li><strong>Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø©:</strong> Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø© ÙˆØ§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</li>
          <li><strong>Ù†Ù‚Ø·ØªØ§Ù†:</strong> Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø© Ø£Ùˆ Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</li>
          <li><strong>Ù†Ù‚Ø·Ø© Ø¥Ø¶Ø§ÙÙŠØ©:</strong> Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø£Ùˆ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</li>
        </ul>
      </div>
      
      <div class="strategy-card">
        <h4>ğŸ“Š Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h4>
        <div class="question-type">
          <h5>âš¡ Ø£Ø³Ø¦Ù„Ø© Ø³Ø±ÙŠØ¹Ø© (30-60 Ø«Ø§Ù†ÙŠØ©)</h5>
          <p>Ø­Ù‚Ø§Ø¦Ù‚ Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ØªØ¹Ø§Ø±ÙŠÙØŒ Ø¹Ù…Ù„ÙŠØ§Øª Ø­Ø³Ø§Ø¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø©</p>
        </div>
        <div class="question-type">
          <h5>ğŸ§  Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙˆØ³Ø·Ø© (1-3 Ø¯Ù‚Ø§Ø¦Ù‚)</h5>
          <p>ØªØ­Ù„ÙŠÙ„ØŒ Ù…Ù‚Ø§Ø±Ù†Ø§ØªØŒ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø§Øª Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©</p>
        </div>
        <div class="question-type">
          <h5>ğŸ¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªÙ‚Ø¯Ù…Ø© (3-10 Ø¯Ù‚Ø§Ø¦Ù‚)</h5>
          <p>Ù…Ø´Ø§Ø±ÙŠØ¹ ØµØºÙŠØ±Ø©ØŒ Ø¹Ø±ÙˆØ¶ØŒ Ø­Ù„ Ù…Ø´ÙƒÙ„Ø§Øª Ù…Ø¹Ù‚Ø¯Ø©</p>
        </div>
      </div>
      
      <div class="strategy-card">
        <h4>ğŸ† Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªØ­ÙÙŠØ²</h4>
        <ul>
          <li>Ø§Ø­ØªÙÙ„ Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø©</li>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø±</li>
          <li>Ø§Ø±Ø¨Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¨Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</li>
          <li>Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ØªØ­ÙÙŠØ² Ø§Ù„ØªØ­Ø³Ù†</li>
        </ul>
      </div>
    </div>
    
    <button onclick="closeTeacherGuide()" class="btn btn-primary">
      <i class="fas fa-check"></i> ÙÙ‡Ù…Øª - Ù„Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ!
    </button>
  </div>
</div>

<!-- Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© -->
<div id="fireworks" class="fireworks-effect"></div>
<div id="timeUpPopup" class="time-up-popup">
  <i class="fas fa-clock"></i> Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!
</div>
<script src="../config/unified-scripts-template.js"></script>
<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ActivityUtils
  const activity = new ActivityUtils('Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª', '../assets/media/sounds/');
  
  // ==== Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø°ÙƒÙŠ ====
  const challengeSounds = {
    start: '../assets/media/sounds/start-timer.mp3',
    win: '../assets/media/sounds/win.mp3',
    winBlockbusters: '../assets/media/sounds/win-Blockbusters.mp3',
    celebration: '../assets/media/sounds/clap.mp3',
    timeUp: '../assets/media/sounds/long-beep.mp3',
    countdown: '../assets/media/sounds/countdown-beep.mp3',
    click: '../assets/media/sounds/Click.mp3',
    select: '../assets/media/sounds/select.mp3',
    reveal: '../assets/media/sounds/reveal.mp3',
    vs: '../assets/media/sounds/vs.mp3',
    draw: '../assets/media/sounds/draw.mp3',
    end: '../assets/media/sounds/end-timer.mp3',
    nameStart: '../assets/media/sounds/name-start.mp3',
    nameStop: '../assets/media/sounds/name-stop.mp3'
  };
  
  // ØªØ´ØºÙŠÙ„ ØªØ³Ù„Ø³Ù„ Ø£ØµÙˆØ§Øª Ø§Ù„ÙÙˆØ² Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
  function playWinSoundSequence() {
    if (!activity.soundEnabled) return;
    
    console.log('ğŸµ Ø¨Ø¯Ø¡ ØªØ³Ù„Ø³Ù„ Ø£ØµÙˆØ§Øª Ø§Ù„ÙÙˆØ² Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...');
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ÙÙˆØ² Ø£ÙˆÙ„Ø§Ù‹
    activity.playSound('win.mp3');
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª win-Blockbusters Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø£ÙˆÙ„
    setTimeout(() => {
      activity.playSound('win-Blockbusters.mp3');
    }, 1000);
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªØµÙÙŠÙ‚ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
    setTimeout(() => {
      activity.playSound('clap.mp3');
    }, 2500);
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù…ØªØ²Ø§Ù…Ù†Ø©
    showCelebrationEffects();
  }
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„ Ø§Ù„Ù…Ø±Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
  function showCelebrationEffects() {
    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // Ø¥Ø¶Ø§ÙØ© ÙƒÙˆÙ†ÙÙŠØªÙŠ Ù…ØªÙ‚Ø¯Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§Ø­Ù„
    if (window.confetti) {
      // Ø§Ù†ÙØ¬Ø§Ø± Ù…Ø±ÙƒØ²ÙŠ
      confetti({ 
        particleCount: 100, 
        spread: 70, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700', '#4169E1', '#8A2BE2']
      });
      
      // Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª Ø¬Ø§Ù†Ø¨ÙŠØ©
      setTimeout(() => {
        confetti({ 
          particleCount: 50, 
          spread: 120, 
          origin: { x: 0.1, y: 0.7 },
          colors: ['#FF6347', '#32CD32', '#FFD700']
        });
        confetti({ 
          particleCount: 50, 
          spread: 120, 
          origin: { x: 0.9, y: 0.7 },
          colors: ['#FF6347', '#32CD32', '#FFD700']
        });
      }, 500);
      
      // Ø§Ù†ÙØ¬Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ
      setTimeout(() => {
        confetti({ 
          particleCount: 80, 
          spread: 100, 
          origin: { y: 0.8 },
          colors: ['#FF1493', '#00CED1', '#FFD700', '#FF6347']
        });
      }, 1000);
    }

    // Ø¥Ø¶Ø§ÙØ© Ù†Ø¬ÙˆÙ… Ù…ØªØ³Ø§Ù‚Ø·Ø©
    createFallingStars();

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 5000);
  }
  
  // Ù†Ø¬ÙˆÙ… Ù…ØªØ³Ø§Ù‚Ø·Ø©
  function createFallingStars() {
    for (let i = 0; i < 10; i++) {
      setTimeout(() => {
        const star = document.createElement('div');
        star.innerHTML = 'â­';
        star.style.cssText = `
          position: fixed;
          font-size: 2rem;
          color: #FFD700;
          z-index: 9999;
          pointer-events: none;
          animation: fallingStar 3s ease-in forwards;
          left: ${Math.random() * 100}vw;
          top: -50px;
        `;
        document.body.appendChild(star);
        
        setTimeout(() => {
          if (star.parentNode) star.parentNode.removeChild(star);
        }, 3000);
      }, i * 200);
    }
  }
  
  // ØªØ­ÙƒÙ… ØµÙˆØªÙŠ Ø°ÙƒÙŠ
  function playSmartSound(soundKey, options = {}) {
    const { volume = 0.7, delay = 0, loop = false } = options;
    
    setTimeout(() => {
      const soundPath = challengeSounds[soundKey];
      if (soundPath && activity.soundEnabled) {
        activity.playSound(soundPath.split('/').pop(), { volume, loop });
      }
    }, delay);
  }// ==== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· ====
let studentData = {}, currentList = [], timer, timeLeft = 0;
let currentTurn = 1, usedStudents = [];
let teamScores = {};
let challengeStats = {
  totalChallenges: 0,
  completedChallenges: 0,
  teamWins: {},
  averageTime: 0,
  bestStreak: 0,
  currentStreak: 0,
  sessionStart: Date.now(),
  dailyStats: {},
  favoriteMode: '',
  totalPlayTime: 0
};

// ==== Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ====
function saveProgress() {
  try {
    const progressData = {
      stats: challengeStats,
      lastPlayed: Date.now(),
      version: '2.0'
    };
    localStorage.setItem('challengesProgress', JSON.stringify(progressData));
    console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
  } catch (error) {
    console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù…:', error);
  }
}

function loadProgress() {
  try {
    const saved = localStorage.getItem('challengesProgress');
    if (saved) {
      const progressData = JSON.parse(saved);
      challengeStats = { ...challengeStats, ...progressData.stats };
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
      const today = new Date().toDateString();
      if (!challengeStats.dailyStats[today]) {
        challengeStats.dailyStats[today] = {
          challenges: 0,
          timeSpent: 0,
          wins: {}
        };
      }
      
      console.log('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø­ÙÙˆØ¸');
      return true;
    }
  } catch (error) {
    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…:', error);
  }
  return false;
}

// ==== Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠ ====
function updatePerformanceStats(winner, timeSpent, mode) {
  const today = new Date().toDateString();
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  challengeStats.totalChallenges++;
  challengeStats.completedChallenges++;
  challengeStats.totalPlayTime += timeSpent;
  challengeStats.averageTime = challengeStats.totalPlayTime / challengeStats.completedChallenges;
  
  // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ²
  if (winner) {
    challengeStats.teamWins[winner] = (challengeStats.teamWins[winner] || 0) + 1;
    challengeStats.currentStreak++;
    challengeStats.bestStreak = Math.max(challengeStats.bestStreak, challengeStats.currentStreak);
  } else {
    challengeStats.currentStreak = 0;
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù…ÙØ¶Ù„
  const modes = JSON.parse(localStorage.getItem('challengesModes') || '{}');
  modes[mode] = (modes[mode] || 0) + 1;
  localStorage.setItem('challengesModes', JSON.stringify(modes));
  
  const favoriteMode = Object.keys(modes).reduce((a, b) => modes[a] > modes[b] ? a : b);
  challengeStats.favoriteMode = favoriteMode;
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
  if (!challengeStats.dailyStats[today]) {
    challengeStats.dailyStats[today] = { challenges: 0, timeSpent: 0, wins: {} };
  }
  
  challengeStats.dailyStats[today].challenges++;
  challengeStats.dailyStats[today].timeSpent += timeSpent;
  
  if (winner) {
    challengeStats.dailyStats[today].wins[winner] = (challengeStats.dailyStats[today].wins[winner] || 0) + 1;
  }
  
  // Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù…
  saveProgress();
  
  // Ø¥Ø´Ø¹Ø§Ø± ØªØ­ÙÙŠØ²ÙŠ
  if (challengeStats.currentStreak > 0 && challengeStats.currentStreak % 5 === 0) {
    showAdvancedNotification(
      'ğŸ”¥ Ø¥Ù†Ø¬Ø§Ø² Ø±Ø§Ø¦Ø¹!',
      `Ø³Ù„Ø³Ù„Ø© Ø§Ù†ØªØµØ§Ø±Ø§Øª ${challengeStats.currentStreak} Ù…ØªØªØ§Ù„ÙŠØ©!`,
      'celebration',
      5000
    );
  }
}

// ==== ÙˆØ¸Ø§Ø¦Ù Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ====
function showLoadingIndicator(message = 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...') {
  const indicator = document.getElementById('loadingIndicator');
  const text = document.getElementById('loadingText');
  if (indicator) {
    indicator.classList.remove('hidden');
    if (text) text.textContent = message;
  }
}

function hideLoadingIndicator() {
  const indicator = document.getElementById('loadingIndicator');
  if (indicator) {
    indicator.classList.add('hidden');
  }
}

function updateLoadingProgress(message) {
  const text = document.getElementById('loadingText');
  if (text) text.textContent = message;
}  // ==== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­Ø³Ù† ÙˆØ§Ù„Ø°ÙƒÙŠ ====
  async function loadStudents() {
    // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    showLoadingIndicator('ï¿½ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...');
    updateLoadingProgress('Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ timeout Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
    const timeoutPromise = new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„')), 3000)
    );
    
    try {
      console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...');
      updateLoadingProgress('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...');
      
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø¹ timeout
      const response = await Promise.race([
        fetch('../data/studentData.json', {
          method: 'GET',
          cache: 'no-cache',
          headers: {
            'Content-Type': 'application/json',
          }
        }),
        fetch('https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/data/studentData.json', {
          method: 'GET',
          cache: 'no-cache',
          headers: {
            'Content-Type': 'application/json',
          }
        }),
        timeoutPromise
      ]);
      
      if (!response.ok) {
        throw new Error(`Ø®Ø·Ø£ HTTP: ${response.status}`);
      }
      
      updateLoadingProgress('Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
      studentData = await response.json();
      
      if (!studentData || typeof studentData !== 'object') {
        throw new Error('ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­');
      }
      
      updateLoadingProgress('ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©...');
      
      // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØµÙÙˆÙ
      populateClassSelect();
      setupEventListeners();
      
      const classCount = Object.keys(studentData).length;
      const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
      
      console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${totalStudents} Ø·Ø§Ù„Ø¨ Ù…Ù† ${classCount} ØµÙ`);
      
      updateLoadingProgress('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
      
      // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          'âœ… ØªØ­Ù…ÙŠÙ„ Ù†Ø§Ø¬Ø­!',
          `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${totalStudents} Ø·Ø§Ù„Ø¨ Ù…Ù† ${classCount} ØµÙ Ø¨Ù†Ø¬Ø§Ø­`,
          'success',
          4000
        );
      }, 1000);
      
    } catch (error) {
      console.warn('âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
      
      updateLoadingProgress('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...');
      
      // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ø³Ù†Ø©
      studentData = {
        'Ø§Ù„Ø¹Ø§Ø´Ø± Ø£': ['Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„ÙØ§Ø±Ø³ÙŠ', 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ', 'Ø³Ø§Ù„Ù… Ø®Ø§Ù„Ø¯ Ø§Ù„Ù‡Ù†Ø§Ø¦ÙŠ', 'Ù…Ø±ÙŠÙ… Ø³Ø¹ÙŠØ¯ Ø§Ù„ÙƒÙ†Ø¯ÙŠ'],
        'Ø§Ù„Ø¹Ø§Ø´Ø± Ø¨': ['Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ø¹Ù…Ø±ÙŠ', 'Ø®Ø¯ÙŠØ¬Ø© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ø¯Ø¬Ø§Ù„ÙŠ', 'Ø·Ù„Ø§Ù„ Ø³Ø§Ù„Ù… Ø§Ù„Ø´Ø­ÙŠ', 'Ù†ÙˆØ±Ø§ Ø¹Ù„ÙŠ Ø§Ù„Ø¨ÙˆØ³Ø¹ÙŠØ¯ÙŠ'],
        'Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø± Ø£': ['Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù… Ø§Ù„Ø±ÙˆØ§Ø­ÙŠ', 'Ø¹Ø§Ø¦Ø´Ø© Ø®Ø§Ù„Ø¯ Ø§Ù„Ø­Ø¨Ø³ÙŠ', 'ÙŠÙˆØ³Ù Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§ÙØ±ÙŠ', 'Ø²ÙŠÙ†Ø¨ Ø¹Ù„ÙŠ Ø§Ù„Ø³ÙŠØ§Ø¨ÙŠ'],
        'Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø± Ø£': ['Ø¹Ù…Ø± Ù…Ø­Ù…Ø¯ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ', 'Ø³Ø§Ø±Ø© Ø³Ø§Ù„Ù… Ø§Ù„Ø¹Ø¨Ø±ÙŠ', 'Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø®Ø±ÙˆØµÙŠ', 'Ø£Ø³Ù…Ø§Ø¡ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø·Ø§Ø´ÙŠ']
      };
      
      populateClassSelect();
      setupEventListeners();
      
      updateLoadingProgress('âš ï¸ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
      
      // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          'âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©',
          'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©',
          'warning',
          4000
        );
      }, 1000);
    }
  }
  
  // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ
  function populateClassSelect() {
    const classSelect = document.getElementById('classSelect');
    classSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>';
    
    Object.keys(studentData).forEach(cls => {
      const option = document.createElement('option');
      option.value = cls;
      option.textContent = `Ø§Ù„ØµÙ ${cls}`;
      classSelect.appendChild(option);
    });
    
    // ØªØ­Ø¯ÙŠØ¯ Ø£ÙˆÙ„ ØµÙ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    if (classSelect.options.length > 1) {
      classSelect.selectedIndex = 1;
      populateStudentSelectors(classSelect.value);
    }
  }
  
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  function setupEventListeners() {
    const classSelect = document.getElementById('classSelect');
    
    classSelect.addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('Click.mp3');
    });

    // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ
    document.getElementById('student1Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });

    document.getElementById('student2Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });
  }

  // ==== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø°ÙƒÙŠ ====
  function showAdvancedNotification(title, message, type = 'info', duration = 4000) {
    const notification = document.createElement('div');
    notification.className = `advanced-notification ${type}`;
    
    const icons = {
      success: 'âœ…',
      warning: 'âš ï¸',
      error: 'âŒ',
      info: 'â„¹ï¸',
      challenge: 'ğŸ”¥',
      timer: 'â°',
      trophy: 'ğŸ†',
      loading: 'ğŸ”„',
      celebration: 'ğŸ‰'
    };
    
    notification.innerHTML = `
      <div class="notification-header">
        <span class="notification-icon">${icons[type] || 'â„¹ï¸'}</span>
        <span class="notification-title">${title}</span>
        <button class="notification-close" onclick="this.closest('.advanced-notification').remove()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="notification-message">${message}</div>
      <div class="notification-progress"></div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø­Ø§ÙˆÙŠØ©
    const container = document.getElementById('notification-container') || document.body;
    container.appendChild(notification);
    
    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
    setTimeout(() => notification.classList.add('show'), 100);
    
    // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
    const progressBar = notification.querySelector('.notification-progress');
    progressBar.style.animation = `progress ${duration}ms linear`;
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, duration);
    
    // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù…Ù†Ø§Ø³Ø¨
    activity.playSound('reveal.mp3');
    
    return notification;
  }

  // Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ø¦Ù… Ù„Ù„Ù†ØµØ§Ø¦Ø­
  function showFloatingTip(message, element) {
    const tip = document.createElement('div');
    tip.className = 'floating-tip';
    tip.innerHTML = `
      <div class="tip-content">
        <i class="fas fa-lightbulb"></i>
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(tip);
    
    // Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    const rect = element.getBoundingClientRect();
    tip.style.left = rect.left + 'px';
    tip.style.top = (rect.top - 60) + 'px';
    
    setTimeout(() => tip.classList.add('show'), 100);
    
    setTimeout(() => {
      tip.classList.remove('show');
      setTimeout(() => {
        if (tip.parentNode) tip.parentNode.removeChild(tip);
      }, 300);
    }, 3000);
  }

  // Ù†Ø¸Ø§Ù… Ù†ØµØ§Ø¦Ø­ Ø°ÙƒÙŠØ©
  function showGameTips() {
    const tips = [
      'ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©',
      'âš¡ Ø§Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©',
      'ğŸ¯ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡',
      'ğŸ”¥ Ø´Ø¬Ø¹ Ø§Ù„ØªÙ†Ø§ÙØ³ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ø¨',
      'ğŸ“Š Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØµØ§Ø¦Ø­',
      'ğŸ® Ø¬Ø±Ø¨ Ø£Ù†Ù…Ø§Ø· Ù…Ø®ØªÙ„ÙØ© Ù„ØªÙ†ÙˆÙŠØ¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©'
    ];
    
    const randomTip = tips[Math.floor(Math.random() * tips.length)];
    
    setTimeout(() => {
      showAdvancedNotification(
        'ğŸ’¡ Ù†ØµÙŠØ­Ø© Ø°ÙƒÙŠØ©',
        randomTip,
        'info',
        6000
      );
    }, Math.random() * 10000 + 15000); // Ø¨ÙŠÙ† 15-25 Ø«Ø§Ù†ÙŠØ©
  }

  // ==== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ù…Ø­Ø³Ù† ====
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    
    // ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    const timeDisplay = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${timeLeft}s`;
    
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeDisplay}`;

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ø°ÙŠØ± Ø§Ù„Ù…Ø­Ø³Ù†Ø©
    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      circle.style.stroke = '#ff4444'; // Ø£Ø­Ù…Ø± Ù„Ù„ØªØ­Ø°ÙŠØ±
      secText.style.color = '#ff4444';
      
      if (timeLeft <= 5) {
        activity.playSound('countdown-beep.mp3');
        secText.style.animation = 'pulse 0.5s infinite';
      }
    } else if (timeLeft <= 30) {
      circle.style.stroke = '#ff8800'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡
      secText.style.color = '#ff8800';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    } else {
      circle.style.stroke = 'var(--accent-color)';
      secText.style.color = 'var(--accent-color)';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    }
  }
  function populateStudentSelectors(cls) {
    const s1 = document.getElementById('student1Select');
    const s2 = document.getElementById('student2Select');
    const students = studentData[cls] || [];
    const selected1 = s1.value;
    const selected2 = s2.value;

    s1.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„</option>';
    s2.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>';

    students.forEach(stu => {
      if (stu !== selected2) {
        const opt1 = document.createElement('option');
        opt1.value = stu;
        opt1.textContent = stu;
        s1.appendChild(opt1);
      }
      if (stu !== selected1) {
        const opt2 = document.createElement('option');
        opt2.value = stu;
        opt2.textContent = stu;
        s2.appendChild(opt2);
      }
    });

    if (selected1 && [...s1.options].some(o => o.value === selected1)) s1.value = selected1;
    if (selected2 && [...s2.options].some(o => o.value === selected2)) s2.value = selected2;
  }

  // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ØªØºÙŠÙŠØ± Ù†Ù…Ø· Ø§Ù„ØªØ­Ø¯ÙŠ
  function handleModeChange() {
    const mode = document.getElementById('mode').value;
    
    activity.playSound('Click.mp3');
    
    const manualSelection = document.getElementById('manualSelection');
    const multiTeamOptions = document.getElementById('multiTeamOptions');
    
    manualSelection.style.display = (mode === 'manual') ? 'block' : 'none';
    multiTeamOptions.style.display = (mode === 'multiTeams') ? 'block' : 'none';

    if (mode === 'manual') {
      const currentClass = document.getElementById('classSelect').value;
      if (currentClass) {
        populateStudentSelectors(currentClass);
        activity.showNotification('Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠÙ† Ù„Ù„ØªØ­Ø¯ÙŠ', 'info');
      }
    }
  }

  // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
  function showInstructionModal(mode) {
    const modal = document.getElementById('instructionModal');
    const text = document.getElementById('instructionText');
    let instructions = '';

    switch (mode) {
      case 'random':
        instructions = 'Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„ØªØ­Ø¯ÙŠ. ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ù‡ Ø¯ÙˆØ± ÙˆØ²Ù…Ù† Ù…Ø­Ø¯Ø¯. Ø§Ù„Ù…Ø¹Ù„Ù… ÙŠØ³Ø¬Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø²Ø±Ø§Ø± + Ùˆ -.';
        break;
      case 'manual':
        instructions = 'ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠÙ† ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©. ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„Ù‡ ÙˆÙ‚Øª Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø£Ø¯Ø§Ø¡. ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹.';
        break;
      case 'teams':
        instructions = 'ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† ÙØ±ÙŠÙ‚ÙŠÙ†. ÙƒÙ„ ÙØ±ÙŠÙ‚ ÙŠÙ…ÙƒÙ†Ù‡ ÙƒØ³Ø¨ Ø£Ùˆ Ø®Ø³Ø§Ø±Ø© Ù†Ù‚Ø§Ø·. Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ ÙˆØ§Ù„ØªÙ†Ø§ÙØ³ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ.';
        break;
      case 'multiTeams':
        instructions = 'Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø¯Ø© ÙØ±Ù‚ (Ù…Ù† 3 Ø¥Ù„Ù‰ 8) Ø­Ø³Ø¨ Ø§Ø®ØªÙŠØ§Ø±Ùƒ. ÙƒÙ„ ÙØ±ÙŠÙ‚ Ù„Ù‡ Ø¯ÙˆØ±Ù‡ ÙˆÙ†Ù‚Ø§Ø·Ù‡ Ø§Ù„Ø®Ø§ØµØ©. Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©.';
        break;
    }

    text.textContent = instructions;
    modal.style.display = 'flex';
    activity.playSound('name-start.mp3');
  }

  // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
  function closeInstructionModal() {
    document.getElementById('instructionModal').style.display = 'none';
    prepareChallengeContinue();
  }

  // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
  function prepareChallenge() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;

    if (!cls) {
      activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ Ø£ÙˆÙ„Ø§Ù‹', false);
      return;
    }

    if (!mode) {
      activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠ', false);
      return;
    }

    activity.playSound('start-timer.mp3');
    showInstructionModal(mode);
  }

  // Ù…ØªØ§Ø¨Ø¹Ø© ØªØ­Ø¶ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
  function prepareChallengeContinue() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;
    timeLeft = parseInt(document.getElementById('duration').value);
    currentList = [...(studentData[cls] || [])];

    if (mode === 'multiTeams') {
      setupMultiTeams();
      return;
    }

    if (currentList.length < 2) {
      activity.showModal('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± ØµÙ Ø¨Ù‡ Ø·Ù„Ø§Ø¨ ÙƒØ§ÙÙŠÙŠÙ†', false);
      return;
    }

    let name1 = 'ÙØ±ÙŠÙ‚ 1', name2 = 'ÙØ±ÙŠÙ‚ 2';

    if (mode === 'random') {
      const remaining = currentList.filter(s => !usedStudents.includes(s));
      if (remaining.length < 2) {
        activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.', false);
        usedStudents = [];
        const shuffled = [...currentList].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      } else {
        const shuffled = [...remaining].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      }
      usedStudents.push(name1, name2);
    } else if (mode === 'manual') {
      name1 = document.getElementById('student1Select').value;
      name2 = document.getElementById('student2Select').value;
      if (!name1 || !name2) {
        activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ÙŠÙ†', false);
        return;
      }
      if (name1 === name2) {
        activity.showModal('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†', false);
        return;
      }
    }

    setupTwoPlayerChallenge(name1, name2);
  }

  // ==== Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ­Ø¯ÙŠ Ù…Ø­Ø³Ù† Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ† ====
  function setupTwoPlayerChallenge(name1, name2) {
    const container = document.getElementById('teamsContainer');
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    container.innerHTML = `
      <div class="team-card" data-team="1">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name1"><i class="fas fa-star"></i> ${name1}</h3>
        <div class="team-score" id="score1">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(1, 1)" title="Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(1, -1)" title="Ø®ØµÙ… Ù†Ù‚Ø·Ø©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status1">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ø¯ÙŠ</div>
      </div>
      <div class="vs-divider">
        <div class="vs-circle">
          <i class="fas fa-bolt"></i>
          <span>VS</span>
        </div>
      </div>
      <div class="team-card" data-team="2">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name2"><i class="fas fa-star"></i> ${name2}</h3>
        <div class="team-score" id="score2">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(2, 1)" title="Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(2, -1)" title="Ø®ØµÙ… Ù†Ù‚Ø·Ø©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status2">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ø¯ÙŠ</div>
      </div>
    `;

    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ±
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 100);

    teamScores = { '1': 0, '2': 0 };
    currentTurn = 1;

    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ!',
      `Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø© Ø¨ÙŠÙ† ${name1} Ùˆ ${name2}`,
      'challenge',
      3000
    );
    
    // ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ø«Ù… Ø¨Ø¯Ø¡ Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø£ÙˆÙ„
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ==== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù† ====
  function setupMultiTeams() {
    const teamCount = parseInt(document.getElementById('teamCountSelect').value);
    const container = document.getElementById('teamsContainer');
    
    // ØªØ£Ø«ÙŠØ± Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ
    container.style.opacity = '0';
    container.innerHTML = '';

    teamScores = {};
    const teamColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a29bfe'];

    for (let i = 1; i <= teamCount; i++) {
      const div = document.createElement('div');
      div.className = 'team-card multi-team';
      div.style.borderColor = teamColors[i - 1] || '#007bff';
      
      div.innerHTML = `
        <div class="team-avatar" style="background: ${teamColors[i - 1] || '#007bff'}">
          <i class="fas fa-users"></i>
        </div>
        <h3 id="name${i}"><i class="fas fa-flag"></i> ÙØ±ÙŠÙ‚ ${i}</h3>
        <div class="team-score" id="score${i}">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(${i}, 1)" title="Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(${i}, -1)" title="Ø®ØµÙ… Ù†Ù‚Ø·Ø©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status${i}">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
      `;
      
      container.appendChild(div);
      teamScores[i.toString()] = 0;
    }

    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
    }, 100);

    currentTurn = 1;
    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'ğŸ† ÙØ±Ù‚ Ù…ØªØ¹Ø¯Ø¯Ø© Ø¬Ø§Ù‡Ø²Ø©!',
      `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${teamCount} ÙØ±Ù‚ Ù„Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ±`,
      'success',
      3000
    );
    
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeLeft}s`;

    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      activity.playSound('countdown-beep.mp3');
    } else {
      wrapper.classList.remove('shake');
    }
  }

  // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
  function startTimer() {
    updateTimer();
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(timer);
        activity.playSound('long-beep.mp3');
        showTimeUpPopup();
      }
    }, 1000);
  }

  // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
  function showTimeUpPopup() {
    const popup = document.getElementById('timeUpPopup');
    popup.style.display = 'block';
    
    setTimeout(() => {
      popup.style.display = 'none';
      nextTurn();
    }, 2000);
  }

  // ==== Ø§Ù„Ø¯ÙˆØ± Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† ====
  function nextTurn() {
    activity.playSound('vs.mp3');
    clearInterval(timer);
    
    const mode = document.getElementById('mode').value;
    const turnLabel = document.getElementById('turnLabel');

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      const teamName = `ÙØ±ÙŠÙ‚ ${currentTurn}`;
      
      turnLabel.innerHTML = `<i class="fas fa-users"></i> Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ${teamName}`;
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚
      updateTeamTurnStatus(currentTurn, count);
      
      showAdvancedNotification(
        'ğŸ”„ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯!',
        `Ø­Ø§Ù† Ø¯ÙˆØ± ${teamName}`,
        'timer',
        2000
      );
      
      timeLeft = parseInt(document.getElementById('duration').value);
      startTimer();
      currentTurn = currentTurn >= count ? 1 : currentTurn + 1;
      return;
    }

    // Ù„Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨)
    const currentPlayerName = currentTurn === 1 ? 
      document.getElementById('name1').textContent : 
      document.getElementById('name2').textContent;
    
    const cleanName = currentPlayerName.replace('â­ ', '');
    turnLabel.innerHTML = `<i class="fas fa-user-clock"></i> Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ${cleanName}`;
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    updatePlayerTurnStatus(currentTurn);
    
    showAdvancedNotification(
      'âš¡ Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†!',
      `Ø­Ø§Ù† Ø¯ÙˆØ± ${cleanName}`,
      'timer',
      2000
    );
    
    timeLeft = parseInt(document.getElementById('duration').value);
    startTimer();
    currentTurn = currentTurn === 1 ? 2 : 1;
  }

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ÙØ±Ù‚
  function updateTeamTurnStatus(activeTurn, totalTeams) {
    for (let i = 1; i <= totalTeams; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'ğŸ¯ Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø¢Ù†!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
  function updatePlayerTurnStatus(activeTurn) {
    for (let i = 1; i <= 2; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'ğŸ¯ Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø¢Ù†!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ==== ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­Ø³Ù† ====
  function adjustScore(team, val) {
    activity.playSound('Click.mp3');
    
    const scoreElement = document.getElementById(`score${team}`);
    const statusElement = document.getElementById(`status${team}`);
    const teamCard = document.querySelector(`[data-team="${team}"]`);
    
    let score = parseInt(scoreElement.textContent) + val;
    score = Math.max(0, score); // Ù…Ù†Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ø§Ù„Ø¨Ø©
    
    const oldScore = parseInt(scoreElement.textContent);
    scoreElement.textContent = score;
    teamScores[team.toString()] = score;

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù…Ø­Ø³Ù†Ø©
    if (val > 0) {
      scoreElement.style.color = '#28a745';
      scoreElement.style.transform = 'scale(1.3)';
      if (statusElement) statusElement.textContent = '+' + val + ' Ù†Ù‚Ø·Ø©!';
      
      // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©
      createScoreParticles(scoreElement, '+' + val, '#28a745');
      
    } else if (val < 0) {
      scoreElement.style.color = '#dc3545';
      scoreElement.style.transform = 'scale(0.8)';
      if (statusElement) statusElement.textContent = val + ' Ù†Ù‚Ø·Ø©';
      
      // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø³Ø§Ù„Ø¨Ø©
      if (teamCard) {
        teamCard.classList.add('shake');
        setTimeout(() => teamCard.classList.remove('shake'), 500);
      }
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
    setTimeout(() => {
      scoreElement.style.color = 'var(--accent-color)';
      scoreElement.style.transform = 'scale(1)';
      if (statusElement) {
        statusElement.textContent = score > 5 ? 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²!' : 
                                  score > 2 ? 'ÙŠØªÙ‚Ø¯Ù… Ø¨Ø«Ø¨Ø§Øª' : 
                                  score > 0 ? 'Ø¨Ø¯Ø§ÙŠØ© Ø¬ÙŠØ¯Ø©' : 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©';
      }
    }, 1000);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
    updateTeamRanking();
  }

  // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ù„Ù„Ù†Ù‚Ø§Ø·
  function createScoreParticles(element, text, color) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      color: ${color};
      font-weight: bold;
      font-size: 1.2rem;
      pointer-events: none;
      z-index: 1000;
      animation: scoreFloat 1s ease-out forwards;
    `;
    particle.textContent = text;
    
    const rect = element.getBoundingClientRect();
    particle.style.left = rect.left + 'px';
    particle.style.top = rect.top + 'px';
    
    document.body.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 1000);
  }

  // ØªØ­Ø¯ÙŠØ« ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ±Ù‚
  function updateTeamRanking() {
    const teams = Object.keys(teamScores).map(team => ({
      id: team,
      score: teamScores[team],
      element: document.getElementById(`score${team}`)
    })).sort((a, b) => b.score - a.score);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø§ÙƒØ²
    teams.forEach((team, index) => {
      const statusElement = document.getElementById(`status${team.id}`);
      if (statusElement && teams.length > 2) {
        const position = index + 1;
        const positionText = position === 1 ? 'ğŸ¥‡ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„' :
                           position === 2 ? 'ğŸ¥ˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ' :
                           position === 3 ? 'ğŸ¥‰ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø«' :
                           `ğŸ“ Ø§Ù„Ù…Ø±ÙƒØ² ${position}`;
        statusElement.textContent = positionText;
      }
    });
  }

  // ==== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ====
  function showStatsButton() {
    const winnerDisplay = document.getElementById('winnerDisplay');
    if (winnerDisplay && winnerDisplay.style.display === 'block') {
      const statsBtn = document.createElement('button');
      statsBtn.className = 'btn btn-info';
      statsBtn.style.marginTop = '1rem';
      statsBtn.innerHTML = '<i class="fas fa-chart-pie"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª';
      statsBtn.onclick = showDetailedStats;
      winnerDisplay.appendChild(statsBtn);
    }
  }

  function showDetailedStats() {
    const modal = document.createElement('div');
    modal.className = 'instruction-modal';
    modal.style.display = 'flex';
    
    const totalGames = challengeStats.totalChallenges;
    const winData = Object.entries(challengeStats.teamWins)
      .map(([name, wins]) => ({ name, wins, percentage: Math.round((wins / totalGames) * 100) }))
      .sort((a, b) => b.wins - a.wins);
    
    modal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <h2><i class="fas fa-chart-pie"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h2>
        <div class="stats-container">
          <div class="stat-row">
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª:</span>
            <span class="stat-value">${totalGames}</span>
          </div>
          <div class="stat-row">
            <span>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:</span>
            <span class="stat-value">${challengeStats.completedChallenges}</span>
          </div>
          ${winData.length > 0 ? `
            <h3><i class="fas fa-trophy"></i> Ø³Ø¬Ù„ Ø§Ù„Ø§Ù†ØªØµØ§Ø±Ø§Øª</h3>
            ${winData.map((player, index) => `
              <div class="winner-stat ${index === 0 ? 'top-winner' : ''}">
                ${index === 0 ? 'ğŸ†' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ“Š'} 
                ${player.name}: ${player.wins} Ø§Ù†ØªØµØ§Ø± (${player.percentage}%)
              </div>
            `).join('')}
          ` : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù†ØªØµØ§Ø±Ø§Øª Ø¨Ø¹Ø¯</p>'}
        </div>
        <button onclick="this.closest('.instruction-modal').remove()" class="btn btn-primary">
          <i class="fas fa-check"></i> Ø¥ØºÙ„Ø§Ù‚
        </button>
      </div>
    `;
    
    document.body.appendChild(modal);
    activity.playSound('reveal.mp3');
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
  function loadSavedStats() {
    try {
      const saved = localStorage.getItem('challengeStats');
      if (saved) {
        challengeStats = { ...challengeStats, ...JSON.parse(saved) };
      }
    } catch (error) {
      console.log('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
    }
  }

  // ==== Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† ====
  function endChallenge() {
    clearInterval(timer);
    activity.playSound('end-timer.mp3');
    
    const mode = document.getElementById('mode').value;
    const winnerDisplay = document.getElementById('winnerDisplay');
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    challengeStats.totalChallenges++;
    challengeStats.completedChallenges++;

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      let maxScore = -1;
      let winners = [];
      let results = [];

      for (let i = 1; i <= count; i++) {
        const score = parseInt(document.getElementById(`score${i}`).textContent);
        results.push({ team: `ÙØ±ÙŠÙ‚ ${i}`, score: score });
        
        if (score > maxScore) {
          maxScore = score;
          winners = [`ÙØ±ÙŠÙ‚ ${i}`];
        } else if (score === maxScore) {
          winners.push(`ÙØ±ÙŠÙ‚ ${i}`);
        }
      }

      // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      results.sort((a, b) => b.score - a.score);
      
      const isWin = winners.length === 1;
      const result = isWin ? 
        `<i class="fas fa-trophy"></i> Ø§Ù„ÙØ§Ø¦Ø²: ${winners[0]} Ø¨Ù€ ${maxScore} Ù†Ù‚Ø·Ø©` : 
        `<i class="fas fa-handshake"></i> ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ†: ${winners.join(' Ùˆ ')} Ø¨Ù€ ${maxScore} Ù†Ù‚Ø·Ø©`;
      
      winnerDisplay.innerHTML = `
        ${result}
        <div class="final-results">
          <h4><i class="fas fa-chart-bar"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</h4>
          ${results.map((r, index) => 
            `<div class="result-item ${index === 0 ? 'winner' : ''}">
              ${index + 1}. ${r.team}: ${r.score} Ù†Ù‚Ø·Ø©
            </div>`
          ).join('')}
        </div>
      `;
      
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ²
      if (isWin) {
        challengeStats.teamWins[winners[0]] = (challengeStats.teamWins[winners[0]] || 0) + 1;
      }
      
      showAdvancedNotification(
        isWin ? 'ğŸ† Ù„Ø¯ÙŠÙ†Ø§ ÙØ§Ø¦Ø²!' : 'ğŸ¤ ØªØ¹Ø§Ø¯Ù„ Ù…Ø«ÙŠØ±!',
        isWin ? `${winners[0]} ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆÙ„` : `ØªØ¹Ø§Ø¯Ù„ Ø±Ø§Ø¦Ø¹ Ø¨ÙŠÙ† ${winners.length} ÙØ±Ù‚`,
        isWin ? 'trophy' : 'success',
        5000
      );
      
      playWinSoundSequence();
      
    } else {
      // Ù„Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø·Ø§Ù„Ø¨ Ø¶Ø¯ Ø·Ø§Ù„Ø¨)
      const name1 = document.getElementById('name1').textContent.replace('â­ ', '');
      const name2 = document.getElementById('name2').textContent.replace('â­ ', '');
      const score1 = parseInt(document.getElementById('score1').textContent);
      const score2 = parseInt(document.getElementById('score2').textContent);

      let result;
      let winnerName = '';
      
      if (score1 > score2) {
        result = `<i class="fas fa-trophy"></i> Ø§Ù„ÙØ§Ø¦Ø²: ${name1} Ø¨Ù€ ${score1} Ù†Ù‚Ø·Ø©`;
        winnerName = name1;
        showAdvancedNotification('ğŸ† Ù„Ø¯ÙŠÙ†Ø§ ÙØ§Ø¦Ø²!', `${name1} ÙŠÙÙˆØ² Ø¨Ø§Ù„ØªØ­Ø¯ÙŠ!`, 'trophy', 5000);
        playWinSoundSequence();
      } else if (score2 > score1) {
        result = `<i class="fas fa-trophy"></i> Ø§Ù„ÙØ§Ø¦Ø²: ${name2} Ø¨Ù€ ${score2} Ù†Ù‚Ø·Ø©`;
        winnerName = name2;
        showAdvancedNotification('ğŸ† Ù„Ø¯ÙŠÙ†Ø§ ÙØ§Ø¦Ø²!', `${name2} ÙŠÙÙˆØ² Ø¨Ø§Ù„ØªØ­Ø¯ÙŠ!`, 'trophy', 5000);
        playWinSoundSequence();
      } else {
        result = `<i class="fas fa-handshake"></i> ØªØ¹Ø§Ø¯Ù„! Ø§Ù„Ù†ØªÙŠØ¬Ø© ${score1} - ${score2}`;
        showAdvancedNotification('ğŸ¤ ØªØ¹Ø§Ø¯Ù„ Ù…Ø«ÙŠØ±!', 'Ù…Ø¨Ø§Ø±Ø§Ø© Ù…ØªÙˆØ§Ø²Ù†Ø© ØªÙ…Ø§Ù…Ø§Ù‹!', 'success', 5000);
        activity.playSound('draw.mp3');
      }

      winnerDisplay.innerHTML = `
        ${result}
        <div class="match-summary">
          <div class="score-breakdown">
            <div class="player-result ${score1 > score2 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name1}: ${score1} Ù†Ù‚Ø·Ø©
            </div>
            <div class="player-result ${score2 > score1 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name2}: ${score2} Ù†Ù‚Ø·Ø©
            </div>
          </div>
        </div>
      `;
      
      // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ²
      if (winnerName) {
        challengeStats.teamWins[winnerName] = (challengeStats.teamWins[winnerName] || 0) + 1;
      }
    }

    winnerDisplay.style.display = 'block';
    
    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    localStorage.setItem('challengeStats', JSON.stringify(challengeStats));
    
    // Ø¹Ø±Ø¶ Ø²Ø± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¶Ø§ÙÙŠ
    setTimeout(() => {
      showStatsButton();
    }, 2000);
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
  function showCelebration(isWin) {
    if (isWin) {
      activity.playSound('win.mp3');
      setTimeout(() => activity.playSound('clap.mp3'), 1000);
    } else {
      activity.playSound('draw.mp3');
    }

    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø©
    createFallingStars();
    
    // Ø¥Ø¶Ø§ÙØ© ÙƒÙˆÙ†ÙÙŠØªÙŠ
    if (window.confetti) {
      confetti({ 
        particleCount: 200, 
        spread: 120, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700']
      });
    }

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 4000);
  }

  // ==== Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† ====
  function resetChallenge() {
    activity.playSound('Click.mp3');
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
    clearInterval(timer);
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
    document.getElementById('challengeArea').style.display = 'none';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¨ØªØ£Ø«ÙŠØ± Ø§Ù†ØªÙ‚Ø§Ù„ÙŠ
    const container = document.getElementById('teamsContainer');
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      container.innerHTML = '';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 300);
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    currentTurn = 1;
    teamScores = {};
    timeLeft = 0;
    usedStudents = [];
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
    document.getElementById('classSelect').selectedIndex = 0;
    document.getElementById('mode').selectedIndex = 0;
    document.getElementById('duration').selectedIndex = 1; // 1 Ø¯Ù‚ÙŠÙ‚Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
    
    // Ø¥Ø®ÙØ§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    document.getElementById('manualSelection').style.display = 'none';
    document.getElementById('multiTeamOptions').style.display = 'none';
    
    showAdvancedNotification(
      'ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†',
      'Ø§Ù„Ù†Ø´Ø§Ø· Ø¬Ø§Ù‡Ø² Ù„ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯!',
      'info',
      3000
    );
    
    console.log('ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
  }

  // ==== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø­Ø³Ù†Ø© ====
  window.onload = async () => {
    console.log('ğŸ”¥ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...');
    
    // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    showLoadingIndicator('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...');
    
    try {
      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
      updateLoadingProgress('ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');
      activity.init();
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      updateLoadingProgress('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
      loadSavedStats();
      
      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
      await loadStudents();
      
      // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      setTimeout(() => {
        showAdvancedNotification(
          'ğŸ”¥ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„!',
          'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³Ø©',
          'challenge',
          5000
        );
      }, 2000);
      
      console.log('ğŸ‰ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
      
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø·:', error);
      updateLoadingProgress('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
      
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„',
          'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',
          'error',
          5000
        );
      }, 1000);
    }
  };

  // ==== Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… ====
  function showTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'flex';
    activity.playSound('reveal.mp3');
    setupTeacherTabs();
  }

  function closeTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'none';
    activity.playSound('Click.mp3');
  }

  function setupTeacherTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
        button.classList.add('active');
        const targetContent = document.getElementById(`${targetTab}-content`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
        
        // ØªØ£Ø«ÙŠØ± ØµÙˆØªÙŠ
        activity.playSound('Click.mp3');
      });
    });
  }
</script>
</body>
</html>
