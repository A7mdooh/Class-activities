<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ üî•</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="../assets/css/responsive.css">
<link rel="stylesheet" href="../config/unified-styles-template.css">
<style>
    /* ÿ™ÿÆÿµŸäÿµ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ */
    .activity-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .challenge-header {
      background: var(--gradient-primary);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: var(--shadow-large);
    }

    .challenge-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .challenge-controls {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      margin-bottom: 2rem;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .control-group label {
      font-weight: 600;
      color: var(--text-color);
      min-width: 100px;
    }

    .control-group select,
    .control-group button {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      border: 2px solid var(--primary-color);
      font-size: 1rem;
      font-weight: 600;
    }

    .control-group select {
      background: white;
      color: var(--primary-color);
      min-width: 150px;
    }

    .challenge-area {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      display: none;
      text-align: center;
    }

    .turn-display {
      background: var(--gradient-accent);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-medium);
    }

    .timer-container {
      position: relative;
      width: 150px;
      height: 150px;
      margin: 2rem auto;
    }

    .timer-circle {
      width: 150px;
      height: 150px;
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
    }

    .timer-container.shake {
      animation: shake 0.5s infinite;
    }

    .teams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      border: 3px solid var(--primary-color);
      transition: all 0.3s ease;
    }

    .team-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-large);
    }

    .team-card h3 {
      color: var(--primary-color);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .team-score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent-color);
      margin: 1rem 0;
    }

    .score-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .score-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .score-btn.plus {
      background: var(--gradient-success);
      color: white;
    }

    .score-btn.minus {
      background: var(--gradient-danger);
      color: white;
    }

    .score-btn:hover {
      transform: scale(1.1);
    }

    .challenge-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .winner-display {
      background: var(--gradient-accent);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      font-size: 2rem;
      font-weight: 700;
      margin-top: 2rem;
      box-shadow: var(--shadow-large);
      display: none;
    }

    .manual-selection {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .multi-team-options {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .instruction-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: var(--shadow-extra-large);
      position: relative;
    }

    .modal-content h2 {
      color: var(--primary-color);
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }

    .modal-content p {
      font-size: 1.3rem;
      line-height: 1.8;
      color: var(--text-color);
      margin-bottom: 2rem;
    }

    .time-up-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 2rem 3rem;
      border-radius: 20px;
      box-shadow: var(--shadow-extra-large);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
      z-index: 10000;
      display: none;
      border: 4px solid var(--accent-color);
    }

    .fireworks-effect {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('../assets/media/sounds/firework.gif') center center no-repeat;
      background-size: cover;
      z-index: 9999;
      display: none;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© */
    @media (max-width: 768px) {
      .challenge-header h1 {
        font-size: 2rem;
      }

      .control-group {
        flex-direction: column;
        text-align: center;
      }

      .teams-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .timer-container {
        width: 120px;
        height: 120px;
      }

      .timer-circle {
        width: 120px;
        height: 120px;
      }

      .challenge-actions {
        flex-direction: column;
        align-items: center;
      }
    }

    @media (max-width: 480px) {
      .activity-container {
        padding: 10px;
      }

      .challenge-header,
      .challenge-controls,
      .challenge-area {
        padding: 1rem;
      }

      .team-score {
        font-size: 2.5rem;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(5px, 0); }
      50% { transform: translate(0, 5px); }
      75% { transform: translate(-5px, 0); }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© */
    .advanced-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 15px;
      padding: 1rem 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index: 10000;
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
      min-width: 300px;
      border-left: 5px solid var(--primary-color);
    }

    .advanced-notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .advanced-notification.success { border-left-color: #28a745; }
    .advanced-notification.warning { border-left-color: #ffc107; }
    .advanced-notification.error { border-left-color: #dc3545; }
    .advanced-notification.challenge { border-left-color: #ff6b35; }
    .advanced-notification.timer { border-left-color: #17a2b8; }
    .advanced-notification.trophy { border-left-color: #ffd700; }
    .advanced-notification.loading { border-left-color: #6f42c1; }
    .advanced-notification.celebration { border-left-color: #fd7e14; }

    .notification-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .notification-close {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      padding: 0.2rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .notification-close:hover {
      background: #f0f0f0;
      color: #666;
    }

    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: var(--primary-color);
      border-radius: 0 0 15px 15px;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    /* ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿπÿßÿ¶ŸÖÿ© */
    .floating-tip {
      position: fixed;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-size: 0.9rem;
      z-index: 10001;
      transform: translateY(10px);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .floating-tip.show {
      transform: translateY(0);
      opacity: 1;
    }

    .tip-content {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tip-content i {
      color: #ffd700;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑŸàÿßÿ¨Ÿáÿ© */
    .control-group button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .team-card:hover .team-avatar {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
    }

    .score-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÜÿ™ŸÇÿßŸÑŸäÿ© ŸÖÿ≠ÿ≥ŸÜÿ© */
    .challenge-area {
      animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© */
    @media (max-width: 768px) {
      .floating-tip {
        position: fixed;
        top: 20px !important;
        left: 20px !important;
        right: 20px !important;
        width: auto !important;
      }
    }

    .notification-icon {
      font-size: 1.2rem;
    }

    .notification-message {
      color: var(--text-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ© */
    .star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: fallingStar 3s linear forwards;
      text-shadow: 0 0 10px #ffd700;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸÅÿ±ŸÇ */
    .team-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .team-status {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      padding: 0.3rem 0.8rem;
      background: #f8f9fa;
      border-radius: 15px;
      text-align: center;
    }

    .vs-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 1rem;
    }

    .vs-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--gradient-accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
    }

    .vs-circle i {
      font-size: 1.2rem;
      margin-bottom: 0.2rem;
    }

    .multi-team {
      position: relative;
      overflow: hidden;
    }

    .multi-team::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-color);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @media (max-width: 768px) {
      .vs-divider {
        margin: 1rem 0;
      }
      
      .vs-circle {
        width: 60px;
        height: 60px;
        font-size: 0.8rem;
      }
      
      .advanced-notification {
        right: 10px;
        left: 10px;
        min-width: auto;
        transform: translateY(-100px);
      }
      
      .advanced-notification.show {
        transform: translateY(0);
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    @keyframes scoreFloat {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-30px) scale(1.2);
        opacity: 0;
      }
    }

    .final-results {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .result-item {
      padding: 0.5rem;
      margin: 0.3rem 0;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
    }

    .result-item.winner {
      background: rgba(255,215,0,0.3);
      border: 2px solid #ffd700;
    }

    .match-summary {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .score-breakdown {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .player-result {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .player-result.winner {
      background: rgba(40,167,69,0.2);
      border: 2px solid #28a745;
      color: #28a745;
    }

    .player-result.loser {
      background: rgba(220,53,69,0.2);
      border: 2px solid #dc3545;
      color: #dc3545;
    }

    .player-result.tie {
      background: rgba(255,193,7,0.2);
      border: 2px solid #ffc107;
      color: #856404;
    }

    .stats-container {
      text-align: left;
      margin: 1rem 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid #eee;
    }

    .stat-value {
      font-weight: 700;
      color: var(--accent-color);
    }

    .winner-stat {
      padding: 0.8rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      background: #f8f9fa;
      border-left: 4px solid var(--primary-color);
    }

    .winner-stat.top-winner {
      background: rgba(255,215,0,0.1);
      border-left-color: #ffd700;
      font-weight: 700;
    }

    /* ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ */
    .teacher-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #eee;
    }

    .tab-btn {
      padding: 0.8rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-color);
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: var(--primary-color);
      color: white;
      transform: translateY(2px);
    }

    .tab-content {
      display: none;
      padding: 1rem 0;
    }

    .tab-content.active {
      display: block;
    }

    .rule-card, .tip-card, .strategy-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1rem 0;
      border-left: 4px solid var(--primary-color);
    }

    .rule-card h4, .tip-card h4, .strategy-card h4 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .rule-card ul, .tip-card ul, .strategy-card ul {
      padding-right: 1.5rem;
      line-height: 1.6;
    }

    .rule-card li, .tip-card li, .strategy-card li {
      margin: 0.5rem 0;
    }

    .question-type {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border: 1px solid #ddd;
    }

    .question-type h5 {
      color: var(--accent-color);
      margin-bottom: 0.5rem;
    }

    .question-type p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ */
    .loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-indicator.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-content {
      text-align: center;
      color: white;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      margin: 0 auto 2rem;
      animation: spin 1s linear infinite;
    }

    .loading-content h3 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .loading-content p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes fallingStar {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }
</style>
</head>
<body>
<!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖŸàÿ≠ÿØÿ© -->
<div class="control-buttons mobile-grid-3">
  <button class="control-btn touch-target" id="backBtn" title="ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">
    <i class="fas fa-home"></i>
  </button>
  <button class="control-btn touch-target" id="fullscreenBtn" title="ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©">
    <i class="fas fa-expand"></i>
  </button>
  <button class="control-btn touch-target" id="muteBtn" title="ŸÉÿ™ŸÖ/ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™">
    <i class="fas fa-volume-up"></i>
  </button>
</div>

<!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
<div id="notification-container"></div>

<!-- ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ ÿ≤ÿ± ÿ•ÿÆŸÅÿßÿ° ÿ∑ÿßÿ±ÿ¶ -->
<div id="loadingIndicator" class="loading-indicator">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h3><i class="fas fa-fire"></i> ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h3>
    <p id="loadingText">Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...</p>
    <button onclick="hideLoadingIndicator(); challengeEnhancer.showToast('‚úÖ ÿ™ŸÖ', 'ÿ™ŸÖ ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸäÿØŸàŸäÿßŸã', 'success')" 
            style="margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
      <i class="fas fa-times"></i> ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    </button>
  </div>
</div>

<div class="activity-container mobile-full-width">
  <!-- ÿ±ÿ£ÿ≥ ÿßŸÑÿ™ÿ≠ÿØŸä -->
  <div class="challenge-header mobile-text-center">
    <h1><i class="fas fa-fire"></i> ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ <i class="fas fa-fire"></i></h1>
    <p>ÿßÿÆÿ™ÿ®ÿ± ŸÖŸáÿßÿ±ÿßÿ™ŸÉ Ÿàÿ™ŸÜÿßŸÅÿ≥ ŸÖÿπ ÿ≤ŸÖŸÑÿßÿ¶ŸÉ ŸÅŸä ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÖÿ´Ÿäÿ±ÿ©!</p>
  </div>

  <!-- ÿ£ÿØŸàÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
  <div class="challenge-controls mobile-full-width">
    <div class="control-group mobile-full-width">
      <label><i class="fas fa-users"></i> ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ:</label>
      <select id="classSelect" class="mobile-full-width">
        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>
      </select>
    </div>

    <div class="control-group mobile-full-width">
      <label><i class="fas fa-gamepad"></i> ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä:</label>
      <select id="mode" onchange="handleModeChange()" class="mobile-full-width">
        <option value="random">ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿπÿ¥Ÿàÿßÿ¶Ÿä)</option>
        <option value="manual">ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</option>
        <option value="teams">ŸÅÿ±ŸäŸÇ ÿ∂ÿØ ŸÅÿ±ŸäŸÇ</option>
        <option value="multiTeams">ÿ™ÿ≠ÿØŸä ÿ®ŸäŸÜ ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ©</option>
      </select>
    </div>

    <div id="manualSelection" class="manual-selection mobile-full-width">
      <h4><i class="fas fa-hand-pointer"></i> ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ</h4>
      <div class="control-group mobile-full-width">
        <label>ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ£ŸàŸÑ:</label>
        <select id="student1Select" class="mobile-full-width"></select>
      </div>
      <div class="control-group mobile-full-width">
        <label>ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ´ÿßŸÜŸä:</label>
        <select id="student2Select" class="mobile-full-width"></select>
      </div>
    </div>

    <div id="multiTeamOptions" class="multi-team-options mobile-full-width">
      <h4><i class="fas fa-users-cog"></i> ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©</h4>
      <div class="control-group mobile-full-width">
        <label>ÿπÿØÿØ ÿßŸÑŸÅÿ±ŸÇ:</label>
        <select id="teamCountSelect" class="mobile-full-width">
          <option value="3">3 ŸÅÿ±ŸÇ</option>
          <option value="4">4 ŸÅÿ±ŸÇ</option>
          <option value="5">5 ŸÅÿ±ŸÇ</option>
          <option value="6">6 ŸÅÿ±ŸÇ</option>
          <option value="7">7 ŸÅÿ±ŸÇ</option>
          <option value="8">8 ŸÅÿ±ŸÇ</option>
        </select>
      </div>
    </div>

    <div class="control-group mobile-full-width">
      <label><i class="fas fa-clock"></i> ÿßŸÑŸÖÿØÿ©:</label>
      <select id="duration" class="mobile-full-width">
        <option value="30">30 ÿ´ÿßŸÜŸäÿ©</option>
        <option value="60">1 ÿØŸÇŸäŸÇÿ©</option>
        <option value="120">2 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="180">3 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="240">4 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="300">5 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="600">10 ÿØŸÇÿßÿ¶ŸÇ</option>
      </select>
    </div>

    <div class="control-group mobile-grid-2">
      <button onclick="prepareChallenge()" class="btn btn-accent touch-target mobile-full-width">
        <i class="fas fa-rocket"></i> ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
      <button onclick="showTeacherGuide()" class="btn btn-info touch-target mobile-full-width">
        <i class="fas fa-chalkboard-teacher"></i> ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ
      </button>
    </div>
    
    <!-- ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ChallengeEnhancer -->
    <div class="control-group mobile-grid-3" style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid #e9ecef;">
      <button onclick="challengeEnhancer.toggleSounds()" class="btn btn-outline-secondary touch-target mobile-full-width" id="soundToggleBtn">
        <i class="fas fa-volume-up"></i> ÿßŸÑÿ£ÿµŸàÿßÿ™: ŸÖŸÅÿπŸÑ
      </button>
      <button onclick="challengeEnhancer.toggleVoiceHints()" class="btn btn-outline-secondary touch-target mobile-full-width" id="voiceToggleBtn">
        <i class="fas fa-microphone"></i> ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©: ŸÖŸÅÿπŸÑ
      </button>
      <button onclick="showEnhancerStats()" class="btn btn-outline-info touch-target mobile-full-width">
        <i class="fas fa-chart-bar"></i> ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤
      </button>
    </div>
  </div>

  <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ÿ≠ÿØŸä -->
  <div id="challengeArea" class="challenge-area mobile-full-width">
    <div id="turnLabel" class="turn-display mobile-text-center">
      <i class="fas fa-user-clock"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±...
    </div>

    <div id="timerWrapper" class="timer-container mobile-text-center">
      <svg class="timer-circle" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="50" fill="none" stroke="#eee" stroke-width="8"></circle>
        <circle cx="60" cy="60" r="50" fill="none" id="progress" stroke="var(--accent-color)" 
                stroke-dasharray="314" stroke-dashoffset="0" stroke-width="8" 
                transform="rotate(-90 60 60)"></circle>
      </svg>
      <div id="timerTextSec" class="timer-text">0s</div>
    </div>

    <div class="teams-grid mobile-grid-2" id="teamsContainer"></div>

    <div class="challenge-actions mobile-grid-3">
      <button onclick="nextTurn()" class="btn btn-primary touch-target mobile-full-width">
        <i class="fas fa-arrow-right"></i> ÿßŸÑÿ™ÿßŸÑŸä
      </button>
      <button onclick="endChallenge()" class="btn btn-success touch-target mobile-full-width">
        <i class="fas fa-trophy"></i> ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
      <button onclick="resetChallenge()" class="btn btn-secondary touch-target mobile-full-width">
        <i class="fas fa-redo"></i> ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
      </button>
    </div>

    <div id="winnerDisplay" class="winner-display"></div>
  </div>
</div>
<!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© -->
<div id="instructionModal" class="instruction-modal responsive-modal">
  <div class="modal-content mobile-full-height">
    <h2><i class="fas fa-info-circle"></i> ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä</h2>
    <p id="instructionText"></p>
    <button onclick="closeInstructionModal()" class="btn btn-primary touch-target mobile-full-width">
      <i class="fas fa-check"></i> ŸÅŸáŸÖÿ™
    </button>
  </div>
</div>

<!-- ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä -->
<div id="teacherGuideModal" class="instruction-modal responsive-modal">
  <div class="modal-content mobile-full-height" style="max-width: 800px;">
    <h2><i class="fas fa-chalkboard-teacher"></i> ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ - ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h2>
    
    <div class="teacher-tabs mobile-grid-3">
      <button class="tab-btn active touch-target" data-tab="rules">ŸÇŸàÿßÿπÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑</button>
      <button class="tab-btn touch-target" data-tab="management">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅ</button>
      <button class="tab-btn touch-target" data-tab="strategies">ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿßÿ™ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
    </div>
    
    <div id="rules-content" class="tab-content active">
      <h3><i class="fas fa-list-ol"></i> ŸÇŸàÿßÿπÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑</h3>
      <div class="rule-card">
        <h4>üéØ ÿßŸÑŸáÿØŸÅ ŸÖŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑</h4>
        <p>ÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ŸäŸÜ ÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸàÿßŸÑÿπŸÖŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä.</p>
      </div>
      
      <div class="rule-card">
        <h4>‚öôÔ∏è ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h4>
        <ul>
          <li><strong>ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿπÿ¥Ÿàÿßÿ¶Ÿä):</strong> ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©</li>
          <li><strong>ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä):</strong> ŸÑÿßÿ≥ÿ™ŸáÿØÿßŸÅ ÿ∑ŸÑÿßÿ® ŸÖÿ≠ÿØÿØŸäŸÜ</li>
          <li><strong>ŸÅÿ±ŸäŸÇ ÿ∂ÿØ ŸÅÿ±ŸäŸÇ:</strong> ŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä</li>
          <li><strong>ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ©:</strong> ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ© ŸàÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™</li>
        </ul>
      </div>
      
      <div class="rule-card">
        <h4>üïí ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸàŸÇÿ™</h4>
        <p>ŸäŸÖŸÉŸÜ ÿ™ÿÆÿµŸäÿµ ŸÖÿØÿ© ŸÉŸÑ ÿØŸàÿ± ŸÖŸÜ 30 ÿ´ÿßŸÜŸäÿ© ÿ•ŸÑŸâ 10 ÿØŸÇÿßÿ¶ŸÇ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑŸÜÿ¥ÿßÿ∑ ŸàÿßŸÑÿ£ŸáÿØÿßŸÅ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ©.</p>
      </div>
    </div>
    
    <div id="management-content" class="tab-content">
      <h3><i class="fas fa-users-cog"></i> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä</h3>
      
      <div class="tip-card">
        <h4>üìã ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑŸÖÿ≥ÿ®ŸÇ</h4>
        <ul>
          <li>ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸÅ</li>
          <li>ÿ≠ÿØÿØ ÿßŸÑŸÖÿØÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿµÿπŸàÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</li>
          <li>ÿ¨Ÿáÿ≤ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™ŸÜŸàÿπÿ© ŸàŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>üéÆ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä</h4>
        <ul>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ£ÿ≤ÿ±ÿßÿ± +/- ŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÅŸàÿ±ÿßŸã</li>
          <li>ÿ¥ÿ¨ÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ ÿπŸÑŸâ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ÿßŸÑÿ™ÿµŸÅŸäŸÇ</li>
          <li>ÿ±ÿßŸÇÿ® ÿßŸÑŸàŸÇÿ™ Ÿàÿßÿ≥ÿ™ŸÅÿØ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©</li>
          <li>ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÖÿßÿ≥ ŸàÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>‚öñÔ∏è ÿßŸÑÿπÿØÿßŸÑÿ© ŸàÿßŸÑÿ™Ÿàÿßÿ≤ŸÜ</h4>
        <ul>
          <li>ÿßŸÖŸÜÿ≠ ŸÅÿ±ÿµ ŸÖÿ™ÿ≥ÿßŸàŸäÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿä ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ©</li>
          <li>ÿßÿπÿØŸÑ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≠ÿ≥ÿ® ŸÇÿØÿ±ÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
        </ul>
      </div>
    </div>
    
    <div id="strategies-content" class="tab-content">
      <h3><i class="fas fa-clipboard-check"></i> ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿßÿ™ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</h3>
      
      <div class="strategy-card">
        <h4>ü•á ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜŸÇÿßÿ∑</h4>
        <ul>
          <li><strong>ŸÜŸÇÿ∑ÿ© Ÿàÿßÿ≠ÿØÿ©:</strong> ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ© ŸàÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©</li>
          <li><strong>ŸÜŸÇÿ∑ÿ™ÿßŸÜ:</strong> ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÖŸÅÿµŸÑÿ© ÿ£Ÿà ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ</li>
          <li><strong>ŸÜŸÇÿ∑ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©:</strong> ŸÑŸÑÿ•ÿ®ÿØÿßÿπ ÿ£Ÿà ÿßŸÑÿ≥ÿ±ÿπÿ© ÿßŸÑŸÖŸÖŸäÿ≤ÿ©</li>
        </ul>
      </div>
      
      <div class="strategy-card">
        <h4>üìä ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖŸÇÿ™ÿ±ÿ≠ÿ©</h4>
        <div class="question-type">
          <h5>‚ö° ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≥ÿ±Ÿäÿπÿ© (30-60 ÿ´ÿßŸÜŸäÿ©)</h5>
          <p>ÿ≠ŸÇÿßÿ¶ŸÇ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©ÿå ÿ™ÿπÿßÿ±ŸäŸÅÿå ÿπŸÖŸÑŸäÿßÿ™ ÿ≠ÿ≥ÿßÿ®Ÿäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©</p>
        </div>
        <div class="question-type">
          <h5>üß† ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (1-3 ÿØŸÇÿßÿ¶ŸÇ)</h5>
          <p>ÿ™ÿ≠ŸÑŸäŸÑÿå ŸÖŸÇÿßÿ±ŸÜÿßÿ™ÿå ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿßÿ™ ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ÿßŸÑÿµÿπŸàÿ®ÿ©</p>
        </div>
        <div class="question-type">
          <h5>üéØ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™ŸÇÿØŸÖÿ© (3-10 ÿØŸÇÿßÿ¶ŸÇ)</h5>
          <p>ŸÖÿ¥ÿßÿ±Ÿäÿπ ÿµÿ∫Ÿäÿ±ÿ©ÿå ÿπÿ±Ÿàÿ∂ÿå ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿßÿ™ ŸÖÿπŸÇÿØÿ©</p>
        </div>
      </div>
      
      <div class="strategy-card">
        <h4>üèÜ ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑÿ™ÿ≠ŸÅŸäÿ≤</h4>
        <ul>
          <li>ÿßÿ≠ÿ™ŸÅŸÑ ÿ®ÿßŸÑŸÜÿ¨ÿßÿ≠ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ŸàÿßŸÑŸÉÿ®Ÿäÿ±ÿ©</li>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ™ÿπÿ≤Ÿäÿ≤ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ±</li>
          <li>ÿßÿ±ÿ®ÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ®ÿßŸÑŸÖŸÜŸáÿ¨ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä</li>
          <li>ÿßÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑÿ™ÿ≠ÿ≥ŸÜ</li>
        </ul>
      </div>
    </div>
    
    <button onclick="closeTeacherGuide()" class="btn btn-primary">
      <i class="fas fa-check"></i> ŸÅŸáŸÖÿ™ - ŸÑŸÜÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸä!
    </button>
  </div>
</div>

<!-- ÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© -->
<div id="fireworks" class="fireworks-effect"></div>
<div id="timeUpPopup" class="time-up-popup">
  <i class="fas fa-clock"></i> ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!
</div>
<script src="../config/unified-scripts-template.js"></script>
<script>
  // ==== ChallengeEnhancer Pro - ŸÖÿØŸÖÿ¨ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ====
  /**
   * üí° ChallengeEnhancer Pro
   * ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ŸÖŸÜ ŸÜÿ∏ÿßŸÖ ÿ™ÿπÿ≤Ÿäÿ≤ ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿµŸÅŸäÿ©
   * ÿ™ÿ¥ŸÖŸÑ: ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸÅŸàÿ±Ÿäÿ©ÿå ÿ£ÿµŸàÿßÿ™ ÿ∞ŸÉŸäÿ©ÿå ŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿßÿ≠ÿ™ŸÅÿßŸÑŸäÿ©ÿå Ÿàÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿµŸàÿ™Ÿäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ©
   */
  class ChallengeEnhancer {
    constructor(activityName = 'ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™') {
      this.name = activityName;
      this.soundEnabled = true;
      this.voiceHintsEnabled = true;
      this.soundsPath = '../assets/media/sounds/';
      this.kingdomSoundsPath = '../assets/media/sounds/kingdom-sounds/';
      this.voicePhrases = [
        'ÿ£ÿØÿßÿ° ÿ±ÿßÿ¶ÿπ!',
        'ÿ£ŸÜÿ™ ÿπŸÑŸâ ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠!',
        'ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿ™ÿ¥ÿ™ÿπŸÑ!',
        'ŸÑÿß ÿ™ÿ™ŸàŸÇŸÅ ÿßŸÑÿ¢ŸÜ!',
        'ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ!',
        'ÿ£ÿπÿ∑Ÿä ŸÉŸÑ ŸÖÿß ŸÑÿØŸäŸÉ!',
        'ÿ™ÿ≠ÿØŸä ŸÜŸÅÿ≥ŸÉ ÿ£ŸÉÿ´ÿ±!',
        'ÿßŸÑŸÅŸàÿ≤ ŸÅŸä ŸÖÿ™ŸÜÿßŸàŸÑ ŸäÿØŸÉ!'
      ];
      this.motivationalCycleId = null;
      this.toastQueue = [];
      this.isProcessingToasts = false;
      this.lastInteractionTime = Date.now();
      
      // ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ™Ÿàÿ≥ÿ™
      this.injectCSS();
      
      console.log(`üéÆ ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ChallengeEnhancer ŸÑŸÑŸÜÿ¥ÿßÿ∑: ${this.name}`);
    }

    // ÿ≠ŸÇŸÜ CSS ŸÑŸÑÿ™Ÿàÿ≥ÿ™ ŸàÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™
    injectCSS() {
      if (document.getElementById('challenge-enhancer-styles')) return;
      
      const style = document.createElement('style');
      style.id = 'challenge-enhancer-styles';
      style.textContent = `
        .toast {
          min-width: 300px;
          max-width: 400px;
          margin-bottom: 10px;
          border-radius: 12px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.2);
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .toast.show {
          opacity: 1;
          transform: translateX(0);
        }
        
        .toast-success {
          background: linear-gradient(135deg, rgba(40, 167, 69, 0.95), rgba(25, 135, 84, 0.95));
          color: white;
          border-left: 4px solid #28a745;
        }
        
        .toast-info {
          background: linear-gradient(135deg, rgba(13, 202, 240, 0.95), rgba(13, 110, 253, 0.95));
          color: white;
          border-left: 4px solid #17a2b8;
        }
        
        .toast-warning {
          background: linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 143, 0, 0.95));
          color: #212529;
          border-left: 4px solid #ffc107;
        }
        
        .toast-error {
          background: linear-gradient(135deg, rgba(220, 53, 69, 0.95), rgba(157, 35, 49, 0.95));
          color: white;
          border-left: 4px solid #dc3545;
        }
        
        .toast-header {
          padding: 12px 16px 8px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-weight: 600;
          font-size: 1rem;
        }
        
        .toast-body {
          padding: 0 16px 12px;
          font-size: 0.9rem;
          line-height: 1.4;
          white-space: pre-line;
        }
        
        .toast button {
          background: none;
          border: none;
          color: inherit;
          font-size: 1.2rem;
          font-weight: bold;
          cursor: pointer;
          opacity: 0.7;
          transition: opacity 0.2s;
          padding: 4px;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
        }
        
        .toast button:hover {
          opacity: 1;
          background: rgba(255, 255, 255, 0.2);
        }
        
        .celebration-burst {
          position: fixed;
          pointer-events: none;
          z-index: 10000;
          animation: celebrationBurst 2s ease-out forwards;
        }
        
        @keyframes celebrationBurst {
          0% {
            transform: scale(0) rotate(0deg);
            opacity: 1;
          }
          50% {
            transform: scale(1.5) rotate(180deg);
            opacity: 0.8;
          }
          100% {
            transform: scale(3) rotate(360deg);
            opacity: 0;
          }
        }
        
        .motivational-pulse {
          animation: motivationalPulse 2s ease-in-out infinite;
        }
        
        @keyframes motivationalPulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        .hover-sound-enabled {
          transition: all 0.2s ease;
        }
        
        .hover-sound-enabled:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
        @media (max-width: 768px) {
          .toast {
            min-width: 280px;
            max-width: 95vw;
            margin: 5px;
            right: 10px !important;
          }
          
          .toast-header {
            padding: 10px 12px 6px;
            font-size: 0.9rem;
          }
          
          .toast-body {
            padding: 0 12px 10px;
            font-size: 0.85rem;
          }
        }
      `;
      document.head.appendChild(style);
    }

    // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸÑŸÅ ÿµŸàÿ™Ÿä ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖÿÆÿµÿµ ŸÖÿπ ŸÜÿ∏ÿßŸÖ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä
    playSound(filename, volume = 0.7, useKingdomSounds = false) {
      if (!this.soundEnabled) return;
      
      const basePath = useKingdomSounds ? this.kingdomSoundsPath : this.soundsPath;
      const fullPath = basePath + filename;
      
      try {
        const audio = new Audio(fullPath);
        audio.volume = Math.min(Math.max(volume, 0), 1);
        
        // ŸÜÿ∏ÿßŸÖ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä ŸÅŸä ÿ≠ÿßŸÑÿ© ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        audio.addEventListener('error', () => {
          console.warn(`ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ™: ${fullPath}`);
          // ÿ¨ÿ±ÿ® ÿßŸÑÿµŸàÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä
          const fallbackAudio = new Audio(this.soundsPath + 'Click.mp3');
          fallbackAudio.volume = volume * 0.5;
          fallbackAudio.play().catch(() => {});
        });
        
        const playPromise = audio.play();
        if (playPromise !== undefined) {
          playPromise.catch(e => {
            console.warn('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™:', e);
          });
        }
      } catch (e) {
        console.warn('ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ŸÉÿßÿ¶ŸÜ ÿßŸÑÿµŸàÿ™:', e);
      }
    }

    // ŸÇÿ±ÿßÿ°ÿ© ÿµŸàÿ™Ÿäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿØÿπŸÖ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
    speakRandomHint() {
      if (!this.voiceHintsEnabled || !window.speechSynthesis) return;
      
      // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ŸÉŸÑÿßŸÖ ÿ≥ÿßÿ®ŸÇ
      speechSynthesis.cancel();
      
      const msg = new SpeechSynthesisUtterance();
      msg.lang = 'ar-SA';
      msg.rate = 0.9;
      msg.pitch = 1.1;
      msg.volume = 0.8;
      msg.text = this.voicePhrases[Math.floor(Math.random() * this.voicePhrases.length)];
      
      // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ°
      msg.onerror = (e) => {
        console.warn('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØÿ´:', e);
      };
      
      speechSynthesis.speak(msg);
    }

    // ÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÅÿßÿπŸÑŸä ŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ŸÜÿ∏ÿßŸÖ ÿ∑ÿßÿ®Ÿàÿ±
    showToast(title, body, type = 'info', duration = 4000) {
      const toast = {
        title,
        body,
        type,
        duration,
        id: Date.now() + Math.random()
      };
      
      this.toastQueue.push(toast);
      
      if (!this.isProcessingToasts) {
        this.processToastQueue();
      }
    }

    // ŸÖÿπÿßŸÑÿ¨ ÿ∑ÿßÿ®Ÿàÿ± ÿßŸÑÿ™Ÿàÿ≥ÿ™ ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ™ÿ±ÿßŸÉŸÖ
    processToastQueue() {
      if (this.toastQueue.length === 0) {
        this.isProcessingToasts = false;
        return;
      }
      
      this.isProcessingToasts = true;
      const toast = this.toastQueue.shift();
      this.displayToast(toast);
      
      // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ™Ÿàÿ≥ÿ™ ÿßŸÑÿ™ÿßŸÑŸä ÿ®ÿπÿØ ŸÅÿ™ÿ±ÿ© ŸÇÿµŸäÿ±ÿ©
      setTimeout(() => {
        this.processToastQueue();
      }, 500);
    }

    // ÿπÿ±ÿ∂ ÿßŸÑÿ™Ÿàÿ≥ÿ™ ÿßŸÑŸÅÿπŸÑŸä
    displayToast(toastData) {
      const toastEl = document.createElement('div');
      toastEl.className = `toast toast-${toastData.type}`;
      toastEl.innerHTML = `
        <div class="toast-header">
          <strong>${toastData.title}</strong>
          <button onclick="this.closest('.toast').remove()" title="ÿ•ÿ∫ŸÑÿßŸÇ">&times;</button>
        </div>
        <div class="toast-body">${toastData.body}</div>
      `;
      
      // ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπ ÿßŸÑÿ™Ÿàÿ≥ÿ™
      Object.assign(toastEl.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        zIndex: 9999
      });
      
      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖŸàÿ∂ÿπ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ™Ÿàÿ≥ÿ™ÿßÿ™ ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©
      const existingToasts = document.querySelectorAll('.toast');
      let topOffset = 20;
      existingToasts.forEach(existing => {
        topOffset += existing.offsetHeight + 10;
      });
      toastEl.style.top = topOffset + 'px';
      
      document.body.appendChild(toastEl);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
      requestAnimationFrame(() => {
        toastEl.classList.add('show');
      });
      
      // ÿ•ÿ≤ÿßŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ©
      setTimeout(() => {
        toastEl.classList.remove('show');
        setTimeout(() => {
          if (toastEl.parentNode) {
            toastEl.remove();
          }
        }, 300);
      }, toastData.duration);
    }

    // ŸÖÿ§ÿ´ÿ± ÿßÿ≠ÿ™ŸÅÿßŸÑŸä ŸÖÿ™ŸÉÿßŸÖŸÑ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©
    celebrateWin(playerName) {
      // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™
      this.playSound('win.mp3');
      setTimeout(() => {
        this.playSound('fireworks-burst.mp3', 0.6, true);
      }, 500);
      
      // ÿ™ÿπŸÑŸäŸÇ ÿµŸàÿ™Ÿä
      setTimeout(() => {
        this.speakRandomHint();
      }, 1000);
      
      // ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿ™ŸáŸÜÿ¶ÿ©
      this.showToast('üèÜ ÿ™ŸáÿßŸÜŸäŸÜÿß!', `${playerName} ŸÅÿßÿ≤ ÿ®ÿßŸÑÿ™ÿ≠ÿØŸä!\nÿ£ÿØÿßÿ° ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ¶Ÿä ŸàŸÖÿ®Ÿáÿ±!`, 'success', 6000);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑÿ®ÿµÿ±Ÿä
      this.createCelebrationBurst();
      
      // ŸÖÿ§ÿ´ÿ± ÿßŸÑŸÉŸàŸÜŸÅŸäÿ™Ÿä ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ÿßÿ≠ÿßŸã
      if (window.confetti) {
        confetti({
          particleCount: 150,
          spread: 100,
          origin: { y: 0.7 },
          colors: ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4']
        });
        
        // ÿßŸÜŸÅÿ¨ÿßÿ± ÿ´ÿßŸÜŸä ÿ®ÿπÿØ ÿ´ÿßŸÜŸäÿ©
        setTimeout(() => {
          confetti({
            particleCount: 100,
            spread: 120,
            origin: { y: 0.6 },
            colors: ['#FFA726', '#EF5350', '#42A5F5', '#66BB6A']
          });
        }, 1000);
      }
    }

    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÜŸÅÿ¨ÿßÿ± ÿßÿ≠ÿ™ŸÅÿßŸÑŸä ŸÖÿÆÿµÿµ
    createCelebrationBurst() {
      const emojis = ['üéâ', 'üéä', '‚≠ê', '‚ú®', 'üåü', 'üèÜ', 'üëè', 'üéØ'];
      for (let i = 0; i < 12; i++) {
        setTimeout(() => {
          const burst = document.createElement('div');
          burst.className = 'celebration-burst';
          burst.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
          burst.style.left = Math.random() * window.innerWidth + 'px';
          burst.style.top = Math.random() * window.innerHeight + 'px';
          burst.style.fontSize = (Math.random() * 30 + 20) + 'px';
          
          document.body.appendChild(burst);
          
          setTimeout(() => {
            if (burst.parentNode) {
              burst.remove();
            }
          }, 2000);
        }, i * 150);
      }
    }

    // ÿ™ÿ≠ŸÅŸäÿ≤ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÖÿπ ŸÖŸÜÿ∑ŸÇ ŸÖÿ≠ÿ≥ŸÜ
    checkMilestones(score, playerName) {
      if (score === 0) {
        this.showToast('üöÄ ÿ™ÿ¥ÿ¨Ÿäÿπ!', `${playerName}ÿå ÿßŸÑÿ®ÿØÿßŸäÿ© ÿµÿπÿ®ÿ© ŸÑŸÉŸÜ ÿßŸÑŸÜŸáÿßŸäÿ© ÿ¨ŸÖŸäŸÑÿ©!\nŸÉŸÑ ÿÆÿ®Ÿäÿ± ŸÉÿßŸÜ ŸÖÿ®ÿ™ÿØÿ¶ÿßŸã ŸäŸàŸÖÿßŸã ŸÖÿß`, 'warning', 4000);
        this.playSound('notification-pop.mp3', 0.4, true);
      } else if (score === 1) {
        this.showToast('üåü ÿßŸÑÿ®ÿØÿßŸäÿ©!', `${playerName} ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ£ŸàŸÑ ŸÜŸÇÿ∑ÿ©!\nÿßŸÑÿ±ÿ≠ŸÑÿ© ÿ®ÿØÿ£ÿ™ ÿ®ÿÆÿ∑Ÿàÿ© Ÿàÿßÿ≠ÿØÿ©`, 'info', 3500);
        this.playSound('crystal-ping.mp3', 0.5, true);
      } else if (score === 3) {
        this.showToast('üî• ÿ™ŸÇÿØŸÖ ÿ±ÿßÿ¶ÿπ!', `${playerName} Ÿäÿ¥ŸÇ ÿ∑ÿ±ŸäŸÇŸá ŸÑŸÑŸÜÿ¨ÿßÿ≠!\nÿßŸÑÿ´ÿ®ÿßÿ™ ÿπŸÑŸâ ÿßŸÑŸáÿØŸÅ ÿ≥ÿ± ÿßŸÑŸÜÿ¨ÿßÿ≠`, 'info', 4000);
        this.playSound('level-up.mp3', 0.6, true);
      } else if (score === 5) {
        this.showToast('‚ö° ŸÜÿµŸÅ ÿßŸÑÿ∑ÿ±ŸäŸÇ!', `${playerName} ŸàÿµŸÑ ÿ•ŸÑŸâ ${score} ŸÜŸÇÿßÿ∑!\nÿßŸÑÿπÿ≤ŸäŸÖÿ© ÿßŸÑŸÇŸàŸäÿ© ÿ™ÿ≠ŸÇŸÇ ÿßŸÑŸÖÿπÿ¨ÿ≤ÿßÿ™`, 'info', 4500);
        this.playSound('achievement-unlock.mp3', 0.7, true);
        this.speakRandomHint();
      } else if (score === 8) {
        this.showToast('üéØ ŸÇÿ±Ÿäÿ® ÿ¨ÿØÿßŸã!', `${playerName} ÿπŸÑŸâ Ÿàÿ¥ŸÉ ÿ™ÿ≠ŸÇŸäŸÇ ÿ•ŸÜÿ¨ÿßÿ≤ ÿπÿ∏ŸäŸÖ!\nÿßŸÑÿÆÿ∑ ÿßŸÑÿ£ÿÆŸäÿ± ŸáŸà ÿßŸÑÿ£ÿµÿπÿ® ŸàÿßŸÑÿ£ŸáŸÖ`, 'warning', 5000);
        this.playSound('epic-charge.mp3', 0.8, true);
      } else if (score >= 10) {
        this.celebrateWin(playerName);
      }
    }

    // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿπŸÜÿØ ÿßŸÑŸÖÿ±Ÿàÿ± ÿπŸÑŸäŸáÿß ŸÖÿπ ÿ£ÿµŸàÿßÿ™
    attachHoverSound(buttonSelector = '.btn, button, .clickable') {
      document.querySelectorAll(buttonSelector).forEach(btn => {
        btn.classList.add('hover-sound-enabled');
        
        btn.addEventListener('mouseenter', () => {
          this.playSound('button-hover.mp3', 0.2, true);
        });
        
        btn.addEventListener('click', () => {
          this.playSound('cosmic-click.mp3', 0.3, true);
        });
      });
    }

    // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ŸÖÿ™ÿ≥ŸÑÿ≥ŸÑ ŸÑŸÑÿ™ÿ≠ŸÅŸäÿ≤ ŸÖÿπ ÿ∞ŸÉÿßÿ°
    startMotivationalCycle(interval = 30000) {
      if (this.motivationalCycleId) {
        clearInterval(this.motivationalCycleId);
      }
      
      const phrases = [
        'üí° ÿ™ÿ∞ŸÉÿ±: ÿßŸÑŸÜŸÇÿ∑ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ŸÇÿØ ÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©!\nŸÉŸÑ ŸÑÿ≠ÿ∏ÿ© ŸÅÿ±ÿµÿ© ŸÑŸÑÿ™ŸÖŸäÿ≤',
        'üìä ÿ™ÿßÿ®ÿπ ÿ™ŸÇÿØŸÖŸÉ ÿπŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨!\nÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ™ÿ≠ŸÉŸä ŸÇÿµÿ© ŸÜÿ¨ÿßÿ≠ŸÉ',
        'üß† ÿ±ŸÉÿ≤ÿå ŸÅÿ£ŸÜÿ™ ŸÇÿ±Ÿäÿ® ŸÖŸÜ ÿßŸÑŸÅŸàÿ≤!\nÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ŸáŸà ÿ≥ŸÑÿßÿ≠ ÿßŸÑÿ£ÿ®ÿ∑ÿßŸÑ',
        '‚ö° ÿßŸÑÿ™ÿ≠ÿØŸä ŸÑÿß ŸäŸÜÿ™ŸáŸä ÿ•ŸÑÿß ŸÖÿπ ÿ¢ÿÆÿ± ÿ´ÿßŸÜŸäÿ©!\nÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ© ÿ™ÿ≠ÿØÿØ ÿßŸÑŸÅÿßÿ¶ÿ≤',
        'üéØ ŸÉŸÑ ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ŸÇÿ±ÿ®ŸÉ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿßŸÑŸáÿØŸÅ!\nÿßŸÑŸÖÿ´ÿßÿ®ÿ±ÿ© ÿ∑ÿ±ŸäŸÇ ÿßŸÑÿ™ŸÅŸàŸÇ',
        'üî• ÿßŸÑÿ•ÿµÿ±ÿßÿ± ŸáŸà ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÜÿ¨ÿßÿ≠!\nÿßŸÑÿπÿ≤ŸäŸÖÿ© ÿ™ŸÉÿ≥ÿ± ŸÉŸÑ ÿßŸÑÿ≠Ÿàÿßÿ¨ÿ≤',
        '‚≠ê ÿ£ŸÜÿ™ ÿ£ŸÇŸàŸâ ŸÖŸÖÿß ÿ™ÿπÿ™ŸÇÿØ!\nÿßŸÑÿ´ŸÇÿ© ÿ®ÿßŸÑŸÜŸÅÿ≥ ŸÜÿµŸÅ ÿßŸÑÿ∑ÿ±ŸäŸÇ',
        'üåü ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÇŸäŸÇŸä ŸÖÿπ ŸÜŸÅÿ≥ŸÉ!\nÿ™ÿ¨ÿßŸàÿ≤ ÿ≠ÿØŸàÿØŸÉ ŸàÿßŸÉÿ™ÿ¥ŸÅ ŸÇÿØÿ±ÿßÿ™ŸÉ'
      ];
      
      let phraseIndex = 0;
      
      this.motivationalCycleId = setInterval(() => {
        // ÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÖŸÉÿ´ŸÅ
        const isUserActive = document.hasFocus() && 
                            (Date.now() - this.lastInteractionTime < 10000);
        
        if (!isUserActive) return;
        
        const text = phrases[phraseIndex % phrases.length];
        this.showToast('üí° ÿ™ÿ≠ŸÅŸäÿ≤ ÿ∞ŸÉŸä', text, 'info', 6000);
        this.playSound('mystic-wind.mp3', 0.25, true);
        
        phraseIndex++;
      }, interval);
    }

    // ÿ•ŸäŸÇÿßŸÅ ÿØŸàÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤
    stopMotivationalCycle() {
      if (this.motivationalCycleId) {
        clearInterval(this.motivationalCycleId);
        this.motivationalCycleId = null;
      }
    }

    // ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿ£ÿÆŸäÿ±
    trackUserInteraction() {
      this.lastInteractionTime = Date.now();
    }

    // ÿ™ŸÅÿπŸäŸÑ/ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ£ÿµŸàÿßÿ™
    toggleSounds() {
      this.soundEnabled = !this.soundEnabled;
      const status = this.soundEnabled ? 'ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ' : 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ';
      this.showToast('üîä ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™', `${status} ÿßŸÑÿ£ÿµŸàÿßÿ™`, 'info', 2000);
      return this.soundEnabled;
    }

    // ÿ™ŸÅÿπŸäŸÑ/ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©
    toggleVoiceHints() {
      this.voiceHintsEnabled = !this.voiceHintsEnabled;
      const status = this.voiceHintsEnabled ? 'ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ' : 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ';
      this.showToast('üó£Ô∏è ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©', `${status} ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©`, 'info', 2000);
      return this.voiceHintsEnabled;
    }

    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ®ÿ∂ ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤Ÿä ŸÑÿπŸÜÿµÿ±
    addMotivationalPulse(element) {
      if (typeof element === 'string') {
        element = document.querySelector(element);
      }
      if (element) {
        element.classList.add('motivational-pulse');
        setTimeout(() => {
          element.classList.remove('motivational-pulse');
        }, 4000);
      }
    }

    // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿÆÿµÿµÿ©
    showWelcomeMessage(playerName) {
      this.showToast(
        `üéÆ ŸÖÿ±ÿ≠ÿ®ÿßŸã ${playerName}!`,
        'ÿßÿ≥ÿ™ÿπÿØ ŸÑÿ™ÿ≠ÿØŸä ŸÖÿ´Ÿäÿ± ŸàŸÖŸÑŸäÿ° ÿ®ÿßŸÑŸÖŸÅÿßÿ¨ÿ¢ÿ™!\nÿ£ÿ∏Ÿáÿ± ŸÖŸáÿßÿ±ÿßÿ™ŸÉ Ÿàÿ≠ŸÇŸÇ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨',
        'info',
        5000
      );
      this.playSound('startapp.mp3', 0.6);
      setTimeout(() => {
        this.speakRandomHint();
      }, 2000);
    }

    // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ
    destroy() {
      this.stopMotivationalCycle();
      
      // ÿ•ÿ≤ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™Ÿàÿ≥ÿ™ÿßÿ™
      document.querySelectorAll('.toast').forEach(toast => {
        toast.remove();
      });
      
      // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØÿ´
      if (window.speechSynthesis) {
        speechSynthesis.cancel();
      }
      
      console.log(`üéÆ ÿ™ŸÖ ÿ™ŸÜÿ∏ŸäŸÅ ŸÖŸàÿßÿ±ÿØ ChallengeEnhancer ŸÑŸÑŸÜÿ¥ÿßÿ∑: ${this.name}`);
    }
  }

  // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ŸÖÿπ ChallengeEnhancer ÿßŸÑŸÖÿØŸÖÿ¨ ====
  const activityName = 'ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™';
  const soundsPath = '../assets/media/sounds/';
  
  // ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿ™ÿπÿ≤Ÿäÿ≤ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖÿØŸÖÿ¨
  const challengeEnhancer = new ChallengeEnhancer(activityName);
  
  // ŸÉÿßÿ¶ŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÖÿ≠ŸÑŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ChallengeEnhancer
  const activity = {
    name: activityName,
    soundEnabled: true,
    soundsPath: soundsPath,
    enhancer: challengeEnhancer,
    
    init() {
      console.log(`üéØ ÿ™ŸáŸäÿ¶ÿ© ${this.name}...`);
      
      // ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ŸÅŸàÿ±ÿßŸã
      this.loadStudentData().catch(error => {
        console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
        // ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
        setTimeout(() => {
          hideLoadingIndicator();
        }, 2000);
      });
      
      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
      try {
        if (typeof ActivityUtils !== 'undefined') {
          ActivityUtils.init(this.name);
        }
      } catch (error) {
        console.warn('ÿ™ÿ≠ÿ∞Ÿäÿ±: ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ActivityUtilsÿå ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿ≥ŸäÿπŸÖŸÑ ÿ®ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ≥ÿ™ŸÇŸÑ');
      }
      
      // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
      this.enhancer.attachHoverSound('.btn, button, .challenge-card, .clickable');
      this.enhancer.startMotivationalCycle(30000); // ŸÉŸÑ 30 ÿ´ÿßŸÜŸäÿ©
      
      // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
      setTimeout(() => {
        this.enhancer.showToast(
          'üéÆ ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã!',
          'ÿßÿ≥ÿ™ÿπÿØ ŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ŸÖÿ´Ÿäÿ±ÿ© ŸàŸÖŸÑŸäÿ¶ÿ© ÿ®ÿßŸÑŸÖÿ±ÿ≠ ŸàÿßŸÑÿ™ÿπŸÑŸÖ!',
          'info',
          5000
        );
        this.enhancer.playSound('startapp.mp3');
      }, 1000);
      
      // ÿ™ÿ™ÿ®ÿπ ÿ™ŸÅÿßÿπŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      document.addEventListener('click', () => {
        this.enhancer.trackUserInteraction();
      });
      
      document.addEventListener('keydown', () => {
        this.enhancer.trackUserInteraction();
      });
    },
    
    // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®
    async loadStudentData() {
      console.log('üìö ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
      
      // ÿßÿ≥ÿ™ÿØÿπÿßÿ° Ÿàÿ∏ŸäŸÅÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©
      try {
        await loadStudents();
        console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
      } catch (error) {
        console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®:', error);
        // ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ¥ŸÑÿå ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        setTimeout(() => {
          hideLoadingIndicator();
          this.enhancer.showToast(
            '‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±',
            'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®. ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©.',
            'warning'
          );
        }, 1000);
      }
    },
    
    playSound(filename, volume = 0.7) {
      // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿ£ÿµŸàÿßÿ™
      this.enhancer.playSound(filename, volume);
    },
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿπŸÑŸäŸÇ ŸÖÿ≠ŸÅÿ≤ ŸÑŸÑÿßÿπÿ®
    motivatePlayer(playerName, score) {
      this.enhancer.checkMilestones(score, playerName);
    },
    
    // ÿßÿ≠ÿ™ŸÅÿßŸÑ ÿ®ÿßŸÑŸÅŸàÿ≤ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™
    celebrateWin(playerName) {
      this.enhancer.celebrateWin(playerName);
    },
    
    // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ŸÖÿÆÿµÿµ
    showNotification(title, message, type = 'info') {
      this.enhancer.showToast(title, message, type);
    },
    
    // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ
    cleanup() {
      this.enhancer.destroy();
    }
  };
  
  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸàÿßŸÑÿ∞ŸÉŸä ====
  const challengeSounds = {
    start: '../assets/media/sounds/start-timer.mp3',
    win: '../assets/media/sounds/win.mp3',
    winBlockbusters: '../assets/media/sounds/win-Blockbusters.mp3',
    celebration: '../assets/media/sounds/clap.mp3',
    timeUp: '../assets/media/sounds/long-beep.mp3',
    countdown: '../assets/media/sounds/countdown-beep.mp3',
    click: '../assets/media/sounds/Click.mp3',
    select: '../assets/media/sounds/select.mp3',
    reveal: '../assets/media/sounds/reveal.mp3',
    vs: '../assets/media/sounds/vs.mp3',
    draw: '../assets/media/sounds/draw.mp3',
    end: '../assets/media/sounds/end-timer.mp3',
    nameStart: '../assets/media/sounds/name-start.mp3',
    nameStop: '../assets/media/sounds/name-stop.mp3'
  };
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÅŸàÿ≤ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
  function playWinSoundSequence(playerName = 'ÿßŸÑŸÅÿßÿ¶ÿ≤') {
    if (!activity.soundEnabled) return;
    
    console.log('üéµ ÿ®ÿØÿ° ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÅŸàÿ≤ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ...');
    
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÜÿ∏ÿßŸÖ ChallengeEnhancer ŸÑŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ ÿßŸÑŸÉÿßŸÖŸÑ
    activity.celebrateWin(playerName);
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÖÿÆÿµÿµÿ© ŸÑŸÑÿ™ÿ≠ÿØŸäÿßÿ™
    setTimeout(() => {
      activity.playSound('win-Blockbusters.mp3');
      activity.enhancer.showToast(
        'üèÜ ÿ•ŸÜÿ¨ÿßÿ≤ ÿ±ÿßÿ¶ÿπ!', 
        `${playerName} ÿ£ÿ´ÿ®ÿ™ ŸÖŸáÿßÿ±ÿßÿ™Ÿá ŸÅŸä ÿßŸÑÿ™ÿ≠ÿØŸä!`, 
        'success', 
        6000
      );
    }, 1500);
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑÿ™ÿµŸÅŸäŸÇ ŸÖÿπ ÿ™ÿπŸÑŸäŸÇ ÿµŸàÿ™Ÿä
    setTimeout(() => {
      activity.playSound('clap.mp3');
      activity.enhancer.speakRandomHint();
    }, 3000);
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÖÿ™ÿ≤ÿßŸÖŸÜÿ© ŸÖÿ≠ÿ≥ŸÜÿ©
    showCelebrationEffectsEnhanced(playerName);
  }
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸÖÿπ ChallengeEnhancer
  function showCelebrationEffectsEnhanced(playerName = 'ÿßŸÑŸÅÿßÿ¶ÿ≤') {
    const fireworks = document.getElementById('fireworks');
    if (fireworks) {
      fireworks.style.display = 'block';
    }
    
    // ÿ™ŸÅÿπŸäŸÑ ÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ ÿßŸÑŸÖÿÆÿµÿµ ŸÖŸÜ ChallengeEnhancer
    activity.enhancer.createCelebrationBurst();
    
    // ŸÉŸàŸÜŸÅŸäÿ™Ÿä ŸÖÿ™ŸÇÿØŸÖ ŸÖÿ™ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ
    if (window.confetti) {
      // ÿßŸÜŸÅÿ¨ÿßÿ± ŸÖÿ±ŸÉÿ≤Ÿä ŸÖÿ∑Ÿàÿ±
      confetti({ 
        particleCount: 150, 
        spread: 90, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700', '#4169E1', '#8A2BE2', '#FF6B6B', '#4ECDC4']
      });
      
      // ÿßŸÜŸÅÿ¨ÿßÿ±ÿßÿ™ ÿ¨ÿßŸÜÿ®Ÿäÿ© ŸÖÿ™ÿ∑Ÿàÿ±ÿ©
      setTimeout(() => {
        confetti({ 
          particleCount: 80, 
          spread: 140, 
          origin: { x: 0.1, y: 0.7 },
          colors: ['#FF6347', '#32CD32', '#FFD700', '#87CEEB']
        });
        confetti({ 
          particleCount: 80, 
          spread: 140, 
          origin: { x: 0.9, y: 0.7 },
          colors: ['#DDA0DD', '#98FB98', '#F0E68C', '#FFA07A']
        });
      }, 800);
      
      // ÿßŸÜŸÅÿ¨ÿßÿ± ŸÜŸáÿßÿ¶Ÿä ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâ
      setTimeout(() => {
        confetti({ 
          particleCount: 200, 
          spread: 160, 
          origin: { y: 0.1 },
          colors: ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD']
        });
      }, 1500);
    }
    
    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
    createFallingStarsEnhanced();
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÖŸáÿ™ÿ≤ÿ©
    document.body.style.animation = 'shake 0.5s ease-in-out 2';
    
    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿπÿØ ŸÅÿ™ÿ±ÿ©
    setTimeout(() => {
      if (fireworks) {
        fireworks.style.display = 'none';
      }
      document.body.style.animation = '';
    }, 5000);
  }
  
  // ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ŸÖŸÜ ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
  function showCelebrationEffects() {
    showCelebrationEffectsEnhanced();
  }
  
  // ŸÜÿ¨ŸàŸÖ ŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ© ŸÖÿ≠ÿ≥ŸÜÿ©
  function createFallingStarsEnhanced() {
    for (let i = 0; i < 15; i++) {
      setTimeout(() => {
        const star = document.createElement('div');
        const starTypes = ['‚≠ê', 'üåü', '‚ú®', 'üí´', 'üéá'];
        star.innerHTML = starTypes[Math.floor(Math.random() * starTypes.length)];
        star.style.cssText = `
          position: fixed;
          font-size: ${Math.random() * 1.5 + 1.5}rem;
          left: ${Math.random() * 100}%;
          top: -50px;
          z-index: 10000;
          pointer-events: none;
          animation: fallingStar 3s linear forwards;
        `;
        
        document.body.appendChild(star);
        
        setTimeout(() => {
          if (star.parentNode) {
            star.remove();
          }
        }, 3000);
      }, i * 200);
    }
  }
  
  // ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿ£ÿµŸÑŸäÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
  function createFallingStars() {
    createFallingStarsEnhanced();
  }

  // ÿ™ÿ≠ŸÉŸÖ ÿµŸàÿ™Ÿä ÿ∞ŸÉŸä ŸÖÿ≠ÿ≥ŸÜ
  function playSmartSound(soundKey, options = {}) {
    const { volume = 0.7, delay = 0, loop = false } = options;
    
    setTimeout(() => {
      const soundPath = challengeSounds[soundKey];
      if (soundPath && activity.soundEnabled) {
        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ
        activity.enhancer.playSound(soundPath.split('/').pop(), volume);
      }
    }, delay);
  }
  
// ==== ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÜÿ¥ÿßÿ∑ ====
let studentData = {}, currentList = [], timer, timeLeft = 0;
let currentTurn = 1, usedStudents = [];
let teamScores = {};
let challengeStats = {
  totalChallenges: 0,
  completedChallenges: 0,
  teamWins: {},
  averageTime: 0,
  bestStreak: 0,
  currentStreak: 0,
  sessionStart: Date.now(),
  dailyStats: {},
  favoriteMode: '',
  totalPlayTime: 0
};

// ==== ŸÜÿ∏ÿßŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ====
function saveProgress() {
  try {
    const progressData = {
      stats: challengeStats,
      lastPlayed: Date.now(),
      version: '2.0'
    };
    localStorage.setItem('challengesProgress', JSON.stringify(progressData));
    console.log('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ ÿ®ŸÜÿ¨ÿßÿ≠');
  } catch (error) {
    console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ:', error);
  }
}

function loadProgress() {
  try {
    const saved = localStorage.getItem('challengesProgress');
    if (saved) {
      const progressData = JSON.parse(saved);
      challengeStats = { ...challengeStats, ...progressData.stats };
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
      const today = new Date().toDateString();
      if (!challengeStats.dailyStats[today]) {
        challengeStats.dailyStats[today] = {
          challenges: 0,
          timeSpent: 0,
          wins: {}
        };
      }
      
      console.log('üìä ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏');
      return true;
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿØŸÖ:', error);
  }
  return false;
}

// ==== ŸÜÿ∏ÿßŸÖ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿ∞ŸÉŸä ====
function updatePerformanceStats(winner, timeSpent, mode) {
  const today = new Date().toDateString();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©
  challengeStats.totalChallenges++;
  challengeStats.completedChallenges++;
  challengeStats.totalPlayTime += timeSpent;
  challengeStats.averageTime = challengeStats.totalPlayTime / challengeStats.completedChallenges;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
  if (winner) {
    challengeStats.teamWins[winner] = (challengeStats.teamWins[winner] || 0) + 1;
    challengeStats.currentStreak++;
    challengeStats.bestStreak = Math.max(challengeStats.bestStreak, challengeStats.currentStreak);
  } else {
    challengeStats.currentStreak = 0;
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑŸÖŸÅÿ∂ŸÑ
  const modes = JSON.parse(localStorage.getItem('challengesModes') || '{}');
  modes[mode] = (modes[mode] || 0) + 1;
  localStorage.setItem('challengesModes', JSON.stringify(modes));
  
  const favoriteMode = Object.keys(modes).reduce((a, b) => modes[a] > modes[b] ? a : b);
  challengeStats.favoriteMode = favoriteMode;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
  if (!challengeStats.dailyStats[today]) {
    challengeStats.dailyStats[today] = { challenges: 0, timeSpent: 0, wins: {} };
  }
  
  challengeStats.dailyStats[today].challenges++;
  challengeStats.dailyStats[today].timeSpent += timeSpent;
  
  if (winner) {
    challengeStats.dailyStats[today].wins[winner] = (challengeStats.dailyStats[today].wins[winner] || 0) + 1;
  }
  
  // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ
  saveProgress();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ™ÿ≠ŸÅŸäÿ≤Ÿä
  if (challengeStats.currentStreak > 0 && challengeStats.currentStreak % 5 === 0) {
    showAdvancedNotification(
      'üî• ÿ•ŸÜÿ¨ÿßÿ≤ ÿ±ÿßÿ¶ÿπ!',
      `ÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ${challengeStats.currentStreak} ŸÖÿ™ÿ™ÿßŸÑŸäÿ©!`,
      'celebration',
      5000
    );
  }
}

// ==== Ÿàÿ∏ÿßÿ¶ŸÅ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ====
function showLoadingIndicator(message = 'Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...') {
  const indicator = document.getElementById('loadingIndicator');
  const text = document.getElementById('loadingText');
  if (indicator) {
    indicator.classList.remove('hidden');
    if (text) text.textContent = message;
  }
}

function hideLoadingIndicator() {
  const indicator = document.getElementById('loadingIndicator');
  if (indicator) {
    indicator.classList.add('hidden');
  }
}

function updateLoadingProgress(message) {
  const text = document.getElementById('loadingText');
  if (text) text.textContent = message;
}

// ==== ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸàÿßŸÑÿ∞ŸÉŸä ====
async function loadStudents() {
    // ÿπÿ±ÿ∂ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    showLoadingIndicator('üìö ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
    updateLoadingProgress('ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');
    
    // ÿ•ÿπÿØÿßÿØ timeout ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ (5 ÿ´ŸàÿßŸÜŸä)
    const timeoutPromise = new Promise((_, reject) => 
      setTimeout(() => reject(new Error('ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ')), 5000)
    );
    
    try {
      console.log('üîÑ ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
      updateLoadingProgress('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑÿÆÿßÿØŸÖ ÿßŸÑŸÖÿ≠ŸÑŸä...');
      
      // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ timeout
      const response = await Promise.race([
        fetch('../data/studentData.json', {
          method: 'GET',
          cache: 'no-cache',
          headers: {
            'Content-Type': 'application/json',
          }
        }),
        timeoutPromise
      ]);
      
      if (!response.ok) {
        throw new Error(`ÿÆÿ∑ÿ£ HTTP: ${response.status}`);
      }
      
      updateLoadingProgress('ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');
      const data = await response.json();
      
      if (!data || typeof data !== 'object') {
        throw new Error('ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
      }
      
      // ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
      studentData = data;
      
      updateLoadingProgress('ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©...');
      
      // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿµŸÅŸàŸÅ
      populateClassSelect();
      setupEventListeners();
      
      const classCount = Object.keys(studentData).length;
      const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
      
      console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${totalStudents} ÿ∑ÿßŸÑÿ® ŸÖŸÜ ${classCount} ÿµŸÅ`);
      
      updateLoadingProgress('‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!');
      
      // ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      setTimeout(() => {
        hideLoadingIndicator();
        if (window.challengeEnhancer && typeof challengeEnhancer.showToast === 'function') {
          challengeEnhancer.showToast(
            '‚úÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿßÿ¨ÿ≠!',
            `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${totalStudents} ÿ∑ÿßŸÑÿ® ŸÖŸÜ ${classCount} ÿµŸÅ ÿ®ŸÜÿ¨ÿßÿ≠`,
            'success',
            4000
          );
        }
      }, 1000);
      
    } catch (error) {
      console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©:', error);
      
      updateLoadingProgress('ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©...');
      
      // ÿ®ŸäÿßŸÜÿßÿ™ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÖÿ≠ÿ≥ŸÜÿ© ŸÖŸÜ studentData.json ÿßŸÑŸÅÿπŸÑŸä
      studentData = {
        'ÿÆÿßŸÖÿ≥ 1': [
          'ÿ£ÿ≠ŸÖÿØ ÿ®ŸÜ ŸÖÿßÿ¨ÿØ ÿ®ŸÜ ŸÖÿ≠ŸÅŸàÿ∏ ŸÖŸÜÿµŸàÿ± ÿßŸÑÿ≥Ÿäÿßÿ®Ÿä',
          'ÿßÿ®ÿ±ÿßŸáŸäŸÖ ÿ®ŸÜ ÿÆŸÑŸäŸÑ ÿ®ŸÜ ÿßÿ®ÿ±ÿßŸáŸäŸÖ ÿ±ÿ≠ŸÖÿ™ ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä',
          'ÿßŸÑÿπÿ≤ ÿ®ŸÜ ÿ∑ÿßÿ±ŸÇ ÿ®ŸÜ ÿπÿ®ÿØÿßŸÑŸÖÿ¨ŸäÿØ ÿ≥ÿπŸäÿØ ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä',
          'ÿßŸÑŸÖŸáŸÑÿ® ÿ®ŸÜ ŸÅŸáÿØ ÿ®ŸÜ ŸÜÿßÿµÿ± ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ®Ÿàÿ≥ÿπŸäÿØŸä',
          'ÿßŸÑŸäÿßÿ≥ ÿ®ŸÜ ÿπŸäÿ≥Ÿâ ÿ®ŸÜ ÿÆŸÑŸÅÿßŸÜ ÿ≥ÿßŸÑŸÖ ÿßŸÑÿ¨ÿßÿ®ÿ±Ÿä'
        ],
        'ÿÆÿßŸÖÿ≥ 2': [
          'ÿ¢ÿØŸÖ ÿ®ŸÜ ŸÖÿ≠ŸÖÿØ ÿ®ŸÜ ÿ£ÿ≠ŸÖÿØ ÿÆŸÑŸäŸÑ ÿßŸÑŸÅÿßÿ±ÿ≥Ÿä',
          'ÿ£ŸÜÿ≥ ÿ®ŸÜ ÿ£ÿ≠ŸÖÿØ ÿ®ŸÜ ŸÖÿ≠ŸÖÿØ ÿπÿ®ÿØÿßŸÑÿ±ÿ≠ŸÖŸÜ ÿßŸÑÿ≤ÿØÿ¨ÿßŸÑŸä',
          'ÿ£ŸÜŸàÿ± ŸÖÿ≠ŸÖÿØ ÿπÿßÿ±ŸÅ ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä',
          'ÿ£ŸàŸëÿßÿ® ÿ®ŸÜ ŸÜÿßÿµÿ± ÿ®ŸÜ ŸÖÿßŸÑ ÿßŸÑŸÑŸá ÿ≠ŸÖÿØÿßŸÜ ÿßŸÑÿπŸÖÿ±Ÿä'
        ],
        'ÿ≥ÿßÿØÿ≥ 1': [
          'ÿ£ÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ ÿßŸÑŸÉŸÜÿØŸä',
          'ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä',
          'ŸÖÿ≠ŸÖÿØ ÿÆÿßŸÑÿØ ÿßŸÑŸáŸÜÿßÿ¶Ÿä',
          'ŸÖÿ±ŸäŸÖ ÿ≥ÿπŸäÿØ ÿßŸÑÿ±Ÿàÿßÿ≠Ÿä'
        ],
        'ÿ≥ÿßÿØÿ≥ 2': [
          'ÿπÿ®ÿØÿßŸÑŸÑŸá ÿ£ÿ≠ŸÖÿØ ÿßŸÑŸÖÿπŸÖÿ±Ÿä',
          'ÿÆÿØŸäÿ¨ÿ© ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≤ÿØÿ¨ÿßŸÑŸä',
          'ÿ∑ŸÑÿßŸÑ ÿ≥ÿßŸÑŸÖ ÿßŸÑÿ¥ÿ≠Ÿä',
          'ŸÜŸàÿ±ÿß ÿπŸÑŸä ÿßŸÑÿ®Ÿàÿ≥ÿπŸäÿØŸä'
        ]
      };
      
      populateClassSelect();
      setupEventListeners();
      
      const classCount = Object.keys(studentData).length;
      const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
      
      updateLoadingProgress('‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©');
      
      // ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      setTimeout(() => {
        hideLoadingIndicator();
        if (window.challengeEnhancer && typeof challengeEnhancer.showToast === 'function') {
          challengeEnhancer.showToast(
            '‚ö†Ô∏è ÿ®ŸäÿßŸÜÿßÿ™ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©',
            `ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© (${totalStudents} ÿ∑ÿßŸÑÿ® ŸÖŸÜ ${classCount} ÿµŸÅ)`,
            'warning',
            4000
          );
        }
      }, 1000);
    }
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿµŸÅŸàŸÅ
  function populateClassSelect() {
    const classSelect = document.getElementById('classSelect');
    classSelect.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>';
    
    Object.keys(studentData).forEach(cls => {
      const option = document.createElement('option');
      option.value = cls;
      option.textContent = `ÿßŸÑÿµŸÅ ${cls}`;
      classSelect.appendChild(option);
    });
    
    // ÿ™ÿ≠ÿØŸäÿØ ÿ£ŸàŸÑ ÿµŸÅ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
    if (classSelect.options.length > 1) {
      classSelect.selectedIndex = 1;
      populateStudentSelectors(classSelect.value);
    }
  }
  
  // ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
  function setupEventListeners() {
    const classSelect = document.getElementById('classSelect');
    
    classSelect.addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('Click.mp3');
    });

    // ÿ±ÿ®ÿ∑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸäÿØŸàŸä
    document.getElementById('student1Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });

    document.getElementById('student2Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸàÿßŸÑÿ∞ŸÉŸä ====
  function showAdvancedNotification(title, message, type = 'info', duration = 4000) {
    const notification = document.createElement('div');
    notification.className = `advanced-notification ${type}`;
    
    const icons = {
      success: '‚úÖ',
      warning: '‚ö†Ô∏è',
      error: '‚ùå',
      info: '‚ÑπÔ∏è',
      challenge: 'üî•',
      timer: '‚è∞',
      trophy: 'üèÜ',
      loading: 'üîÑ',
      celebration: 'üéâ'
    };
    
    notification.innerHTML = `
      <div class="notification-header">
        <span class="notification-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
        <span class="notification-title">${title}</span>
        <button class="notification-close" onclick="this.closest('.advanced-notification').remove()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="notification-message">${message}</div>
      <div class="notification-progress"></div>
    `;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑÿ≠ÿßŸàŸäÿ©
    const container = document.getElementById('notification-container') || document.body;
    container.appendChild(notification);
    
    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
    setTimeout(() => notification.classList.add('show'), 100);
    
    // ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
    const progressBar = notification.querySelector('.notification-progress');
    progressBar.style.animation = `progress ${duration}ms linear`;
    
    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, duration);
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ŸÖŸÜÿßÿ≥ÿ®
    activity.playSound('reveal.mp3');
    
    return notification;
  }

  // ÿ•ÿ¥ÿπÿßÿ± ÿπÿßÿ¶ŸÖ ŸÑŸÑŸÜÿµÿßÿ¶ÿ≠
  function showFloatingTip(message, element) {
    const tip = document.createElement('div');
    tip.className = 'floating-tip';
    tip.innerHTML = `
      <div class="tip-content">
        <i class="fas fa-lightbulb"></i>
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(tip);
    
    // ŸÖŸàŸÇÿπ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
    const rect = element.getBoundingClientRect();
    tip.style.left = rect.left + 'px';
    tip.style.top = (rect.top - 60) + 'px';
    
    setTimeout(() => tip.classList.add('show'), 100);
    
    setTimeout(() => {
      tip.classList.remove('show');
      setTimeout(() => {
        if (tip.parentNode) tip.parentNode.removeChild(tip);
      }, 300);
    }, 3000);
  }

  // ŸÜÿ∏ÿßŸÖ ŸÜÿµÿßÿ¶ÿ≠ ÿ∞ŸÉŸäÿ©
  function showGameTips() {
    const tips = [
      'üí° ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©',
      '‚ö° ÿßÿ∂ÿ®ÿ∑ ÿßŸÑŸàŸÇÿ™ ÿ≠ÿ≥ÿ® ÿµÿπŸàÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©',
      'üéØ ÿ±ÿßŸÇÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ°',
      'üî• ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ŸäŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®',
      'üìä ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÜÿµÿßÿ¶ÿ≠',
      'üéÆ ÿ¨ÿ±ÿ® ÿ£ŸÜŸÖÿßÿ∑ ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑÿ™ŸÜŸàŸäÿπ ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©'
    ];
    
    const randomTip = tips[Math.floor(Math.random() * tips.length)];
    
    setTimeout(() => {
      showAdvancedNotification(
        'üí° ŸÜÿµŸäÿ≠ÿ© ÿ∞ŸÉŸäÿ©',
        randomTip,
        'info',
        6000
      );
    }, Math.random() * 10000 + 15000); // ÿ®ŸäŸÜ 15-25 ÿ´ÿßŸÜŸäÿ©
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    
    // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿπÿ±ÿ∂ ÿßŸÑŸàŸÇÿ™
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    const timeDisplay = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${timeLeft}s`;
    
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeDisplay}`;

    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      circle.style.stroke = '#ff4444'; // ÿ£ÿ≠ŸÖÿ± ŸÑŸÑÿ™ÿ≠ÿ∞Ÿäÿ±
      secText.style.color = '#ff4444';
      
      if (timeLeft <= 5) {
        activity.playSound('countdown-beep.mp3');
        secText.style.animation = 'pulse 0.5s infinite';
      }
    } else if (timeLeft <= 30) {
      circle.style.stroke = '#ff8800'; // ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ŸÑŸÑÿ™ŸÜÿ®ŸäŸá
      secText.style.color = '#ff8800';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    } else {
      circle.style.stroke = 'var(--accent-color)';
      secText.style.color = 'var(--accent-color)';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    }
  }
  function populateStudentSelectors(cls) {
    const s1 = document.getElementById('student1Select');
    const s2 = document.getElementById('student2Select');
    const students = studentData[cls] || [];
    const selected1 = s1.value;
    const selected2 = s2.value;

    s1.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ£ŸàŸÑ</option>';
    s2.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ´ÿßŸÜŸä</option>';

    students.forEach(stu => {
      if (stu !== selected2) {
        const opt1 = document.createElement('option');
        opt1.value = stu;
        opt1.textContent = stu;
        s1.appendChild(opt1);
      }
      if (stu !== selected1) {
        const opt2 = document.createElement('option');
        opt2.value = stu;
        opt2.textContent = stu;
        s2.appendChild(opt2);
      }
    });

    if (selected1 && [...s1.options].some(o => o.value === selected1)) s1.value = selected1;
    if (selected2 && [...s2.options].some(o => o.value === selected2)) s2.value = selected2;
  }

  // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ™ÿ∫ŸäŸäÿ± ŸÜŸÖÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸä
  function handleModeChange() {
    const mode = document.getElementById('mode').value;
    
    activity.playSound('Click.mp3');
    
    const manualSelection = document.getElementById('manualSelection');
    const multiTeamOptions = document.getElementById('multiTeamOptions');
    
    manualSelection.style.display = (mode === 'manual') ? 'block' : 'none';
    multiTeamOptions.style.display = (mode === 'multiTeams') ? 'block' : 'none';

    if (mode === 'manual') {
      const currentClass = document.getElementById('classSelect').value;
      if (currentClass) {
        populateStudentSelectors(currentClass);
        activity.showNotification('ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ ŸÑŸÑÿ™ÿ≠ÿØŸä', 'info');
      }
    }
  }

  // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
  function showInstructionModal(mode) {
    const modal = document.getElementById('instructionModal');
    const text = document.getElementById('instructionText');
    let instructions = '';

    switch (mode) {
      case 'random':
        instructions = 'ÿ≥Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿ®ÿ¥ŸÉŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿä ŸÑŸÑÿ™ÿ≠ÿØŸä. ŸÉŸÑ ÿ∑ÿßŸÑÿ® ŸÑŸá ÿØŸàÿ± Ÿàÿ≤ŸÖŸÜ ŸÖÿ≠ÿØÿØ. ÿßŸÑŸÖÿπŸÑŸÖ Ÿäÿ≥ÿ¨ŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸäÿØŸàŸäÿßŸã ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ£ÿ≤ÿ±ÿßÿ± + Ÿà -.';
        break;
      case 'manual':
        instructions = 'ŸäŸÖŸÉŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ ŸäÿØŸàŸäÿßŸã ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©. ŸÉŸÑ ÿ∑ÿßŸÑÿ® ŸÑŸá ŸàŸÇÿ™ ŸÖÿ≠ÿØÿØ ŸÑŸÑÿ£ÿØÿßÿ°. Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸäÿØŸàŸäÿßŸã.';
        break;
      case 'teams':
        instructions = 'Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ŸäŸÜ ŸÅÿ±ŸäŸÇŸäŸÜ. ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸäŸÖŸÉŸÜŸá ŸÉÿ≥ÿ® ÿ£Ÿà ÿÆÿ≥ÿßÿ±ÿ© ŸÜŸÇÿßÿ∑. ÿßŸÑŸáÿØŸÅ ŸáŸà ÿßŸÑÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä ŸàÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä.';
        break;
      case 'multiTeams':
        instructions = 'ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿπÿØÿ© ŸÅÿ±ŸÇ (ŸÖŸÜ 3 ÿ•ŸÑŸâ 8) ÿ≠ÿ≥ÿ® ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ. ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸÑŸá ÿØŸàÿ±Ÿá ŸàŸÜŸÇÿßÿ∑Ÿá ÿßŸÑÿÆÿßÿµÿ©. ŸÖÿ´ÿßŸÑŸä ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©.';
        break;
    }

    text.textContent = instructions;
    modal.style.display = 'flex';
    activity.playSound('name-start.mp3');
  }

  // ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
  function closeInstructionModal() {
    document.getElementById('instructionModal').style.display = 'none';
    prepareChallengeContinue();
  }

  // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ChallengeEnhancer
  function prepareChallenge() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;

    if (!cls) {
      activity.enhancer.showToast(
        '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 
        'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ÿ£ŸàŸÑÿßŸã ŸÇÿ®ŸÑ ÿßŸÑÿ®ÿØÿ°!', 
        'warning'
      );
      activity.enhancer.playSound('ancient-bell.mp3', 0.5, true);
      return;
    }

    if (!mode) {
      activity.enhancer.showToast(
        '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 
        'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÜÿßÿ≥ÿ®!', 
        'warning'
      );
      activity.enhancer.playSound('ancient-bell.mp3', 0.5, true);
      return;
    }

    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ£ÿµŸàÿßÿ™ Ÿàÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿØÿßŸäÿ©
    activity.playSound('start-timer.mp3');
    activity.enhancer.showToast(
      'üöÄ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±!', 
      'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ´Ÿäÿ±...', 
      'info',
      3000
    );
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ®ÿ∂ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÜÿ¥ÿ∑ÿ©
    activity.enhancer.addMotivationalPulse('#challengeControls');
    
    showInstructionModal(mode);
  }

  // ŸÖÿ™ÿßÿ®ÿπÿ© ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ÿπÿØ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ŸÖÿπ ÿßŸÑÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
  function prepareChallengeContinue() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;
    timeLeft = parseInt(document.getElementById('duration').value);
    currentList = [...(studentData[cls] || [])];

    // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ¥ÿ¨ŸäÿπŸäÿ© ŸÑÿ®ÿØÿßŸäÿ© ÿßŸÑÿ™ÿ≠ÿØŸä
    activity.enhancer.showToast(
      '‚ö° ÿßŸÜÿ∑ŸÑÿßŸÇ ÿßŸÑÿ™ÿ≠ÿØŸä!', 
      `ÿ®ÿØÿ£ ÿ™ÿ≠ÿØŸä ${mode} ŸÑŸÖÿØÿ© ${timeLeft} ÿ´ÿßŸÜŸäÿ©!`, 
      'success',
      4000
    );
    
    activity.enhancer.playSound('battle-horn.mp3', 0.7, true);

    if (mode === 'multiTeams') {
      activity.enhancer.showToast(
        'üë• Ÿàÿ∂ÿπ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©', 
        'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ©!', 
        'info'
      );
      setupMultiTeams();
      return;
    }

    if (currentList.length < 2) {
      activity.showModal('ÿÆÿ∑ÿ£', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ ÿ®Ÿá ÿ∑ŸÑÿßÿ® ŸÉÿßŸÅŸäŸäŸÜ', false);
      return;
    }

    let name1 = 'ŸÅÿ±ŸäŸÇ 1', name2 = 'ŸÅÿ±ŸäŸÇ 2';

    if (mode === 'random') {
      const remaining = currentList.filter(s => !usedStudents.includes(s));
      if (remaining.length < 2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®. ÿ≥Ÿäÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©.', false);
        usedStudents = [];
        const shuffled = [...currentList].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      } else {
        const shuffled = [...remaining].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      }
      usedStudents.push(name1, name2);
    } else if (mode === 'manual') {
      name1 = document.getElementById('student1Select').value;
      name2 = document.getElementById('student2Select').value;
      if (!name1 || !name2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ', false);
        return;
      }
      if (name1 === name2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ŸÖÿÆÿ™ŸÑŸÅŸäŸÜ', false);
        return;
      }
    }

    setupTwoPlayerChallenge(name1, name2);
  }

  // ==== ÿ•ÿπÿØÿßÿØ ÿ™ÿ≠ÿØŸä ŸÖÿ≠ÿ≥ŸÜ ÿ®ŸäŸÜ ŸÑÿßÿπÿ®ŸäŸÜ ====
  function setupTwoPlayerChallenge(name1, name2) {
    const container = document.getElementById('teamsContainer');
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    container.innerHTML = `
      <div class="team-card" data-team="1">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name1"><i class="fas fa-star"></i> ${name1}</h3>
        <div class="team-score" id="score1">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(1, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(1, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status1">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ≠ÿØŸä</div>
      </div>
      <div class="vs-divider">
        <div class="vs-circle">
          <i class="fas fa-bolt"></i>
          <span>VS</span>
        </div>
      </div>
      <div class="team-card" data-team="2">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name2"><i class="fas fa-star"></i> ${name2}</h3>
        <div class="team-score" id="score2">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(2, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(2, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status2">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ≠ÿØŸä</div>
      </div>
    `;

    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 100);

    teamScores = { '1': 0, '2': 0 };
    currentTurn = 1;

    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'üî• ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä!',
      `ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿ© ÿ®ŸäŸÜ ${name1} Ÿà ${name2}`,
      'challenge',
      3000
    );
    
    // ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ÿ´ŸÖ ÿ®ÿØÿ° ÿßŸÑÿØŸàÿ± ÿßŸÑÿ£ŸàŸÑ
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ==== ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function setupMultiTeams() {
    const teamCount = parseInt(document.getElementById('teamCountSelect').value);
    const container = document.getElementById('teamsContainer');
    
    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    container.style.opacity = '0';
    container.innerHTML = '';

    teamScores = {};
    const teamColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a29bfe'];

    for (let i = 1; i <= teamCount; i++) {
      const div = document.createElement('div');
      div.className = 'team-card multi-team';
      div.style.borderColor = teamColors[i - 1] || '#007bff';
      
      div.innerHTML = `
        <div class="team-avatar" style="background: ${teamColors[i - 1] || '#007bff'}">
          <i class="fas fa-users"></i>
        </div>
        <h3 id="name${i}"><i class="fas fa-flag"></i> ŸÅÿ±ŸäŸÇ ${i}</h3>
        <div class="team-score" id="score${i}">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(${i}, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(${i}, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status${i}">ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</div>
      `;
      
      container.appendChild(div);
      teamScores[i.toString()] = 0;
    }

    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑŸÖÿ™ÿ≥ŸÑÿ≥ŸÑ
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
    }, 100);

    currentTurn = 1;
    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'üèÜ ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ© ÿ¨ÿßŸáÿ≤ÿ©!',
      `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ${teamCount} ŸÅÿ±ŸÇ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÉÿ®Ÿäÿ±`,
      'success',
      3000
    );
    
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ§ŸÇÿ™
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeLeft}s`;

    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      activity.playSound('countdown-beep.mp3');
    } else {
      wrapper.classList.remove('shake');
    }
  }

  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  function startTimer() {
    updateTimer();
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(timer);
        activity.playSound('long-beep.mp3');
        showTimeUpPopup();
      }
    }, 1000);
  }

  // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™
  function showTimeUpPopup() {
    const popup = document.getElementById('timeUpPopup');
    popup.style.display = 'block';
    
    setTimeout(() => {
      popup.style.display = 'none';
      nextTurn();
    }, 2000);
  }

  // ==== ÿßŸÑÿØŸàÿ± ÿßŸÑÿ™ÿßŸÑŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ChallengeEnhancer ====
  function nextTurn() {
    activity.playSound('vs.mp3');
    clearInterval(timer);
    
    const mode = document.getElementById('mode').value;
    const turnLabel = document.getElementById('turnLabel');

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      const teamName = `ŸÅÿ±ŸäŸÇ ${currentTurn}`;
      
      turnLabel.innerHTML = `<i class="fas fa-users"></i> ÿßŸÑÿØŸàÿ± ÿπŸÑŸâ: ${teamName}`;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ±ŸÇ
      updateTeamTurnStatus(currentTurn, count);
      
      // ÿ•ÿ¥ÿπÿßÿ± ŸÖÿ≠ÿ≥ŸÜ ŸÑŸÑÿØŸàÿ± ÿßŸÑÿ¨ÿØŸäÿØ
      activity.enhancer.showToast(
        'üîÑ ÿØŸàÿ± ÿ¨ÿØŸäÿØ!',
        `ÿ≠ÿßŸÜ ÿØŸàÿ± ${teamName} - ÿ£ÿπÿ∑Ÿàÿß ŸÉŸÑ ŸÖÿß ŸÑÿØŸäŸÉŸÖ!`,
        'info',
        3000
      );
      activity.enhancer.playSound('notification-pop.mp3', 0.6, true);
      
      timeLeft = parseInt(document.getElementById('duration').value);
      startTimer();
      currentTurn = currentTurn >= count ? 1 : currentTurn + 1;
      return;
    }

    // ŸÑŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿÆÿ±Ÿâ (ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ®) ŸÖÿπ ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™
    const currentPlayerName = currentTurn === 1 ? 
      document.getElementById('name1').textContent : 
      document.getElementById('name2').textContent;
    
    const cleanName = currentPlayerName.replace('‚≠ê ', '');
    
    // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ¥ÿ¨ŸäÿπŸäÿ© ŸÑŸÑÿßÿπÿ® ÿßŸÑŸÇÿßÿØŸÖ
    activity.enhancer.showToast(
      'üéØ ÿØŸàÿ±ŸÉ ÿßŸÑÿ¢ŸÜ!',
      `${cleanName} - ÿ£ÿ∏Ÿáÿ± ŸÖŸáÿßÿ±ÿßÿ™ŸÉ!`,
      'warning',
      3000
    );
    activity.enhancer.playSound('brain-activate.mp3', 0.7, true);
    turnLabel.innerHTML = `<i class="fas fa-user-clock"></i> ÿßŸÑÿØŸàÿ± ÿπŸÑŸâ: ${cleanName}`;
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
    updatePlayerTurnStatus(currentTurn);
    
    showAdvancedNotification(
      '‚ö° ÿØŸàÿ±ŸÉ ÿßŸÑÿ¢ŸÜ!',
      `ÿ≠ÿßŸÜ ÿØŸàÿ± ${cleanName}`,
      'timer',
      2000
    );
    
    timeLeft = parseInt(document.getElementById('duration').value);
    startTimer();
    currentTurn = currentTurn === 1 ? 2 : 1;
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ±ŸÇ
  function updateTeamTurnStatus(activeTurn, totalTeams) {
    for (let i = 1; i <= totalTeams; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'üéØ ÿØŸàÿ±Ÿá ÿßŸÑÿ¢ŸÜ!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
  function updatePlayerTurnStatus(activeTurn) {
    for (let i = 1; i <= 2; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'üéØ ÿØŸàÿ±Ÿá ÿßŸÑÿ¢ŸÜ!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ==== ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ChallengeEnhancer ====
  function adjustScore(team, val) {
    activity.playSound('Click.mp3');
    
    const scoreElement = document.getElementById(`score${team}`);
    const statusElement = document.getElementById(`status${team}`);
    const teamCard = document.querySelector(`[data-team="${team}"]`);
    const playerName = document.getElementById(`name${team}`)?.textContent?.replace('‚≠ê ', '') || `ÿßŸÑŸÅÿ±ŸäŸÇ ${team}`;
    
    let score = parseInt(scoreElement.textContent) + val;
    score = Math.max(0, score); // ŸÖŸÜÿπ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ≥ÿßŸÑÿ®ÿ©
    
    const oldScore = parseInt(scoreElement.textContent);
    scoreElement.textContent = score;
    teamScores[team.toString()] = score;

    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ Ÿàÿ£ÿµŸàÿßÿ™ ŸÖÿ≠ÿ≥ŸÜÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ChallengeEnhancer
    if (val > 0) {
      scoreElement.style.color = '#28a745';
      scoreElement.style.transform = 'scale(1.3)';
      if (statusElement) statusElement.textContent = '+' + val + ' ŸÜŸÇÿ∑ÿ©!';
      
      // ÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑŸÑÿßÿπÿ® ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ¨ÿØŸäÿØÿ©
      activity.motivatePlayer(playerName, score);
      
      // ÿ£ÿµŸàÿßÿ™ ÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ© ŸÖÿ™ŸÜŸàÿπÿ©
      const positiveSounds = ['crystal-ping.mp3', 'bonus-collect.mp3', 'level-up.mp3'];
      activity.enhancer.playSound(
        positiveSounds[Math.floor(Math.random() * positiveSounds.length)], 
        0.6, 
        true
      );
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¨ÿ≥ŸäŸÖÿßÿ™ ŸÑŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©
      createScoreParticles(scoreElement, '+' + val, '#28a745');
      
    } else if (val < 0) {
      scoreElement.style.color = '#dc3545';
      scoreElement.style.transform = 'scale(0.8)';
      if (statusElement) statusElement.textContent = val + ' ŸÜŸÇÿ∑ÿ©';
      
      // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ¥ÿ¨ŸäÿπŸäÿ© ÿπŸÜÿØ ÿÆÿ≥ÿßÿ±ÿ© ÿßŸÑŸÜŸÇÿßÿ∑
      activity.enhancer.showToast(
        'üí™ ŸÑÿß ÿ™Ÿäÿ£ÿ≥!',
        `${playerName} - ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ≥ÿ™ŸÉŸàŸÜ ÿ£ŸÅÿ∂ŸÑ!`,
        'warning',
        2500
      );
      
      activity.enhancer.playSound('ancient-bell.mp3', 0.4, true);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÑŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ≥ÿßŸÑÿ®ÿ©
      if (teamCard) {
        teamCard.classList.add('shake');
        setTimeout(() => teamCard.classList.remove('shake'), 500);
      }
    }

    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™
    setTimeout(() => {
      scoreElement.style.color = 'var(--accent-color)';
      scoreElement.style.transform = 'scale(1)';
      if (statusElement) {
        statusElement.textContent = score > 5 ? 'ÿ£ÿØÿßÿ° ŸÖŸÖÿ™ÿßÿ≤!' : 
                                  score > 2 ? 'Ÿäÿ™ŸÇÿØŸÖ ÿ®ÿ´ÿ®ÿßÿ™' : 
                                  score > 0 ? 'ÿ®ÿØÿßŸäÿ© ÿ¨ŸäÿØÿ©' : 'ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿßŸäÿ©';
      }
    }, 1000);

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ŸÅŸä ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©
    updateTeamRanking();
  }

  // ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¨ÿ≥ŸäŸÖÿßÿ™ ŸÑŸÑŸÜŸÇÿßÿ∑
  function createScoreParticles(element, text, color) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      color: ${color};
      font-weight: bold;
      font-size: 1.2rem;
      pointer-events: none;
      z-index: 1000;
      animation: scoreFloat 1s ease-out forwards;
    `;
    particle.textContent = text;
    
    const rect = element.getBoundingClientRect();
    particle.style.left = rect.left + 'px';
    particle.style.top = rect.top + 'px';
    
    document.body.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 1000);
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÅÿ±ŸÇ
  function updateTeamRanking() {
    const teams = Object.keys(teamScores).map(team => ({
      id: team,
      score: teamScores[team],
      element: document.getElementById(`score${team}`)
    })).sort((a, b) => b.score - a.score);

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ±ÿßŸÉÿ≤
    teams.forEach((team, index) => {
      const statusElement = document.getElementById(`status${team.id}`);
      if (statusElement && teams.length > 2) {
        const position = index + 1;
        const positionText = position === 1 ? 'ü•á ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸàŸÑ' :
                           position === 2 ? 'ü•à ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÜŸä' :
                           position === 3 ? 'ü•â ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´' :
                           `üìç ÿßŸÑŸÖÿ±ŸÉÿ≤ ${position}`;
        statusElement.textContent = positionText;
      }
    });
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ====
  function showStatsButton() {
    const winnerDisplay = document.getElementById('winnerDisplay');
    if (winnerDisplay && winnerDisplay.style.display === 'block') {
      const statsBtn = document.createElement('button');
      statsBtn.className = 'btn btn-info';
      statsBtn.style.marginTop = '1rem';
      statsBtn.innerHTML = '<i class="fas fa-chart-pie"></i> ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™';
      statsBtn.onclick = showDetailedStats;
      winnerDisplay.appendChild(statsBtn);
    }
  }

  function showDetailedStats() {
    const modal = document.createElement('div');
    modal.className = 'instruction-modal';
    modal.style.display = 'flex';
    
    const totalGames = challengeStats.totalChallenges;
    const winData = Object.entries(challengeStats.teamWins)
      .map(([name, wins]) => ({ name, wins, percentage: Math.round((wins / totalGames) * 100) }))
      .sort((a, b) => b.wins - a.wins);
    
    modal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <h2><i class="fas fa-chart-pie"></i> ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h2>
        <div class="stats-container">
          <div class="stat-row">
            <span>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™:</span>
            <span class="stat-value">${totalGames}</span>
          </div>
          <div class="stat-row">
            <span>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©:</span>
            <span class="stat-value">${challengeStats.completedChallenges}</span>
          </div>
          ${winData.length > 0 ? `
            <h3><i class="fas fa-trophy"></i> ÿ≥ÿ¨ŸÑ ÿßŸÑÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™</h3>
            ${winData.map((player, index) => `
              <div class="winner-stat ${index === 0 ? 'top-winner' : ''}">
                ${index === 0 ? 'üèÜ' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üìä'} 
                ${player.name}: ${player.wins} ÿßŸÜÿ™ÿµÿßÿ± (${player.percentage}%)
              </div>
            `).join('')}
          ` : '<p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿ®ÿπÿØ</p>'}
        </div>
        <button onclick="this.closest('.instruction-modal').remove()" class="btn btn-primary">
          <i class="fas fa-check"></i> ÿ•ÿ∫ŸÑÿßŸÇ
        </button>
      </div>
    `;
    
    document.body.appendChild(modal);
    activity.playSound('reveal.mp3');
  }

  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
  function loadSavedStats() {
    try {
      const saved = localStorage.getItem('challengeStats');
      if (saved) {
        challengeStats = { ...challengeStats, ...JSON.parse(saved) };
      }
    } catch (error) {
      console.log('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™:', error);
    }
  }

  // ==== ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function endChallenge() {
    clearInterval(timer);
    activity.playSound('end-timer.mp3');
    
    const mode = document.getElementById('mode').value;
    const winnerDisplay = document.getElementById('winnerDisplay');
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
    challengeStats.totalChallenges++;
    challengeStats.completedChallenges++;

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      let maxScore = -1;
      let winners = [];
      let results = [];

      for (let i = 1; i <= count; i++) {
        const score = parseInt(document.getElementById(`score${i}`).textContent);
        results.push({ team: `ŸÅÿ±ŸäŸÇ ${i}`, score: score });
        
        if (score > maxScore) {
          maxScore = score;
          winners = [`ŸÅÿ±ŸäŸÇ ${i}`];
        } else if (score === maxScore) {
          winners.push(`ŸÅÿ±ŸäŸÇ ${i}`);
        }
      }

      // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
      results.sort((a, b) => b.score - a.score);
      
      const isWin = winners.length === 1;
      const result = isWin ? 
        `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${winners[0]} ÿ®ŸÄ ${maxScore} ŸÜŸÇÿ∑ÿ©` : 
        `<i class="fas fa-handshake"></i> ÿ™ÿπÿßÿØŸÑ ÿ®ŸäŸÜ: ${winners.join(' Ÿà ')} ÿ®ŸÄ ${maxScore} ŸÜŸÇÿ∑ÿ©`;
      
      winnerDisplay.innerHTML = `
        ${result}
        <div class="final-results">
          <h4><i class="fas fa-chart-bar"></i> ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©:</h4>
          ${results.map((r, index) => 
            `<div class="result-item ${index === 0 ? 'winner' : ''}">
              ${index + 1}. ${r.team}: ${r.score} ŸÜŸÇÿ∑ÿ©
            </div>`
          ).join('')}
        </div>
      `;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
      if (isWin) {
        challengeStats.teamWins[winners[0]] = (challengeStats.teamWins[winners[0]] || 0) + 1;
      }
      
      showAdvancedNotification(
        isWin ? 'üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!' : 'ü§ù ÿ™ÿπÿßÿØŸÑ ŸÖÿ´Ÿäÿ±!',
        isWin ? `${winners[0]} Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸàŸÑ` : `ÿ™ÿπÿßÿØŸÑ ÿ±ÿßÿ¶ÿπ ÿ®ŸäŸÜ ${winners.length} ŸÅÿ±ŸÇ`,
        isWin ? 'trophy' : 'success',
        5000
      );
      
      playWinSoundSequence();
      
    } else {
      // ŸÑŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿÆÿ±Ÿâ (ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ®)
      const name1 = document.getElementById('name1').textContent.replace('‚≠ê ', '');
      const name2 = document.getElementById('name2').textContent.replace('‚≠ê ', '');
      const score1 = parseInt(document.getElementById('score1').textContent);
      const score2 = parseInt(document.getElementById('score2').textContent);

      let result;
      let winnerName = '';
      
      if (score1 > score2) {
        result = `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${name1} ÿ®ŸÄ ${score1} ŸÜŸÇÿ∑ÿ©`;
        winnerName = name1;
        showAdvancedNotification('üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!', `${name1} ŸäŸÅŸàÿ≤ ÿ®ÿßŸÑÿ™ÿ≠ÿØŸä!`, 'trophy', 5000);
        playWinSoundSequence();
      } else if (score2 > score1) {
        result = `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${name2} ÿ®ŸÄ ${score2} ŸÜŸÇÿ∑ÿ©`;
        winnerName = name2;
        showAdvancedNotification('üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!', `${name2} ŸäŸÅŸàÿ≤ ÿ®ÿßŸÑÿ™ÿ≠ÿØŸä!`, 'trophy', 5000);
        playWinSoundSequence();
      } else {
        result = `<i class="fas fa-handshake"></i> ÿ™ÿπÿßÿØŸÑ! ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ${score1} - ${score2}`;
        showAdvancedNotification('ü§ù ÿ™ÿπÿßÿØŸÑ ŸÖÿ´Ÿäÿ±!', 'ŸÖÿ®ÿßÿ±ÿßÿ© ŸÖÿ™Ÿàÿßÿ≤ŸÜÿ© ÿ™ŸÖÿßŸÖÿßŸã!', 'success', 5000);
        activity.playSound('draw.mp3');
      }

      winnerDisplay.innerHTML = `
        ${result}
        <div class="match-summary">
          <div class="score-breakdown">
            <div class="player-result ${score1 > score2 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name1}: ${score1} ŸÜŸÇÿ∑ÿ©
            </div>
            <div class="player-result ${score2 > score1 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name2}: ${score2} ŸÜŸÇÿ∑ÿ©
            </div>
          </div>
        </div>
      `;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
      if (winnerName) {
        challengeStats.teamWins[winnerName] = (challengeStats.teamWins[winnerName] || 0) + 1;
      }
    }

    winnerDisplay.style.display = 'block';
    
    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
    localStorage.setItem('challengeStats', JSON.stringify(challengeStats));
    
    // ÿπÿ±ÿ∂ ÿ≤ÿ± ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ•ÿ∂ÿßŸÅŸä
    setTimeout(() => {
      showStatsButton();
    }, 2000);
  }

  // ÿπÿ±ÿ∂ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
  function showCelebration(isWin) {
    if (isWin) {
      activity.playSound('win.mp3');
      setTimeout(() => activity.playSound('clap.mp3'), 1000);
    } else {
      activity.playSound('draw.mp3');
    }

    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ©
    createFallingStars();
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàŸÜŸÅŸäÿ™Ÿä
    if (window.confetti) {
      confetti({ 
        particleCount: 200, 
        spread: 120, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700']
      });
    }

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 4000);
  }

  // ==== ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function resetChallenge() {
    activity.playSound('Click.mp3');
    
    // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
    clearInterval(timer);
    
    // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ
    document.getElementById('challengeArea').style.display = 'none';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿ®ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    const container = document.getElementById('teamsContainer');
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      container.innerHTML = '';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 300);
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™
    currentTurn = 1;
    teamScores = {};
    timeLeft = 0;
    usedStudents = [];
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
    document.getElementById('classSelect').selectedIndex = 0;
    document.getElementById('mode').selectedIndex = 0;
    document.getElementById('duration').selectedIndex = 1; // 1 ÿØŸÇŸäŸÇÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
    
    // ÿ•ÿÆŸÅÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
    document.getElementById('manualSelection').style.display = 'none';
    document.getElementById('multiTeamOptions').style.display = 'none';
    
    showAdvancedNotification(
      'üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ',
      'ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿ¨ÿßŸáÿ≤ ŸÑÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ!',
      'info',
      3000
    );
    
    console.log('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ŸÜÿ¨ÿßÿ≠');
  }

  // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ====
  window.onload = async () => {
    console.log('üî• ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ...');
    
    try {
      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä (ÿßŸÑÿ∞Ÿä ÿ≥Ÿäÿ®ÿØÿ£ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™)
      console.log('üéØ ÿ®ÿØÿ° ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑...');
      activity.init();
      console.log('‚úÖ ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ÿ®ŸÜÿ¨ÿßÿ≠');
      
      // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
      try {
        loadSavedStats();
        console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
      } catch (statsError) {
        console.warn('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™:', statsError);
      }
      
    } catch (error) {
      console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑:', error);
      
      // ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      setTimeout(() => {
        hideLoadingIndicator();
        if (window.challengeEnhancer && typeof challengeEnhancer.showToast === 'function') {
          challengeEnhancer.showToast(
            '‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ',
            'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜÿ¥ÿßÿ∑. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©.',
            'error'
          );
        }
      }, 1000);
    }
  };

  // ==== ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ====
  function showTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'flex';
    activity.playSound('reveal.mp3');
    setupTeacherTabs();
  }

  function closeTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'none';
    activity.playSound('Click.mp3');
  }

  function setupTeacherTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');
        
        // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±
        button.classList.add('active');
        const targetContent = document.getElementById(`${targetTab}-content`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
        
        // ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä
        activity.playSound('Click.mp3');
      });
    });
  }

  // ==== Ÿàÿ∏ÿßÿ¶ŸÅ ChallengeEnhancer ÿßŸÑÿ•ÿ∂ÿßŸÅŸäÿ© ====
  function showEnhancerStats() {
    const stats = {
      totalToasts: 0, // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿπÿØÿßÿØ ŸÅŸä ChallengeEnhancer
      soundsPlayed: 0,
      celebrationsTriggered: 0,
      motivationCycleActive: challengeEnhancer.motivationalCycleId !== null
    };
    
    challengeEnhancer.showToast(
      'üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ',
      `ÿØŸàÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤: ${stats.motivationCycleActive ? 'ŸÜÿ¥ÿ∑ÿ©' : 'ŸÖÿ™ŸàŸÇŸÅÿ©'}\nÿßŸÑÿ£ÿµŸàÿßÿ™: ${challengeEnhancer.soundEnabled ? 'ŸÖŸÅÿπŸÑÿ©' : 'ŸÖÿπÿ∑ŸÑÿ©'}\nÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™: ${challengeEnhancer.voiceHintsEnabled ? 'ŸÖŸÅÿπŸÑÿ©' : 'ŸÖÿπÿ∑ŸÑÿ©'}`,
      'info',
      6000
    );
  }
  
  function updateToggleButtons() {
    const soundBtn = document.getElementById('soundToggleBtn');
    const voiceBtn = document.getElementById('voiceToggleBtn');
    
    if (soundBtn) {
      soundBtn.innerHTML = challengeEnhancer.soundEnabled ? 
        '<i class="fas fa-volume-up"></i> ÿßŸÑÿ£ÿµŸàÿßÿ™: ŸÖŸÅÿπŸÑ' : 
        '<i class="fas fa-volume-mute"></i> ÿßŸÑÿ£ÿµŸàÿßÿ™: ŸÖÿπÿ∑ŸÑ';
    }
    
    if (voiceBtn) {
      voiceBtn.innerHTML = challengeEnhancer.voiceHintsEnabled ? 
        '<i class="fas fa-microphone"></i> ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©: ŸÖŸÅÿπŸÑ' : 
        '<i class="fas fa-microphone-slash"></i> ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©: ŸÖÿπÿ∑ŸÑ';
    }
  }

  // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÉÿßŸÖŸÑ ŸÖÿπ ÿ•ÿÆŸÅÿßÿ° ÿ¢ŸÖŸÜ ŸÑŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ====
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ¢ŸÑŸäÿ© ÿ∑Ÿàÿßÿ±ÿ¶ ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÖŸÜÿπ ÿ™ÿπŸÑŸäŸÇ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
  const emergencyLoadingFix = () => {
    console.log('üöë ÿ™ŸÅÿπŸäŸÑ ÿ¢ŸÑŸäÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿßŸÑÿ¥ÿßŸÖŸÑÿ©');
    
    // ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÅŸàÿ±ÿßŸã
    const loadingIndicator = document.getElementById('loadingIndicator');
    if (loadingIndicator) {
      loadingIndicator.style.display = 'none';
      loadingIndicator.style.opacity = '0';
    }
    
    // ÿ™ŸÅÿπŸäŸÑ ChallengeEnhancer ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸÅÿπŸÑÿßŸã
    if (!window.challengeEnhancer) {
      try {
        window.challengeEnhancer = new ChallengeEnhancer();
        console.log('‚úÖ ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ChallengeEnhancer ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿ¢ŸÑŸäÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶');
      } catch (error) {
        console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ŸÅÿπŸäŸÑ ChallengeEnhancer:', error);
      }
    }
    
    // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠
    setTimeout(() => {
      if (window.challengeEnhancer && typeof challengeEnhancer.showToast === 'function') {
        challengeEnhancer.showToast(
          'üöë ÿ™ŸÖ ÿ•ŸÜŸÇÿßÿ∞ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ!',
          'ÿ™ŸÖ ÿ™ÿ¨ÿßŸàÿ≤ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ - ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ¨ÿßŸáÿ≤ ÿßŸÑÿ¢ŸÜ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ',
          'success'
        );
      }
    }, 500);
  };

  // ŸÖÿ§ŸÇÿ™ ÿ∑Ÿàÿßÿ±ÿ¶ ŸÑŸÖŸÜÿπ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑÿØÿßÿ¶ŸÖ (10 ÿ´ŸàÿßŸÜŸä ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)
  const emergencyTimeout = setTimeout(() => {
    console.warn('‚è∞ ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿµŸàŸâ - ÿ™ŸÅÿπŸäŸÑ ÿ¢ŸÑŸäÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶');
    emergencyLoadingFix();
  }, 10000);

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üì± DOM ÿ¨ÿßŸáÿ≤ - ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ...');
    
    // ÿ•ŸÑÿ∫ÿßÿ° ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ÿ®ŸäÿπŸä
    clearTimeout(emergencyTimeout);
    
    try {
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸÇÿ∑ (ÿ®ÿØŸàŸÜ ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ)
      setTimeout(() => {
        updateToggleButtons();
      }, 2000); // ÿ®ÿπÿØ ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑ ŸÇÿØ ÿ™ŸÖ ÿ™ŸáŸäÿ¶ÿ™Ÿá ŸÅŸä window.onload
      
      // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπÿßÿ™ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©
      const soundToggleBtn = document.getElementById('soundToggleBtn');
      const voiceToggleBtn = document.getElementById('voiceToggleBtn');
      
      if (soundToggleBtn) {
        soundToggleBtn.addEventListener('click', updateToggleButtons);
      }
      
      if (voiceToggleBtn) {
        voiceToggleBtn.addEventListener('click', updateToggleButtons);
      }
      
      // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ® ŸÖÿ≠ÿ≥ŸÜÿ©
      setTimeout(() => {
        if (window.challengeEnhancer && typeof challengeEnhancer.showToast === 'function') {
          challengeEnhancer.showToast(
            'üéâ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿ≠ŸÅŸäÿ≤ ÿ¨ÿßŸáÿ≤!',
            'ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ŸàÿßŸÑÿµŸàÿ™Ÿäÿ© ÿ®ŸÜÿ¨ÿßÿ≠',
            'success',
            5000
          );
        }
      }, 2000);
      
    } catch (error) {
      console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑:', error);
      emergencyLoadingFix(); // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¢ŸÑŸäÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ ÿπŸÜÿØ ÿßŸÑÿÆÿ∑ÿ£
      hideLoadingIndicator();
      
      // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£ ŸàÿØŸäÿ© ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      setTimeout(() => {
        challengeEnhancer.showToast(
          '‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá',
          'ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿ®ŸÜÿ¨ÿßÿ≠ÿå ŸÑŸÉŸÜ ŸÇÿØ ÿ™ŸÉŸàŸÜ ÿ®ÿπÿ∂ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ŸÖÿ≠ÿØŸàÿØÿ©',
          'warning',
          4000
        );
      }, 1000);
    }
  });

  // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿπŸÜÿØ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿµŸÅÿ≠ÿ©
  window.addEventListener('beforeunload', function() {
    if (activity && activity.cleanup) {
      activity.cleanup();
    }
  });

  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÖÿØŸÖÿ¨
  console.log('üéØ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸÖÿπ ChallengeEnhancer ŸÖÿØŸÖÿ¨ - ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ¥ÿ∫ŸäŸÑ!');
  console.log('üìä ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©: ChallengeEnhancer Pro ŸÖÿØŸÖÿ¨ÿå ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ™ŸÅÿßÿπŸÑŸäÿ©ÿå ÿ£ÿµŸàÿßÿ™ ÿ∞ŸÉŸäÿ©ÿå ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßÿ≠ÿ™ŸÅÿßŸÑŸäÿ©');
  console.log('üéÆ ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ¨ÿØŸäÿØÿ© ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ©');
  console.log('‚úÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ¢ŸÜ ÿµŸÅÿ≠ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÖÿ≥ÿ™ŸÇŸÑÿ© - ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑŸÖŸÑŸÅÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ©!');
</script>

<!-- Responsive JavaScript Helper -->
<script src="../assets/js/responsive-helper.js"></script>
</body>
</html>
