<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<title>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ üî•</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="../config/unified-styles-template.css">
<style>
    /* ÿ™ÿÆÿµŸäÿµ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ */
    .activity-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .challenge-header {
      background: var(--gradient-primary);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      text-align: center;
      box-shadow: var(--shadow-large);
    }

    .challenge-header h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .challenge-controls {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      margin-bottom: 2rem;
    }

    .control-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
    }

    .control-group label {
      font-weight: 600;
      color: var(--text-color);
      min-width: 100px;
    }

    .control-group select,
    .control-group button {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      border: 2px solid var(--primary-color);
      font-size: 1rem;
      font-weight: 600;
    }

    .control-group select {
      background: white;
      color: var(--primary-color);
      min-width: 150px;
    }

    .challenge-area {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      display: none;
      text-align: center;
    }

    .turn-display {
      background: var(--gradient-accent);
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-medium);
    }

    .timer-container {
      position: relative;
      width: 150px;
      height: 150px;
      margin: 2rem auto;
    }

    .timer-circle {
      width: 150px;
      height: 150px;
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
    }

    .timer-container.shake {
      animation: shake 0.5s infinite;
    }

    .teams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-card {
      background: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: var(--shadow-medium);
      border: 3px solid var(--primary-color);
      transition: all 0.3s ease;
    }

    .team-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-large);
    }

    .team-card h3 {
      color: var(--primary-color);
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .team-score {
      font-size: 3rem;
      font-weight: 700;
      color: var(--accent-color);
      margin: 1rem 0;
    }

    .score-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .score-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 1.5rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .score-btn.plus {
      background: var(--gradient-success);
      color: white;
    }

    .score-btn.minus {
      background: var(--gradient-danger);
      color: white;
    }

    .score-btn:hover {
      transform: scale(1.1);
    }

    .challenge-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    .winner-display {
      background: var(--gradient-accent);
      color: white;
      padding: 2rem;
      border-radius: 15px;
      font-size: 2rem;
      font-weight: 700;
      margin-top: 2rem;
      box-shadow: var(--shadow-large);
      display: none;
    }

    .manual-selection {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .multi-team-options {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 2px dashed var(--primary-color);
      display: none;
    }

    .instruction-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: var(--shadow-extra-large);
      position: relative;
    }

    .modal-content h2 {
      color: var(--primary-color);
      font-size: 2rem;
      margin-bottom: 1.5rem;
    }

    .modal-content p {
      font-size: 1.3rem;
      line-height: 1.8;
      color: var(--text-color);
      margin-bottom: 2rem;
    }

    .time-up-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 2rem 3rem;
      border-radius: 20px;
      box-shadow: var(--shadow-extra-large);
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-color);
      z-index: 10000;
      display: none;
      border: 4px solid var(--accent-color);
    }

    .fireworks-effect {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('../assets/media/sounds/firework.gif') center center no-repeat;
      background-size: cover;
      z-index: 9999;
      display: none;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© */
    @media (max-width: 768px) {
      .challenge-header h1 {
        font-size: 2rem;
      }

      .control-group {
        flex-direction: column;
        text-align: center;
      }

      .teams-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .timer-container {
        width: 120px;
        height: 120px;
      }

      .timer-circle {
        width: 120px;
        height: 120px;
      }

      .challenge-actions {
        flex-direction: column;
        align-items: center;
      }
    }

    @media (max-width: 480px) {
      .activity-container {
        padding: 10px;
      }

      .challenge-header,
      .challenge-controls,
      .challenge-area {
        padding: 1rem;
      }

      .team-score {
        font-size: 2.5rem;
      }
    }

    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(5px, 0); }
      50% { transform: translate(0, 5px); }
      75% { transform: translate(-5px, 0); }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© */
    .advanced-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 15px;
      padding: 1rem 1.5rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index: 10000;
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
      min-width: 300px;
      border-left: 5px solid var(--primary-color);
    }

    .advanced-notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .advanced-notification.success { border-left-color: #28a745; }
    .advanced-notification.warning { border-left-color: #ffc107; }
    .advanced-notification.error { border-left-color: #dc3545; }
    .advanced-notification.challenge { border-left-color: #ff6b35; }
    .advanced-notification.timer { border-left-color: #17a2b8; }
    .advanced-notification.trophy { border-left-color: #ffd700; }
    .advanced-notification.loading { border-left-color: #6f42c1; }
    .advanced-notification.celebration { border-left-color: #fd7e14; }

    .notification-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .notification-close {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      padding: 0.2rem;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .notification-close:hover {
      background: #f0f0f0;
      color: #666;
    }

    .notification-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: var(--primary-color);
      border-radius: 0 0 15px 15px;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    /* ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿπÿßÿ¶ŸÖÿ© */
    .floating-tip {
      position: fixed;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-size: 0.9rem;
      z-index: 10001;
      transform: translateY(10px);
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .floating-tip.show {
      transform: translateY(0);
      opacity: 1;
    }

    .tip-content {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tip-content i {
      color: #ffd700;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑŸàÿßÿ¨Ÿáÿ© */
    .control-group button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .team-card:hover .team-avatar {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
    }

    .score-btn:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÜÿ™ŸÇÿßŸÑŸäÿ© ŸÖÿ≠ÿ≥ŸÜÿ© */
    .challenge-area {
      animation: slideInUp 0.6s ease-out;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© */
    @media (max-width: 768px) {
      .floating-tip {
        position: fixed;
        top: 20px !important;
        left: 20px !important;
        right: 20px !important;
        width: auto !important;
      }
    }

    .notification-icon {
      font-size: 1.2rem;
    }

    .notification-message {
      color: var(--text-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ© */
    .star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: fallingStar 3s linear forwards;
      text-shadow: 0 0 10px #ffd700;
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸÅÿ±ŸÇ */
    .team-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
      color: white;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .team-status {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      padding: 0.3rem 0.8rem;
      background: #f8f9fa;
      border-radius: 15px;
      text-align: center;
    }

    .vs-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 1rem;
    }

    .vs-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--gradient-accent);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
      animation: pulse 2s infinite;
    }

    .vs-circle i {
      font-size: 1.2rem;
      margin-bottom: 0.2rem;
    }

    .multi-team {
      position: relative;
      overflow: hidden;
    }

    .multi-team::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-color);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @media (max-width: 768px) {
      .vs-divider {
        margin: 1rem 0;
      }
      
      .vs-circle {
        width: 60px;
        height: 60px;
        font-size: 0.8rem;
      }
      
      .advanced-notification {
        right: 10px;
        left: 10px;
        min-width: auto;
        transform: translateY(-100px);
      }
      
      .advanced-notification.show {
        transform: translateY(0);
      }
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    @keyframes scoreFloat {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-30px) scale(1.2);
        opacity: 0;
      }
    }

    .final-results {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .result-item {
      padding: 0.5rem;
      margin: 0.3rem 0;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
    }

    .result-item.winner {
      background: rgba(255,215,0,0.3);
      border: 2px solid #ffd700;
    }

    .match-summary {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .score-breakdown {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .player-result {
      padding: 0.8rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
    }

    .player-result.winner {
      background: rgba(40,167,69,0.2);
      border: 2px solid #28a745;
      color: #28a745;
    }

    .player-result.loser {
      background: rgba(220,53,69,0.2);
      border: 2px solid #dc3545;
      color: #dc3545;
    }

    .player-result.tie {
      background: rgba(255,193,7,0.2);
      border: 2px solid #ffc107;
      color: #856404;
    }

    .stats-container {
      text-align: left;
      margin: 1rem 0;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid #eee;
    }

    .stat-value {
      font-weight: 700;
      color: var(--accent-color);
    }

    .winner-stat {
      padding: 0.8rem;
      margin: 0.5rem 0;
      border-radius: 8px;
      background: #f8f9fa;
      border-left: 4px solid var(--primary-color);
    }

    .winner-stat.top-winner {
      background: rgba(255,215,0,0.1);
      border-left-color: #ffd700;
      font-weight: 700;
    }

    /* ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ */
    .teacher-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid #eee;
    }

    .tab-btn {
      padding: 0.8rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-color);
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: var(--primary-color);
      color: white;
      transform: translateY(2px);
    }

    .tab-content {
      display: none;
      padding: 1rem 0;
    }

    .tab-content.active {
      display: block;
    }

    .rule-card, .tip-card, .strategy-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1.5rem;
      margin: 1rem 0;
      border-left: 4px solid var(--primary-color);
    }

    .rule-card h4, .tip-card h4, .strategy-card h4 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .rule-card ul, .tip-card ul, .strategy-card ul {
      padding-right: 1.5rem;
      line-height: 1.6;
    }

    .rule-card li, .tip-card li, .strategy-card li {
      margin: 0.5rem 0;
    }

    .question-type {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      border: 1px solid #ddd;
    }

    .question-type h5 {
      color: var(--accent-color);
      margin-bottom: 0.5rem;
    }

    .question-type p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ */
    .loading-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-indicator.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-content {
      text-align: center;
      color: white;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      margin: 0 auto 2rem;
      animation: spin 1s linear infinite;
    }

    .loading-content h3 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .loading-content p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes fallingStar {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
</style>
</head>
<body>
<!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑŸÖŸàÿ≠ÿØÿ© -->
<div class="control-buttons">
  <button class="control-btn" id="backBtn" title="ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">
    <i class="fas fa-home"></i>
  </button>
  <button class="control-btn" id="fullscreenBtn" title="ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©">
    <i class="fas fa-expand"></i>
  </button>
  <button class="control-btn" id="muteBtn" title="ŸÉÿ™ŸÖ/ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™">
    <i class="fas fa-volume-up"></i>
  </button>
</div>

<!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
<div id="notification-container"></div>

<!-- ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
<div id="loadingIndicator" class="loading-indicator">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <h3><i class="fas fa-fire"></i> ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h3>
    <p id="loadingText">Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...</p>
  </div>
</div>

<div class="activity-container">
  <!-- ÿ±ÿ£ÿ≥ ÿßŸÑÿ™ÿ≠ÿØŸä -->
  <div class="challenge-header">
    <h1><i class="fas fa-fire"></i> ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ <i class="fas fa-fire"></i></h1>
    <p>ÿßÿÆÿ™ÿ®ÿ± ŸÖŸáÿßÿ±ÿßÿ™ŸÉ Ÿàÿ™ŸÜÿßŸÅÿ≥ ŸÖÿπ ÿ≤ŸÖŸÑÿßÿ¶ŸÉ ŸÅŸä ÿ™ÿ≠ÿØŸäÿßÿ™ ŸÖÿ´Ÿäÿ±ÿ©!</p>
  </div>

  <!-- ÿ£ÿØŸàÿßÿ™ ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
  <div class="challenge-controls">
    <div class="control-group">
      <label><i class="fas fa-users"></i> ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ:</label>
      <select id="classSelect">
        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>
      </select>
    </div>

    <div class="control-group">
      <label><i class="fas fa-gamepad"></i> ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä:</label>
      <select id="mode" onchange="handleModeChange()">
        <option value="random">ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿπÿ¥Ÿàÿßÿ¶Ÿä)</option>
        <option value="manual">ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</option>
        <option value="teams">ŸÅÿ±ŸäŸÇ ÿ∂ÿØ ŸÅÿ±ŸäŸÇ</option>
        <option value="multiTeams">ÿ™ÿ≠ÿØŸä ÿ®ŸäŸÜ ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ©</option>
      </select>
    </div>

    <div id="manualSelection" class="manual-selection">
      <h4><i class="fas fa-hand-pointer"></i> ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ</h4>
      <div class="control-group">
        <label>ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ£ŸàŸÑ:</label>
        <select id="student1Select"></select>
      </div>
      <div class="control-group">
        <label>ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ´ÿßŸÜŸä:</label>
        <select id="student2Select"></select>
      </div>
    </div>

    <div id="multiTeamOptions" class="multi-team-options">
      <h4><i class="fas fa-users-cog"></i> ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©</h4>
      <div class="control-group">
        <label>ÿπÿØÿØ ÿßŸÑŸÅÿ±ŸÇ:</label>
        <select id="teamCountSelect">
          <option value="3">3 ŸÅÿ±ŸÇ</option>
          <option value="4">4 ŸÅÿ±ŸÇ</option>
          <option value="5">5 ŸÅÿ±ŸÇ</option>
          <option value="6">6 ŸÅÿ±ŸÇ</option>
          <option value="7">7 ŸÅÿ±ŸÇ</option>
          <option value="8">8 ŸÅÿ±ŸÇ</option>
        </select>
      </div>
    </div>

    <div class="control-group">
      <label><i class="fas fa-clock"></i> ÿßŸÑŸÖÿØÿ©:</label>
      <select id="duration">
        <option value="30">30 ÿ´ÿßŸÜŸäÿ©</option>
        <option value="60">1 ÿØŸÇŸäŸÇÿ©</option>
        <option value="120">2 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="180">3 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="240">4 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="300">5 ÿØŸÇÿßÿ¶ŸÇ</option>
        <option value="600">10 ÿØŸÇÿßÿ¶ŸÇ</option>
      </select>
    </div>

    <div class="control-group">
      <button onclick="prepareChallenge()" class="btn btn-accent">
        <i class="fas fa-rocket"></i> ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
      <button onclick="showTeacherGuide()" class="btn btn-info">
        <i class="fas fa-chalkboard-teacher"></i> ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ
      </button>
    </div>
  </div>

  <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ™ÿ≠ÿØŸä -->
  <div id="challengeArea" class="challenge-area">
    <div id="turnLabel" class="turn-display">
      <i class="fas fa-user-clock"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±...
    </div>

    <div id="timerWrapper" class="timer-container">
      <svg class="timer-circle" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="50" fill="none" stroke="#eee" stroke-width="8"></circle>
        <circle cx="60" cy="60" r="50" fill="none" id="progress" stroke="var(--accent-color)" 
                stroke-dasharray="314" stroke-dashoffset="0" stroke-width="8" 
                transform="rotate(-90 60 60)"></circle>
      </svg>
      <div id="timerTextSec" class="timer-text">0s</div>
    </div>

    <div class="teams-grid" id="teamsContainer"></div>

    <div class="challenge-actions">
      <button onclick="nextTurn()" class="btn btn-primary">
        <i class="fas fa-arrow-right"></i> ÿßŸÑÿ™ÿßŸÑŸä
      </button>
      <button onclick="endChallenge()" class="btn btn-success">
        <i class="fas fa-trophy"></i> ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
      </button>
      <button onclick="resetChallenge()" class="btn btn-secondary">
        <i class="fas fa-redo"></i> ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ
      </button>
    </div>

    <div id="winnerDisplay" class="winner-display"></div>
  </div>
</div>
<!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© -->
<div id="instructionModal" class="instruction-modal">
  <div class="modal-content">
    <h2><i class="fas fa-info-circle"></i> ÿ™ÿπŸÑŸäŸÖÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä</h2>
    <p id="instructionText"></p>
    <button onclick="closeInstructionModal()" class="btn btn-primary">
      <i class="fas fa-check"></i> ŸÅŸáŸÖÿ™
    </button>
  </div>
</div>

<!-- ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä -->
<div id="teacherGuideModal" class="instruction-modal">
  <div class="modal-content" style="max-width: 800px;">
    <h2><i class="fas fa-chalkboard-teacher"></i> ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ - ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h2>
    
    <div class="teacher-tabs">
      <button class="tab-btn active" data-tab="rules">ŸÇŸàÿßÿπÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑</button>
      <button class="tab-btn" data-tab="management">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅ</button>
      <button class="tab-btn" data-tab="strategies">ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿßÿ™ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
    </div>
    
    <div id="rules-content" class="tab-content active">
      <h3><i class="fas fa-list-ol"></i> ŸÇŸàÿßÿπÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑</h3>
      <div class="rule-card">
        <h4>üéØ ÿßŸÑŸáÿØŸÅ ŸÖŸÜ ÿßŸÑŸÜÿ¥ÿßÿ∑</h4>
        <p>ÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ŸäŸÜ ÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ™ÿ∑ŸàŸäÿ± ŸÖŸáÿßÿ±ÿßÿ™ ÿßŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸàÿßŸÑÿπŸÖŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä.</p>
      </div>
      
      <div class="rule-card">
        <h4>‚öôÔ∏è ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h4>
        <ul>
          <li><strong>ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿπÿ¥Ÿàÿßÿ¶Ÿä):</strong> ŸÖŸÜÿßÿ≥ÿ® ŸÑŸÑŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÑÿ≥ÿ±Ÿäÿπÿ©</li>
          <li><strong>ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ® (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä):</strong> ŸÑÿßÿ≥ÿ™ŸáÿØÿßŸÅ ÿ∑ŸÑÿßÿ® ŸÖÿ≠ÿØÿØŸäŸÜ</li>
          <li><strong>ŸÅÿ±ŸäŸÇ ÿ∂ÿØ ŸÅÿ±ŸäŸÇ:</strong> ŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿπŸÖŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä</li>
          <li><strong>ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ©:</strong> ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ© ŸàÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™</li>
        </ul>
      </div>
      
      <div class="rule-card">
        <h4>üïí ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸàŸÇÿ™</h4>
        <p>ŸäŸÖŸÉŸÜ ÿ™ÿÆÿµŸäÿµ ŸÖÿØÿ© ŸÉŸÑ ÿØŸàÿ± ŸÖŸÜ 30 ÿ´ÿßŸÜŸäÿ© ÿ•ŸÑŸâ 10 ÿØŸÇÿßÿ¶ŸÇ ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑŸÜÿ¥ÿßÿ∑ ŸàÿßŸÑÿ£ŸáÿØÿßŸÅ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ©.</p>
      </div>
    </div>
    
    <div id="management-content" class="tab-content">
      <h3><i class="fas fa-users-cog"></i> ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµŸÅ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä</h3>
      
      <div class="tip-card">
        <h4>üìã ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑŸÖÿ≥ÿ®ŸÇ</h4>
        <ul>
          <li>ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸÅ</li>
          <li>ÿ≠ÿØÿØ ÿßŸÑŸÖÿØÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿµÿπŸàÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</li>
          <li>ÿ¨Ÿáÿ≤ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™ŸÜŸàÿπÿ© ŸàŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>üéÆ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä</h4>
        <ul>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ£ÿ≤ÿ±ÿßÿ± +/- ŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÅŸàÿ±ÿßŸã</li>
          <li>ÿ¥ÿ¨ÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ ÿπŸÑŸâ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ÿßŸÑÿ™ÿµŸÅŸäŸÇ</li>
          <li>ÿ±ÿßŸÇÿ® ÿßŸÑŸàŸÇÿ™ Ÿàÿßÿ≥ÿ™ŸÅÿØ ŸÖŸÜ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ±ÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ©</li>
          <li>ÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ŸÖÿßÿ≥ ŸàÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©</li>
        </ul>
      </div>
      
      <div class="tip-card">
        <h4>‚öñÔ∏è ÿßŸÑÿπÿØÿßŸÑÿ© ŸàÿßŸÑÿ™Ÿàÿßÿ≤ŸÜ</h4>
        <ul>
          <li>ÿßŸÖŸÜÿ≠ ŸÅÿ±ÿµ ŸÖÿ™ÿ≥ÿßŸàŸäÿ© ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿä ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ¥ÿßŸÖŸÑÿ©</li>
          <li>ÿßÿπÿØŸÑ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≠ÿ≥ÿ® ŸÇÿØÿ±ÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</li>
        </ul>
      </div>
    </div>
    
    <div id="strategies-content" class="tab-content">
      <h3><i class="fas fa-clipboard-check"></i> ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿßÿ™ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</h3>
      
      <div class="strategy-card">
        <h4>ü•á ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜŸÇÿßÿ∑</h4>
        <ul>
          <li><strong>ŸÜŸÇÿ∑ÿ© Ÿàÿßÿ≠ÿØÿ©:</strong> ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿ®ÿ≥Ÿäÿ∑ÿ© ŸàÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©</li>
          <li><strong>ŸÜŸÇÿ∑ÿ™ÿßŸÜ:</strong> ŸÑŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÖŸÅÿµŸÑÿ© ÿ£Ÿà ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ</li>
          <li><strong>ŸÜŸÇÿ∑ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©:</strong> ŸÑŸÑÿ•ÿ®ÿØÿßÿπ ÿ£Ÿà ÿßŸÑÿ≥ÿ±ÿπÿ© ÿßŸÑŸÖŸÖŸäÿ≤ÿ©</li>
        </ul>
      </div>
      
      <div class="strategy-card">
        <h4>üìä ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖŸÇÿ™ÿ±ÿ≠ÿ©</h4>
        <div class="question-type">
          <h5>‚ö° ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ≥ÿ±Ÿäÿπÿ© (30-60 ÿ´ÿßŸÜŸäÿ©)</h5>
          <p>ÿ≠ŸÇÿßÿ¶ŸÇ ÿ£ÿ≥ÿßÿ≥Ÿäÿ©ÿå ÿ™ÿπÿßÿ±ŸäŸÅÿå ÿπŸÖŸÑŸäÿßÿ™ ÿ≠ÿ≥ÿßÿ®Ÿäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©</p>
        </div>
        <div class="question-type">
          <h5>üß† ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (1-3 ÿØŸÇÿßÿ¶ŸÇ)</h5>
          <p>ÿ™ÿ≠ŸÑŸäŸÑÿå ŸÖŸÇÿßÿ±ŸÜÿßÿ™ÿå ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿßÿ™ ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ÿßŸÑÿµÿπŸàÿ®ÿ©</p>
        </div>
        <div class="question-type">
          <h5>üéØ ÿ£ÿ≥ÿ¶ŸÑÿ© ŸÖÿ™ŸÇÿØŸÖÿ© (3-10 ÿØŸÇÿßÿ¶ŸÇ)</h5>
          <p>ŸÖÿ¥ÿßÿ±Ÿäÿπ ÿµÿ∫Ÿäÿ±ÿ©ÿå ÿπÿ±Ÿàÿ∂ÿå ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿßÿ™ ŸÖÿπŸÇÿØÿ©</p>
        </div>
      </div>
      
      <div class="strategy-card">
        <h4>üèÜ ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑÿ™ÿ≠ŸÅŸäÿ≤</h4>
        <ul>
          <li>ÿßÿ≠ÿ™ŸÅŸÑ ÿ®ÿßŸÑŸÜÿ¨ÿßÿ≠ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ŸàÿßŸÑŸÉÿ®Ÿäÿ±ÿ©</li>
          <li>ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ™ÿπÿ≤Ÿäÿ≤ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ÿßÿ≥ÿ™ŸÖÿ±ÿßÿ±</li>
          <li>ÿßÿ±ÿ®ÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ®ÿßŸÑŸÖŸÜŸáÿ¨ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä</li>
          <li>ÿßÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑÿ™ÿ≠ŸÅŸäÿ≤ ÿßŸÑÿ™ÿ≠ÿ≥ŸÜ</li>
        </ul>
      </div>
    </div>
    
    <button onclick="closeTeacherGuide()" class="btn btn-primary">
      <i class="fas fa-check"></i> ŸÅŸáŸÖÿ™ - ŸÑŸÜÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≠ÿØŸä!
    </button>
  </div>
</div>

<!-- ÿßŸÑŸÖÿ§ÿ´ÿ±ÿßÿ™ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© -->
<div id="fireworks" class="fireworks-effect"></div>
<div id="timeUpPopup" class="time-up-popup">
  <i class="fas fa-clock"></i> ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™!
</div>
<script src="../config/unified-scripts-template.js"></script>
<script>
  // ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ActivityUtils
  const activity = new ActivityUtils('ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™', '../assets/media/sounds/');
  
  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸàÿßŸÑÿ∞ŸÉŸä ====
  const challengeSounds = {
    start: '../assets/media/sounds/start-timer.mp3',
    win: '../assets/media/sounds/win.mp3',
    winBlockbusters: '../assets/media/sounds/win-Blockbusters.mp3',
    celebration: '../assets/media/sounds/clap.mp3',
    timeUp: '../assets/media/sounds/long-beep.mp3',
    countdown: '../assets/media/sounds/countdown-beep.mp3',
    click: '../assets/media/sounds/Click.mp3',
    select: '../assets/media/sounds/select.mp3',
    reveal: '../assets/media/sounds/reveal.mp3',
    vs: '../assets/media/sounds/vs.mp3',
    draw: '../assets/media/sounds/draw.mp3',
    end: '../assets/media/sounds/end-timer.mp3',
    nameStart: '../assets/media/sounds/name-start.mp3',
    nameStop: '../assets/media/sounds/name-stop.mp3'
  };
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÅŸàÿ≤ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ
  function playWinSoundSequence() {
    if (!activity.soundEnabled) return;
    
    console.log('üéµ ÿ®ÿØÿ° ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÅŸàÿ≤ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ...');
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑŸÅŸàÿ≤ ÿ£ŸàŸÑÿßŸã
    activity.playSound('win.mp3');
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ win-Blockbusters ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ£ŸàŸÑ
    setTimeout(() => {
      activity.playSound('win-Blockbusters.mp3');
    }, 1000);
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑÿ™ÿµŸÅŸäŸÇ ÿ®ÿπÿØ ÿ´ÿßŸÜŸäÿ™ŸäŸÜ
    setTimeout(() => {
      activity.playSound('clap.mp3');
    }, 2500);
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÖÿ™ÿ≤ÿßŸÖŸÜÿ©
    showCelebrationEffects();
  }
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©
  function showCelebrationEffects() {
    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàŸÜŸÅŸäÿ™Ÿä ŸÖÿ™ŸÇÿØŸÖ ŸÖÿ™ÿπÿØÿØ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑ
    if (window.confetti) {
      // ÿßŸÜŸÅÿ¨ÿßÿ± ŸÖÿ±ŸÉÿ≤Ÿä
      confetti({ 
        particleCount: 100, 
        spread: 70, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700', '#4169E1', '#8A2BE2']
      });
      
      // ÿßŸÜŸÅÿ¨ÿßÿ±ÿßÿ™ ÿ¨ÿßŸÜÿ®Ÿäÿ©
      setTimeout(() => {
        confetti({ 
          particleCount: 50, 
          spread: 120, 
          origin: { x: 0.1, y: 0.7 },
          colors: ['#FF6347', '#32CD32', '#FFD700']
        });
        confetti({ 
          particleCount: 50, 
          spread: 120, 
          origin: { x: 0.9, y: 0.7 },
          colors: ['#FF6347', '#32CD32', '#FFD700']
        });
      }, 500);
      
      // ÿßŸÜŸÅÿ¨ÿßÿ± ŸÜŸáÿßÿ¶Ÿä
      setTimeout(() => {
        confetti({ 
          particleCount: 80, 
          spread: 100, 
          origin: { y: 0.8 },
          colors: ['#FF1493', '#00CED1', '#FFD700', '#FF6347']
        });
      }, 1000);
    }

    // ÿ•ÿ∂ÿßŸÅÿ© ŸÜÿ¨ŸàŸÖ ŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ©
    createFallingStars();

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 5000);
  }
  
  // ŸÜÿ¨ŸàŸÖ ŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ©
  function createFallingStars() {
    for (let i = 0; i < 10; i++) {
      setTimeout(() => {
        const star = document.createElement('div');
        star.innerHTML = '‚≠ê';
        star.style.cssText = `
          position: fixed;
          font-size: 2rem;
          color: #FFD700;
          z-index: 9999;
          pointer-events: none;
          animation: fallingStar 3s ease-in forwards;
          left: ${Math.random() * 100}vw;
          top: -50px;
        `;
        document.body.appendChild(star);
        
        setTimeout(() => {
          if (star.parentNode) star.parentNode.removeChild(star);
        }, 3000);
      }, i * 200);
    }
  }
  
  // ÿ™ÿ≠ŸÉŸÖ ÿµŸàÿ™Ÿä ÿ∞ŸÉŸä
  function playSmartSound(soundKey, options = {}) {
    const { volume = 0.7, delay = 0, loop = false } = options;
    
    setTimeout(() => {
      const soundPath = challengeSounds[soundKey];
      if (soundPath && activity.soundEnabled) {
        activity.playSound(soundPath.split('/').pop(), { volume, loop });
      }
    }, delay);
  }// ==== ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑŸÜÿ¥ÿßÿ∑ ====
let studentData = {}, currentList = [], timer, timeLeft = 0;
let currentTurn = 1, usedStudents = [];
let teamScores = {};
let challengeStats = {
  totalChallenges: 0,
  completedChallenges: 0,
  teamWins: {},
  averageTime: 0,
  bestStreak: 0,
  currentStreak: 0,
  sessionStart: Date.now(),
  dailyStats: {},
  favoriteMode: '',
  totalPlayTime: 0
};

// ==== ŸÜÿ∏ÿßŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ====
function saveProgress() {
  try {
    const progressData = {
      stats: challengeStats,
      lastPlayed: Date.now(),
      version: '2.0'
    };
    localStorage.setItem('challengesProgress', JSON.stringify(progressData));
    console.log('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ ÿ®ŸÜÿ¨ÿßÿ≠');
  } catch (error) {
    console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ:', error);
  }
}

function loadProgress() {
  try {
    const saved = localStorage.getItem('challengesProgress');
    if (saved) {
      const progressData = JSON.parse(saved);
      challengeStats = { ...challengeStats, ...progressData.stats };
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
      const today = new Date().toDateString();
      if (!challengeStats.dailyStats[today]) {
        challengeStats.dailyStats[today] = {
          challenges: 0,
          timeSpent: 0,
          wins: {}
        };
      }
      
      console.log('üìä ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿØŸÖ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏');
      return true;
    }
  } catch (error) {
    console.warn('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇÿØŸÖ:', error);
  }
  return false;
}

// ==== ŸÜÿ∏ÿßŸÖ ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿ∞ŸÉŸä ====
function updatePerformanceStats(winner, timeSpent, mode) {
  const today = new Date().toDateString();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿπÿßŸÖÿ©
  challengeStats.totalChallenges++;
  challengeStats.completedChallenges++;
  challengeStats.totalPlayTime += timeSpent;
  challengeStats.averageTime = challengeStats.totalPlayTime / challengeStats.completedChallenges;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
  if (winner) {
    challengeStats.teamWins[winner] = (challengeStats.teamWins[winner] || 0) + 1;
    challengeStats.currentStreak++;
    challengeStats.bestStreak = Math.max(challengeStats.bestStreak, challengeStats.currentStreak);
  } else {
    challengeStats.currentStreak = 0;
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜŸÖÿ∑ ÿßŸÑŸÖŸÅÿ∂ŸÑ
  const modes = JSON.parse(localStorage.getItem('challengesModes') || '{}');
  modes[mode] = (modes[mode] || 0) + 1;
  localStorage.setItem('challengesModes', JSON.stringify(modes));
  
  const favoriteMode = Object.keys(modes).reduce((a, b) => modes[a] > modes[b] ? a : b);
  challengeStats.favoriteMode = favoriteMode;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
  if (!challengeStats.dailyStats[today]) {
    challengeStats.dailyStats[today] = { challenges: 0, timeSpent: 0, wins: {} };
  }
  
  challengeStats.dailyStats[today].challenges++;
  challengeStats.dailyStats[today].timeSpent += timeSpent;
  
  if (winner) {
    challengeStats.dailyStats[today].wins[winner] = (challengeStats.dailyStats[today].wins[winner] || 0) + 1;
  }
  
  // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÇÿØŸÖ
  saveProgress();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ™ÿ≠ŸÅŸäÿ≤Ÿä
  if (challengeStats.currentStreak > 0 && challengeStats.currentStreak % 5 === 0) {
    showAdvancedNotification(
      'üî• ÿ•ŸÜÿ¨ÿßÿ≤ ÿ±ÿßÿ¶ÿπ!',
      `ÿ≥ŸÑÿ≥ŸÑÿ© ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ${challengeStats.currentStreak} ŸÖÿ™ÿ™ÿßŸÑŸäÿ©!`,
      'celebration',
      5000
    );
  }
}

// ==== Ÿàÿ∏ÿßÿ¶ŸÅ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ====
function showLoadingIndicator(message = 'Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...') {
  const indicator = document.getElementById('loadingIndicator');
  const text = document.getElementById('loadingText');
  if (indicator) {
    indicator.classList.remove('hidden');
    if (text) text.textContent = message;
  }
}

function hideLoadingIndicator() {
  const indicator = document.getElementById('loadingIndicator');
  if (indicator) {
    indicator.classList.add('hidden');
  }
}

function updateLoadingProgress(message) {
  const text = document.getElementById('loadingText');
  if (text) text.textContent = message;
}  // ==== ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ŸàÿßŸÑÿ∞ŸÉŸä ====
  async function loadStudents() {
    // ÿπÿ±ÿ∂ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    showLoadingIndicator('ÔøΩ ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
    updateLoadingProgress('ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');
    
    // ÿ•ÿπÿØÿßÿØ timeout ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ
    const timeoutPromise = new Promise((_, reject) => 
      setTimeout(() => reject(new Error('ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ')), 3000)
    );
    
    try {
      console.log('üîÑ ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...');
      updateLoadingProgress('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ ÿßŸÑÿÆÿßÿØŸÖ...');
      
      // ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿπ timeout
      const response = await Promise.race([
        fetch('../data/studentData.json', {
          method: 'GET',
          cache: 'no-cache',
          headers: {
            'Content-Type': 'application/json',
          }
        }),
        fetch('https://raw.githubusercontent.com/A7mdooh/entertainment-app/main/data/studentData.json', {
          method: 'GET',
          cache: 'no-cache',
          headers: {
            'Content-Type': 'application/json',
          }
        }),
        timeoutPromise
      ]);
      
      if (!response.ok) {
        throw new Error(`ÿÆÿ∑ÿ£ HTTP: ${response.status}`);
      }
      
      updateLoadingProgress('ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...');
      studentData = await response.json();
      
      if (!studentData || typeof studentData !== 'object') {
        throw new Error('ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
      }
      
      updateLoadingProgress('ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©...');
      
      // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿµŸÅŸàŸÅ
      populateClassSelect();
      setupEventListeners();
      
      const classCount = Object.keys(studentData).length;
      const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
      
      console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${totalStudents} ÿ∑ÿßŸÑÿ® ŸÖŸÜ ${classCount} ÿµŸÅ`);
      
      updateLoadingProgress('‚úÖ ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!');
      
      // ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          '‚úÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿßÿ¨ÿ≠!',
          `ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${totalStudents} ÿ∑ÿßŸÑÿ® ŸÖŸÜ ${classCount} ÿµŸÅ ÿ®ŸÜÿ¨ÿßÿ≠`,
          'success',
          4000
        );
      }, 1000);
      
    } catch (error) {
      console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©:', error);
      
      updateLoadingProgress('ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©...');
      
      // ÿ®ŸäÿßŸÜÿßÿ™ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ŸÖÿ≠ÿ≥ŸÜÿ©
      studentData = {
        'ÿßŸÑÿπÿßÿ¥ÿ± ÿ£': ['ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ ÿßŸÑŸÅÿßÿ±ÿ≥Ÿä', 'ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä ÿßŸÑÿ®ŸÑŸàÿ¥Ÿä', 'ÿ≥ÿßŸÑŸÖ ÿÆÿßŸÑÿØ ÿßŸÑŸáŸÜÿßÿ¶Ÿä', 'ŸÖÿ±ŸäŸÖ ÿ≥ÿπŸäÿØ ÿßŸÑŸÉŸÜÿØŸä'],
        'ÿßŸÑÿπÿßÿ¥ÿ± ÿ®': ['ÿπÿ®ÿØÿßŸÑŸÑŸá ÿ£ÿ≠ŸÖÿØ ÿßŸÑŸÖÿπŸÖÿ±Ÿä', 'ÿÆÿØŸäÿ¨ÿ© ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≤ÿØÿ¨ÿßŸÑŸä', 'ÿ∑ŸÑÿßŸÑ ÿ≥ÿßŸÑŸÖ ÿßŸÑÿ¥ÿ≠Ÿä', 'ŸÜŸàÿ±ÿß ÿπŸÑŸä ÿßŸÑÿ®Ÿàÿ≥ÿπŸäÿØŸä'],
        'ÿßŸÑÿ≠ÿßÿØŸä ÿπÿ¥ÿ± ÿ£': ['ŸÖÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ ÿßŸÑÿ±Ÿàÿßÿ≠Ÿä', 'ÿπÿßÿ¶ÿ¥ÿ© ÿÆÿßŸÑÿØ ÿßŸÑÿ≠ÿ®ÿ≥Ÿä', 'ŸäŸàÿ≥ŸÅ ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ∫ÿßŸÅÿ±Ÿä', 'ÿ≤ŸäŸÜÿ® ÿπŸÑŸä ÿßŸÑÿ≥Ÿäÿßÿ®Ÿä'],
        'ÿßŸÑÿ´ÿßŸÜŸä ÿπÿ¥ÿ± ÿ£': ['ÿπŸÖÿ± ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≠ÿßÿ±ÿ´Ÿä', 'ÿ≥ÿßÿ±ÿ© ÿ≥ÿßŸÑŸÖ ÿßŸÑÿπÿ®ÿ±Ÿä', 'ÿ≠ŸÖÿØ ÿπŸÑŸä ÿßŸÑÿÆÿ±ŸàÿµŸä', 'ÿ£ÿ≥ŸÖÿßÿ° ÿ£ÿ≠ŸÖÿØ ÿßŸÑÿ®ÿ∑ÿßÿ¥Ÿä']
      };
      
      populateClassSelect();
      setupEventListeners();
      
      updateLoadingProgress('‚ö†Ô∏è ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©');
      
      // ÿ•ÿÆŸÅÿßÿ° ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          '‚ö†Ô∏è ÿ®ŸäÿßŸÜÿßÿ™ ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ©',
          'ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©',
          'warning',
          4000
        );
      }, 1000);
    }
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿµŸÅŸàŸÅ
  function populateClassSelect() {
    const classSelect = document.getElementById('classSelect');
    classSelect.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸÅ</option>';
    
    Object.keys(studentData).forEach(cls => {
      const option = document.createElement('option');
      option.value = cls;
      option.textContent = `ÿßŸÑÿµŸÅ ${cls}`;
      classSelect.appendChild(option);
    });
    
    // ÿ™ÿ≠ÿØŸäÿØ ÿ£ŸàŸÑ ÿµŸÅ ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
    if (classSelect.options.length > 1) {
      classSelect.selectedIndex = 1;
      populateStudentSelectors(classSelect.value);
    }
  }
  
  // ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
  function setupEventListeners() {
    const classSelect = document.getElementById('classSelect');
    
    classSelect.addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('Click.mp3');
    });

    // ÿ±ÿ®ÿ∑ ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸäÿØŸàŸä
    document.getElementById('student1Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });

    document.getElementById('student2Select').addEventListener('change', () => {
      populateStudentSelectors(classSelect.value);
      activity.playSound('select.mp3');
    });
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸàÿßŸÑÿ∞ŸÉŸä ====
  function showAdvancedNotification(title, message, type = 'info', duration = 4000) {
    const notification = document.createElement('div');
    notification.className = `advanced-notification ${type}`;
    
    const icons = {
      success: '‚úÖ',
      warning: '‚ö†Ô∏è',
      error: '‚ùå',
      info: '‚ÑπÔ∏è',
      challenge: 'üî•',
      timer: '‚è∞',
      trophy: 'üèÜ',
      loading: 'üîÑ',
      celebration: 'üéâ'
    };
    
    notification.innerHTML = `
      <div class="notification-header">
        <span class="notification-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
        <span class="notification-title">${title}</span>
        <button class="notification-close" onclick="this.closest('.advanced-notification').remove()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="notification-message">${message}</div>
      <div class="notification-progress"></div>
    `;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑÿ≠ÿßŸàŸäÿ©
    const container = document.getElementById('notification-container') || document.body;
    container.appendChild(notification);
    
    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
    setTimeout(() => notification.classList.add('show'), 100);
    
    // ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÇÿØŸÖ
    const progressBar = notification.querySelector('.notification-progress');
    progressBar.style.animation = `progress ${duration}ms linear`;
    
    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, duration);
    
    // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ŸÖŸÜÿßÿ≥ÿ®
    activity.playSound('reveal.mp3');
    
    return notification;
  }

  // ÿ•ÿ¥ÿπÿßÿ± ÿπÿßÿ¶ŸÖ ŸÑŸÑŸÜÿµÿßÿ¶ÿ≠
  function showFloatingTip(message, element) {
    const tip = document.createElement('div');
    tip.className = 'floating-tip';
    tip.innerHTML = `
      <div class="tip-content">
        <i class="fas fa-lightbulb"></i>
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(tip);
    
    // ŸÖŸàŸÇÿπ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
    const rect = element.getBoundingClientRect();
    tip.style.left = rect.left + 'px';
    tip.style.top = (rect.top - 60) + 'px';
    
    setTimeout(() => tip.classList.add('show'), 100);
    
    setTimeout(() => {
      tip.classList.remove('show');
      setTimeout(() => {
        if (tip.parentNode) tip.parentNode.removeChild(tip);
      }, 300);
    }, 3000);
  }

  // ŸÜÿ∏ÿßŸÖ ŸÜÿµÿßÿ¶ÿ≠ ÿ∞ŸÉŸäÿ©
  function showGameTips() {
    const tips = [
      'üí° ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©',
      '‚ö° ÿßÿ∂ÿ®ÿ∑ ÿßŸÑŸàŸÇÿ™ ÿ≠ÿ≥ÿ® ÿµÿπŸàÿ®ÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©',
      'üéØ ÿ±ÿßŸÇÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑÿ£ÿØÿßÿ°',
      'üî• ÿ¥ÿ¨ÿπ ÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä ÿ®ŸäŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®',
      'üìä ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÜÿµÿßÿ¶ÿ≠',
      'üéÆ ÿ¨ÿ±ÿ® ÿ£ŸÜŸÖÿßÿ∑ ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑÿ™ŸÜŸàŸäÿπ ÿßŸÑÿ™ÿ¨ÿ±ÿ®ÿ©'
    ];
    
    const randomTip = tips[Math.floor(Math.random() * tips.length)];
    
    setTimeout(() => {
      showAdvancedNotification(
        'üí° ŸÜÿµŸäÿ≠ÿ© ÿ∞ŸÉŸäÿ©',
        randomTip,
        'info',
        6000
      );
    }, Math.random() * 10000 + 15000); // ÿ®ŸäŸÜ 15-25 ÿ´ÿßŸÜŸäÿ©
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    
    // ÿ™ÿ≠ÿ≥ŸäŸÜ ÿπÿ±ÿ∂ ÿßŸÑŸàŸÇÿ™
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    const timeDisplay = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2, '0')}` : `${timeLeft}s`;
    
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeDisplay}`;

    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ∞Ÿäÿ± ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ©
    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      circle.style.stroke = '#ff4444'; // ÿ£ÿ≠ŸÖÿ± ŸÑŸÑÿ™ÿ≠ÿ∞Ÿäÿ±
      secText.style.color = '#ff4444';
      
      if (timeLeft <= 5) {
        activity.playSound('countdown-beep.mp3');
        secText.style.animation = 'pulse 0.5s infinite';
      }
    } else if (timeLeft <= 30) {
      circle.style.stroke = '#ff8800'; // ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä ŸÑŸÑÿ™ŸÜÿ®ŸäŸá
      secText.style.color = '#ff8800';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    } else {
      circle.style.stroke = 'var(--accent-color)';
      secText.style.color = 'var(--accent-color)';
      wrapper.classList.remove('shake');
      secText.style.animation = 'none';
    }
  }
  function populateStudentSelectors(cls) {
    const s1 = document.getElementById('student1Select');
    const s2 = document.getElementById('student2Select');
    const students = studentData[cls] || [];
    const selected1 = s1.value;
    const selected2 = s2.value;

    s1.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ£ŸàŸÑ</option>';
    s2.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ´ÿßŸÜŸä</option>';

    students.forEach(stu => {
      if (stu !== selected2) {
        const opt1 = document.createElement('option');
        opt1.value = stu;
        opt1.textContent = stu;
        s1.appendChild(opt1);
      }
      if (stu !== selected1) {
        const opt2 = document.createElement('option');
        opt2.value = stu;
        opt2.textContent = stu;
        s2.appendChild(opt2);
      }
    });

    if (selected1 && [...s1.options].some(o => o.value === selected1)) s1.value = selected1;
    if (selected2 && [...s2.options].some(o => o.value === selected2)) s2.value = selected2;
  }

  // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿ™ÿ∫ŸäŸäÿ± ŸÜŸÖÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸä
  function handleModeChange() {
    const mode = document.getElementById('mode').value;
    
    activity.playSound('Click.mp3');
    
    const manualSelection = document.getElementById('manualSelection');
    const multiTeamOptions = document.getElementById('multiTeamOptions');
    
    manualSelection.style.display = (mode === 'manual') ? 'block' : 'none';
    multiTeamOptions.style.display = (mode === 'multiTeams') ? 'block' : 'none';

    if (mode === 'manual') {
      const currentClass = document.getElementById('classSelect').value;
      if (currentClass) {
        populateStudentSelectors(currentClass);
        activity.showNotification('ÿßÿÆÿ™ÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ ŸÑŸÑÿ™ÿ≠ÿØŸä', 'info');
      }
    }
  }

  // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
  function showInstructionModal(mode) {
    const modal = document.getElementById('instructionModal');
    const text = document.getElementById('instructionText');
    let instructions = '';

    switch (mode) {
      case 'random':
        instructions = 'ÿ≥Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿ®ÿ¥ŸÉŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿä ŸÑŸÑÿ™ÿ≠ÿØŸä. ŸÉŸÑ ÿ∑ÿßŸÑÿ® ŸÑŸá ÿØŸàÿ± Ÿàÿ≤ŸÖŸÜ ŸÖÿ≠ÿØÿØ. ÿßŸÑŸÖÿπŸÑŸÖ Ÿäÿ≥ÿ¨ŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸäÿØŸàŸäÿßŸã ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ£ÿ≤ÿ±ÿßÿ± + Ÿà -.';
        break;
      case 'manual':
        instructions = 'ŸäŸÖŸÉŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ ŸäÿØŸàŸäÿßŸã ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©. ŸÉŸÑ ÿ∑ÿßŸÑÿ® ŸÑŸá ŸàŸÇÿ™ ŸÖÿ≠ÿØÿØ ŸÑŸÑÿ£ÿØÿßÿ°. Ÿäÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ŸäÿØŸàŸäÿßŸã.';
        break;
      case 'teams':
        instructions = 'Ÿäÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ŸäŸÜ ŸÅÿ±ŸäŸÇŸäŸÜ. ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸäŸÖŸÉŸÜŸá ŸÉÿ≥ÿ® ÿ£Ÿà ÿÆÿ≥ÿßÿ±ÿ© ŸÜŸÇÿßÿ∑. ÿßŸÑŸáÿØŸÅ ŸáŸà ÿßŸÑÿ™ŸÅÿßÿπŸÑ ÿßŸÑÿ¨ŸÖÿßÿπŸä ŸàÿßŸÑÿ™ŸÜÿßŸÅÿ≥ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿä.';
        break;
      case 'multiTeams':
        instructions = 'ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿπÿØÿ© ŸÅÿ±ŸÇ (ŸÖŸÜ 3 ÿ•ŸÑŸâ 8) ÿ≠ÿ≥ÿ® ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ. ŸÉŸÑ ŸÅÿ±ŸäŸÇ ŸÑŸá ÿØŸàÿ±Ÿá ŸàŸÜŸÇÿßÿ∑Ÿá ÿßŸÑÿÆÿßÿµÿ©. ŸÖÿ´ÿßŸÑŸä ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¨ŸÖÿßÿπŸäÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ©.';
        break;
    }

    text.textContent = instructions;
    modal.style.display = 'flex';
    activity.playSound('name-start.mp3');
  }

  // ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
  function closeInstructionModal() {
    document.getElementById('instructionModal').style.display = 'none';
    prepareChallengeContinue();
  }

  // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
  function prepareChallenge() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;

    if (!cls) {
      activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ÿ£ŸàŸÑÿßŸã', false);
      return;
    }

    if (!mode) {
      activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ÿØŸä', false);
      return;
    }

    activity.playSound('start-timer.mp3');
    showInstructionModal(mode);
  }

  // ŸÖÿ™ÿßÿ®ÿπÿ© ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ÿπÿØ ÿßŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™
  function prepareChallengeContinue() {
    const cls = document.getElementById('classSelect').value;
    const mode = document.getElementById('mode').value;
    timeLeft = parseInt(document.getElementById('duration').value);
    currentList = [...(studentData[cls] || [])];

    if (mode === 'multiTeams') {
      setupMultiTeams();
      return;
    }

    if (currentList.length < 2) {
      activity.showModal('ÿÆÿ∑ÿ£', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ ÿ®Ÿá ÿ∑ŸÑÿßÿ® ŸÉÿßŸÅŸäŸäŸÜ', false);
      return;
    }

    let name1 = 'ŸÅÿ±ŸäŸÇ 1', name2 = 'ŸÅÿ±ŸäŸÇ 2';

    if (mode === 'random') {
      const remaining = currentList.filter(s => !usedStudents.includes(s));
      if (remaining.length < 2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'ÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®. ÿ≥Ÿäÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©.', false);
        usedStudents = [];
        const shuffled = [...currentList].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      } else {
        const shuffled = [...remaining].sort(() => 0.5 - Math.random());
        name1 = shuffled[0];
        name2 = shuffled[1];
      }
      usedStudents.push(name1, name2);
    } else if (mode === 'manual') {
      name1 = document.getElementById('student1Select').value;
      name2 = document.getElementById('student2Select').value;
      if (!name1 || !name2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ∑ÿßŸÑÿ®ŸäŸÜ', false);
        return;
      }
      if (name1 === name2) {
        activity.showModal('ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ŸÖÿÆÿ™ŸÑŸÅŸäŸÜ', false);
        return;
      }
    }

    setupTwoPlayerChallenge(name1, name2);
  }

  // ==== ÿ•ÿπÿØÿßÿØ ÿ™ÿ≠ÿØŸä ŸÖÿ≠ÿ≥ŸÜ ÿ®ŸäŸÜ ŸÑÿßÿπÿ®ŸäŸÜ ====
  function setupTwoPlayerChallenge(name1, name2) {
    const container = document.getElementById('teamsContainer');
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    container.innerHTML = `
      <div class="team-card" data-team="1">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name1"><i class="fas fa-star"></i> ${name1}</h3>
        <div class="team-score" id="score1">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(1, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(1, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status1">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ≠ÿØŸä</div>
      </div>
      <div class="vs-divider">
        <div class="vs-circle">
          <i class="fas fa-bolt"></i>
          <span>VS</span>
        </div>
      </div>
      <div class="team-card" data-team="2">
        <div class="team-avatar">
          <i class="fas fa-user-graduate"></i>
        </div>
        <h3 id="name2"><i class="fas fa-star"></i> ${name2}</h3>
        <div class="team-score" id="score2">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(2, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(2, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status2">ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ≠ÿØŸä</div>
      </div>
    `;

    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ±
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 100);

    teamScores = { '1': 0, '2': 0 };
    currentTurn = 1;

    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'üî• ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸä!',
      `ÿßŸÑŸÖŸàÿßÿ¨Ÿáÿ© ÿ®ŸäŸÜ ${name1} Ÿà ${name2}`,
      'challenge',
      3000
    );
    
    // ÿ™ÿ£ÿÆŸäÿ± ŸÇÿµŸäÿ± ÿ´ŸÖ ÿ®ÿØÿ° ÿßŸÑÿØŸàÿ± ÿßŸÑÿ£ŸàŸÑ
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ==== ÿ•ÿπÿØÿßÿØ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function setupMultiTeams() {
    const teamCount = parseInt(document.getElementById('teamCountSelect').value);
    const container = document.getElementById('teamsContainer');
    
    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    container.style.opacity = '0';
    container.innerHTML = '';

    teamScores = {};
    const teamColors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a29bfe'];

    for (let i = 1; i <= teamCount; i++) {
      const div = document.createElement('div');
      div.className = 'team-card multi-team';
      div.style.borderColor = teamColors[i - 1] || '#007bff';
      
      div.innerHTML = `
        <div class="team-avatar" style="background: ${teamColors[i - 1] || '#007bff'}">
          <i class="fas fa-users"></i>
        </div>
        <h3 id="name${i}"><i class="fas fa-flag"></i> ŸÅÿ±ŸäŸÇ ${i}</h3>
        <div class="team-score" id="score${i}">0</div>
        <div class="score-controls">
          <button class="score-btn plus" onclick="adjustScore(${i}, 1)" title="ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-plus"></i>
          </button>
          <button class="score-btn minus" onclick="adjustScore(${i}, -1)" title="ÿÆÿµŸÖ ŸÜŸÇÿ∑ÿ©">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="team-status" id="status${i}">ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±</div>
      `;
      
      container.appendChild(div);
      teamScores[i.toString()] = 0;
    }

    // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∏ŸáŸàÿ± ÿßŸÑŸÖÿ™ÿ≥ŸÑÿ≥ŸÑ
    setTimeout(() => {
      container.style.transition = 'all 0.5s ease';
      container.style.opacity = '1';
    }, 100);

    currentTurn = 1;
    document.getElementById('challengeArea').style.display = 'block';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    showAdvancedNotification(
      'üèÜ ŸÅÿ±ŸÇ ŸÖÿ™ÿπÿØÿØÿ© ÿ¨ÿßŸáÿ≤ÿ©!',
      `ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ${teamCount} ŸÅÿ±ŸÇ ŸÑŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÉÿ®Ÿäÿ±`,
      'success',
      3000
    );
    
    setTimeout(() => {
      nextTurn();
    }, 1500);
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ§ŸÇÿ™
  function updateTimer() {
    const secText = document.getElementById('timerTextSec');
    const circle = document.getElementById('progress');
    const wrapper = document.getElementById('timerWrapper');

    const total = parseInt(document.getElementById('duration').value);
    const percent = timeLeft / total;
    const offset = 314 * (1 - percent);

    circle.style.strokeDashoffset = offset;
    secText.innerHTML = `<i class="fas fa-clock"></i><br>${timeLeft}s`;

    if (timeLeft <= 10 && timeLeft > 0) {
      wrapper.classList.add('shake');
      activity.playSound('countdown-beep.mp3');
    } else {
      wrapper.classList.remove('shake');
    }
  }

  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  function startTimer() {
    updateTimer();
    timer = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(timer);
        activity.playSound('long-beep.mp3');
        showTimeUpPopup();
      }
    }, 1000);
  }

  // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™
  function showTimeUpPopup() {
    const popup = document.getElementById('timeUpPopup');
    popup.style.display = 'block';
    
    setTimeout(() => {
      popup.style.display = 'none';
      nextTurn();
    }, 2000);
  }

  // ==== ÿßŸÑÿØŸàÿ± ÿßŸÑÿ™ÿßŸÑŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function nextTurn() {
    activity.playSound('vs.mp3');
    clearInterval(timer);
    
    const mode = document.getElementById('mode').value;
    const turnLabel = document.getElementById('turnLabel');

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      const teamName = `ŸÅÿ±ŸäŸÇ ${currentTurn}`;
      
      turnLabel.innerHTML = `<i class="fas fa-users"></i> ÿßŸÑÿØŸàÿ± ÿπŸÑŸâ: ${teamName}`;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ±ŸÇ
      updateTeamTurnStatus(currentTurn, count);
      
      showAdvancedNotification(
        'üîÑ ÿØŸàÿ± ÿ¨ÿØŸäÿØ!',
        `ÿ≠ÿßŸÜ ÿØŸàÿ± ${teamName}`,
        'timer',
        2000
      );
      
      timeLeft = parseInt(document.getElementById('duration').value);
      startTimer();
      currentTurn = currentTurn >= count ? 1 : currentTurn + 1;
      return;
    }

    // ŸÑŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿÆÿ±Ÿâ (ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ®)
    const currentPlayerName = currentTurn === 1 ? 
      document.getElementById('name1').textContent : 
      document.getElementById('name2').textContent;
    
    const cleanName = currentPlayerName.replace('‚≠ê ', '');
    turnLabel.innerHTML = `<i class="fas fa-user-clock"></i> ÿßŸÑÿØŸàÿ± ÿπŸÑŸâ: ${cleanName}`;
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
    updatePlayerTurnStatus(currentTurn);
    
    showAdvancedNotification(
      '‚ö° ÿØŸàÿ±ŸÉ ÿßŸÑÿ¢ŸÜ!',
      `ÿ≠ÿßŸÜ ÿØŸàÿ± ${cleanName}`,
      'timer',
      2000
    );
    
    timeLeft = parseInt(document.getElementById('duration').value);
    startTimer();
    currentTurn = currentTurn === 1 ? 2 : 1;
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÅÿ±ŸÇ
  function updateTeamTurnStatus(activeTurn, totalTeams) {
    for (let i = 1; i <= totalTeams; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'üéØ ÿØŸàÿ±Ÿá ÿßŸÑÿ¢ŸÜ!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
  function updatePlayerTurnStatus(activeTurn) {
    for (let i = 1; i <= 2; i++) {
      const statusElement = document.getElementById(`status${i}`);
      const teamCard = document.querySelector(`[data-team="${i}"]`);
      
      if (statusElement) {
        if (i === activeTurn) {
          statusElement.textContent = 'üéØ ÿØŸàÿ±Ÿá ÿßŸÑÿ¢ŸÜ!';
          statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
          statusElement.style.color = '#856404';
          if (teamCard) {
            teamCard.style.transform = 'scale(1.02)';
            teamCard.style.borderColor = '#ffc107';
            teamCard.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.4)';
          }
        } else {
          statusElement.textContent = 'ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...';
          statusElement.style.background = '#f8f9fa';
          statusElement.style.color = 'var(--text-secondary)';
          if (teamCard) {
            teamCard.style.transform = 'scale(1)';
            teamCard.style.borderColor = 'var(--primary-color)';
            teamCard.style.boxShadow = 'var(--shadow-medium)';
          }
        }
      }
    }
  }

  // ==== ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function adjustScore(team, val) {
    activity.playSound('Click.mp3');
    
    const scoreElement = document.getElementById(`score${team}`);
    const statusElement = document.getElementById(`status${team}`);
    const teamCard = document.querySelector(`[data-team="${team}"]`);
    
    let score = parseInt(scoreElement.textContent) + val;
    score = Math.max(0, score); // ŸÖŸÜÿπ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ≥ÿßŸÑÿ®ÿ©
    
    const oldScore = parseInt(scoreElement.textContent);
    scoreElement.textContent = score;
    teamScores[team.toString()] = score;

    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÖÿ≠ÿ≥ŸÜÿ©
    if (val > 0) {
      scoreElement.style.color = '#28a745';
      scoreElement.style.transform = 'scale(1.3)';
      if (statusElement) statusElement.textContent = '+' + val + ' ŸÜŸÇÿ∑ÿ©!';
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¨ÿ≥ŸäŸÖÿßÿ™ ŸÑŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©
      createScoreParticles(scoreElement, '+' + val, '#28a745');
      
    } else if (val < 0) {
      scoreElement.style.color = '#dc3545';
      scoreElement.style.transform = 'scale(0.8)';
      if (statusElement) statusElement.textContent = val + ' ŸÜŸÇÿ∑ÿ©';
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÑŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ≥ÿßŸÑÿ®ÿ©
      if (teamCard) {
        teamCard.classList.add('shake');
        setTimeout(() => teamCard.classList.remove('shake'), 500);
      }
    }

    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™
    setTimeout(() => {
      scoreElement.style.color = 'var(--accent-color)';
      scoreElement.style.transform = 'scale(1)';
      if (statusElement) {
        statusElement.textContent = score > 5 ? 'ÿ£ÿØÿßÿ° ŸÖŸÖÿ™ÿßÿ≤!' : 
                                  score > 2 ? 'Ÿäÿ™ŸÇÿØŸÖ ÿ®ÿ´ÿ®ÿßÿ™' : 
                                  score > 0 ? 'ÿ®ÿØÿßŸäÿ© ÿ¨ŸäÿØÿ©' : 'ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿßŸäÿ©';
      }
    }, 1000);

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ŸÅŸä ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ©
    updateTeamRanking();
  }

  // ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¨ÿ≥ŸäŸÖÿßÿ™ ŸÑŸÑŸÜŸÇÿßÿ∑
  function createScoreParticles(element, text, color) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      color: ${color};
      font-weight: bold;
      font-size: 1.2rem;
      pointer-events: none;
      z-index: 1000;
      animation: scoreFloat 1s ease-out forwards;
    `;
    particle.textContent = text;
    
    const rect = element.getBoundingClientRect();
    particle.style.left = rect.left + 'px';
    particle.style.top = rect.top + 'px';
    
    document.body.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 1000);
  }

  // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÅÿ±ŸÇ
  function updateTeamRanking() {
    const teams = Object.keys(teamScores).map(team => ({
      id: team,
      score: teamScores[team],
      element: document.getElementById(`score${team}`)
    })).sort((a, b) => b.score - a.score);

    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ±ÿßŸÉÿ≤
    teams.forEach((team, index) => {
      const statusElement = document.getElementById(`status${team.id}`);
      if (statusElement && teams.length > 2) {
        const position = index + 1;
        const positionText = position === 1 ? 'ü•á ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸàŸÑ' :
                           position === 2 ? 'ü•à ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÜŸä' :
                           position === 3 ? 'ü•â ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´' :
                           `üìç ÿßŸÑŸÖÿ±ŸÉÿ≤ ${position}`;
        statusElement.textContent = positionText;
      }
    });
  }

  // ==== ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ====
  function showStatsButton() {
    const winnerDisplay = document.getElementById('winnerDisplay');
    if (winnerDisplay && winnerDisplay.style.display === 'block') {
      const statsBtn = document.createElement('button');
      statsBtn.className = 'btn btn-info';
      statsBtn.style.marginTop = '1rem';
      statsBtn.innerHTML = '<i class="fas fa-chart-pie"></i> ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™';
      statsBtn.onclick = showDetailedStats;
      winnerDisplay.appendChild(statsBtn);
    }
  }

  function showDetailedStats() {
    const modal = document.createElement('div');
    modal.className = 'instruction-modal';
    modal.style.display = 'flex';
    
    const totalGames = challengeStats.totalChallenges;
    const winData = Object.entries(challengeStats.teamWins)
      .map(([name, wins]) => ({ name, wins, percentage: Math.round((wins / totalGames) * 100) }))
      .sort((a, b) => b.wins - a.wins);
    
    modal.innerHTML = `
      <div class="modal-content" style="max-width: 600px;">
        <h2><i class="fas fa-chart-pie"></i> ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™</h2>
        <div class="stats-container">
          <div class="stat-row">
            <span>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™:</span>
            <span class="stat-value">${totalGames}</span>
          </div>
          <div class="stat-row">
            <span>ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©:</span>
            <span class="stat-value">${challengeStats.completedChallenges}</span>
          </div>
          ${winData.length > 0 ? `
            <h3><i class="fas fa-trophy"></i> ÿ≥ÿ¨ŸÑ ÿßŸÑÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™</h3>
            ${winData.map((player, index) => `
              <div class="winner-stat ${index === 0 ? 'top-winner' : ''}">
                ${index === 0 ? 'üèÜ' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üìä'} 
                ${player.name}: ${player.wins} ÿßŸÜÿ™ÿµÿßÿ± (${player.percentage}%)
              </div>
            `).join('')}
          ` : '<p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÜÿ™ÿµÿßÿ±ÿßÿ™ ÿ®ÿπÿØ</p>'}
        </div>
        <button onclick="this.closest('.instruction-modal').remove()" class="btn btn-primary">
          <i class="fas fa-check"></i> ÿ•ÿ∫ŸÑÿßŸÇ
        </button>
      </div>
    `;
    
    document.body.appendChild(modal);
    activity.playSound('reveal.mp3');
  }

  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
  function loadSavedStats() {
    try {
      const saved = localStorage.getItem('challengeStats');
      if (saved) {
        challengeStats = { ...challengeStats, ...JSON.parse(saved) };
      }
    } catch (error) {
      console.log('‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™:', error);
    }
  }

  // ==== ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function endChallenge() {
    clearInterval(timer);
    activity.playSound('end-timer.mp3');
    
    const mode = document.getElementById('mode').value;
    const winnerDisplay = document.getElementById('winnerDisplay');
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
    challengeStats.totalChallenges++;
    challengeStats.completedChallenges++;

    if (mode === 'multiTeams') {
      const count = parseInt(document.getElementById('teamCountSelect').value);
      let maxScore = -1;
      let winners = [];
      let results = [];

      for (let i = 1; i <= count; i++) {
        const score = parseInt(document.getElementById(`score${i}`).textContent);
        results.push({ team: `ŸÅÿ±ŸäŸÇ ${i}`, score: score });
        
        if (score > maxScore) {
          maxScore = score;
          winners = [`ŸÅÿ±ŸäŸÇ ${i}`];
        } else if (score === maxScore) {
          winners.push(`ŸÅÿ±ŸäŸÇ ${i}`);
        }
      }

      // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
      results.sort((a, b) => b.score - a.score);
      
      const isWin = winners.length === 1;
      const result = isWin ? 
        `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${winners[0]} ÿ®ŸÄ ${maxScore} ŸÜŸÇÿ∑ÿ©` : 
        `<i class="fas fa-handshake"></i> ÿ™ÿπÿßÿØŸÑ ÿ®ŸäŸÜ: ${winners.join(' Ÿà ')} ÿ®ŸÄ ${maxScore} ŸÜŸÇÿ∑ÿ©`;
      
      winnerDisplay.innerHTML = `
        ${result}
        <div class="final-results">
          <h4><i class="fas fa-chart-bar"></i> ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©:</h4>
          ${results.map((r, index) => 
            `<div class="result-item ${index === 0 ? 'winner' : ''}">
              ${index + 1}. ${r.team}: ${r.score} ŸÜŸÇÿ∑ÿ©
            </div>`
          ).join('')}
        </div>
      `;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
      if (isWin) {
        challengeStats.teamWins[winners[0]] = (challengeStats.teamWins[winners[0]] || 0) + 1;
      }
      
      showAdvancedNotification(
        isWin ? 'üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!' : 'ü§ù ÿ™ÿπÿßÿØŸÑ ŸÖÿ´Ÿäÿ±!',
        isWin ? `${winners[0]} Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸàŸÑ` : `ÿ™ÿπÿßÿØŸÑ ÿ±ÿßÿ¶ÿπ ÿ®ŸäŸÜ ${winners.length} ŸÅÿ±ŸÇ`,
        isWin ? 'trophy' : 'success',
        5000
      );
      
      playWinSoundSequence();
      
    } else {
      // ŸÑŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿÆÿ±Ÿâ (ÿ∑ÿßŸÑÿ® ÿ∂ÿØ ÿ∑ÿßŸÑÿ®)
      const name1 = document.getElementById('name1').textContent.replace('‚≠ê ', '');
      const name2 = document.getElementById('name2').textContent.replace('‚≠ê ', '');
      const score1 = parseInt(document.getElementById('score1').textContent);
      const score2 = parseInt(document.getElementById('score2').textContent);

      let result;
      let winnerName = '';
      
      if (score1 > score2) {
        result = `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${name1} ÿ®ŸÄ ${score1} ŸÜŸÇÿ∑ÿ©`;
        winnerName = name1;
        showAdvancedNotification('üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!', `${name1} ŸäŸÅŸàÿ≤ ÿ®ÿßŸÑÿ™ÿ≠ÿØŸä!`, 'trophy', 5000);
        playWinSoundSequence();
      } else if (score2 > score1) {
        result = `<i class="fas fa-trophy"></i> ÿßŸÑŸÅÿßÿ¶ÿ≤: ${name2} ÿ®ŸÄ ${score2} ŸÜŸÇÿ∑ÿ©`;
        winnerName = name2;
        showAdvancedNotification('üèÜ ŸÑÿØŸäŸÜÿß ŸÅÿßÿ¶ÿ≤!', `${name2} ŸäŸÅŸàÿ≤ ÿ®ÿßŸÑÿ™ÿ≠ÿØŸä!`, 'trophy', 5000);
        playWinSoundSequence();
      } else {
        result = `<i class="fas fa-handshake"></i> ÿ™ÿπÿßÿØŸÑ! ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ${score1} - ${score2}`;
        showAdvancedNotification('ü§ù ÿ™ÿπÿßÿØŸÑ ŸÖÿ´Ÿäÿ±!', 'ŸÖÿ®ÿßÿ±ÿßÿ© ŸÖÿ™Ÿàÿßÿ≤ŸÜÿ© ÿ™ŸÖÿßŸÖÿßŸã!', 'success', 5000);
        activity.playSound('draw.mp3');
      }

      winnerDisplay.innerHTML = `
        ${result}
        <div class="match-summary">
          <div class="score-breakdown">
            <div class="player-result ${score1 > score2 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name1}: ${score1} ŸÜŸÇÿ∑ÿ©
            </div>
            <div class="player-result ${score2 > score1 ? 'winner' : score1 === score2 ? 'tie' : 'loser'}">
              ${name2}: ${score2} ŸÜŸÇÿ∑ÿ©
            </div>
          </div>
        </div>
      `;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÅŸàÿ≤
      if (winnerName) {
        challengeStats.teamWins[winnerName] = (challengeStats.teamWins[winnerName] || 0) + 1;
      }
    }

    winnerDisplay.style.display = 'block';
    
    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
    localStorage.setItem('challengeStats', JSON.stringify(challengeStats));
    
    // ÿπÿ±ÿ∂ ÿ≤ÿ± ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ•ÿ∂ÿßŸÅŸä
    setTimeout(() => {
      showStatsButton();
    }, 2000);
  }

  // ÿπÿ±ÿ∂ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
  function showCelebration(isWin) {
    if (isWin) {
      activity.playSound('win.mp3');
      setTimeout(() => activity.playSound('clap.mp3'), 1000);
    } else {
      activity.playSound('draw.mp3');
    }

    const fireworks = document.getElementById('fireworks');
    fireworks.style.display = 'block';
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≥ÿßŸÇÿ∑ÿ©
    createFallingStars();
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàŸÜŸÅŸäÿ™Ÿä
    if (window.confetti) {
      confetti({ 
        particleCount: 200, 
        spread: 120, 
        origin: { y: 0.6 },
        colors: ['#DC143C', '#228B22', '#FFD700']
      });
    }

    setTimeout(() => {
      fireworks.style.display = 'none';
    }, 4000);
  }

  // ==== ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿ≠ÿ≥ŸÜ ====
  function resetChallenge() {
    activity.playSound('Click.mp3');
    
    // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™
    clearInterval(timer);
    
    // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ
    document.getElementById('challengeArea').style.display = 'none';
    document.getElementById('winnerDisplay').style.display = 'none';
    
    // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿ®ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜÿ™ŸÇÿßŸÑŸä
    const container = document.getElementById('teamsContainer');
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
      container.innerHTML = '';
      container.style.opacity = '1';
      container.style.transform = 'translateY(0)';
    }, 300);
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™
    currentTurn = 1;
    teamScores = {};
    timeLeft = 0;
    usedStudents = [];
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
    document.getElementById('classSelect').selectedIndex = 0;
    document.getElementById('mode').selectedIndex = 0;
    document.getElementById('duration').selectedIndex = 1; // 1 ÿØŸÇŸäŸÇÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã
    
    // ÿ•ÿÆŸÅÿßÿ° ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
    document.getElementById('manualSelection').style.display = 'none';
    document.getElementById('multiTeamOptions').style.display = 'none';
    
    showAdvancedNotification(
      'üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿπŸäŸäŸÜ',
      'ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿ¨ÿßŸáÿ≤ ŸÑÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ!',
      'info',
      3000
    );
    
    console.log('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ÿ≠ÿØŸä ÿ®ŸÜÿ¨ÿßÿ≠');
  }

  // ==== ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ====
  window.onload = async () => {
    console.log('üî• ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ...');
    
    // ÿπÿ±ÿ∂ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    showLoadingIndicator('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ŸáŸäÿ¶ÿ©...');
    
    try {
      // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä
      updateLoadingProgress('ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ...');
      activity.init();
      
      // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
      updateLoadingProgress('ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™...');
      loadSavedStats();
      
      // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®
      await loadStudents();
      
      // ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ¨ÿßŸáÿ≤Ÿäÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
      setTimeout(() => {
        showAdvancedNotification(
          'üî• ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿπŸÖŸÑ!',
          'ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ŸàÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©',
          'challenge',
          5000
        );
      }, 2000);
      
      console.log('üéâ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!');
      
    } catch (error) {
      console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿßÿ∑:', error);
      updateLoadingProgress('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ');
      
      setTimeout(() => {
        hideLoadingIndicator();
        showAdvancedNotification(
          '‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ',
          'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ŸáŸäÿ¶ÿ©ÿå ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ',
          'error',
          5000
        );
      }, 1000);
    }
  };

  // ==== ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ ====
  function showTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'flex';
    activity.playSound('reveal.mp3');
    setupTeacherTabs();
  }

  function closeTeacherGuide() {
    const modal = document.getElementById('teacherGuideModal');
    modal.style.display = 'none';
    activity.playSound('Click.mp3');
  }

  function setupTeacherTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetTab = button.getAttribute('data-tab');
        
        // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±
        button.classList.add('active');
        const targetContent = document.getElementById(`${targetTab}-content`);
        if (targetContent) {
          targetContent.classList.add('active');
        }
        
        // ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä
        activity.playSound('Click.mp3');
      });
    });
  }
</script>
</body>
</html>
