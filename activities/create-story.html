<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙƒÙˆÙ‘Ù† Ù‚ØµØ© - Ù†Ø´Ø§Ø· Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØµ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>
  
  <!-- Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  
  <!-- Ø§Ù„Ø£Ù†Ù…Ø§Ø· ÙˆØ§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…ÙˆØ­Ø¯ -->
  <link rel="stylesheet" href="../assets/css/responsive.css">
  <link rel="stylesheet" href="../assets/css/style.css">
  <script src="../assets/css/style.css" type="text/javascript"></script>
  
  <style>
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ù†Ø´Ø§Ø· Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØ© */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      font-family: 'Cairo', sans-serif;
    }

    .main-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .page-header {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-icon {
      font-size: 3rem;
      color: #667eea;
      animation: bounceIn 1s ease-out;
    }

    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); opacity: 1; }
    }

    .header-text h1 {
      margin: 0;
      color: #2d3748;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .header-text p {
      margin: 5px 0 0 0;
      color: #718096;
      font-size: 1.1rem;
    }

    .game-settings-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      animation: slideInRight 0.8s ease-out;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .settings-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 25px;
      color: #2d3748;
    }

    .settings-header i {
      font-size: 1.5rem;
      color: #667eea;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      color: #2d3748;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-family: 'Cairo', sans-serif;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      color: #8b4513;
      box-shadow: 0 4px 15px rgba(252, 182, 159, 0.4);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(252, 182, 159, 0.6);
    }

    .btn-success {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      color: #2d5016;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(132, 250, 176, 0.6);
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø© */
    .generated-story-area {
      animation: fadeInScale 0.8s ease-out;
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .story-display-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .story-header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }

    .story-header h3 {
      color: #2d3748;
      font-size: 1.8rem;
      margin: 0 0 10px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .story-author {
      color: #667eea;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .story-content {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 15%, #ffecd2 100%);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      line-height: 1.8;
      font-size: 1.2rem;
      color: #2d3748;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
      animation: typewriter 2s ease-out;
    }

    @keyframes typewriter {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .story-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
    @media (max-width: 768px) {
      .main-container {
        padding: 15px;
      }

      .header-content {
        flex-direction: column;
        text-align: center;
      }

      .header-text h1 {
        font-size: 2rem;
      }

      .story-actions {
        grid-template-columns: 1fr;
      }
    }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ø­ØªÙØ§Ù„ÙŠØ© */
    .celebration-effect {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem;
      color: #ffd700;
      z-index: 1000;
      animation: celebrationPulse 2s ease-out;
    }

    @keyframes celebrationPulse {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ */
    .students-selection-area {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      animation: slideInLeft 0.8s ease-out;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .student-selection-card {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border-radius: 15px;
      padding: 20px;
      margin: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
    }

    .student-selection-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(240, 147, 251, 0.6);
    }

    .student-selection-card.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transform: scale(1.05);
    }

    .student-avatar {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .student-name {
      font-size: 1.2rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ÙˆØ­Ø¯Ø© -->
  <div class="control-buttons-container mobile-grid-4">
    <button class="control-btn touch-target" id="backBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
      <i class="fas fa-home"></i>
    </button>
    <button class="control-btn touch-target" id="muteBtn" title="ÙƒØªÙ… Ø§Ù„ØµÙˆØª">
      <i class="fas fa-volume-up"></i>
    </button>
    <button class="control-btn touch-target" id="instructionsBtn" title="ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·">
      <i class="fas fa-question-circle"></i>
    </button>
    <button class="control-btn touch-target" id="fullscreenBtn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
      <i class="fas fa-expand"></i>
    </button>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· -->
  <div class="instructions-overlay responsive-modal" id="instructionsModal">
    <div class="instructions-content mobile-full-height">
      <button class="close-btn touch-target" onclick="closeInstructions()" title="Ø¥ØºÙ„Ø§Ù‚">
        <i class="fas fa-times"></i>
      </button>
      <div class="instructions-title">
        <i class="fas fa-book-open"></i> ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù†Ø´Ø§Ø· ÙƒÙˆÙ‘Ù† Ù‚ØµØ©
      </div>
      <ul class="instructions-list">
        <li>Ø§Ø®ØªØ± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©.</li>
        <li>Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·: ÙØ±Ø¯ÙŠ Ø£Ùˆ Ø¬Ù…Ø§Ø¹ÙŠØŒ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø£Ùˆ Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠ.</li>
        <li>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©: Ù…ØºØ§Ù…Ø±Ø©ØŒ Ø®ÙŠØ§Ù„ØŒ ÙØ¶Ø§Ø¡ØŒ Ø£Ùˆ Ø­ÙŠØ§Ø© Ù…Ø¯Ø±Ø³ÙŠØ©.</li>
        <li>ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ±Ø¯ÙŠØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ ÙÙƒØ±Ø© Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù‚ØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ).</li>
        <li>Ø§Ø¶ØºØ· "Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©" Ù„Ø¥Ù†ØªØ§Ø¬ Ù‚ØµØ© ÙÙˆØ±ÙŠØ© Ù…Ø¹ Ø·Ø§Ù„Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ.</li>
        <li>Ø£Ùˆ Ø§Ø®ØªØ± "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø§Ø·" Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø¤Ù‚Øª.</li>
        <li>ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØŒ Ø§Ø®ØªØ± Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª.</li>
        <li>Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "Ø§Ù„ØªØ§Ù„ÙŠ" Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ.</li>
        <li>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù‚ØµØµ Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø© Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØµ Ø¬Ø¯ÙŠØ¯Ø©.</li>
      </ul>
      <button class="btn btn-primary touch-target mobile-full-width" onclick="closeInstructions()">
        <i class="fas fa-check"></i> ÙÙ‡Ù…Øª
      </button>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
  <div class="victory-modal responsive-modal" id="thankYouModal">
    <div class="victory-content mobile-full-height">
      <button class="close-btn touch-target" id="closeModalBtn" title="Ø¥ØºÙ„Ø§Ù‚">
        <i class="fas fa-times"></i>
      </button>
      <div class="victory-fireworks">
        <i class="fas fa-star"></i> <i class="fas fa-star"></i> <i class="fas fa-star"></i>
      </div>
      <div class="victory-trophy">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="victory-team">Ø´ÙƒØ±Ø§Ù‹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒÙ… Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©!</div>
      <div class="victory-names">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù‚ØµØ©:</div>
      <div class="honor-board-section">
        <ul class="honor-list" id="participantList"></ul>
      </div>
      <button class="btn btn-primary touch-target mobile-full-width" id="modalBackBtn">
        <i class="fas fa-redo"></i> Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯
      </button>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div class="main-container mobile-full-width">
    <div class="page-header mobile-text-center">
      <div class="header-content">
        <div class="header-icon">
          <i class="fas fa-book-open"></i>
        </div>
        <div class="header-text">
          <h1>Ù†Ø´Ø§Ø· ÙƒÙˆÙ‘Ù† Ù‚ØµØ©</h1>
          <p>Ø§Ø®ØªØ± Ø§Ù„ØµÙ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ</p>
        </div>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="game-settings-card mobile-full-width" id="settingsCard">
      <div class="settings-header">
        <i class="fas fa-cog"></i>
        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·</h3>
      </div>
      <form class="story-settings-form" id="storySettingsForm">
        <div class="form-group mobile-full-width">
          <label for="classSelect">
            <i class="fas fa-graduation-cap"></i> Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
          </label>
          <select id="classSelect" class="form-input mobile-full-width" required>
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>
          </select>
        </div>
        
        <div class="form-group mobile-full-width">
          <label for="modeSelect">
            <i class="fas fa-users"></i> Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©
          </label>
          <select id="modeSelect" class="form-input mobile-full-width" required>
            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© --</option>
            <option value="single">ÙØ±Ø¯ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</option>
            <option value="group">Ø¬Ù…Ø§Ø¹ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</option>
            <option value="select-single">ÙØ±Ø¯ÙŠØ© Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØ©</option>
            <option value="select-group">Ø¬Ù…Ø§Ø¹ÙŠØ© Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØ©</option>
          </select>
        </div>

        <div class="form-group mobile-full-width">
          <label for="storyTypeSelect">
            <i class="fas fa-magic"></i> Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©
          </label>
          <select id="storyTypeSelect" class="form-input mobile-full-width" required>
            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© --</option>
            <option value="adventure">Ù…ØºØ§Ù…Ø±Ø© Ø´ÙŠÙ‚Ø©</option>
            <option value="fantasy">Ø®ÙŠØ§Ù„ ÙˆØ³Ø­Ø±</option>
            <option value="space">Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ÙØ¶Ø§Ø¡</option>
            <option value="school">Ø­ÙŠØ§Ø© Ù…Ø¯Ø±Ø³ÙŠØ©</option>
            <option value="mystery">Ù„ØºØ² ÙˆÙ…ØºØ§Ù…Ø±Ø©</option>
            <option value="friendship">ØµØ¯Ø§Ù‚Ø© ÙˆØªØ¹Ø§ÙˆÙ†</option>
          </select>
        </div>

        <div class="form-group mobile-full-width" id="storyIdeaGroup" style="display: none;">
          <label for="storyIdea">
            <i class="fas fa-lightbulb"></i> ÙÙƒØ±Ø© Ø§Ù„Ù‚ØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          </label>
          <textarea id="storyIdea" class="form-input mobile-full-width" rows="3" 
                    placeholder="Ø§ÙƒØªØ¨ ÙÙƒØ±Ø© Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ù‚ØµØ©... (Ù…Ø«Ù„: Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„ØºØ§Ø¨Ø©ØŒ Ø§ÙƒØªØ´Ø§Ù ÙƒÙ†Ø² Ù…ÙÙ‚ÙˆØ¯ØŒ Ù…Ø³Ø§Ø¹Ø¯Ø© ØµØ¯ÙŠÙ‚...)"></textarea>
        </div>
        
        <div class="button-group">
          <button type="submit" class="btn btn-primary touch-target mobile-full-width" id="startBtn">
            <i class="fas fa-play"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø§Ø·
          </button>
          <button type="button" class="btn btn-secondary touch-target mobile-full-width" id="generateStoryBtn" style="display: none;">
            <i class="fas fa-magic"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
          </button>
        </div>
      </form>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ -->
    <div class="students-selection-area mobile-full-width" id="studentSelection"></div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Ø´Ø§Ø· -->
    <div class="story-activity-area mobile-full-width" id="storyContainer">
      <div class="current-student-card mobile-text-center">
        <div class="student-name-display" id="studentName"></div>
        <div class="timer-container mobile-text-center">
          <canvas id="timerCanvas" width="150" height="150"></canvas>
          <div class="timer-label">Ù…Ø¤Ù‚Øª Ø§Ù„Ø³Ø±Ø¯</div>
        </div>
        <div class="story-controls mobile-grid-2">
          <button class="btn btn-success touch-target mobile-full-width" id="nextBtn" style="display:none">
            <i class="fas fa-arrow-left"></i> Ø§Ù„ØªØ§Ù„ÙŠ
          </button>
          <button class="btn btn-danger touch-target mobile-full-width" id="finishBtn">
            <i class="fas fa-stop"></i> Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù‚ØµØ©
          </button>
        </div>
        <div class="celebration-message" id="celebration">
          <i class="fas fa-star"></i> Ø£Ø­Ø³Ù†Øª! <i class="fas fa-star"></i>
        </div>
      </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø© -->
    <div class="generated-story-area mobile-full-width" id="generatedStoryContainer" style="display: none;">
      <div class="story-display-card">
        <div class="story-header">
          <h3><i class="fas fa-book-open"></i> Ù‚ØµØªÙƒ Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©</h3>
          <div class="story-author" id="storyAuthor"></div>
        </div>
        <div class="story-content" id="storyContent"></div>
        <div class="story-actions">
          <button class="btn btn-primary touch-target mobile-full-width" id="regenerateStoryBtn">
            <i class="fas fa-sync-alt"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø©
          </button>
          <button class="btn btn-success touch-target mobile-full-width" id="shareStoryBtn">
            <i class="fas fa-share"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù‚ØµØ©
          </button>
          <button class="btn btn-secondary touch-target mobile-full-width" id="backToSettingsBtn">
            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
          </button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ù…Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
    const OmaniColors = {
      red: '#DC143C',
      green: '#228B22', 
      gold: '#FFD700',
      white: '#F8F9FA',
      black: '#1A1A1A'
    };

    let ActivityManager;
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø·
    document.addEventListener('DOMContentLoaded', function() {
      ActivityManager = new ActivityUtils({
        activityName: 'create-story',
        primaryColor: OmaniColors.red,
        secondaryColor: OmaniColors.green,
        sounds: {
          click: '../assets/media/sounds/Click.mp3',
          success: '../assets/media/sounds/name-start.mp3',
          celebration: '../assets/media/sounds/clap.mp3',
          win: '../assets/media/sounds/win.mp3'
        }
      });

      initializeStoryActivity();
    });

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù†Ø´Ø§Ø·
    let students = [];
    let currentStudentList = [];
    let usedStudents = [];
    let selectedManualStudents = [];
    let timerInterval;
    let secondsPassed = 0;
    let currentMode = '';
    let currentStoryType = '';
    let generatedStories = [];

    // Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù‚ØµØµ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    const storyTemplates = {
      adventure: {
        beginnings: [
          "ÙÙŠ ÙŠÙˆÙ… Ù…Ø´Ø±Ù‚ØŒ Ù‚Ø±Ø± {name} Ø§Ù„Ø°Ù‡Ø§Ø¨ ÙÙŠ Ù…ØºØ§Ù…Ø±Ø© Ø§Ø³ØªÙƒØ´Ø§ÙÙŠØ© Ø¥Ù„Ù‰",
          "Ø¨ÙŠÙ†Ù…Ø§ ÙƒØ§Ù† {name} ÙŠØªØ¬ÙˆÙ„ ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©ØŒ Ø§ÙƒØªØ´Ù Ø·Ø±ÙŠÙ‚Ø§Ù‹ ØºØ§Ù…Ø¶Ø§Ù‹ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰",
          "Ø§Ø³ØªÙŠÙ‚Ø¸ {name} Ø¹Ù„Ù‰ ØµÙˆØª ØºØ±ÙŠØ¨ØŒ ÙˆØ¹Ù†Ø¯Ù…Ø§ Ù†Ø¸Ø± Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø±Ø£Ù‰",
          "ÙˆØ¬Ø¯ {name} Ø®Ø±ÙŠØ·Ø© Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø¹Ù„ÙŠØ© ØªØ´ÙŠØ± Ø¥Ù„Ù‰ ÙƒÙ†Ø² Ù…Ø¯ÙÙˆÙ† ÙÙŠ"
        ],
        middles: [
          "ØºØ§Ø¨Ø© Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø© ÙˆØ§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØºØ±ÙŠØ¨Ø©",
          "ÙƒÙ‡Ù Ù…Ø¶ÙŠØ¡ Ø¨Ø£Ø­Ø¬Ø§Ø± ÙƒØ±ÙŠÙ…Ø© Ù…Ù„ÙˆÙ†Ø©",
          "Ø¬Ø²ÙŠØ±Ø© ØµØºÙŠØ±Ø© ÙˆØ³Ø· Ø¨Ø­ÙŠØ±Ø© Ø²Ø±Ù‚Ø§Ø¡ ØµØ§ÙÙŠØ©",
          "Ù‚Ù„Ø¹Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù…Ø­Ø§Ø·Ø© Ø¨Ø­Ø¯ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„ÙˆØ±ÙˆØ¯ Ø§Ù„Ù…Ù„ÙˆÙ†Ø©",
          "ÙˆØ§Ø¯ÙŠ Ø³Ø­Ø±ÙŠ ØªØ·ÙŠØ± ÙÙŠÙ‡ Ø§Ù„ÙØ±Ø§Ø´Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©"
        ],
        ends: [
          "ÙˆØ¨Ø¹Ø¯ Ù…ØºØ§Ù…Ø±Ø© Ù…Ø«ÙŠØ±Ø©ØŒ Ø¹Ø§Ø¯ {name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø­Ù…Ù„Ø§Ù‹ Ø¨Ø°ÙƒØ±ÙŠØ§Øª Ø¬Ù…ÙŠÙ„Ø© ÙˆØ£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯.",
          "Ø§ÙƒØªØ´Ù {name} Ø£Ù† Ø£Ø¹Ø¸Ù… ÙƒÙ†Ø² Ù‡Ùˆ Ø§Ù„ØµØ¯Ø§Ù‚Ø§Øª Ø§Ù„ØªÙŠ ÙƒÙˆÙ‘Ù†Ù‡Ø§ ÙÙŠ Ø±Ø­Ù„ØªÙ‡.",
          "ØªØ¹Ù„Ù… {name} Ø£Ù† Ø§Ù„Ø´Ø¬Ø§Ø¹Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ ÙŠÙ…ÙƒÙ†Ù‡Ù…Ø§ Ø­Ù„ Ø£ÙŠ Ù…Ø´ÙƒÙ„Ø©.",
          "Ø¹Ø§Ø¯ {name} ÙˆÙ‡Ùˆ ÙŠØ­Ù…Ù„ ÙÙŠ Ù‚Ù„Ø¨Ù‡ Ø­Ø¨ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ÙˆØ§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù."
        ]
      },
      fantasy: {
        beginnings: [
          "ÙÙŠ Ø¹Ø§Ù„Ù… Ø³Ø­Ø±ÙŠ Ø¨Ø¹ÙŠØ¯ØŒ ÙƒØ§Ù† {name} Ø³Ø§Ø­Ø±Ø§Ù‹ ØµØºÙŠØ±Ø§Ù‹ ÙŠØªØ¹Ù„Ù…",
          "Ø§ÙƒØªØ´Ù {name} Ø£Ù†Ù‡ ÙŠÙ…Ù„Ùƒ Ù‚ÙˆØ© Ø³Ø­Ø±ÙŠØ© Ø®Ø§ØµØ© ØªÙ…ÙƒÙ†Ù‡ Ù…Ù†",
          "ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¬Ù†ÙŠØ§ØªØŒ Ø§Ù„ØªÙ‚Ù‰ {name} Ø¨Ø¬Ù†ÙŠØ© ØµØºÙŠØ±Ø© Ø·Ù„Ø¨Øª Ù…Ù†Ù‡",
          "Ø¨ÙŠÙ†Ù…Ø§ ÙƒØ§Ù† {name} ÙŠÙ‚Ø±Ø£ ÙƒØªØ§Ø¨Ø§Ù‹ Ø³Ø­Ø±ÙŠØ§Ù‹ØŒ Ø§Ù†ÙØªØ­ Ø¨Ø§Ø¨ Ø³Ø±ÙŠ Ø¥Ù„Ù‰"
        ],
        middles: [
          "ÙÙ†ÙˆÙ† Ø§Ù„Ø³Ø­Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†",
          "Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª ÙˆÙÙ‡Ù… Ù„ØºØªÙ‡Ù…",
          "Ø£Ù† ÙŠØ³Ø§Ø¹Ø¯Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø¬Ù…Ø© Ù…ÙÙ‚ÙˆØ¯Ø©",
          "Ø¹Ø§Ù„Ù… Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ù…Ø®Ù„ÙˆÙ‚Ø§Øª Ø§Ù„Ø³Ø­Ø±ÙŠØ© Ø§Ù„ÙˆØ¯ÙˆØ¯Ø©",
          "ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø¥Ù„Ù‰ Ø£Ø´ÙŠØ§Ø¡ Ù…ÙÙŠØ¯Ø© ÙˆØ¬Ù…ÙŠÙ„Ø©"
        ],
        ends: [
          "ÙˆÙ‡ÙƒØ°Ø§ Ø£ØµØ¨Ø­ {name} Ø³Ø§Ø­Ø±Ø§Ù‹ Ù…Ø­Ø¨ÙˆØ¨Ø§Ù‹ ÙŠØ³Ø§Ø¹Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø¨Ø³Ø­Ø±Ù‡ Ø§Ù„Ø·ÙŠØ¨.",
          "ØªØ¹Ù„Ù… {name} Ø£Ù† Ø§Ù„Ø³Ø­Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙƒÙ…Ù† ÙÙŠ Ø§Ù„Ø¹Ø·Ø§Ø¡ ÙˆÙ…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.",
          "Ø´ÙƒØ±ØªÙ‡ Ø§Ù„Ø¬Ù†ÙŠØ© ÙˆØ£Ù‡Ø¯ØªÙ‡ Ù‚Ù„Ø§Ø¯Ø© Ø³Ø­Ø±ÙŠØ© ØªØ­Ù…ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø£Ø°Ù‰.",
          "Ø¹Ø§Ø¯ {name} Ø¥Ù„Ù‰ Ø¹Ø§Ù„Ù…Ù‡ ÙˆÙ‡Ùˆ ÙŠØ­Ù…Ù„ Ø³Ø± Ø§Ù„Ø³Ø­Ø± ÙÙŠ Ù‚Ù„Ø¨Ù‡."
        ]
      },
      space: {
        beginnings: [
          "ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¨Ø¹ÙŠØ¯ØŒ ÙƒØ§Ù† {name} Ø±Ø§Ø¦Ø¯ ÙØ¶Ø§Ø¡ Ø´Ø¬Ø§Ø¹Ø§Ù‹ ÙŠØ³ØªÙƒØ´Ù",
          "Ø¨ÙŠÙ†Ù…Ø§ ÙƒØ§Ù† {name} ÙŠÙ†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¬ÙˆÙ…ØŒ Ø±Ø£Ù‰ Ø³ÙÙŠÙ†Ø© ÙØ¶Ø§Ø¡ ØªÙ‡Ø¨Ø· ÙÙŠ",
          "Ø§Ø®ØªØ±Ø¹ {name} ØµØ§Ø±ÙˆØ®Ø§Ù‹ ØµØºÙŠØ±Ø§Ù‹ ÙˆÙ‚Ø±Ø± Ø§Ù„Ø³ÙØ± Ø¥Ù„Ù‰",
          "ÙÙŠ Ù…Ø­Ø·Ø© Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©ØŒ Ø§Ù„ØªÙ‚Ù‰ {name} Ø¨ÙƒØ§Ø¦Ù† ÙØ¶Ø§Ø¦ÙŠ ÙˆØ¯ÙˆØ¯ Ù…Ù†"
        ],
        middles: [
          "ÙƒÙˆØ§ÙƒØ¨ Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø­Ø«Ø§Ù‹ Ø¹Ù† Ø­ÙŠØ§Ø© Ø°ÙƒÙŠØ©",
          "Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù…Ù†Ø²Ù„Ù‡",
          "Ø§Ù„Ù‚Ù…Ø± Ù„Ø²Ø±Ø§Ø¹Ø© Ø£ÙˆÙ„ Ø­Ø¯ÙŠÙ‚Ø© ÙØ¶Ø§Ø¦ÙŠØ©",
          "ÙƒÙˆÙƒØ¨ Ø¨Ø¹ÙŠØ¯ ÙŠØ­Ø¨ Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ§Ù„Ø¹Ù„Ù…",
          "Ø§Ù„Ù…Ø¬Ø±Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© Ù„Ø§ÙƒØªØ´Ø§Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙƒÙˆÙ†"
        ],
        ends: [
          "ÙˆØ¹Ø§Ø¯ {name} Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ Ù„ÙŠØ´Ø§Ø±Ùƒ Ø§ÙƒØªØ´Ø§ÙØ§ØªÙ‡ Ø§Ù„Ù…Ø°Ù‡Ù„Ø© Ù…Ø¹ Ø§Ù„Ø¹Ø§Ù„Ù….",
          "ØªØ¹Ù„Ù… {name} Ø£Ù† Ø§Ù„ÙƒÙˆÙ† Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ¹Ø§Ø±Ù.",
          "Ø£ØµØ¨Ø­ {name} Ø£ÙˆÙ„ Ù…Ø²Ø§Ø±Ø¹ ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ ÙˆØ£Ù„Ù‡Ù… Ø§Ù„Ø¬Ù…ÙŠØ¹.",
          "ÙƒÙˆÙ‘Ù† {name} ØµØ¯Ø§Ù‚Ø§Øª ÙØ¶Ø§Ø¦ÙŠØ© Ø³ØªØ¯ÙˆÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¯."
        ]
      },
      school: {
        beginnings: [
          "ÙÙŠ Ø£ÙˆÙ„ ÙŠÙˆÙ… Ø¯Ø±Ø§Ø³ÙŠØŒ ÙƒØ§Ù† {name} Ù…ØªØ­Ù…Ø³Ø§Ù‹ Ù„Ø£Ù†Ù‡ Ø³ÙŠÙ„ØªÙ‚ÙŠ",
          "Ø§ÙƒØªØ´Ù {name} ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© ÙƒØªØ§Ø¨Ø§Ù‹ Ø³Ø­Ø±ÙŠØ§Ù‹ ÙŠØ­ÙƒÙŠ Ø¹Ù†",
          "Ù†Ø¸Ù… {name} Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ù‡ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¹Ù„Ù…ÙŠØ© Ù…Ù…ØªØ¹Ø© Ø­ÙˆÙ„",
          "ÙÙŠ Ø±Ø­Ù„Ø© Ù…Ø¯Ø±Ø³ÙŠØ©ØŒ Ø§ÙƒØªØ´Ù {name} ÙˆØ²Ù…Ù„Ø§Ø¤Ù‡"
        ],
        middles: [
          "Ø¨Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯ ÙˆÙ…Ø¹Ù„Ù…ÙŠÙ† Ø±Ø§Ø¦Ø¹ÙŠÙ†",
          "Ù…ØºØ§Ù…Ø±Ø§Øª Ø·Ù„Ø§Ø¨ ÙÙŠ Ù…Ø¯Ø§Ø±Ø³ Ù…Ø®ØªÙ„ÙØ© Ø­ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…",
          "Ø§Ø®ØªØ±Ø§Ø¹Ø§Øª Ø¨Ø³ÙŠØ·Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",
          "Ø­Ø¯ÙŠÙ‚Ø© Ù…Ø®ÙÙŠØ© Ø®Ù„Ù Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ø§Ù„Ù†Ø§Ø¯Ø±Ø©",
          "Ù…ÙƒØªØ¨Ø© Ø³Ø±ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù‚Ø¯Ù… Ø§Ù„ÙƒØªØ¨ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…"
        ],
        ends: [
          "ÙˆÙ‡ÙƒØ°Ø§ Ø£ØµØ¨Ø­Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ§Ù† {name} Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù…Ø±Ø­.",
          "ØªØ¹Ù„Ù… {name} Ø£Ù† Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø£Ø¬Ù…Ù„ Ù‡Ø¯ÙŠØ© ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡Ø§.",
          "ÙØ§Ø² {name} ÙˆÙØ±ÙŠÙ‚Ù‡ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆØªÙ‚Ø¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.",
          "Ù‚Ø±Ø± {name} Ø£Ù† ÙŠØµØ¨Ø­ Ù…Ø¹Ù„Ù…Ø§Ù‹ Ù„ÙŠØ´Ø§Ø±Ùƒ Ø­Ø¨Ù‡ Ù„Ù„ØªØ¹Ù„Ù… Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†."
        ]
      },
      mystery: {
        beginnings: [
          "Ø§ÙƒØªØ´Ù {name} Ù„ØºØ²Ø§Ù‹ ØºØ±ÙŠØ¨Ø§Ù‹ ÙÙŠ Ù…Ù†Ø²Ù„ Ø¬Ø¯ØªÙ‡ Ø§Ù„Ù‚Ø¯ÙŠÙ…",
          "Ø¨ÙŠÙ†Ù…Ø§ ÙƒØ§Ù† {name} ÙŠÙ„Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©ØŒ ÙˆØ¬Ø¯ Ù…ÙØªØ§Ø­Ø§Ù‹ ØºØ§Ù…Ø¶Ø§Ù‹",
          "Ø³Ù…Ø¹ {name} Ø£ØµÙˆØ§ØªØ§Ù‹ ØºØ±ÙŠØ¨Ø© ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø¹Ù„ÙŠØ© ÙƒÙ„ Ù„ÙŠÙ„Ø©",
          "Ø¹Ø«Ø± {name} Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ù‚Ø¯ÙŠÙ…Ø© Ù…ÙƒØªÙˆØ¨Ø© Ø¨Ø­Ø¨Ø± Ø§Ø®ØªÙÙ‰ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹"
        ],
        middles: [
          "ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØµÙ†Ø¯ÙˆÙ‚ Ø®Ø´Ø¨ÙŠ Ù…Ù…Ù„ÙˆØ¡ Ø¨Ø§Ù„Ø£Ø³Ø±Ø§Ø±",
          "Ù„Ø§ ÙŠÙØªØ­ Ø¥Ù„Ø§ Ø¨Ø§Ø¨ ØºØ±ÙØ© Ù…Ù‡Ø¬ÙˆØ±Ø© Ù…Ù†Ø° Ø³Ù†ÙˆØ§Øª",
          "ØªÙƒØ´Ù Ø¹Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù…Ø± Ø³Ø±ÙŠ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ÙƒÙ†Ø² Ù…Ø®ÙÙŠ",
          "ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…ÙƒØ§Ù† Ù…Ù‡Ù… ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"
        ],
        ends: [
          "ÙˆØ­Ù„ {name} Ø§Ù„Ù„ØºØ² Ø¨Ø°ÙƒØ§Ø¦Ù‡ ÙˆØµØ¨Ø±Ù‡ØŒ Ù…ÙƒØªØ´ÙØ§Ù‹ Ø³Ø±Ø§Ù‹ Ø¹Ø§Ø¦Ù„ÙŠØ§Ù‹ Ø¬Ù…ÙŠÙ„Ø§Ù‹.",
          "ØªØ¨ÙŠÙ† Ø£Ù† Ø§Ù„Ù„ØºØ² ÙƒØ§Ù† Ù„Ø¹Ø¨Ø© Ø°ÙƒÙŠØ© ØªØ±ÙƒÙ‡Ø§ Ø§Ù„Ø¬Ø¯ Ù„Ù„Ø£Ø­ÙØ§Ø¯.",
          "Ø§ÙƒØªØ´Ù {name} Ø£Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø² Ù‡ÙŠ Ø§Ù„ØªÙŠ ØªØ¬Ù…Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©.",
          "Ø´Ø§Ø±Ùƒ {name} Ø­Ù„ Ø§Ù„Ù„ØºØ² Ù…Ø¹ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙˆØ£ØµØ¨Ø­ Ù…Ø­Ù‚Ù‚ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„."
        ]
      },
      friendship: {
        beginnings: [
          "Ø§Ù„ØªÙ‚Ù‰ {name} Ø¨Ø·ÙÙ„ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø­ÙŠ ÙˆØ£Ø±Ø§Ø¯ Ø£Ù† ÙŠØµØ¨Ø­Ø§ ØµØ¯ÙŠÙ‚ÙŠÙ†",
          "ÙƒØ§Ù† {name} Ø®Ø¬ÙˆÙ„Ø§Ù‹ ÙˆÙ„ÙƒÙ†Ù‡ Ù‚Ø±Ø± Ø£Ù† ÙŠÙ‚ØªØ±Ø¨ Ù…Ù† Ø²Ù…Ù„Ø§Ø¦Ù‡",
          "Ø³Ø§Ø¹Ø¯ {name} Ø²Ù…ÙŠÙ„Ù‡ Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠÙˆØ§Ø¬Ù‡ ØµØ¹ÙˆØ¨Ø© ÙÙŠ",
          "Ù†Ø¸Ù… {name} Ø­ÙÙ„Ø© ØµØºÙŠØ±Ø© Ù„ØµØ¯ÙŠÙ‚Ù‡ Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† Ø­Ø²ÙŠÙ†Ø§Ù‹"
        ],
        middles: [
          "ÙØ¯Ø¹Ø§Ù‡ Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ù‡ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ù…ØªØ¹Ø©",
          "ÙÙŠ ÙØ±ØµØ© Ø§Ù„ØºØ¯Ø§Ø¡ ÙˆØªØ´Ø§Ø±ÙƒÙˆØ§ Ø§Ù„Ø·Ø¹Ø§Ù… ÙˆØ§Ù„Ø¶Ø­Ùƒ",
          "ÙˆØ§Ø¬Ø¨Ù‡ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙÙ‚Ø¶ÙˆØ§ ÙˆÙ‚ØªØ§Ù‹ Ù…Ù…ØªØ¹Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©",
          "Ù„Ø£Ù†Ù‡ Ø§Ù†ØªÙ‚Ù„ Ù…Ù† Ù…Ø¯ÙŠÙ†Ø© Ø£Ø®Ø±Ù‰ ÙˆÙŠÙØªÙ‚Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡Ù‡ Ø§Ù„Ù‚Ø¯Ø§Ù…Ù‰"
        ],
        ends: [
          "ÙˆÙ‡ÙƒØ°Ø§ ÙƒÙˆÙ‘Ù† {name} ØµØ¯Ø§Ù‚Ø© Ù‚ÙˆÙŠØ© Ø³ØªØ¯ÙˆÙ… Ø·ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…Ø±.",
          "ØªØ¹Ù„Ù… {name} Ø£Ù† Ø§Ù„ØµØ¯Ø§Ù‚Ø© ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¹Ø·Ø§Ø¡ ÙˆØªØ¶Ø­ÙŠØ©.",
          "Ø´ÙƒØ±Ù‡ ØµØ¯ÙŠÙ‚Ù‡ ÙˆØ£ØµØ¨Ø­Ø§ Ø£ÙØ¶Ù„ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.",
          "Ø£Ø¯Ø±Ùƒ {name} Ø£Ù† Ø¥Ø³Ø¹Ø§Ø¯ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© Ù„Ù‡ Ø£ÙŠØ¶Ø§Ù‹."
        ]
      }
    };

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
    async function loadStudentData() {
      try {
        const response = await fetch('../data/studentData.json');
        const data = await response.json();
        students = data.students || [];
        populateClassSelect();
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
        ActivityManager.showNotification('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨', 'error');
      }
    }

    // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙÙˆÙ
    function populateClassSelect() {
      const classSelect = document.getElementById('classSelect');
      const classes = [...new Set(students.map(s => s.class))];
      
      classSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>';
      classes.forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = className;
        classSelect.appendChild(option);
      });
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©
    function handleModeChange() {
      ActivityManager.playSound('click');
      const container = document.getElementById('studentSelection');
      container.innerHTML = '';
      container.style.display = 'none';
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
      const mode = document.getElementById('modeSelect').value;
      const storyIdeaGroup = document.getElementById('storyIdeaGroup');
      const generateBtn = document.getElementById('generateStoryBtn');
      
      if (mode.includes('single')) {
        storyIdeaGroup.style.display = 'block';
        generateBtn.style.display = 'inline-flex';
      } else {
        storyIdeaGroup.style.display = 'none';
        generateBtn.style.display = 'none';
      }
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
    function generateAutomaticStory() {
      const className = document.getElementById('classSelect').value;
      const storyType = document.getElementById('storyTypeSelect').value;
      const storyIdea = document.getElementById('storyIdea').value.trim();
      
      if (!className || !storyType) {
        ActivityManager.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© Ø£ÙˆÙ„Ø§Ù‹', 'warning');
        return;
      }
      
      const classStudents = students.filter(s => s.class === className);
      if (classStudents.length === 0) {
        ActivityManager.showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ', 'error');
        return;
      }
      
      // Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
      const randomStudent = classStudents[Math.floor(Math.random() * classStudents.length)];
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØ©
      const story = createStory(randomStudent.name, storyType, storyIdea);
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØ©
      displayGeneratedStory(story, randomStudent.name, storyType);
      
      // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„
      playStoryGenerationEffects();
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª
    function createStory(studentName, storyType, customIdea = '') {
      const template = storyTemplates[storyType];
      if (!template) return 'Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ© ØºÙŠØ± Ù…ØªÙˆÙØ±.';
      
      // Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù†Ø§ØµØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨
      const beginning = template.beginnings[Math.floor(Math.random() * template.beginnings.length)];
      const middle = template.middles[Math.floor(Math.random() * template.middles.length)];
      const end = template.ends[Math.floor(Math.random() * template.ends.length)];
      
      let story = beginning.replace('{name}', studentName) + ' ' + middle + '. ';
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø© Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ØªÙˆÙØ±Øª
      if (customIdea) {
        story += `ÙˆÙƒÙ…Ø§ Ø®Ø·Ø· ${studentName}ØŒ ${customIdea}. `;
      }
      
      story += end.replace('{name}', studentName);
      
      return story;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©
    function displayGeneratedStory(story, authorName, storyType) {
      // Ø¥Ø®ÙØ§Ø¡ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      document.getElementById('settingsCard').style.display = 'none';
      document.getElementById('studentSelection').style.display = 'none';
      document.getElementById('storyContainer').style.display = 'none';
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚ØµØ©
      const container = document.getElementById('generatedStoryContainer');
      container.style.display = 'block';
      
      // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚ØµØ©
      document.getElementById('storyAuthor').textContent = `Ø¨Ù‚Ù„Ù…: ${authorName}`;
      document.getElementById('storyContent').textContent = story;
      
      // Ø­ÙØ¸ Ø§Ù„Ù‚ØµØ© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
      generatedStories.push({
        author: authorName,
        type: storyType,
        content: story,
        timestamp: new Date()
      });
    }

    // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØ©
    function playStoryGenerationEffects() {
      ActivityManager.playSound('success');
      
      // Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ø­ØªÙØ§Ù„ÙŠ
      const celebrationElement = document.createElement('div');
      celebrationElement.className = 'celebration-effect';
      celebrationElement.innerHTML = 'âœ¨ğŸ“–âœ¨';
      document.body.appendChild(celebrationElement);
      
      setTimeout(() => {
        celebrationElement.remove();
      }, 2000);
      
      // ØªØ£Ø«ÙŠØ± Confetti
      setTimeout(() => {
        confetti({
          particleCount: 80,
          spread: 60,
          origin: { y: 0.7 },
          colors: ['#667eea', '#764ba2', '#ffecd2', '#fcb69f']
        });
        
        ActivityManager.playSound('celebration');
      }, 500);
      
      // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©
      setTimeout(() => {
        ActivityManager.showNotification('ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© Ø±Ø§Ø¦Ø¹Ø©! Ø£Ø­Ø³Ù†Øª!', 'success');
      }, 1000);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø©
    function regenerateStory() {
      const className = document.getElementById('classSelect').value;
      const storyType = document.getElementById('storyTypeSelect').value;
      const storyIdea = document.getElementById('storyIdea').value.trim();
      
      // Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ù…Ø®ØªÙ„Ù
      const classStudents = students.filter(s => s.class === className);
      const availableStudents = classStudents.filter(s => 
        !generatedStories.some(story => story.author === s.name)
      );
      
      let selectedStudent;
      if (availableStudents.length > 0) {
        selectedStudent = availableStudents[Math.floor(Math.random() * availableStudents.length)];
      } else {
        selectedStudent = classStudents[Math.floor(Math.random() * classStudents.length)];
      }
      
      const story = createStory(selectedStudent.name, storyType, storyIdea);
      displayGeneratedStory(story, selectedStudent.name, storyType);
      playStoryGenerationEffects();
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù‚ØµØ©
    function shareStory() {
      const storyContent = document.getElementById('storyContent').textContent;
      const storyAuthor = document.getElementById('storyAuthor').textContent;
      
      const shareText = `${storyAuthor}\n\n${storyContent}\n\n#Ù‚ØµØªÙŠ_Ø§Ù„Ø±Ø§Ø¦Ø¹Ø© #Ø¥Ø¨Ø¯Ø§Ø¹_Ø§Ù„Ø·Ù„Ø§Ø¨`;
      
      if (navigator.share) {
        navigator.share({
          title: 'Ù‚ØµØªÙŠ Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©',
          text: shareText
        }).catch(() => {
          copyToClipboard(shareText);
        });
      } else {
        copyToClipboard(shareText);
      }
    }

    // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©
    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          ActivityManager.showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù‚ØµØ© Ù„Ù„Ø­Ø§ÙØ¸Ø©!', 'success');
        });
      } else {
        // Fallback Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        ActivityManager.showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù‚ØµØ© Ù„Ù„Ø­Ø§ÙØ¸Ø©!', 'success');
      }
    }

    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚ØµØ©
    function backToSettings() {
      document.getElementById('settingsCard').style.display = 'block';
      document.getElementById('generatedStoryContainer').style.display = 'none';
      document.getElementById('storyContainer').style.display = 'none';
      document.getElementById('studentSelection').style.display = 'none';
    }

    // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨
    function showStudentSelection(className, mode) {
      const container = document.getElementById('studentSelection');
      const classStudents = students.filter(s => s.class === className);
      
      container.innerHTML = '';
      container.style.display = 'block';
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
      const header = document.createElement('div');
      header.className = 'students-selection-header mobile-text-center';
      header.innerHTML = `
        <h3><i class="fas fa-users"></i> Ø§Ø®ØªØ± Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
        <p>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨ Ù„Ø§Ø®ØªÙŠØ§Ø±Ù‡Ù… ${mode === 'select-single' ? '(Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·)' : '(Ø¹Ø¯Ø© Ø·Ù„Ø§Ø¨)'}</p>
      `;
      container.appendChild(header);
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
      const cardsContainer = document.createElement('div');
      cardsContainer.className = 'student-cards-grid mobile-grid-2';
      
      classStudents.forEach(student => {
        const card = document.createElement('div');
        card.className = 'student-selection-card touch-target';
        card.innerHTML = `
          <div class="student-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="student-name">${student.name}</div>
        `;
        
        card.addEventListener('click', () => {
          ActivityManager.playSound('click');
          
          if (mode === 'select-single') {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨
            document.querySelectorAll('.student-selection-card').forEach(c => 
              c.classList.remove('selected'));
            selectedManualStudents = [student.name];
            card.classList.add('selected');
          } else {
            // ÙˆØ¶Ø¹ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨
            if (selectedManualStudents.includes(student.name)) {
              selectedManualStudents = selectedManualStudents.filter(n => n !== student.name);
              card.classList.remove('selected');
            } else {
              selectedManualStudents.push(student.name);
              card.classList.add('selected');
            }
          }
        });
        
        cardsContainer.appendChild(card);
      });
      
      container.appendChild(cardsContainer);
      
      // Ø²Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±Ø¯
      const startButton = document.createElement('button');
      startButton.className = 'btn btn-primary start-story-btn touch-target mobile-full-width';
      startButton.innerHTML = '<i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø±Ø¯';
      startButton.addEventListener('click', () => {
        if (selectedManualStudents.length === 0) {
          ActivityManager.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'warning');
          return;
        }
        
        currentStudentList = [...selectedManualStudents];
        usedStudents = [];
        currentMode = mode;
        startStoryActivity();
      });
      
      container.appendChild(startButton);
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø§Ø·
    function startStoryActivity() {
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Ø´Ø§Ø·
      document.getElementById('settingsCard').style.display = 'none';
      document.getElementById('studentSelection').style.display = 'none';
      document.getElementById('storyContainer').style.display = 'block';
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
      const nextBtn = document.getElementById('nextBtn');
      nextBtn.style.display = currentMode.includes('group') ? 'inline-block' : 'none';
      
      // Ø¨Ø¯Ø¡ Ù…Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„
      nextStudent();
      startTimer();
      
      ActivityManager.playSound('success');
      ActivityManager.showNotification('Ø¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø§Ø·! Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø³Ø±Ø¯', 'success');
    }

    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
    function nextStudent() {
      if (currentStudentList.length === 0) {
        ActivityManager.showNotification('Ø§Ù†ØªÙ‡Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨!', 'info');
        return;
      }
      
      const randomIndex = Math.floor(Math.random() * currentStudentList.length);
      const selectedStudent = currentStudentList.splice(randomIndex, 1)[0];
      usedStudents.push(selectedStudent);
      
      document.getElementById('studentName').innerHTML = `
        <i class="fas fa-user-edit"></i> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø³Ø±Ø¯ ÙŠØ§ ${selectedStudent}
      `;
      
      ActivityManager.playSound('click');
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
    function startTimer() {
      const canvas = document.getElementById('timerCanvas');
      const ctx = canvas.getContext('2d');
      secondsPassed = 0;

      function drawTimer() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Ø±Ø³Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
        ctx.beginPath();
        ctx.arc(75, 75, 65, 0, 2 * Math.PI);
        ctx.strokeStyle = '#E0E0E0';
        ctx.lineWidth = 10;
        ctx.stroke();

        // Ø±Ø³Ù… Ø§Ù„ØªÙ‚Ø¯Ù…
        const progress = (secondsPassed % 300) / 300; // ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
        ctx.beginPath();
        ctx.arc(75, 75, 65, -Math.PI / 2, (2 * Math.PI * progress) - Math.PI / 2);
        ctx.strokeStyle = OmaniColors.red;
        ctx.lineWidth = 10;
        ctx.stroke();

        // Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª
        ctx.fillStyle = OmaniColors.black;
        ctx.font = 'bold 18px Cairo';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        const minutes = Math.floor(secondsPassed / 60);
        const seconds = secondsPassed % 60;
        const timeText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        ctx.fillText(timeText, 75, 75);
      }

      drawTimer();
      timerInterval = setInterval(() => {
        secondsPassed++;
        drawTimer();
      }, 1000);
    }

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù‚ØµØ©
    function finishStory() {
      stopTimer();
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ù„
      const celebration = document.getElementById('celebration');
      celebration.style.display = 'block';
      celebration.style.opacity = '1';
      
      // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„
      ActivityManager.playSound('celebration');
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 },
        colors: [OmaniColors.red, OmaniColors.green, OmaniColors.gold]
      });
      
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ø­ØªÙØ§Ù„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      setTimeout(() => {
        celebration.style.opacity = '0';
        setTimeout(() => {
          celebration.style.display = 'none';
          showFinalResults();
        }, 500);
      }, 3000);
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    function showFinalResults() {
      const modal = document.getElementById('thankYouModal');
      const participantList = document.getElementById('participantList');
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      participantList.innerHTML = '';
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
      usedStudents.forEach((name, index) => {
        const li = document.createElement('li');
        li.className = 'honor-item';
        li.innerHTML = `
          <span class="honor-rank">${index + 1}</span>
          <span class="honor-team">${name}</span>
          <span class="honor-names">Ù…Ø´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù‚ØµØ©</span>
        `;
        participantList.appendChild(li);
      });
      
      modal.style.display = 'flex';
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø´Ø§Ø·
    function resetStoryActivity() {
      stopTimer();
      
      currentStudentList = [];
      usedStudents = [];
      selectedManualStudents = [];
      generatedStories = [];
      secondsPassed = 0;
      currentMode = '';
      currentStoryType = '';
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      document.getElementById('settingsCard').style.display = 'block';
      document.getElementById('studentSelection').style.display = 'none';
      document.getElementById('storyContainer').style.display = 'none';
      document.getElementById('generatedStoryContainer').style.display = 'none';
      document.getElementById('thankYouModal').style.display = 'none';
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      document.getElementById('storySettingsForm').reset();
      document.getElementById('studentSelection').innerHTML = '';
      document.getElementById('storyContent').textContent = '';
      document.getElementById('storyAuthor').textContent = '';
      
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©
      document.getElementById('storyIdeaGroup').style.display = 'none';
      document.getElementById('generateStoryBtn').style.display = 'none';
      
      ActivityManager.showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø´Ø§Ø·', 'success');
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø§Ø·
    function initializeStoryActivity() {
      loadStudentData();
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
      document.getElementById('backBtn').addEventListener('click', () => {
        window.location.href = '../main.html';
      });
      
      document.getElementById('muteBtn').addEventListener('click', () => {
        ActivityManager.toggleMute();
        const icon = document.querySelector('#muteBtn i');
        icon.className = ActivityManager.isMuted() ? 'fas fa-volume-mute' : 'fas fa-volume-up';
      });
      
      document.getElementById('instructionsBtn').addEventListener('click', () => {
        document.getElementById('instructionsModal').style.display = 'flex';
      });
      
      document.getElementById('fullscreenBtn').addEventListener('click', () => {
        ActivityManager.toggleFullscreen();
      });
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
      document.getElementById('storySettingsForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const className = document.getElementById('classSelect').value;
        const mode = document.getElementById('modeSelect').value;
        const storyType = document.getElementById('storyTypeSelect').value;
        
        if (!className || !mode || !storyType) {
          ActivityManager.showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
          return;
        }
        
        const classStudents = students.filter(s => s.class === className);
        currentMode = mode;
        currentStoryType = storyType;
        
        if (mode.includes('select')) {
          // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠ
          selectedManualStudents = [];
          showStudentSelection(className, mode);
        } else {
          // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
          currentStudentList = classStudents.map(s => s.name);
          usedStudents = [];
          startStoryActivity();
        }
      });
      
      // Ù…Ø¹Ø§Ù„Ø¬ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚ØµØ©
      document.getElementById('modeSelect').addEventListener('change', handleModeChange);
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ØµØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
      document.getElementById('generateStoryBtn').addEventListener('click', generateAutomaticStory);
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø§Ø·
      document.getElementById('nextBtn').addEventListener('click', nextStudent);
      document.getElementById('finishBtn').addEventListener('click', finishStory);
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø²Ø±Ø§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚ØµØ© Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©
      document.getElementById('regenerateStoryBtn').addEventListener('click', regenerateStory);
      document.getElementById('shareStoryBtn').addEventListener('click', shareStory);
      document.getElementById('backToSettingsBtn').addEventListener('click', backToSettings);
      
      // Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById('closeModalBtn').addEventListener('click', () => {
        document.getElementById('thankYouModal').style.display = 'none';
      });
      
      document.getElementById('modalBackBtn').addEventListener('click', resetStoryActivity);
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
    function closeInstructions() {
      document.getElementById('instructionsModal').style.display = 'none';
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeInstructions();
        document.getElementById('thankYouModal').style.display = 'none';
      }
    });
  </script>
  
  <!-- Responsive JavaScript Helper -->
  <script src="../assets/js/responsive-helper.js"></script>
</body>
</html>
