<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© | ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --dark-gradient: linear-gradient(135deg, #232526 0%, #414345 100%);
      
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-light: #a0aec0;
      --bg-primary: #f7fafc;
      --bg-secondary: #edf2f7;
      --border-radius: 20px;
      --shadow-light: 0 10px 25px rgba(0,0,0,0.1);
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.15);
      
      --arabic-font: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--arabic-font);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
      padding-top: 80px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
    }

    /* ===== PARTICLES BACKGROUND ===== */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
    }

    /* ==== ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© ==== */
    .cosmic-control-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(255, 215, 0, 0.5);
      padding: 1rem 2rem;
      z-index: 99999;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.7);
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    .control-buttons-container {
      display: flex !important;
      justify-content: space-between;
      align-items: center;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
      height: 60px;
    }

    .app-title-cosmic {
      display: flex !important;
      align-items: center;
      gap: 1rem;
      color: white;
      visibility: visible !important;
    }

    .title-icon {
      font-size: 2rem;
      animation: cosmic-glow 2s ease-in-out infinite alternate;
    }

    .title-text {
      font-size: 1.5rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #00ffff, #ff69b4);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: cosmic-text 3s ease-in-out infinite;
    }

    .version-badge {
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4);
    }

    .control-group-cosmic {
      display: flex !important;
      gap: 0.8rem;
      align-items: center;
      visibility: visible !important;
    }

    .cosmic-control-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 215, 0, 0.5);
      color: white;
      padding: 0.8rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
      min-width: 4rem;
      height: 4rem;
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 99999;
      gap: 0.2rem;
      overflow: hidden;
    }

    .cosmic-control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .cosmic-control-btn:hover::before {
      left: 100%;
    }

    .cosmic-control-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .cosmic-control-btn:active {
      transform: translateY(-1px) scale(1.02);
    }

    .btn-icon {
      font-size: 1.4rem;
      transition: transform 0.3s ease;
    }

    .cosmic-control-btn:hover .btn-icon {
      transform: scale(1.2);
    }

    .btn-tooltip {
      font-size: 0.7rem;
      font-weight: 600;
      opacity: 0.8;
    }

    @keyframes cosmic-glow {
      0% { text-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700; }
      100% { text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700; }
    }

    @keyframes cosmic-text {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ÿ™ÿ≠ÿØŸäÿ´ padding ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
    .main-header {
      margin-top: 6rem !important;
    }

    /* ==== ŸÜŸàÿßŸÅÿ∞ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸàÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ==== */
    .settings-modal, .stats-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 20000;
      backdrop-filter: blur(10px);
      align-items: center;
      justify-content: center;
    }

    .settings-modal.active, .stats-modal.active {
      display: flex;
    }

    .settings-content {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      border: 2px solid #ffd700;
      border-radius: 20px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .stats-content {
      background: linear-gradient(135deg, #0f3460, #16537e);
      border: 2px solid #00ffff;
      border-radius: 20px;
      padding: 2rem;
      max-width: 800px;
      width: 95%;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    }

    .settings-title {
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0;
    }

    .close-settings {
      background: rgba(255, 69, 69, 0.2);
      border: 2px solid #ff4545;
      color: #ff4545;
      padding: 0.5rem;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .close-settings:hover {
      background: #ff4545;
      color: white;
      transform: scale(1.1);
    }

    .setting-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setting-item {
      margin-bottom: 1rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    /* ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ */
    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-color: #ffd700;
    }

    .settings-tab-btn.active {
      background: rgba(255, 215, 0, 0.3);
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .setting-select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ===== ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ===== */
    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-icon-main {
      font-size: 3rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rotateIcon 3s ease-in-out infinite;
    }

    @keyframes rotateIcon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    .settings-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .settings-subtitle {
      margin: 0.3rem 0 0 0;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
    }

    .setting-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setting-item {
      margin-bottom: 1rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    /* ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ */
    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-color: #ffd700;
    }

    .settings-tab-btn.active {
      background: rgba(255, 215, 0, 0.3);
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .setting-select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ===== ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ===== */
    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-icon-main {
      font-size: 3rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rotateIcon 3s ease-in-out infinite;
    }

    @keyframes rotateIcon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    .settings-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .settings-subtitle {
      margin: 0.3rem 0 0 0;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
    }

    .setting-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setting-item {
      margin-bottom: 1rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    /* ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ */
    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-color: #ffd700;
    }

    .settings-tab-btn.active {
      background: rgba(255, 215, 0, 0.3);
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .setting-select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ===== ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ÿ≥ŸÜÿ© ===== */
    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-icon-main {
      font-size: 3rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rotateIcon 3s ease-in-out infinite;
    }

    @keyframes rotateIcon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    .settings-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .settings-subtitle {
      margin: 0.3rem 0 0 0;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
    }

    .setting-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setting-item {
      margin-bottom: 1rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    /* ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ */
    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-color: #ffd700;
    }

    .settings-tab-btn.active {
      background: rgba(255, 215, 0, 0.3);
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .setting-select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }

    /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÖÿÆÿµÿµ ŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© */
    .wisdom-arena {
      position: fixed;
      top: 80px;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 30%, #3a3a5c 60%, #4a4a6a 100%);
      overflow-y: auto;
      z-index: 1000;
      animation: wisdomEnter 1s ease-out;
    }

    .wisdom-arena-container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    .wisdom-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(218, 165, 32, 0.1);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(218, 165, 32, 0.3);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(218, 165, 32, 0.2);
    }

    .wisdom-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .wisdom-icon {
      font-size: 4rem;
      background: linear-gradient(45deg, #daa520, #ffd700);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: wisdomPulse 3s ease-in-out infinite;
    }

    .wisdom-title {
      font-size: 3rem;
      font-weight: 900;
      color: #daa520;
      text-shadow: 0 0 20px rgba(218, 165, 32, 0.7);
      margin: 0;
    }

    .wisdom-subtitle {
      font-size: 1.2rem;
      color: #ffd700;
      margin: 0.5rem 0 0 0;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .wisdom-timer-container .timer-circle {
      border-color: rgba(218, 165, 32, 0.5);
      background: radial-gradient(circle, rgba(218, 165, 32, 0.2), transparent);
    }

    .wisdom-btn {
      background: linear-gradient(135deg, #daa520, #b8860b);
      border: 2px solid rgba(218, 165, 32, 0.5);
      color: #fff;
      padding: 1rem 1.5rem;
      border-radius: 15px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
    }

    .wisdom-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(218, 165, 32, 0.5);
    }

    .philosophers-zone {
      background: rgba(218, 165, 32, 0.1);
      border: 2px solid rgba(218, 165, 32, 0.3);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .philosopher-card {
      background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.1));
      border: 2px solid rgba(218, 165, 32, 0.3);
      border-radius: 15px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .philosopher-card:hover {
      transform: translateY(-5px);
      border-color: rgba(218, 165, 32, 0.7);
      box-shadow: 0 10px 25px rgba(218, 165, 32, 0.3);
    }

    .philosopher-card.wisdom-correct {
      background: linear-gradient(135deg, rgba(218, 165, 32, 0.4), rgba(255, 215, 0, 0.4));
      border-color: #daa520;
      animation: wisdomCorrect 0.8s ease-out;
    }

    .wisdom-question-zone {
      background: radial-gradient(circle, rgba(218, 165, 32, 0.1), transparent);
      border: 3px solid rgba(218, 165, 32, 0.5);
      border-radius: 25px;
      padding: 2rem;
      margin-bottom: 2rem;
      text-align: center;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wisdom-active {
      background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.2));
      animation: wisdomGlow 2s ease-in-out infinite;
    }

    @keyframes wisdomEnter {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes wisdomPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 10px #daa520);
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 20px #ffd700);
        transform: scale(1.05);
      }
    }

    @keyframes wisdomCorrect {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(218, 165, 32, 0.8); }
      100% { transform: scale(1); }
    }

    @keyframes wisdomGlow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
        border-color: rgba(218, 165, 32, 0.5);
      }
      50% { 
        box-shadow: 0 0 40px rgba(218, 165, 32, 0.7);
        border-color: rgba(218, 165, 32, 0.9);
      }
    }
  `;

  // ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ±ÿ£ÿ≥
  const wisdomStyle = document.createElement('style');
  wisdomStyle.textContent = wisdomCSS;
  document.head.appendChild(wisdomStyle);

  function startWisdomChallenge() {
    console.log('üß† ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!');
    
    // Wisdom realm entrance effects
    playSoundSequence([
      'wisdom-chime',
      'ancient-bell',
      'brain-activate'
    ], 800);
    
    // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©
    document.getElementById('kingdomDashboard').style.display = 'none';
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿØÿ±ÿßŸÖŸäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
    const enterMessages = [
      'üß† ÿ£ÿ®Ÿàÿßÿ® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿπÿ∏ŸäŸÖÿ© ÿ™ŸÅÿ™ÿ≠ ÿ£ŸÖÿßŸÖŸÉŸÖ!',
      'üìö ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ£ŸÑŸÅ ÿ≠ŸÉŸÖÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÜŸäÿ±ÿ©!',
      'üí≠ ÿ£ŸÜŸÅÿßÿ≥ ÿßŸÑŸÅŸÑÿßÿ≥ŸÅÿ© ÿßŸÑŸÇÿØŸÖÿßÿ° ÿ™ÿ≠Ÿäÿ∑ ÿ®ŸÉŸÖ!',
      'üåü ŸÜŸàÿ± ÿßŸÑŸÖÿπÿ±ŸÅÿ© Ÿäÿ∂Ÿäÿ° ÿØÿ±Ÿàÿ®ŸÉŸÖ!',
      'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿπŸÖŸäŸÇÿ© Ÿäÿ≥ÿ™ŸÇÿ®ŸÑŸÉŸÖ!',
      'üîÆ ŸÉÿ±Ÿäÿ≥ÿ™ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© Ÿäÿ™ŸàŸáÿ¨ ÿ®ÿ≠ÿ∂Ÿàÿ±ŸÉŸÖ!',
      'üìñ ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ™ŸÉÿ™ÿ® ÿ£ÿ≥ŸÖÿßÿ°ŸÉŸÖ!'
    ];
    
    const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
    
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©
    createWisdomArena();
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
    createWisdomAura();
    
    // ÿ±ÿ≥ÿßŸÑÿ© ÿØÿÆŸàŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®
    const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
    showQuantumNotification('üß† ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${randomEnterMessage} (${studentsCount} ÿπŸÇŸÑ ŸÖŸÅŸÉÿ± ÿ¨ÿßŸáÿ≤!)`, 'wisdom');
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
    setTimeout(() => {
      showQuantumNotification('üí° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÅŸÉÿ±Ÿä ÿßŸÑÿπŸÖŸäŸÇ!', 'ÿßŸÑÿ£ÿπŸÖŸÇ ŸÅŸä ÿßŸÑÿ™ŸÅŸÉŸäÿ± Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'info');
    }, 2000);
    
    setTimeout(() => {
      showQuantumNotification('üéØ ŸÑŸÑŸÖŸÅŸÉÿ±ŸäŸÜ ÿßŸÑÿπÿ∏ÿßŸÖ!', 'ŸÅŸÉÿ±Ÿàÿß ÿ®ÿπŸÖŸÇ Ÿàÿ™ÿ£ŸÖŸÑ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿßÿ¨ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿü üëë', 'warning');
    }, 4000);
  }

  function createWisdomArena() {
    const mainApp = document.getElementById('mainApp');
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
    let wisdomArena = document.getElementById('wisdomArena');
    
    if (wisdomArena) {
      // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©ÿå ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ±Ÿáÿß Ÿàÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
      wisdomArena.style.display = 'block';
      resetWisdomArena();
    } else {
      // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ©
      wisdomArena = document.createElement('div');
      wisdomArena.id = 'wisdomArena';
      wisdomArena.className = 'wisdom-arena';
      
      wisdomArena.innerHTML = `
        <div class="wisdom-arena-container">
          <!-- ÿ±ÿ£ÿ≥ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
          <div class="wisdom-header">
            <div class="wisdom-title-container">
              <div class="wisdom-icon">üß†</div>
              <div>
                <h1 class="wisdom-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©</h1>
                <p class="wisdom-subtitle">ÿ™ÿ≠ÿØŸä ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÖŸÅŸÉÿ±ÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿßÿ°</p>
              </div>
            </div>
            
            <!-- ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
            <div class="wisdom-timer-container">
              <div class="timer-circle">
                <div class="timer-text" id="wisdomTimer">10:00</div>
                <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
              </div>
            </div>
            
            <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
            <div class="wisdom-controls">
              <button class="wisdom-btn" id="startWisdomQuestionBtn" onclick="startNewWisdomQuestion()">
                üß† ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©
              </button>
              <button class="wisdom-btn secondary" onclick="pauseWisdomChallenge()">
                ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
              </button>
              <button class="wisdom-btn danger" onclick="endWisdomChallenge()">
                üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
              </button>
            </div>
          </div>
          
          <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ -->
          <div class="philosophers-zone">
            <div class="zone-title">üéì ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖŸÅŸÉÿ±ŸàŸÜ</div>
            <div class="philosophers-grid" id="philosophersGrid">
              <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ -->
            </div>
          </div>
          
          <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© -->
          <div class="wisdom-question-zone">
            <div class="question-display" id="wisdomQuestionDisplay">
              <div class="waiting-state">
                <div class="waiting-icon">üí≠</div>
                <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑŸÇÿßÿØŸÖ</h3>
                <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã</p>
              </div>
            </div>
          </div>
          
          <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
          <div class="wisdom-scoreboard">
            <div class="scoreboard-title">üèõÔ∏è ŸÇÿµÿ± ÿßŸÑÿ≠ŸÉŸÖÿ©</div>
            <div class="scores-container" id="wisdomScores">
              <!-- ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
            </div>
          </div>
          
          <!-- ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÉŸÖÿ© -->
          <div class="wisdom-effects" id="wisdomEffects"></div>
        </div>
      `;
      
      mainApp.appendChild(wisdomArena);
    }
    
    // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
    initializePhilosophers();
    
    // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
    startWisdomTimer();
  }

  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿπ ŸÜŸÅÿ≥ ÿßŸÑÿ∑ŸÑÿßÿ®
  function resetWisdomArena() {
    wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ
    
    if (wisdomTimerInterval) {
      clearInterval(wisdomTimerInterval);
      wisdomTimerInterval = null;
    }
    
    gameState.waitingForWisdomAnswer = false;
    
    selectedStudentsList.forEach((studentName, index) => {
      const scoreElement = document.getElementById(`wisdom-score-${index}`);
      if (scoreElement) {
        scoreElement.textContent = '0';
      }
    });
    
    resetWisdomQuestionZone();
    updateWisdomScoreboard();
  }

  // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
  function initializePhilosophers() {
    const philosophersGrid = document.getElementById('philosophersGrid');
    philosophersGrid.innerHTML = '';
    
    selectedStudentsList.forEach((studentName, index) => {
      const philosopherCard = document.createElement('div');
      philosopherCard.className = 'philosopher-card';
      philosopherCard.id = `philosopher-${index}`;
      philosopherCard.onclick = () => selectPhilosopher(index, studentName);
      
      philosopherCard.innerHTML = `
        <div class="philosopher-name">${studentName}</div>
        <div class="philosopher-score" id="wisdom-score-${index}">0</div>
        <div style="font-size: 0.8rem; color: rgba(255,215,0,0.7); margin-top: 0.5rem;">ÿ¨ŸàÿßŸáÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© üíé</div>
      `;
      
      philosophersGrid.appendChild(philosopherCard);
    });
    
    updateWisdomScoreboard();
  }

  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÑŸÑÿ≠ŸÉŸÖÿ©
  let wisdomTimerInterval;
  let wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ

  function startWisdomTimer() {
    const timerElement = document.getElementById('wisdomTimer');
    
    wisdomTimerInterval = setInterval(() => {
      wisdomTimeLeft--;
      
      const minutes = Math.floor(wisdomTimeLeft / 60);
      const seconds = wisdomTimeLeft % 60;
      timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÅŸÑÿ≥ŸÅŸäÿ© ÿØŸàÿ±Ÿäÿ©
      if (wisdomTimeLeft === 480) { // 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©
        showQuantumNotification('üí≠ 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ™ÿ£ŸÖŸÑ!', 'üåü ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ÿ™ÿ®ŸÑŸàÿ± ŸÅŸä ÿπŸÇŸàŸÑŸÉŸÖ ÿßŸÑŸÜŸäÿ±ÿ©!', 'info');
      } else if (wisdomTimeLeft === 360) { // 6 ÿØŸÇÿßÿ¶ŸÇ
        showQuantumNotification('üß† ŸÖŸÜÿ™ÿµŸÅ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üí° ÿßŸÑŸÖÿπÿ±ŸÅÿ© ÿ™ŸÜŸÖŸà ŸÖÿπ ŸÉŸÑ ÿ™ÿ£ŸÖŸÑ!', 'warning');
      } else if (wisdomTimeLeft === 240) { // 4 ÿØŸÇÿßÿ¶ŸÇ
        showQuantumNotification('üìö 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ•ŸÑŸáÿßŸÖ!', 'üéØ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÇÿ™ÿ±ÿ® ŸÖŸÜ ŸÇŸÑŸàÿ®ŸÉŸÖ!', 'battle');
      } else if (wisdomTimeLeft === 120) { // ÿØŸÇŸäŸÇÿ™ÿßŸÜ
        showQuantumNotification('üíé ÿØŸÇŸäŸÇÿ™ÿßŸÜ ÿ£ÿÆŸäÿ±ÿ™ÿßŸÜ!', 'üî• ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ŸÑŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!', 'warning');
      }
      
  
  selected.forEach(card => {
    card.classList.add('selected');
    card.querySelector('.selection-indicator').textContent = '‚úì';
    selectedStudentsList.push(card.dataset.studentName);
  });
  
  updateSelectedCount();
  playSoundSequence(['cosmic-explosion', 'point-earn'], 300);
}

function quickSelectCount() {
  const studentCards = document.querySelectorAll('.student-card');
  const maxCount = studentCards.length;
  
  const count = parseInt(prompt(`ŸÉŸÖ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿßÿÆÿ™Ÿäÿßÿ±ŸáŸÖÿü (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ: ${maxCount})`, '6'));
  
  if (count && count > 0 && count <= maxCount) {
    clearAllStudents();
    
    const shuffled = Array.from(studentCards).sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, count);
    
    selected.forEach(card => {
      card.classList.add('selected');
      card.querySelector('.selection-indicator').textContent = '‚úì';
      selectedStudentsList.push(card.dataset.studentName);
    });
    
    updateSelectedCount();
    playCosmicSound('level-up');
  }
}

function updateSelectedCount() {
  console.log('üî¢ ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿØÿØŸäŸÜ...');
  
  const countElement = document.getElementById('selectedCount');
  const startBtn = document.getElementById('startGameBtn');
  
  if (!countElement) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± ÿßŸÑÿπÿØ selectedCount');
    return;
  }
  
  if (!startBtn) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° startGameBtn');
    return;
  }
  
  const selectedCount = selectedStudentsList.length;
  console.log(`üë• ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ: ${selectedCount}`);
  console.log('üìã ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ:', selectedStudentsList);
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿµ ŸÖÿπ ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä
  countElement.textContent = selectedCount;
  countElement.style.transform = 'scale(1.2)';
  countElement.style.color = selectedCount > 0 ? '#00ffff' : '#ffffff';
  
  setTimeout(() => {
    countElement.style.transform = 'scale(1)';
  }, 200);
  
  // Enable/disable start button
  if (selectedCount >= 2) {
    console.log('‚úÖ ÿ™ŸÅÿπŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° - ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿπÿØÿØ ŸÉÿßŸÅŸä ŸÖŸÜ ÿßŸÑÿ∑ŸÑÿßÿ®');
    startBtn.disabled = false;
    startBtn.style.opacity = '1';
    startBtn.style.cursor = 'pointer';
    startBtn.style.transform = 'scale(1.05)';
    
    // ÿ•ÿ¥ÿπÿßÿ± ÿ®ÿµÿ±Ÿä ŸÑŸÑÿßÿ≥ÿ™ÿπÿØÿßÿØ
    showQuantumNotification(
      'üéØ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ®ÿØÿ°!',
      `ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ${selectedCount} ÿ∑ÿßŸÑÿ®`,
      'success'
    );
  } else {
    console.log('‚ö†Ô∏è ÿ™ÿπÿ∑ŸäŸÑ ÿ≤ÿ± ÿßŸÑÿ®ÿØÿ° - ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä');
    startBtn.disabled = true;
    startBtn.style.opacity = '0.5';
    startBtn.style.cursor = 'not-allowed';
    
    // Check for achievement
    if (team.score % 5 === 0) {
      showQuantumNotification('üèÜ ÿ•ŸÜÿ¨ÿßÿ≤!', `${team.name} ÿ≠ŸÇŸÇ ${team.score} ŸÜŸÇÿßÿ∑!`, 'achievement');
      playCosmicSound('level-up');
    }
  }
}

function removePointFromTeam(teamId) {
  const team = gameState.teams.find(t => t.id === teamId);
  if (team && team.score > 0) {
    team.score--;
    document.getElementById(`score-${team.id}`).textContent = team.score;
    
    // Energy drain
    team.energy = Math.max(0, team.energy - 3);
    document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
    
    playCosmicSound('point-lose');
  }
}

// Helper function for combo system
function getTeamCombo(teamId) {
  // Simple combo tracking (can be enhanced)
  if (!gameState.teamCombos) gameState.teamCombos = {};
  if (!gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  gameState.teamCombos[teamId]++;
  
  // Reset combo after 5 seconds
  setTimeout(() => {
    if (gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  }, 5000);
  
  return gameState.teamCombos[teamId];
}

// ===== SPECIAL EFFECTS =====
function createCosmicExplosion(element) {
  const rect = element.getBoundingClientRect();
  const explosion = document.createElement('div');
  explosion.className = 'cosmic-explosion';
  explosion.style.left = (rect.left + rect.width / 2 - 100) + 'px';
  explosion.style.top = (rect.top + rect.height / 2 - 100) + 'px';
  document.body.appendChild(explosion);
  
  setTimeout(() => explosion.remove(), 1000);
}

function createCosmicStars() {
  for (let i = 0; i < 10; i++) {
    setTimeout(() => {
      const star = document.createElement('div');
      star.className = 'cosmic-star';
      star.textContent = ['‚≠ê', '‚ú®', 'üí´', 'üåü'][Math.floor(Math.random() * 4)];
      star.style.left = Math.random() * window.innerWidth + 'px';
      star.style.top = '-50px';
      document.body.appendChild(star);
      
      setTimeout(() => star.remove(), 4000);
    }, i * 100);
  }
}

function startCosmicRain() {
  const rainInterval = setInterval(() => {
    if (!gameState.isActive) {
      clearInterval(rainInterval);
      return;
    }
    
    createCosmicStars();
  }, 2000);
}

// ===== AI COACH SYSTEM =====
function getAITip() {
  const tip = aiCoachMessages[Math.floor(Math.random() * aiCoachMessages.length)];
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const tipElement = document.createElement('div');
  tipElement.style.cssText = `
    background: linear-gradient(45deg, rgba(0,255,255,0.2), rgba(255,0,255,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(0,255,255,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  tipElement.textContent = tip;
  
  messagesContainer.appendChild(tipElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Enhanced AI coach sounds
  playSoundSequence([
    'ai-beep',
    'ai-notification'
  ], 300);
}

function analyzePerformance() {
  const analysis = generatePerformanceAnalysis();
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const analysisElement = document.createElement('div');
  analysisElement.style.cssText = `
    background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,105,180,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(255,215,0,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  analysisElement.innerHTML = analysis;
  
  messagesContainer.appendChild(analysisElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Data processing sound sequence
  playSoundSequence([
    'scanner-beep',
    'data-process',
    'ai-notification'
  ], 500);
}

function generatePerformanceAnalysis() {
  const sessionMinutes = Math.floor((Date.now() - gameState.sessionStartTime) / 60000);
  const avgPointsPerMinute = sessionMinutes > 0 ? (getTotalPoints() / sessionMinutes).toFixed(1) : 0;
  
  return `
    üìä <strong>ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ£ÿØÿßÿ°:</strong><br>
    ‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©: ${sessionMinutes} ÿØŸÇŸäŸÇÿ©<br>
    üéØ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©: ${gameState.completedChallenges}<br>
    ‚ö° ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÜŸÇÿßÿ∑/ÿØŸÇŸäŸÇÿ©: ${avgPointsPerMinute}<br>
    üí™ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ£ÿØÿßÿ°: ${getPerformanceRating(avgPointsPerMinute)}
  `;
}

function getPerformanceRating(avgPoints) {
  if (avgPoints >= 2) return "üî• ŸÖŸÖÿ™ÿßÿ≤";
  if (avgPoints >= 1) return "üí™ ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã";
  if (avgPoints >= 0.5) return "üëç ÿ¨ŸäÿØ";
  return "üìà ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ≠ÿ≥ŸÜ";
}

// ===== UTILITY FUNCTIONS =====
function updateBattleTimer() {
  const minutes = Math.floor(gameState.battleDuration / 60);
  const seconds = gameState.battleDuration % 60;
  document.getElementById('challengeTimer').textContent = 
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function startSessionTimer() {
  setInterval(() => {
    const elapsed = Math.floor((Date.now() - gameState.sessionStartTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('sessionTime').textContent = 
      `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }, 1000);
}

function showKingdoms() {
  console.log('üëë ÿ•ÿ∏Ÿáÿßÿ± ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ...');
  
  // Show main app container first
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä');
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑÿ£ÿÆÿ±Ÿâ ÿ£ŸàŸÑÿßŸã
  const elementsToHide = [
    'selectionPanel', 'lightningArena', 'battleArena', 
    'gameInterface', 'wizardArena', 'mysteryArena'
  ];
  
  elementsToHide.forEach(elementId => {
    const element = document.getElementById(elementId);
    if (element) {
      element.style.display = 'none';
      console.log(`‚úÖ ÿ™ŸÖ ÿ•ÿÆŸÅÿßÿ° ${elementId}`);
    }
  });
  
  // ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÖÿßŸÑŸÉ ÿ®ŸÇŸàÿ©
  const kingdomContent = document.getElementById('kingdomContent');
  if (kingdomContent) {
    kingdomContent.style.display = 'block';
    kingdomContent.style.visibility = 'visible';
    kingdomContent.style.opacity = '1';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ kingdomContent');
  }
  
  // ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  const kingdomDashboard = document.getElementById('kingdomDashboard');
  if (kingdomDashboard) {
    kingdomDashboard.style.display = 'grid';
    kingdomDashboard.style.visibility = 'visible';
    kingdomDashboard.style.opacity = '1';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ŸÑŸàÿ≠ÿ© ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ kingdomDashboard');
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
  updateStats();
  console.log('üìä ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ£Ÿä ÿ™ÿ≠ŸàŸÑÿßÿ™ CSS
  document.body.style.overflow = 'auto';
}

function updateStats() {
  console.log('üìä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™...');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©
  const challengesElement = document.getElementById('completedChallenges');
  if (challengesElement) {
    challengesElement.textContent = gameState.completedChallenges;
    console.log('‚úÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©:', gameState.completedChallenges);
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± completedChallenges');
  }
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ÿßŸÇÿ©
  gameState.energyLevel = Math.max(50, gameState.energyLevel - 5);
  const energyElement = document.getElementById('energyLevel');
  if (energyElement) {
    energyElement.textContent = gameState.energyLevel + '%';
    console.log('‚úÖ ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ∑ÿßŸÇÿ©:', gameState.energyLevel + '%');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÜÿµÿ± energyLevel');
  }
  
  console.log('üìä ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
}

function getTotalPoints() {
  return gameState.teams.reduce((total, team) => total + team.score, 0);
}

function findWinner() {
  return gameState.teams.reduce((winner, team) => 
    team.score > winner.score ? team : winner
  );
}

function celebrateVictory(winner) {
  // Massive confetti celebration
  confetti({
    particleCount: 200,
    spread: 100,
    origin: { y: 0.6 },
    colors: ['#FFD700', '#FF6347', '#00FFFF', '#FF00FF']
  });
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.1, y: 0.7 }
    });
  }, 300);
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.9, y: 0.7 }
    });
  }, 600);
  
  showQuantumNotification('üëë ÿßŸÑŸÜÿµÿ±!', `${winner.name} ŸÅÿßÿ≤ ÿ®ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!`, 'victory');
  
  // Ultimate victory sound sequence
  playSoundSequence([
    'ultimate-triumph',
    'fireworks-burst',
    'golden-confetti'
  ], 1500);
  
  createCosmicStars();
}

function triggerRandomEvent() {
  const events = [
    { 
      text: '‚ö° ÿπÿßÿµŸÅÿ© ŸÉŸàŸÜŸäÿ©! ÿ¨ŸÖŸäÿπ ÿßŸÑŸÅÿ±ŸÇ ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ∑ÿßŸÇÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©', 
      effect: 'energy_boost',
      sound: ['cosmic-explosion', 'energy-boost']
    },
    { 
      text: 'üåü ŸÜÿ¨ŸÖ ÿ≥ÿßŸÇÿ∑! ŸÜŸÇÿ∑ÿ© ŸÖÿ∂ÿßÿπŸÅÿ© ŸÑŸÑŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿßŸÑŸä', 
      effect: 'double_points',
      sound: ['star-fall', 'bonus-collect']
    },
    { 
      text: 'üåÄ ÿØŸàÿßŸÖÿ© ÿ≤ŸÖŸÜŸäÿ©! ÿßŸÑŸàŸÇÿ™ Ÿäÿ™ÿ®ÿßÿ∑ÿ£', 
      effect: 'time_slow',
      sound: ['time-warp', 'mystic-wind']
    },
    { 
      text: 'üíé ŸÉÿ±Ÿäÿ≥ÿ™ÿßŸÑ ÿ≥ÿ≠ÿ±Ÿä ÿ∏Ÿáÿ±! ŸÖŸÉÿßŸÅÿ£ÿ© ÿÆÿßÿµÿ©', 
      effect: 'bonus_crystal',
      sound: ['crystal-ping', 'crystal-bonus']
    },
    {
      text: 'üîÆ ÿ®Ÿàÿßÿ®ÿ© ÿ®ŸèÿπÿØŸäÿ© ŸÅŸèÿ™ÿ≠ÿ™! ÿ∑ÿßŸÇÿ© ÿ≥ÿ≠ÿ±Ÿäÿ© ÿ™ŸÖŸÑÿ£ ÿßŸÑÿ≥ÿßÿ≠ÿ©',
      effect: 'portal_magic',
      sound: ['portal-open', 'spell-cast']
    },
    {
      text: 'üèÜ ÿ•ŸÜÿ¨ÿßÿ≤ ŸÖŸÑŸÉŸä! ÿ¨ŸÖŸäÿπ ÿßŸÑŸÅÿ±ŸÇ ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿ•ÿ∂ÿßŸÅŸäÿ©',
      effect: 'royal_bonus',
      sound: ['royal-fanfare', 'achievement-unlock']
    }
  ];
  
  const event = events[Math.floor(Math.random() * events.length)];
  showQuantumNotification('üéÜ ÿ≠ÿØÿ´ ÿÆÿßÿµ!', event.text, 'special');
  
  // Play event sound sequence
  if (event.sound) {
    playSoundSequence(event.sound, 800);
  }
  
  // Apply event effect
  switch(event.effect) {
    case 'energy_boost':
      gameState.teams.forEach(team => {
        team.energy = Math.min(100, team.energy + 20);
        document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
      });
      break;
      
    case 'double_points':
      gameState.doublePointsNext = true;
      setTimeout(() => gameState.doublePointsNext = false, 10000);
      break;
      
    case 'bonus_crystal':
      gameState.teams.forEach(team => {
        team.score += 2;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
      
    case 'portal_magic':
      gameState.teams.forEach(team => {
        team.energy = 100;
        document.getElementById(`energy-${team.id}`).textContent = '100%';
      });
      break;
      
    case 'royal_bonus':
      gameState.teams.forEach(team => {
        team.score += 1;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
  }
}

// ===== ADVANCED SOUND SYSTEM =====
let audioContext = null;
let masterVolume = 0.7;
let soundQueue = [];
let activeSounds = new Map();

// Initialize Web Audio Context for better sound control
function initAudioSystem() {
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    console.log('üéµ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ÿ¨ÿßŸáÿ≤!');
  } catch (error) {
    console.warn('‚ö†Ô∏è ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿå ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ŸÇŸÑŸäÿØŸä');
  }
}

function playCosmicSound(soundType, options = {}) {
  if (!gameState.soundEnabled) return;
  
  // Enhanced sound library with all kingdom sounds
  const sounds = {
    // Kingdom Core Sounds
    'kingdom-enter': '../assets/media/sounds/kingdom-sounds/kingdom-enter.mp3',
    'cosmic-portal': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'magic-sparkle': '../assets/media/sounds/kingdom-sounds/magic-sparkle.mp3',
    'royal-fanfare': '../assets/media/sounds/kingdom-sounds/royal-fanfare.mp3',
    
    // Lightning Realm Sounds
    'lightning-strike': '../assets/media/sounds/kingdom-sounds/lightning-strike.mp3',
    'electric-charge': '../assets/media/sounds/kingdom-sounds/electric-charge.mp3',
    'thunder-rumble': '../assets/media/sounds/kingdom-sounds/thunder-rumble.mp3',
    'lightning-whoosh': '../assets/media/sounds/kingdom-sounds/lightning-whoosh.mp3',
    
    // Wisdom Realm Sounds
    'wisdom-chime': '../assets/media/sounds/kingdom-sounds/wisdom-chime.mp3',
    'brain-activate': '../assets/media/sounds/kingdom-sounds/brain-activate.mp3',
    'ancient-bell': '../assets/media/sounds/kingdom-sounds/ancient-bell.mp3',
    'knowledge-unlock': '../assets/media/sounds/kingdom-sounds/knowledge-unlock.mp3',
    
    // Battle Arena Sounds
    'battle-horn': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'sword-clash': '../assets/media/sounds/kingdom-sounds/sword-clash.mp3',
    'armor-clank': '../assets/media/sounds/kingdom-sounds/armor-clank.mp3',
    'war-drum': '../assets/media/sounds/kingdom-sounds/war-drum.mp3',
    'epic-charge': '../assets/media/sounds/kingdom-sounds/epic-charge.mp3',
    'shield-block': '../assets/media/sounds/kingdom-sounds/shield-block.mp3',
    'battle-victory': '../assets/media/sounds/kingdom-sounds/battle-victory.mp3',
    
    // Mystery Realm Sounds
    'mystery-whisper': '../assets/media/sounds/kingdom-sounds/mystery-whisper.mp3',
    'crystal-ping': '../assets/media/sounds/kingdom-sounds/crystal-ping.mp3',
    'mystic-wind': '../assets/media/sounds/kingdom-sounds/mystic-wind.mp3',
    'spell-cast': '../assets/media/sounds/kingdom-sounds/spell-cast.mp3',
    'riddle-solved': '../assets/media/sounds/kingdom-sounds/riddle-solved.mp3',
    
    // AI Coach Sounds
    'ai-beep': '../assets/media/sounds/kingdom-sounds/ai-beep.mp3',
    'robot-voice': '../assets/media/sounds/kingdom-sounds/robot-voice.mp3',
    'data-process': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'ai-notification': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'scanner-beep': '../assets/media/sounds/kingdom-sounds/scanner-beep.mp3',
    
    // Points & Achievements
    'point-earn': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lose': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'combo-hit': '../assets/media/sounds/kingdom-sounds/combo-hit.mp3',
    'achievement-unlock': '../assets/media/sounds/kingdom-sounds/achievement-unlock.mp3',
    'level-up': '../assets/media/sounds/kingdom-sounds/level-up.mp3',
    'bonus-collect': '../assets/media/sounds/kingdom-sounds/bonus-collect.mp3',
    'perfect-score': '../assets/media/sounds/kingdom-sounds/perfect-score.mp3',
    
    // Special Effects & Random Events
    'cosmic-explosion': '../assets/media/sounds/kingdom-sounds/cosmic-explosion.mp3',
    'star-fall': '../assets/media/sounds/kingdom-sounds/star-fall.mp3',
    'time-warp': '../assets/media/sounds/kingdom-sounds/time-warp.mp3',
    'energy-boost': '../assets/media/sounds/kingdom-sounds/energy-boost.mp3',
    'crystal-bonus': '../assets/media/sounds/kingdom-sounds/crystal-bonus.mp3',
    'portal-open': '../assets/media/sounds/kingdom-sounds/portal-open.mp3',
    'dimensional-shift': '../assets/media/sounds/kingdom-sounds/dimensional-shift.mp3',
    
    // Celebration & Victory
    'epic-victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'crown-ceremony': '../assets/media/sounds/kingdom-sounds/crown-ceremony.mp3',
    'fireworks-burst': '../assets/media/sounds/kingdom-sounds/fireworks-burst.mp3',
    'crowd-cheer': '../assets/media/sounds/kingdom-sounds/crowd-cheer.mp3',
    'golden-confetti': '../assets/media/sounds/kingdom-sounds/golden-confetti.mp3',
    'ultimate-triumph': '../assets/media/sounds/kingdom-sounds/ultimate-triumph.mp3',
    
    // UI & Control Sounds
    'button-hover': '../assets/media/sounds/kingdom-sounds/button-hover.mp3',
    'panel-slide': '../assets/media/sounds/kingdom-sounds/panel-slide.mp3',
    'menu-open': '../assets/media/sounds/kingdom-sounds/menu-open.mp3',
    'setting-change': '../assets/media/sounds/kingdom-sounds/setting-change.mp3',
    'notification-pop': '../assets/media/sounds/kingdom-sounds/notification-pop.mp3',
    'cosmic-click': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3',
    
    // Timer & Countdown
    'countdown-tick': '../assets/media/sounds/kingdom-sounds/countdown-tick.mp3',
    'final-countdown': '../assets/media/sounds/kingdom-sounds/final-countdown.mp3',
    'time-warning': '../assets/media/sounds/kingdom-sounds/time-warning.mp3',
    'time-up': '../assets/media/sounds/kingdom-sounds/time-up.mp3',
    'timer-start': '../assets/media/sounds/kingdom-sounds/timer-start.mp3',
    'timer-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    
    // Legacy sounds fallback
    'realm-activate': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'battle-start': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'battle-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    'point-gained': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lost': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'ai-tip': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'analysis': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'reset': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3'
  };
  
  const soundPath = sounds[soundType];
  if (soundPath) {
    const audio = new Audio(soundPath);
    
    // Apply options
    audio.volume = (options.volume || masterVolume) * (gameState.soundEnabled ? 1 : 0);
    
    // Advanced sound controls
    if (options.loop) audio.loop = true;
    if (options.delay) {
      setTimeout(() => audio.play().catch(e => console.log('Sound play failed:', e)), options.delay);
    } else {
      audio.play().catch(e => console.log('Sound play failed:', e));
    }
    
    // Track active sounds
    if (options.id) {
      activeSounds.set(options.id, audio);
    }
    
    // Auto cleanup
    audio.addEventListener('ended', () => {
      if (options.id) activeSounds.delete(options.id);
    });
    
    return audio;
  }
}

// Enhanced sound control functions
function stopSound(soundId) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
    activeSounds.delete(soundId);
  }
}

function fadeOutSound(soundId, duration = 1000) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    const startVolume = audio.volume;
    const fadeStep = startVolume / (duration / 50);
    
    const fadeInterval = setInterval(() => {
      audio.volume = Math.max(0, audio.volume - fadeStep);
      if (audio.volume <= 0) {
        clearInterval(fadeInterval);
        audio.pause();
        activeSounds.delete(soundId);
      }
    }, 50);
  }
}

function setMasterVolume(volume) {
  masterVolume = Math.max(0, Math.min(1, volume));
  activeSounds.forEach(audio => {
    audio.volume = masterVolume * (gameState.soundEnabled ? 1 : 0);
  });
}

// Play sound sequences
function playSoundSequence(sounds, interval = 500) {
  sounds.forEach((sound, index) => {
    setTimeout(() => {
      if (typeof sound === 'string') {
        playCosmicSound(sound);
      } else {
        playCosmicSound(sound.type, sound.options);
      }
    }, index * interval);
  });
}

function toggleSound() {
  gameState.soundEnabled = !gameState.soundEnabled;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ÿ≠ŸÉŸÖ
  updateSoundButton();
  
  // Play sound toggle feedback
  if (gameState.soundEnabled) {
    setTimeout(() => playCosmicSound('setting-change'), 100);
  }
}

// ===== NOTIFICATIONS SYSTEM =====
function showQuantumNotification(title, message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = 'quantum-notification';
  
  const icons = {
    info: 'üí´',
    success: '‚úÖ',
    warning: '‚ö†Ô∏è',
    error: '‚ùå',
    battle: '‚öîÔ∏è',
    victory: 'üëë',
    achievement: 'üèÜ',
    special: 'üéÜ'
  };
  
  // Enhanced notification sounds
  const notificationSounds = {
    info: 'notification-pop',
    success: ['notification-pop', 'magic-sparkle'],
    warning: 'time-warning',
    error: 'cosmic-click',
    battle: ['notification-pop', 'war-drum'],
    victory: ['notification-pop', 'crown-ceremony'],
    achievement: ['notification-pop', 'achievement-unlock'],
    special: ['notification-pop', 'cosmic-explosion']
  };
  
  notification.innerHTML = `
    <div class="notification-header">
      <span class="notification-icon">${icons[type] || 'üí´'}</span>
      <strong>${title}</strong>
      <button onclick="this.parentElement.parentElement.remove()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer;">√ó</button>
    </div>
    <div>${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  // Play notification sound
  const sound = notificationSounds[type];
  if (Array.isArray(sound)) {
    playSoundSequence(sound, 300);
  } else {
    playCosmicSound(sound || 'notification-pop');
  }
  
  // Show animation
  setTimeout(() => notification.classList.add('show'), 100);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 500);
  }, 5000);
}

function showWelcomeMessage() {
  // Welcome sequence with royal fanfare
  playSoundSequence([
    'kingdom-enter',
    'royal-fanfare',
    'magic-sparkle'
  ], 1000);
  
  showQuantumNotification(
    'üåü ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™!',
    'ÿßÿ≥ÿ™ÿπÿØ ŸÑÿÆŸàÿ∂ ÿ£ÿπÿ∏ŸÖ ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿßÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ© ŸÅŸä ÿßŸÑŸÉŸàŸÜ!',
    'success'
  );
}

// ===== CHALLENGE TYPES =====
function startLightningChallenge() {
  console.log('‚ö° ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!');
  
  // Lightning realm entrance effects
  playSoundSequence([
    'lightning-strike',
    'electric-charge',
    'thunder-rumble'
  ], 600);
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿØÿ±ÿßŸÖŸäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  const enterMessages = [
    '‚ö° ÿßŸÜŸÅÿ™ÿ≠ÿ™ ÿ£ÿ®Ÿàÿßÿ® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!',
    'üå©Ô∏è ÿßŸÑÿπŸàÿßÿµŸÅ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿ™ÿ≠Ÿäÿ∑ ÿ®ŸÉŸÖ ŸÖŸÜ ŸÉŸÑ ÿ¨ÿßŸÜÿ®!',
    'üí´ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ™ÿ™ÿØŸÅŸÇ ŸÅŸä ÿßŸÑŸáŸàÿßÿ° ÿ≠ŸàŸÑŸÉŸÖ!',
    '‚ö° ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿßŸÑÿ£ÿπÿ∏ŸÖ!',
    'üî• ÿßŸÑŸÜŸäÿ±ÿßŸÜ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ© ÿ™ÿ¥ÿ™ÿπŸÑ ŸÅŸä ÿ£ÿπŸäŸÜŸÉŸÖ!'
  ];
  
  const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
  
  // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ
  createLightningArena();
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  createLightningStorm();
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿØÿÆŸàŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('‚ö° ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!', `${randomEnterMessage} (${studentsCount} ÿ∑ŸÑÿßÿ® ÿ¨ÿßŸáÿ≤ŸàŸÜ!)`, 'battle');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üß†‚ö° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ∞ŸáŸÜŸä ÿßŸÑÿ®ÿ±ŸÇŸä!', 'ÿßŸÑÿ£ÿ≥ÿ±ÿπ ŸÅŸä ÿßŸÑÿ™ŸÅŸÉŸäÿ± Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑŸÇŸàÿ© ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!', 'info');
  }, 2000);
  
  setTimeout(() => {
    showQuantumNotification('üéØ ÿßŸÜÿ™ÿ®ŸáŸàÿß ÿ¨ŸäÿØÿßŸã!', 'ŸÉŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ© = ÿµÿßÿπŸÇÿ© ÿ®ÿ±ŸÇ ŸÇŸàŸäÿ©! ‚ö°', 'warning');
  }, 4000);
}

function createLightningArena() {
  const mainApp = document.getElementById('mainApp');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÖÿ≥ÿ®ŸÇÿßŸã
  let lightningArena = document.getElementById('lightningArena');
  
  if (lightningArena) {
    // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©ÿå ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ±Ÿáÿß Ÿàÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
    lightningArena.style.display = 'block';
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ ŸàÿßŸÑŸÖÿ§ŸÇÿ™
    resetLightningArena();
  } else {
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ¨ÿØŸäÿØÿ©
    lightningArena = document.createElement('div');
    lightningArena.id = 'lightningArena';
    lightningArena.className = 'lightning-arena';
    
    lightningArena.innerHTML = `
      <div class="lightning-arena-container">
        <!-- ÿ±ÿ£ÿ≥ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ -->
        <div class="lightning-header">
          <div class="lightning-title-container">
            <div class="lightning-icon">‚ö°</div>
            <div>
              <h1 class="lightning-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ</h1>
              <p class="lightning-subtitle">ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≥ÿ±ÿπÿ© ŸàÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿ®ÿ±ŸÇŸä</p>
            </div>
          </div>
          
          <!-- ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
        <div class="lightning-timer-container">
          <div class="timer-circle">
            <div class="timer-text" id="lightningTimer">60</div>
            <div class="timer-label">ÿ´ÿßŸÜŸäÿ©</div>
          </div>
        </div>
        
        <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
        <div class="lightning-controls">
          <button class="lightning-btn" id="startQuestionBtn" onclick="startNewQuestion()">
            ‚ö° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
          </button>
          <button class="lightning-btn secondary" onclick="pauseLightningChallenge()">
            ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
          </button>
          <button class="lightning-btn danger" onclick="endLightningChallenge()">
            üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
          </button>
        </div>
      </div>
      
      <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ -->
      <div class="competitors-zone">
        <div class="zone-title">üèÜ ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸàŸÜ</div>
        <div class="competitors-grid" id="competitorsGrid">
          <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ -->
        </div>
      </div>
      
      <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© -->
      <div class="question-zone">
        <div class="question-display" id="questionDisplay">
          <div class="waiting-state">
            <div class="waiting-icon">‚ö°</div>
            <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä</h3>
            <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¥ŸÅŸàŸäÿßŸã</p>
          </div>
        </div>
      </div>
      
      <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ -->
      <div class="lightning-scoreboard">
        <div class="scoreboard-title">‚ö° ŸÑŸàÿ≠ÿ© ÿßŸÑÿµŸàÿßÿπŸÇ</div>
        <div class="scores-container" id="lightningScores">
          <!-- ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
        </div>
      </div>
      
      <!-- ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ -->
      <div class="lightning-effects" id="lightningEffects"></div>
    </div>
  `;
    
    mainApp.appendChild(lightningArena);
  }
  
  // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
  initializeCompetitors();
  
  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  startLightningTimer();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿπ ŸÜŸÅÿ≥ ÿßŸÑÿ∑ŸÑÿßÿ®
function resetLightningArena() {
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
  lightningTimeLeft = 300; // 5 ÿØŸÇÿßÿ¶ŸÇ
  
  // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ≥ÿßÿ®ŸÇ ÿ•ŸÜ Ÿàÿ¨ÿØ
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
  gameState.waitingForAnswer = false;
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ŸÑÿßÿ®
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    if (scoreElement) {
      scoreElement.textContent = '0';
    }
  });
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetQuestionZone();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateLightningScoreboard();
}

// ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
function initializeCompetitors() {
  const competitorsGrid = document.getElementById('competitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card';
    competitorCard.id = `competitor-${index}`;
    competitorCard.onclick = () => selectCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ÿµŸàÿßÿπŸÇ</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
  
  updateLightningScoreboard();
}

// ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
let lightningTimerInterval;
let lightningTimeLeft = 300; // 5 ÿØŸÇÿßÿ¶ŸÇ

function startLightningTimer() {
  const timerElement = document.getElementById('lightningTimer');
  
  lightningTimerInterval = setInterval(() => {
    lightningTimeLeft--;
    
    const minutes = Math.floor(lightningTimeLeft / 60);
    const seconds = lightningTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿØŸàÿ±Ÿäÿ©
    if (lightningTimeLeft === 240) { // 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©
      showQuantumNotification('‚è∞ 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©!', 'üî• ÿßŸÑŸÜÿßÿ± ŸÖÿß ÿ≤ÿßŸÑÿ™ ŸÖÿ¥ÿ™ÿπŸÑÿ©! ÿßÿ≥ÿ™ŸÖÿ±Ÿàÿß!', 'info');
    } else if (lightningTimeLeft === 180) { // 3 ÿØŸÇÿßÿ¶ŸÇ
      showQuantumNotification('‚ö° ŸÜÿµŸÅ ÿßŸÑŸàŸÇÿ™ ŸÖÿ±!', 'üí´ ÿßŸÑÿ∑ÿßŸÇÿ© ÿ™ÿ±ÿ™ŸÅÿπ! ŸÖŸÜ ÿ≥ŸäŸÅŸàÿ≤ÿü', 'warning');
    } else if (lightningTimeLeft === 120) { // ÿØŸÇŸäŸÇÿ™ÿßŸÜ
      showQuantumNotification('üå©Ô∏è ÿØŸÇŸäŸÇÿ™ÿßŸÜ ŸÖÿ™ÿ®ŸÇŸäÿ™ÿßŸÜ!', 'üî•‚ö° ÿßŸÑŸÖÿπÿ±ŸÉÿ© ÿ™ÿ≠ÿ™ÿØŸÖ! ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ≠ÿßÿ≥ŸÖÿ©!', 'battle');
    } else if (lightningTimeLeft === 60) { // ÿØŸÇŸäŸÇÿ© Ÿàÿßÿ≠ÿØÿ©
      showQuantumNotification('üö® ÿØŸÇŸäŸÇÿ© ÿ£ÿÆŸäÿ±ÿ©!', 'üí• ÿßŸÑŸàŸÇÿ™ ŸäŸÜŸÅÿØ! ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©!', 'error');
    }
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ©
    if (lightningTimeLeft <= 30 && lightningTimeLeft > 0) {
      if (lightningTimeLeft % 5 === 0) {
        playCosmicSound('countdown-tick');
        createLightningBolt();
      }
      timerElement.style.color = '#ff4757';
      timerElement.parentElement.style.borderColor = '#ff4757';
    } else if (lightningTimeLeft <= 10 && lightningTimeLeft > 0) {
      playCosmicSound('countdown-beep');
      createLightningBolt();
      timerElement.style.animation = 'urgentPulse 0.5s infinite';
      
      // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿπÿØ ÿßŸÑÿ™ŸÜÿßÿ≤ŸÑŸä ÿßŸÑÿ£ÿÆŸäÿ±
      if (lightningTimeLeft === 10) {
        showQuantumNotification('üîü ÿπÿ¥ÿ± ÿ´ŸàÿßŸÜ!', 'üí• ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä ŸÇÿßÿØŸÖ!', 'error');
      } else if (lightningTimeLeft === 5) {
        showQuantumNotification('5Ô∏è‚É£ ÿÆŸÖÿ≥ ÿ´ŸàÿßŸÜ!', '‚ö°üî• ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ£ÿÆŸäÿ±ÿ©!', 'error');
      }
    }
    
    if (lightningTimeLeft <= 0) {
      endLightningChallenge();
    }
  }, 1000);
}

// ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
function startNewQuestion() {
  playCosmicSound('question-start');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÑŸÑÿ≥ÿ§ÿßŸÑ
  const questionStartMessages = [
    'üî• ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ®ÿ±ŸÇŸä ÿßŸÑŸÇÿßÿØŸÖ ÿ≥Ÿäÿ≠ÿ±ŸÇ ÿßŸÑÿπŸÇŸàŸÑ!',
    '‚ö° ÿßŸÜÿ∑ŸÑŸÇÿ™ ÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿäÿ©!',
    'üå©Ô∏è ÿπÿßÿµŸÅÿ© ÿ∞ŸáŸÜŸäÿ© ŸÇÿßÿØŸÖÿ©... ÿßÿ≥ÿ™ÿπÿØŸàÿß!',
    'üí´ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ™ŸÖŸÑÿ£ ÿßŸÑŸÅÿ∂ÿßÿ°!',
    'üéØ ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿßŸÑÿ¢ŸÜ... ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ≠ÿßÿ≥ŸÖÿ©!',
    'üî•‚ö° ÿØŸÖÿßÿ∫ŸÉŸÖ ÿ≥Ÿäÿ≠ÿ™ÿ±ŸÇ ŸÖŸÜ ŸÇŸàÿ© Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ§ÿßŸÑ!',
    'üåü ÿ®ÿ±ŸäŸÇ ÿßŸÑÿ∞ŸÉÿßÿ° ŸäŸÑŸÖÿπ ŸÅŸä ÿπŸäŸàŸÜŸÉŸÖ!'
  ];
  
  const randomQuestionMessage = questionStartMessages[Math.floor(Math.random() * questionStartMessages.length)];
  
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">‚ùì</div>
      <h2>ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿ¥ŸÅŸàŸäÿßŸã ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="instruction-text">
        ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ∞Ÿä Ÿäÿ¨Ÿäÿ® ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠ ŸÑÿ•ÿπÿ∑ÿßÿ¶Ÿá ÿµÿßÿπŸÇÿ© ‚ö°
      </div>
      <button class="lightning-btn" onclick="cancelQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
      </button>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©
  createLightningStorm();
  
  // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
  gameState.waitingForAnswer = true;
  
  // ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿπŸÑŸÖ ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('‚ùì ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸÜÿ¥ÿ∑', randomQuestionMessage, 'info');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ®
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑÿ∑ŸÑÿßÿ®', 'ŸÅŸÉÿ±Ÿàÿß ÿ®ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ®ÿ±ŸÇ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿµÿßÿπŸÇÿ©ÿü ‚ö°', 'warning');
  }, 1500);
}

// ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ® ŸÖÿ¨Ÿäÿ® (ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©)
function selectCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸáŸÜÿ¶ÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const congratsMessages = [
    `üî•‚ö° ${studentName} ÿßÿ¥ÿ™ÿπŸÑ ŸÖÿ´ŸÑ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üí´ ${studentName} ÿ£ÿ∂ÿßÿ° ÿßŸÑÿ≥ŸÖÿßÿ° ÿ®ÿ∞ŸÉÿßÿ¶Ÿá!`,
    `‚ö°üß† ÿπŸÇŸÑ ${studentName} ÿ£ÿ≥ÿ±ÿπ ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üåü ${studentName} ŸÑŸÖÿπ ŸÉÿßŸÑŸÜÿ¨ŸÖ ÿßŸÑÿ≥ÿßÿ∑ÿπ!`,
    `üî• ${studentName} ÿ£ÿ≠ÿ±ŸÇ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿ®ŸÇŸàÿ©!`,
    `‚ö°üéØ ${studentName} ÿ∂ÿ±ÿ® ÿßŸÑŸáÿØŸÅ ÿ®ÿØŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üí• ÿßŸÜŸÅÿ¨ÿßÿ± ÿ∞ŸÉÿßÿ° ŸÖŸÜ ${studentName}!`,
    `üå©Ô∏è ${studentName} ÿπÿßÿµŸÅÿ© ÿ∞ŸáŸÜŸäÿ© ŸÇŸàŸäÿ©!`
  ];
  
  const randomCongratsMessage = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
  
  // ÿ•ÿ∂ÿßŸÅÿ© ŸÜŸÇÿ∑ÿ© ŸÑŸÑÿ∑ÿßŸÑÿ®
  const scoreElement = document.getElementById(`score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ©
  const competitorCard = document.getElementById(`competitor-${index}`);
  competitorCard.classList.add('answered-correct');
  
  setTimeout(() => {
    competitorCard.classList.remove('answered-correct');
  }, 1000);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ©
  playSoundSequence(['correct-answer', 'lightning-strike', 'power-up'], 200);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ
  createLightningBolt();
  createElectricExplosion(competitorCard);
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateLightningScoreboard();
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetQuestionZone();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('‚ö° ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©!', randomCongratsMessage, 'success');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑
  setTimeout(() => {
    if (currentScore === 1) {
      showQuantumNotification('üåü ÿßŸÑÿ®ÿØÿßŸäÿ© ÿßŸÑŸÇŸàŸäÿ©!', `${studentName} ÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ®ÿ±ŸÇ!`, 'info');
    } else if (currentScore === 3) {
      showQuantumNotification('üî• ÿ´ŸÑÿßÿ´ ÿµŸàÿßÿπŸÇ!', `${studentName} Ÿäÿ≠ÿ™ÿ±ŸÇ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ°!`, 'warning');
    } else if (currentScore === 5) {
      showQuantumNotification('‚ö°üëë ŸÖŸÑŸÉ ÿßŸÑÿ®ÿ±ŸÇ!', `${studentName} ŸäŸÇÿ™ÿ±ÿ® ŸÖŸÜ ÿßŸÑÿπÿ±ÿ¥!`, 'battle');
    } else if (currentScore >= 7) {
      showQuantumNotification('üå©Ô∏èüí• ÿ•ÿπÿµÿßÿ± ÿ∞ŸáŸÜŸä!', `${studentName} ŸÑÿß ŸäŸèŸàŸÇŸÅ!`, 'success');
    }
  }, 1000);
  
  gameState.waitingForAnswer = false;
}

// ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
function cancelQuestion() {
  resetQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ŸÑÿ∫ÿßÿ° ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const cancelMessages = [
    'üå™Ô∏è ÿßŸÑÿπÿßÿµŸÅÿ© ŸáÿØÿ£ÿ™... ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ£ŸÑÿ∫Ÿä!',
    'üí≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ÿ®ÿØÿØÿ™... ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ŸÇÿßÿØŸÖ!',
    '‚ö° ÿßŸÑÿµÿßÿπŸÇÿ© ÿßŸÜÿ∑ŸÅÿ£ÿ™... ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÑÿ™ÿßŸÑŸä!',
    'üéØ ÿßŸÑŸáÿØŸÅ ÿ™ÿ∫Ÿäÿ±... ŸÅÿ±ÿµÿ© ÿ¨ÿØŸäÿØÿ© ŸÇÿßÿØŸÖÿ©!',
    'üîÑ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿßŸÑÿ∑ÿßŸÇÿ©... ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßŸÜÿ∑ŸÑÿßŸÇ!'
  ];
  
  const randomCancelMessage = cancelMessages[Math.floor(Math.random() * cancelMessages.length)];
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ', randomCancelMessage, 'info');
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
function resetQuestionZone() {
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">‚ö°</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿ¥ŸÅŸàŸäÿßŸã</p>
    </div>
  `;
}

// ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
function updateLightningScoreboard() {
  const scoresContainer = document.getElementById('lightningScores');
  
  // ÿ¨ŸÖÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  // ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
  scores.sort((a, b) => b.score - a.score);
  
  // ÿ•ŸÜÿ¥ÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  scoresContainer.innerHTML = scores.map((student, position) => `
    <div class="score-item ${position === 0 ? 'first-place' : ''}" style="
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: ${position === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3))' : 'rgba(255,255,255,0.1)'};
      border-radius: 10px;
      border: ${position === 0 ? '2px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div style="
          background: ${position === 0 ? '#ffd700' : position === 1 ? '#c0c0c0' : position === 2 ? '#cd7f32' : '#666'};
          color: ${position <= 2 ? '#000' : '#fff'};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        ">
          ${position + 1}
        </div>
        <span style="color: white; font-weight: 600;">${student.name}</span>
      </div>
      <div style="color: #ffff00; font-weight: 700; font-size: 1.2rem;">
        ${student.score} ‚ö°
      </div>
    </div>
  `).join('');
}

// ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÖÿ§ŸÇÿ™ÿßŸã
function pauseLightningChallenge() {
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿßŸÑÿ•ŸäŸÇÿßŸÅ', 'ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÖÿ§ŸÇÿ™ÿßŸã', 'info');
    
    // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ ŸÑŸÑÿ≤ÿ±
    const pauseBtn = document.querySelector('.lightning-btn.secondary');
    pauseBtn.innerHTML = '‚ñ∂Ô∏è ŸÖÿ™ÿßÿ®ÿπÿ©';
    pauseBtn.onclick = resumeLightningChallenge;
  }
}

// ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿ™ÿ≠ÿØŸä
function resumeLightningChallenge() {
  startLightningTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('‚ñ∂Ô∏è ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™ÿ¶ŸÜÿßŸÅ', 'ÿßÿ≥ÿ™ŸÖÿ± ÿßŸÑÿ™ÿ≠ÿØŸä!', 'success');
  
  // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÜÿµ ŸÑŸÑÿ≤ÿ±
  const pauseBtn = document.querySelector('.lightning-btn.secondary');
  pauseBtn.innerHTML = '‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™';
  pauseBtn.onclick = pauseLightningChallenge;
}

// ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
function endLightningChallenge() {
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
  }
  
  playCosmicSound('challenge-complete');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÜŸáÿßŸäÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ©
  const endMessages = [
    'üå©Ô∏è ÿπÿßÿµŸÅÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ™ŸáÿØÿ£... ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©!',
    '‚ö°üí• ÿßŸÜÿ∑ŸÅÿ£ÿ™ ÿßŸÑÿ¥ÿ±ÿßÿ±ÿßÿ™... ŸÖŸÜ ŸáŸà ÿßŸÑÿ®ÿ∑ŸÑÿü',
    'üî• ŸÜÿßÿ± ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÜÿ∑ŸÅÿ£ÿ™... ÿ≠ÿßŸÜ ŸàŸÇÿ™ ÿßŸÑÿ™ŸÇŸäŸäŸÖ!',
    'üí´ ÿßŸÑŸÜÿ¨ŸàŸÖ ÿ™ŸàŸÇŸÅÿ™ ÿπŸÜ ÿßŸÑŸÑŸÖÿπÿßŸÜ... ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©!',
    'üéÜ ÿßŸÑÿ£ŸÑÿπÿßÿ® ÿßŸÑŸÜÿßÿ±Ÿäÿ© ÿßŸÑÿ∞ŸáŸÜŸäÿ© ÿßŸÜÿ™Ÿáÿ™!'
  ];
  
  const randomEndMessage = endMessages[Math.floor(Math.random() * endMessages.length)];
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä!', randomEndMessage, 'battle');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ÿ∂Ÿäÿ±Ÿäÿ© ŸÑŸÑŸÜÿ™ÿßÿ¶ÿ¨
  setTimeout(() => {
    showQuantumNotification('üìä ÿ¨ÿßÿ±Ÿä ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨...', 'ÿßÿ≥ÿ™ÿπÿØŸàÿß ŸÑŸÖÿπÿ±ŸÅÿ© ŸÖŸÑŸÉ ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ¨ÿØŸäÿØ! üëë', 'info');
  }, 1000);
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  setTimeout(() => {
    showFinalResults();
  }, 2000);
}

// ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
function showFinalResults() {
  const lightningArena = document.getElementById('lightningArena');
  
  // ÿ¨ŸÖÿπ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  const finalScores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  }).sort((a, b) => b.score - a.score);
  
  const winner = finalScores[0];
  
  lightningArena.innerHTML = `
    <div class="final-results">
      <div class="results-container">
        <div class="victory-header">
          <div class="victory-crown">üëë</div>
          <h1 class="victory-title">ÿßŸÜÿ™ŸáŸâ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ!</h1>
          <div class="lightning-effects-final">‚ö°‚ö°‚ö°</div>
        </div>
        
        <div class="winner-announcement">
          <h2 style="color: #ffd700; font-size: 2.5rem; margin: 1rem 0;">
            üèÜ ÿßŸÑŸÅÿßÿ¶ÿ≤: ${winner.name}
          </h2>
          <div style="color: #ffff00; font-size: 2rem; font-weight: 700;">
            ${winner.score} ÿµÿßÿπŸÇÿ© ‚ö°
          </div>
        </div>
        
        <div class="final-scoreboard">
          <h3 style="color: #00ffff; margin-bottom: 1rem;">üèÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©</h3>
          ${finalScores.map((student, index) => `
            <div class="final-score-item" style="
              display: flex;
              justify-content: space-between;
              padding: 1rem;
              margin: 0.5rem 0;
              background: ${index === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.4))' : 'rgba(255,255,255,0.1)'};
              border-radius: 15px;
              border: ${index === 0 ? '3px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
              ${index === 0 ? 'animation: winnerGlow 2s ease-in-out infinite;' : ''}
            ">
              <span style="color: white; font-weight: 600;">${index + 1}. ${student.name}</span>
              <span style="color: #ffff00; font-weight: 700;">${student.score} ‚ö°</span>
            </div>
          `).join('')}
        </div>
        
        <div class="results-actions">
          <button class="lightning-btn" onclick="backToKingdomDashboard()" style="margin: 1rem;">
            üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
          </button>
          <button class="lightning-btn secondary" onclick="startLightningChallenge()" style="margin: 1rem;">
            üîÑ ÿ™ÿ≠ÿØŸä ÿ¨ÿØŸäÿØ
          </button>
        </div>
      </div>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÜŸáÿßÿ¶Ÿäÿ©
  createLightningStorm();
  playSoundSequence(['victory-fanfare', 'fireworks', 'applause'], 1000);
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  const winnerMessages = [
    `üî•‚ö° ${winner.name} ÿ£ÿµÿ®ÿ≠ ÿ•ŸÖÿ®ÿ±ÿßÿ∑Ÿàÿ± ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ£ÿπÿ∏ŸÖ!`,
    `üëëüí´ ${winner.name} Ÿäÿ±ÿ™ÿØŸä ÿ™ÿßÿ¨ ŸÖŸÑŸÉ ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üå©Ô∏èüèÜ ${winner.name} ÿ≥ŸäÿØ ÿßŸÑÿπŸàÿßÿµŸÅ ÿßŸÑÿ∞ŸáŸÜŸäÿ©!`,
    `‚ö°üíé ${winner.name} ÿ¨ŸàŸáÿ±ÿ© ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ®ÿ±ŸÇ!`,
    `üî•üëë ${winner.name} ÿ≠ÿßŸÉŸÖ ÿßŸÑÿµŸàÿßÿπŸÇ ÿßŸÑÿ¨ÿØŸäÿØ!`
  ];
  
  const randomWinnerMessage = winnerMessages[Math.floor(Math.random() * winnerMessages.length)];
  
  // ÿ•ÿπŸÑÿßŸÜ ÿßŸÑŸÅÿßÿ¶ÿ≤
  setTimeout(() => {
    showQuantumNotification('üëë ÿßŸÑŸÅÿßÿ¶ÿ≤ ÿßŸÑŸÖÿ™Ÿàÿ¨!', randomWinnerMessage, 'success');
  }, 500);
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ŸÑŸÑÿ∑ŸÑÿßÿ® ÿ≠ÿ≥ÿ® ŸÜÿ™ÿßÿ¶ÿ¨ŸáŸÖ
  setTimeout(() => {
    if (finalScores.length > 1) {
      const second = finalScores[1];
      showQuantumNotification('ü•à ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÜŸä', `${second.name} ŸÖÿ≠ÿßÿ±ÿ® ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ¥ÿ¨ÿßÿπ! üó°Ô∏è‚ö°`, 'info');
    }
  }, 2000);
  
  setTimeout(() => {
    if (finalScores.length > 2) {
      const third = finalScores[2];
      showQuantumNotification('ü•â ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ´ÿßŸÑÿ´', `${third.name} ŸÅÿßÿ±ÿ≥ ÿßŸÑÿµŸàÿßÿπŸÇ ÿßŸÑŸÖÿ®ÿØÿπ! üõ°Ô∏è‚ö°`, 'warning');
    }
  }, 3500);
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿßŸÖÿ©
  setTimeout(() => {
    showQuantumNotification('üåü ÿ¨ŸÖŸäÿπŸÉŸÖ ÿ£ÿ®ÿ∑ÿßŸÑ!', 'ŸÉŸÑ Ÿàÿßÿ≠ÿØ ŸÖŸÜŸÉŸÖ ŸÑÿØŸäŸá ÿ¥ÿ±ÿßÿ±ÿ© ÿßŸÑÿπÿ®ŸÇÿ±Ÿäÿ©! ÿßÿ≥ÿ™ŸÖÿ±Ÿàÿß ŸÅŸä ÿßŸÑÿ™ÿ£ŸÑŸÇ! ‚ú®', 'battle');
  }, 5000);
}

// ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©
function backToKingdomDashboard() {
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ ÿ≠ÿ∞ŸÅŸáÿß ŸÑŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ÿßŸÑÿ©
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸäÿπŸÖŸÑ
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ ŸàÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('kingdomDashboard').style.display = 'grid';
  playCosmicSound('ui-back');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿπŸàÿØÿ© ÿ•ÿ®ÿØÿßÿπŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const returnMessages = [
    'üè∞ ÿπÿØÿ™ŸÖ ÿ•ŸÑŸâ ÿßŸÑŸÇŸÑÿπÿ© ÿßŸÑŸÖŸÑŸÉŸäÿ© ÿ®ÿπÿØ ŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑÿ®ÿ±ŸÇ!',
    'üëë ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ÿπŸàÿØÿ© ŸÖÿ≠ÿßÿ±ÿ®Ÿä ÿßŸÑÿ®ÿ±ŸÇ!',
    'üåü ÿßŸÑŸÜÿ¨ŸàŸÖ ÿ™ÿ∂Ÿäÿ° ŸÑÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿ£ÿ®ÿ∑ÿßŸÑ ÿßŸÑŸÖÿπÿ±ŸÅÿ©!',
    '‚ö°üè∞ ÿ∑ÿßŸÇÿ© ÿßŸÑÿ®ÿ±ŸÇ ŸÖÿß ÿ≤ÿßŸÑÿ™ ÿ™ÿ≥ÿ±Ÿä ŸÅŸä ÿπÿ±ŸàŸÇŸÉŸÖ!',
    'üé≠ ÿßŸÑŸÖÿ≥ÿ±ÿ≠ ÿ¨ÿßŸáÿ≤ ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©!',
    'üó°Ô∏è ÿßŸÑÿ£ÿ≥ŸÑÿ≠ÿ© ÿßŸÑÿ∞ŸáŸÜŸäÿ© ÿ¥Ÿèÿ≠ÿ∞ÿ™... ÿ£Ÿä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©ÿü'
  ];
  
  const randomReturnMessage = returnMessages[Math.floor(Math.random() * returnMessages.length)];
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿπ ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸáŸÖ
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©', `${randomReturnMessage} (ŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÄ ${studentsCount} ÿ∑ŸÑÿßÿ®)`, 'success');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üéØ ÿ¨ÿßŸáÿ≤ ŸÑŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ©ÿü', 'ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ¨ÿØŸäÿØÿ© Ÿàÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿ™ÿ≠ÿØŸäÿßÿ™ ÿ£ÿÆÿ±Ÿâ! üöÄ', 'info');
  }, 2000);
}

// ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸÇ ÿßŸÑÿ®ÿµÿ±Ÿäÿ© ÿßŸÑŸÖÿ∞ŸáŸÑÿ©
function createLightningStorm() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  // ÿ•ŸÜÿ¥ÿßÿ° 5 ÿµŸàÿßÿπŸÇ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      createLightningBolt();
    }, i * 200);
  }
}

function createLightningBolt() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  const bolt = document.createElement('div');
  bolt.className = 'lightning-bolt';
  bolt.style.left = Math.random() * 100 + '%';
  bolt.style.animationDelay = Math.random() * 0.5 + 's';
  
  effectsContainer.appendChild(bolt);
  
  // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ®ÿ±ŸÇ ÿ®ÿπÿØ ÿßŸÑÿßŸÜŸäŸÖŸäÿ¥ŸÜ
  setTimeout(() => {
    if (bolt.parentNode) {
      bolt.parentNode.removeChild(bolt);
    }
  }, 600);
  
  // ÿµŸàÿ™ ÿßŸÑÿ®ÿ±ŸÇ
  playCosmicSound('lightning-strike', { volume: 0.3 });
}

function createElectricExplosion(element) {
  // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÜŸÅÿ¨ÿßÿ± ŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿπŸÜÿµÿ±
  const explosion = document.createElement('div');
  explosion.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,0,0.8), rgba(0,255,255,0.4), transparent);
    transform: translate(-50%, -50%) scale(0);
    animation: electricExplosion 0.6s ease-out;
    pointer-events: none;
    z-index: 1000;
  `;
  
  element.style.position = 'relative';
  element.appendChild(explosion);
  
  setTimeout(() => {
    if (explosion.parentNode) {
      explosion.parentNode.removeChild(explosion);
    }
  }, 600);
}

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä
const electricExplosionCSS = `
  @keyframes electricExplosion {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.8;
    }
    100% { 
      transform: translate(-50%, -50%) scale(3);
      opacity: 0;
    }
  }
  
  @keyframes winnerGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    }
  }
  
  @keyframes urgentPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  .final-results {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80vh;
    background: linear-gradient(135deg, #000428 0%, #004e92 100%);
    position: relative;
    overflow: hidden;
  }
  
  .results-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 215, 0, 0.5);
    border-radius: 25px;
    padding: 3rem;
    max-width: 600px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }
  
  .victory-header {
    margin-bottom: 2rem;
  }
  
  .victory-crown {
    font-size: 4rem;
    animation: crownBounce 2s ease-in-out infinite;
  }
  
  @keyframes crownBounce {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  .victory-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #ffd700;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
    margin: 1rem 0;
  }
  
  .lightning-effects-final {
    font-size: 2rem;
    color: #ffff00;
    animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }
  
  .winner-announcement {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
    border: 2px solid #ffd700;
    border-radius: 20px;
    padding: 2rem;
    margin: 2rem 0;
    animation: winnerGlow 2s ease-in-out infinite;
  }
  
  .final-scoreboard {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 1.5rem;
    margin: 2rem 0;
  }
  
  .results-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
`;

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ±ÿ£ÿ≥
const style = document.createElement('style');
style.textContent = electricExplosionCSS;
document.head.appendChild(style);

function startWisdomChallenge() {
  // Wisdom realm entrance
  playSoundSequence([
    'wisdom-chime',
    'ancient-bell',
    'brain-activate'
  ], 800);
  
  showQuantumNotification('üß† ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©', 'ÿ™ÿ≠ÿØŸä ŸÅŸÉÿ±Ÿä ÿπŸÖŸäŸÇ ŸàŸÖÿπŸÇÿØ!', 'info');
  
  // Wisdom challenge with thinking time
  setTimeout(() => {
    playCosmicSound('knowledge-unlock');
    showQuantumNotification('üí° ŸÅŸÉÿ± ÿ®ÿπŸÖŸÇ', 'ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑŸÑÿ™ÿ£ŸÖŸÑ ŸàÿßŸÑÿµÿ®ÿ±', 'info');
  }, 3000);
}

function startMysteryChallenge() {
  // Mystery realm entrance
  playSoundSequence([
    'mystery-whisper',
    'mystic-wind',
    'spell-cast'
  ], 700);
  
  showQuantumNotification('üîÆ ÿ™ÿ≠ÿØŸä ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤', 'ŸÑÿ∫ÿ≤ ÿ∫ÿßŸÖÿ∂ ŸäŸÜÿ™ÿ∏ÿ± ÿ≠ŸÑŸá!', 'special');
  
  // Mystery challenge with suspense
  setTimeout(() => {
    playCosmicSound('crystal-ping');
    showQuantumNotification('üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿØŸÑÿ©', 'ÿßŸÑÿ£ŸÑÿ∫ÿßÿ≤ ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿπŸäŸÜ ÿ´ÿßŸÇÿ®ÿ©!', 'special');
  }, 2000);
  
  setTimeout(() => {
    const solved = Math.random() > 0.5;
    if (solved) {
      playCosmicSound('riddle-solved');
      showQuantumNotification('‚úÖ ÿ≠ŸèŸÑ ÿßŸÑŸÑÿ∫ÿ≤!', 'ÿ£ÿ≠ÿ≥ŸÜÿ™! ŸÑŸÇÿØ ŸÉÿ¥ŸÅÿ™ ÿßŸÑÿ≠ŸÇŸäŸÇÿ©', 'success');
    }
  }, 8000);
}

function openSettings() {
  console.log('‚öôÔ∏è ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  playCosmicSound('menu-open');
  
  const settingsModal = document.getElementById('settingsModal');
  if (settingsModal) {
    settingsModal.classList.add('active');
    settingsModal.style.display = 'flex';
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
    updateSettingsData();
    
    showQuantumNotification('‚öôÔ∏è ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ≠ŸÉŸÖ', 'ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©', 'success');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
    showQuantumNotification('‚ùå ÿÆÿ∑ÿ£', 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'error');
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function updateSettingsData() {
  console.log('üìä ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™...');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  const classesCountElement = document.getElementById('classesCount');
  const totalStudentsElement = document.getElementById('totalStudentsCount');
  const lastUpdateElement = document.getElementById('lastUpdateTime');
  
  if (classesCountElement) classesCountElement.textContent = classesCount;
  if (totalStudentsElement) totalStudentsElement.textContent = totalStudents;
  if (lastUpdateElement) lastUpdateElement.textContent = new Date().toLocaleString('ar-SA');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±
  const selectedClassElement = document.getElementById('selectedClassDisplay');
  if (selectedClassElement && gameState.selectedClass) {
    selectedClassElement.innerHTML = `<option value="${gameState.selectedClass}" selected>${gameState.selectedClass}</option>`;
  }
  
  console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: ${classesCount} ÿµŸÅŸàŸÅÿå ${totalStudents} ÿ∑ÿßŸÑÿ®`);
}

// ===== ENHANCED UI INTERACTIONS =====
// Add hover sound effects to buttons
document.addEventListener('DOMContentLoaded', () => {
  // Initialize audio system
  initAudioSystem();
  
  // Initialize control buttons
  initializeControlButtons();
  
  // Load student data first, then start with class selection
  loadStudentData().then(() => {
    loadClassSelection();
  }).catch(error => {
    console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®:', error);
    loadClassSelection(); // Try to load anyway
  });
  
  // Add hover effects to neural buttons after page load
  setTimeout(() => {
    const buttons = document.querySelectorAll('.neural-button, .realm-card');
    buttons.forEach(button => {
      button.addEventListener('mouseenter', () => {
        playCosmicSound('button-hover', { volume: 0.3 });
      });
      
      button.addEventListener('click', () => {
        playCosmicSound('cosmic-click', { volume: 0.5 });
      });
    });
  }, 1000);
});

// ===== INITIALIZATION =====
window.addEventListener('load', async () => {
  await initializeKingdom();
});

async function initializeKingdom() {
  console.log('üè∞ ÿ®ÿØÿ° ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑŸÖŸÖŸÑŸÉÿ©...');
  
  const progressBar = document.getElementById('progressBar');
  const loaderText = document.getElementById('loaderText');
  
  // Initialize particles
  initParticles();
  
  // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸàÿ±ÿßŸã
  setTimeout(() => {
    ensureControlHeaderVisible();
  }, 100);
  
  // Loading sequence with sound effects
  const loadingSteps = [
    { progress: 20, text: "ÔøΩ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑŸÉŸàŸÜŸäÿ©...", sound: 'cosmic-portal' },
    { progress: 40, text: "‚ö° ÿ¥ÿ≠ŸÜ ŸÖÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä...", sound: 'ai-beep' },
    { progress: 60, text: "üè∞ ÿ®ŸÜÿßÿ° ÿßŸÑŸÖŸÖÿßŸÑŸäŸÉ ÿßŸÑÿ≥ÿ≠ÿ±Ÿäÿ©...", sound: 'magic-sparkle' },
    { progress: 80, text: "üë• ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ...", sound: 'data-process' },
    { progress: 100, text: "üéâ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ¨ÿßŸáÿ≤ÿ©!", sound: 'kingdom-enter' }
  ];
  
  for (let step of loadingSteps) {
    await new Promise(resolve => setTimeout(resolve, 800));
    progressBar.style.width = step.progress + '%';
    loaderText.textContent = step.text;
    
    // Play loading sound
    if (step.sound) {
      playCosmicSound(step.sound, { volume: 0.4 });
    }
  }
  
  // Load student data with confirmation
  loaderText.textContent = "üìö ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®...";
  await loadStudentData();
  
  // Confirm data loaded
  const classCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  loaderText.textContent = `‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${classCount} ÿµŸÅŸàŸÅ ŸÖÿπ ${totalStudents} ÿ∑ÿßŸÑÿ®`;
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  // Hide loader and show main app
  await new Promise(resolve => setTimeout(resolve, 1000));
  document.getElementById('cosmicLoader').style.opacity = '0';
  setTimeout(() => {
    document.getElementById('cosmicLoader').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ∏ŸáŸàÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
    ensureControlHeaderVisible();
    
    // Additional visual confirmation
    setTimeout(() => {
      ensureControlHeaderVisible();
      initializeControlButtons(); // ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
      setupSettingsTabs(); // ÿ™ŸÅÿπŸäŸÑ ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
    }, 500);
    
    // Show class selection panel initially instead of welcome message
    loadClassSelection();
    
    // Debug info
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
    
    startSessionTimer();
    // showWelcomeMessage(); // Will be shown after student selection
  }, 1000);
}

// ===== Ÿàÿ∏ÿßÿ¶ŸÅ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ© =====

// ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ≠ÿßÿ™ ŸàÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
function hideAllArenas() {
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸÇ
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑŸÖÿπÿ±ŸÉÿ©
  const battleArena = document.getElementById('battleArena');
  if (battleArena) {
    battleArena.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
  const selectionPanel = document.getElementById('selectionPanel');
  if (selectionPanel) {
    selectionPanel.style.display = 'none';
  }
  
  // ÿ•ÿÆŸÅÿßÿ° Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÑÿπÿ®ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
  const gameInterface = document.getElementById('gameInterface');
  if (gameInterface) {
    gameInterface.style.display = 'none';
  }
  
  // ÿ•ŸäŸÇÿßŸÅ ÿ£Ÿä ŸÖÿ§ŸÇÿ™ÿßÿ™ ŸÜÿ¥ÿ∑ÿ©
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  if (gameState.battleTimer) {
    clearInterval(gameState.battleTimer);
    gameState.battleTimer = null;
  }
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±
  gameState.waitingForAnswer = false;
}

// ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
function initializeControlButtons() {
  console.log('üîß ÿ®ÿØÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ...');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÇÿ®ŸÑ ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´
  const homeBtn = document.getElementById('homeBtn');
  if (!homeBtn) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© homeBtn');
    return;
  } else {
    console.log('‚úÖ ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©');
  }

  // ÿ≤ÿ± ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
  homeBtn.addEventListener('click', function() {
    console.log('üè† ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©!');
    playCosmicSound('ui-back');
    
    console.log('üîç ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©...');
    
    // ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© (ÿµŸÅÿ≠ÿ© ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©)
    if (document.referrer && document.referrer !== window.location.href) {
      // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿµŸÅÿ≠ÿ© ÿ≥ÿßÿ®ŸÇÿ©ÿå ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸäŸáÿß
      console.log('‚Ü©Ô∏è ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©:', document.referrer);
      window.history.back();
    } else {
      // ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸáŸÜÿßŸÉ ÿµŸÅÿ≠ÿ© ÿ≥ÿßÿ®ŸÇÿ©ÿå ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ©
      console.log('üè† ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©');
      window.location.href = '../index.html';
    }
  });

  // ÿ≤ÿ± ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
  const kingdomsBtn = document.getElementById('kingdomsBtn');
  if (kingdomsBtn) {
    kingdomsBtn.addEventListener('click', function() {
      console.log('üè∞ ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ!');
      playCosmicSound('ui-back');
      
      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
      if ((gameState.selectedStudents && gameState.selectedStudents.length > 0) || 
          (selectedStudentsList && selectedStudentsList.length > 0)) {
        // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜÿå ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ
        console.log('üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ ŸÖÿπ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßÿ∏ ÿ®ÿßŸÑÿ∑ŸÑÿßÿ®');
        
        // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≥ÿßÿ≠ÿßÿ™
        hideAllArenas();
        
        // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ
        showKingdoms();
        
        // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
        if (!gameState.sessionStartTime) {
          gameState.sessionStartTime = Date.now();
          startSessionTimer();
        }
        
        const studentsCount = gameState.selectedStudents?.length || selectedStudentsList?.length || 0;
        showQuantumNotification('üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ', `ŸÖÿ≠ÿ™ŸÅÿ∏ ÿ®ŸÄ ${studentsCount} ÿ∑ŸÑÿßÿ® - ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ¨ÿØŸäÿØÿ©!`, 'success');
      } else {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸáŸÜÿßŸÉ ÿ∑ŸÑÿßÿ®ÿå ÿßÿ∞Ÿáÿ® ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ
        console.log('üè∞ ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÖÿ≠ÿØÿØŸàŸÜÿå ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ');
        loadClassSelection();
      }
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ');
  }

  // ÿ≤ÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑÿµŸàÿ™
  const soundToggleBtn = document.getElementById('soundToggleBtn');
  if (soundToggleBtn) {
    soundToggleBtn.addEventListener('click', function() {
      gameState.soundEnabled = !gameState.soundEnabled;
      updateSoundButton();
      playCosmicSound('ui-click');
      showQuantumNotification(
        gameState.soundEnabled ? 'üîä ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™' : 'üîá ÿ™ŸÖ ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™',
        '', 
        'info'
      );
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™');
  }

  // ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ
  const teacherGuideBtn = document.getElementById('teacherGuideBtn');
  if (teacherGuideBtn) {
    teacherGuideBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showTeacherGuide();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿØŸÑŸäŸÑ ÿßŸÑŸÖÿπŸÑŸÖ');
  }  // ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
  const settingsBtn = document.getElementById('settingsBtn');
  if (settingsBtn) {
    settingsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSettingsModal();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™');
  }

  // ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
  const sessionBtn = document.getElementById('sessionBtn');
  if (sessionBtn) {
    sessionBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSessionManagement();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©');
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑÿ≤ÿ± ÿ≠ÿ≥ÿ® ÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
    updateSessionButtonStatus();
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©');
  }

  // ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
  const statsBtn = document.getElementById('statsBtn');
  if (statsBtn) {
    statsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showStatsModal();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™');
  }

  // ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  if (fullscreenBtn) {
    fullscreenBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      toggleFullscreen();
    });
    console.log('‚úÖ ÿ™ŸÖ ÿ±ÿ®ÿ∑ ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©');
  } else {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≤ÿ± ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©');
  }
  
  console.log('üîß ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ');
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
function updateSoundButton() {
  const soundBtn = document.getElementById('soundToggleBtn');
  const icon = soundBtn.querySelector('.btn-icon');
  icon.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function showSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.add('active');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
  updateSettingsDisplay();
  
  // ÿ™ŸÅÿπŸäŸÑ ÿ£ŸàŸÑ ÿ™ÿ®ŸàŸäÿ®
  showSettingsTab('game-settings');
  
  // ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
  setupSettingsTabs();
}

// ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
function setupSettingsTabs() {
  const tabButtons = document.querySelectorAll('.settings-tab-btn');
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      showSettingsTab(tabId);
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÜÿ¥ÿ∑ÿ©
      tabButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
    });
  });
}

// ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ®ŸàŸäÿ® ŸÖÿπŸäŸÜ
function showSettingsTab(tabId) {
  // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
  const allTabs = document.querySelectorAll('.settings-tab-content');
  allTabs.forEach(tab => tab.classList.remove('active'));
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
  const targetTab = document.getElementById(tabId + '-content');
  if (targetTab) {
    targetTab.classList.add('active');
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function updateSettingsDisplay() {
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿµŸàÿ™
  document.getElementById('masterVolumeSlider').value = (gameState.masterVolume || 0.5) * 100;
  document.getElementById('volumeDisplay').textContent = Math.round((gameState.masterVolume || 0.5) * 100) + '%';
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ£ÿÆÿ±Ÿâ
  document.getElementById('particlesToggle').checked = gameState.particlesEnabled !== false;
  document.getElementById('animationsToggle').checked = gameState.animationsEnabled !== false;
  document.getElementById('notificationsToggle').checked = gameState.notificationsEnabled !== false;
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿµŸÅ
  updateClassDataDisplay();
  
  // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ™ÿ∫ŸäŸäÿ± ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿµŸàÿ™
  setupVolumeSliders();
}

// ÿ•ÿπÿØÿßÿØ ÿ£ÿ¥ÿ±ÿ∑ÿ© ÿßŸÑÿµŸàÿ™
function setupVolumeSliders() {
  const masterSlider = document.getElementById('masterVolumeSlider');
  const effectsSlider = document.getElementById('effectsVolumeSlider');
  const musicSlider = document.getElementById('musicVolumeSlider');
  
  masterSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.masterVolume = volume;
    document.getElementById('volumeDisplay').textContent = this.value + '%';
    playCosmicSound('ui-click', { volume: volume });
  });
  
  effectsSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.effectsVolume = volume;
    document.getElementById('effectsVolumeDisplay').textContent = this.value + '%';
    playCosmicSound('cosmic-click', { volume: volume });
  });
  
  musicSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.musicVolume = volume;
    document.getElementById('musicVolumeDisplay').textContent = this.value + '%';
  });
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ
function updateClassDataDisplay() {
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  document.getElementById('classesCount').textContent = classesCount;
  document.getElementById('totalStudentsCount').textContent = totalStudents;
  document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('ar-SA');
  
  // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±
  const selectedClassSelect = document.getElementById('selectedClassDisplay');
  selectedClassSelect.innerHTML = '<option value="">-- ŸÑŸÖ Ÿäÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸÅ --</option>';
  Object.keys(studentData).forEach(className => {
    const option = document.createElement('option');
    option.value = className;
    option.textContent = className;
    if (gameState.selectedClass === className) {
      option.selected = true;
    }
    selectedClassSelect.appendChild(option);
  });
}

// ÿßÿÆÿ™ÿ®ÿßÿ± ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
function testAllSounds() {
  const soundTests = [
    'cosmic-click', 'button-hover', 'achievement', 'magic-sparkle', 
    'epic-charge', 'victory-fanfare', 'ui-back'
  ];
  
  let index = 0;
  const interval = setInterval(() => {
    if (index < soundTests.length) {
      playCosmicSound(soundTests[index], { volume: 0.3 });
      showQuantumNotification(`üéµ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿµŸàÿ™: ${soundTests[index]}`, '', 'info');
      index++;
    } else {
      clearInterval(interval);
      showQuantumNotification('üéº ÿßŸÜÿ™ŸáŸâ ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ÿµŸàÿßÿ™!', '', 'success');
    }
  }, 1000);
}

// ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™
function muteAllSounds() {
  gameState.soundEnabled = false;
  gameState.masterVolume = 0;
  gameState.effectsVolume = 0;
  gameState.musicVolume = 0;
  
  document.getElementById('masterVolumeSlider').value = 0;
  document.getElementById('effectsVolumeSlider').value = 0;
  document.getElementById('musicVolumeSlider').value = 0;
  
  updateSoundButton();
  showQuantumNotification('üîá ÿ™ŸÖ ŸÉÿ™ŸÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿµŸàÿßÿ™', '', 'info');
}

// ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function saveAllSettings() {
  const settings = {
    masterVolume: document.getElementById('masterVolumeSlider').value / 100,
    effectsVolume: document.getElementById('effectsVolumeSlider').value / 100,
    musicVolume: document.getElementById('musicVolumeSlider').value / 100,
    particlesEnabled: document.getElementById('particlesToggle').checked,
    animationsEnabled: document.getElementById('animationsToggle').checked,
    notificationsEnabled: document.getElementById('notificationsToggle').checked,
    fullscreenMode: document.getElementById('fullscreenModeToggle').checked,
    challengeDuration: document.getElementById('challengeDurationSelect').value,
    difficulty: document.getElementById('difficultySelect').value,
    scoringSystem: document.getElementById('scoringSystemSelect').value,
    colorTheme: document.getElementById('colorThemeSelect').value,
    autoSelectStudents: document.getElementById('autoSelectAllStudents').checked,
    randomizeOrder: document.getElementById('randomizeStudentOrder').checked,
    quickStart: document.getElementById('enableQuickStart').checked,
    rememberSelection: document.getElementById('rememberLastSelection').checked,
    timestamp: new Date().toISOString()
  };
  
  // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿπŸÑŸâ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿπÿßŸÖÿ©
  Object.assign(gameState, settings);
  
  // ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
  localStorage.setItem('kingdomSettingsAdvanced', JSON.stringify(settings));
  
  playCosmicSound('achievement');
  showQuantumNotification('üíæ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!', 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¢ŸÜ', 'success');
  closeSettingsModal();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function resetAllSettings() {
  if (confirm('üîÑ ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÑŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©ÿü\n\nÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿÆÿµÿµÿ©.')) {
    // ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    const defaultSettings = {
      masterVolume: 0.5,
      effectsVolume: 0.7,
      musicVolume: 0.3,
      particlesEnabled: true,
      animationsEnabled: true,
      notificationsEnabled: true,
      fullscreenMode: false,
      challengeDuration: 60,
      difficulty: 'medium',
      scoringSystem: 'standard',
      colorTheme: 'cosmic',
      autoSelectStudents: false,
      randomizeOrder: false,
      quickStart: false,
      rememberSelection: true
    };
    
    Object.assign(gameState, defaultSettings);
    localStorage.removeItem('kingdomSettingsAdvanced');
    
    updateSettingsDisplay();
    playCosmicSound('ui-reset');
    showQuantumNotification('üîÑ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÜÿ¥ÿ∑ÿ© ÿßŸÑÿ¢ŸÜ', 'info');
  }
}

// ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function exportSettings() {
  const settings = JSON.parse(localStorage.getItem('kingdomSettingsAdvanced') || '{}');
  const exportData = {
    appName: 'ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©',
    version: '2.0',
    settings: settings,
    exportDate: new Date().toISOString(),
    exportedBy: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ'
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-settings-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('üì§ ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', '', 'success');
}

// ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ
function exportClassData() {
  const exportData = {
    appName: 'ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ©',
    dataType: 'ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®',
    classes: studentData,
    statistics: {
      totalClasses: Object.keys(studentData).length,
      totalStudents: Object.values(studentData).reduce((sum, students) => sum + students.length, 0)
    },
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-class-data-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('üì• ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', '', 'success');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
function closeSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.remove('active');
  modal.style.display = 'none';
  playCosmicSound('ui-back');
}

// ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇÿØŸäŸÖ)
function saveSettings() {
  saveAllSettings();
}

// ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ (ŸÑŸÑÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÇÿØŸäŸÖ)
function resetSettings() {
  resetAllSettings();
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
function showSessionManagement() {
  const savedSession = loadTeacherSession();
  
  // ÿ•ŸÜÿ¥ÿßÿ° modal ŸÑŸÑÿ¨ŸÑÿ≥ÿ© ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØ
  let sessionModal = document.getElementById('sessionModal');
  if (!sessionModal) {
    sessionModal = document.createElement('div');
    sessionModal.id = 'sessionModal';
    sessionModal.className = 'cosmic-modal';
    document.body.appendChild(sessionModal);
  }
  
  sessionModal.innerHTML = `
    <div class="modal-overlay" onclick="closeSessionModal()"></div>
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>üíæ ÿ•ÿØÿßÿ±ÿ© ÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿπŸÑŸÖ</h2>
        <button class="modal-close" onclick="closeSessionModal()">√ó</button>
      </div>
      <div class="modal-body">
        ${savedSession ? `
          <!-- ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© -->
          <div style="background: rgba(79, 172, 254, 0.1); border: 2px solid rgba(79, 172, 254, 0.3);
                      border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: #4facfe; margin-bottom: 1rem;">üéì ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ©</h3>
            <div style="display: grid; gap: 1rem; text-align: right;">
              <div>
                <strong style="color: #ffd700;">ÿßŸÑÿµŸÅ:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedClass}</span>
              </div>
              <div>
                <strong style="color: #ffd700;">ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedStudents.length} ÿ∑ÿßŸÑÿ®</span>
              </div>
              <div>
                <strong style="color: #ffd700;">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ≠ŸÅÿ∏:</strong>
                <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                  ${new Date(savedSession.timestamp).toLocaleString('ar-SA')}
                </span>
              </div>
            </div>
            
            <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ŸÑÿßÿ® -->
            <div style="margin-top: 1.5rem;">
              <strong style="color: #ffd700;">ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ŸàŸÜ:</strong>
              <div style="max-height: 150px; overflow-y: auto; margin-top: 0.5rem;
                          background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
                  ${savedSession.selectedStudents.map(student => `
                    <span style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.3);
                                border-radius: 8px; padding: 0.5rem; text-align: center; font-size: 0.9rem;">
                      ${student}
                    </span>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ© -->
          <div style="display: grid; gap: 1rem;">
            <button class="neural-button" onclick="continueWithSavedSession(); closeSessionModal();" 
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              ‚úÖ ŸÖÿ™ÿßÿ®ÿπÿ© ŸÖÿπ Ÿáÿ∞Ÿá ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            </button>
            
            <button class="neural-button" onclick="exportSession()" 
                    style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
              üì§ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
            </button>
            
            <button class="neural-button" onclick="confirmClearSession()" 
                    style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
              üóëÔ∏è ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            </button>
          </div>
        ` : `
          <!-- ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ© -->
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üíæ</div>
            <h3 style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">
              ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©
            </h3>
            <p style="color: rgba(255,255,255,0.5); margin-bottom: 2rem;">
              ÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ®
            </p>
            
            <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3);
                        border-radius: 15px; padding: 2rem; text-align: right;">
              <h4 style="color: #ffd700; margin-bottom: 1rem;">üí° ŸÉŸäŸÅ ŸäÿπŸÖŸÑ ŸÜÿ∏ÿßŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ¨ŸÑÿ≥ÿ©ÿü</h4>
              <ul style="color: rgba(255,255,255,0.8); list-style: none; padding: 0;">
                <li style="margin-bottom: 0.5rem;">üéØ Ÿäÿ≠ŸÅÿ∏ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ® ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã</li>
                <li style="margin-bottom: 0.5rem;">‚ö° Ÿäÿ≥ÿ™ÿπŸäÿØ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±ÿßÿ™ ÿπŸÜÿØ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿ™ÿ∑ÿ®ŸäŸÇ</li>
                <li style="margin-bottom: 0.5rem;">üîÑ Ÿäÿ≠ÿßŸÅÿ∏ ÿπŸÑŸâ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ŸÑŸÖÿØÿ© 24 ÿ≥ÿßÿπÿ©</li>
                <li style="margin-bottom: 0.5rem;">üéÆ ŸäŸàŸÅÿ± ŸàŸÇÿ™ ÿßŸÑŸÖÿπŸÑŸÖ ÿπŸÜÿØ ÿßŸÑÿ™ŸÜŸÇŸÑ ÿ®ŸäŸÜ ÿßŸÑŸÖŸÖÿßŸÑŸÉ</li>
              </ul>
            </div>
          </div>
        `}
      </div>
    </div>
  `;
  
  sessionModal.classList.add('active');
}

function closeSessionModal() {
  const sessionModal = document.getElementById('sessionModal');
  if (sessionModal) {
    sessionModal.classList.remove('active');
  }
}

function confirmClearSession() {
  if (confirm('üóëÔ∏è ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©ÿü\n\nÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅ ŸàÿßŸÑÿ∑ŸÑÿßÿ® Ÿàÿ≥ÿ™ÿ≠ÿ™ÿßÿ¨ ŸÑÿ•ÿπÿßÿØÿ© ÿßÿÆÿ™Ÿäÿßÿ±ŸáŸÖ.')) {
    clearTeacherSession();
    closeSessionModal();
  }
}

function exportSession() {
  const savedSession = loadTeacherSession();
  if (savedSession) {
    const sessionData = {
      ...savedSession,
      exportDate: new Date().toISOString(),
      appVersion: '2.0'
    };
    
    const dataStr = JSON.stringify(sessionData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `kingdom-session-${savedSession.selectedClass}-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    URL.revokeObjectURL(url);
    
    showQuantumNotification('üì§ ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ±', 'ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
function updateSessionButtonStatus() {
  const sessionBtn = document.getElementById('sessionBtn');
  if (!sessionBtn) return;
  
  const savedSession = loadTeacherSession();
  const iconElement = sessionBtn.querySelector('.btn-icon');
  const tooltipElement = sessionBtn.querySelector('.btn-tooltip');
  
  if (savedSession) {
    // ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©
    iconElement.textContent = 'üíæ';
    tooltipElement.textContent = 'ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©';
    sessionBtn.style.boxShadow = '0 0 10px rgba(79, 172, 254, 0.5)';
    sessionBtn.title = `ÿ¨ŸÑÿ≥ÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©: ${savedSession.selectedClass} (${savedSession.selectedStudents.length} ÿ∑ŸÑÿßÿ®)`;
  } else {
    // ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿ©
    iconElement.textContent = 'üíæ';
    tooltipElement.textContent = 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©';
    sessionBtn.style.boxShadow = '';
    sessionBtn.title = 'ÿ•ÿØÿßÿ±ÿ© ÿ¨ŸÑÿ≥ÿ© ÿßŸÑŸÖÿπŸÑŸÖ';
  }
}

// ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
function showStatsModal() {
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  
  content.innerHTML = `
    <div style="display: grid; gap: 1.5rem;">
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">üéÆ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÑÿπÿ®</h3>
        <div>ÿπÿØÿØ ÿßŸÑÿ£ŸÑÿπÿßÿ®: ${gameState.totalGames || 0}</div>
        <div>ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖŸÉÿ™ÿ≥ÿ®ÿ©: ${gameState.totalPoints || 0}</div>
      </div>
      
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #00ffff; margin-bottom: 1rem;">üë• ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</h3>
        <div>ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉŸäŸÜ: ${gameState.selectedStudents?.length || 0}</div>
        <div>ÿßŸÑÿµŸÅ ÿßŸÑŸÖÿÆÿ™ÿßÿ±: ${gameState.selectedClass || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ'}</div>
      </div>
    </div>
  `;
  
  modal.classList.add('active');
}

// ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
function closeStatsModal() {
  const modal = document.getElementById('statsModal');
  modal.classList.remove('active');
  playCosmicSound('ui-back');
}

// Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().then(() => {
      showQuantumNotification('‚õ∂ Ÿàÿ∂ÿπ ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÖŸÅÿπŸÑ', '', 'info');
    });
  } else {
    document.exitFullscreen().then(() => {
      showQuantumNotification('‚õ∂ ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©', '', 'info');
    });
  }
}

// ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
function backToMainDashboard() {
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
  document.getElementById('selectionPanel').style.display = 'none';
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä
  document.getElementById('kingdomContent').style.display = 'block';
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑÿπŸàÿØÿ©
  playCosmicSound('ui-back');
  
  // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ®
  showWelcomeMessage();
  
  showQuantumNotification(
    'üè∞ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™',
    'ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÜÿßÿ≥ÿ® ŸÑÿ®ÿØÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©',
    'info'
  );
}

// ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
function loadSavedSettings() {
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
  const advancedSettings = localStorage.getItem('kingdomSettingsAdvanced');
  if (advancedSettings) {
    const settings = JSON.parse(advancedSettings);
    Object.assign(gameState, settings);
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©');
    return;
  }
  
  // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© ŸÑŸÑÿ™ŸàÿßŸÅŸÇ
  const oldSettings = localStorage.getItem('kingdomSettings');
  if (oldSettings) {
    const settings = JSON.parse(oldSettings);
    gameState.masterVolume = settings.masterVolume || 0.5;
    gameState.particlesEnabled = settings.particlesEnabled !== false;
    gameState.animationsEnabled = settings.animationsEnabled !== false;
    gameState.soundEnabled = settings.soundEnabled !== false;
    console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÇÿØŸäŸÖÿ© Ÿàÿ™ÿ±ŸÇŸäÿ™Ÿáÿß');
  } else {
    // ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    gameState.masterVolume = 0.5;
    gameState.effectsVolume = 0.7;
    gameState.musicVolume = 0.3;
    gameState.particlesEnabled = true;
    gameState.animationsEnabled = true;
    gameState.notificationsEnabled = true;
    console.log('üìã ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©');
  }
}

// ===== FINAL INITIALIZATION =====
console.log('üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿßŸÑÿ∞ŸÉŸäÿ© - ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ŸÖŸÑ!');
console.log('üéµ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿµŸàÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖ ŸÖÿπ 61 ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä ÿ¨ÿßŸáÿ≤!');
console.log('‚ö° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÖÿßŸÑŸäŸÉ ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿπŸÖŸÑ!');

// Initialize the enhanced audio system
initAudioSystem();

// ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿπŸÑŸàŸäÿ©
initializeControlButtons();

// ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
loadSavedSettings();

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
updateSoundButton();

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
updateSessionButtonStatus();
</script>
</body>
</html>// ...existing code...

let gameState = {
  currentRealm: null,
  isActive: false,
  sessionStartTime: Date.now(),
  completedChallenges: 0,
  energyLevel: 100,
  soundEnabled: true,
  teams: [],
  battleTimer: null,
  battleDuration: 0,
  selectedClass: null,
  selectedStudents: [],
  gameStarted: false,
  waitingForAnswer: false,  // ŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ®ÿ±ŸÇ
  waitingForWisdomAnswer: false  // ŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©
};

// ÿ•ÿ≤ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿØŸàÿßŸÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ©
// ÿ™ŸÖ ÿ≠ÿ∞ŸÅ: saveTeacherSession, loadTeacherSession, restoreTeacherSession, clearTeacherSession, etc.

function loadClassSelection() {
  console.log('üéì ÿ®ÿØÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿµŸÅŸàŸÅ');
  console.log('üìä ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©:', Object.keys(studentData));
  
  // Show main app container
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('‚úÖ ÿ™ŸÖ ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä');
  }
  
  // Hide main dashboard
  document.getElementById('kingdomContent').style.display = 'none';
  
  // Show selection panel
  document.getElementById('selectionPanel').style.display = 'block';
  
  const classGrid = document.getElementById('classGrid');
  if (!classGrid) {
    console.error('‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ classGrid');
    return;
  }
  
  classGrid.innerHTML = '';
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  if (!studentData || Object.keys(studentData).length === 0) {
    console.warn('‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ∑ŸÑÿßÿ®');
    classGrid.innerHTML = `
      <div style="text-align: center; color: #ff6b6b; padding: 2rem; grid-column: 1 / -1;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
        <h3>ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿßÿ®</h3>
        <p>ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
        <button class="neural-button" onclick="reloadStudentData()" style="margin-top: 1rem;">
          üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        </button>
      </div>
    `;
    
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    loadStudentData().then(() => {
      loadClassSelection(); // ÿ•ÿπÿßÿØÿ© ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿßŸÑÿØÿßŸÑÿ© ÿ®ÿπÿØ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
    }).catch(error => {
      console.error('‚ùå ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
    });
    return;
  }
  
  const classNames = Object.keys(studentData);
  console.log(`üìö ÿ™ÿ≠ŸÖŸäŸÑ ${classNames.length} ÿµŸÅŸàŸÅ:`, classNames);
  
  classNames.forEach(className => {
    const classCard = document.createElement('div');
    classCard.className = 'class-card';
    classCard.style.cursor = 'pointer';
    
    // ÿ±ÿ®ÿ∑ ÿßŸÑÿ≠ÿØÿ´ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿ¢ŸÖŸÜÿ©
    classCard.addEventListener('click', function() {
      console.log('üñ±Ô∏è ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿµŸÅ:', className);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä ŸÅŸàÿ±Ÿä
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = '';
      }, 150);
      
      // ÿ™ÿ£ÿ´Ÿäÿ± ÿµŸàÿ™Ÿä
      playCosmicSound('button-click', { volume: 0.3 });
      
      // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿØÿßŸÑÿ© ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±
      selectClass(className);
    });
    
    const studentCount = studentData[className].length;
    
    classCard.innerHTML = `
      <div style="font-size: 3rem; margin-bottom: 1rem;">üè´</div>
      <h4 style="margin: 0; color: #ffd700;">${className}</h4>
      <div class="student-count" style="color: #00ffff; margin-top: 0.5rem;">${studentCount} ÿ∑ÿßŸÑÿ®</div>
    `;
    
    // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ hover
    classCard.addEventListener('mouseenter', () => {
      playCosmicSound('button-hover', { volume: 0.2 });
    });
    
    classGrid.appendChild(classCard);
  });
  
  playCosmicSound('panel-slide');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅŸàŸÅ
  showQuantumNotification(
    `üìö ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${Object.keys(studentData).length} ÿµŸÅŸàŸÅ`,
    'ÿßÿÆÿ™ÿ± ÿµŸÅŸÉ ŸÑÿ®ÿØÿ° ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿ©',
    'success'
  );
  
  console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑÿµŸÅŸàŸÅ ÿ®ŸÜÿ¨ÿßÿ≠');
}

function startKingdomGame() {
  if (selectedStudentsList.length < 2) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑÿ®ÿØÿ° ÿßŸÑŸÑÿπÿ®ÿ©', 'warning');
    return;
  }
  
  gameState.selectedStudents = [...selectedStudentsList];
  gameState.gameStarted = true;
  
  // Hide selection panel and show game interface
  document.getElementById('selectionPanel').style.display = 'none';
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('gameInterface').style.display = 'block';
  
  // Generate teams from selected students
  generateTeamsFromStudents();
  
  // Play epic start sequence
  playSoundSequence([
    'royal-fanfare',
    'kingdom-enter',
    'epic-charge'
  ], 1000);
  
  showQuantumNotification(
    'üèÜ ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ÿ®ÿØÿ£ÿ™!', 
    `ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ${selectedStudentsList.length} ŸÖÿ¥ÿßÿ±ŸÉ ŸÖŸÜ ${gameState.selectedClass}`, 
    'success'
  );
  
  // Show welcome message after selection
  setTimeout(() => {
    showWelcomeMessage();
  }, 2000);
}

// ÿ•ÿ≤ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿ£ÿ≤ÿ±ÿßÿ± ŸàÿØŸàÿßŸÑ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ¨ŸÑÿ≥ÿ© ŸÖŸÜ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ
function initializeControlButtons() {
  console.log('üîß ÿ®ÿØÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ...');
  
  const homeBtn = document.getElementById('homeBtn');
  if (homeBtn) {
    homeBtn.addEventListener('click', function() {
      console.log('üè† ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©!');
      playCosmicSound('ui-back');
      
      if (document.referrer && document.referrer !== window.location.href) {
        window.history.back();
      } else {
        window.location.href = '../index.html';
      }
    });
  }

  const kingdomsBtn = document.getElementById('kingdomsBtn');
  if (kingdomsBtn) {
    kingdomsBtn.addEventListener('click', function() {
      console.log('üè∞ ÿ™ŸÖ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑŸÖŸÖÿßŸÑŸÉ!');
      playCosmicSound('ui-back');
      
      if ((gameState.selectedStudents && gameState.selectedStudents.length > 0) || 
          (selectedStudentsList && selectedStudentsList.length > 0)) {
        hideAllArenas();
        showKingdoms();
        
        if (!gameState.sessionStartTime) {
          gameState.sessionStartTime = Date.now();
          startSessionTimer();
        }
        
        const studentsCount = gameState.selectedStudents?.length || selectedStudentsList?.length || 0;
        showQuantumNotification('üè∞ ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖÿßŸÑŸÉ', `${studentsCount} ÿ∑ŸÑÿßÿ® ÿ¨ÿßŸáÿ≤ŸàŸÜ - ÿßÿÆÿ™ÿ± ŸÖŸÖŸÑŸÉÿ© ÿ¨ÿØŸäÿØÿ©!`, 'success');
      } else {
        loadClassSelection();
      }
    });
  }

  const soundToggleBtn = document.getElementById('soundToggleBtn');
  if (soundToggleBtn) {
    soundToggleBtn.addEventListener('click', function() {
      gameState.soundEnabled = !gameState.soundEnabled;
      updateSoundButton();
      playCosmicSound('ui-click');
      showQuantumNotification(
        gameState.soundEnabled ? 'üîä ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™' : 'üîá ÿ™ŸÖ ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™',
        '', 
        'info'
      );
    });
  }

  const teacherGuideBtn = document.getElementById('teacherGuideBtn');
  if (teacherGuideBtn) {
    teacherGuideBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showTeacherGuide();
    });
  }

  const settingsBtn = document.getElementById('settingsBtn');
  if (settingsBtn) {
    settingsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSettingsModal();
    });
  }

  const statsBtn = document.getElementById('statsBtn');
  if (statsBtn) {
    statsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showStatsModal();
    });
  }

  const fullscreenBtn = document.getElementById('fullscreenBtn');
  if (fullscreenBtn) {
    fullscreenBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      toggleFullscreen();
    });
  }
  
  console.log('üîß ÿßŸÜÿ™Ÿáÿßÿ° ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ');
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
updateSoundButton();

// ÿ™ÿ¨ÿ±ÿ®ÿ©
</script>
</body>
</html>// ...existing code...

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÖÿÆÿµÿµ ŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©
const wisdomCSS = `
  .wisdom-arena {
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 30%, #3a3a5c 60%, #4a4a6a 100%);
    overflow-y: auto;
    z-index: 1000;
    animation: wisdomEnter 1s ease-out;
  }

  .wisdom-arena-container {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
  }

  .wisdom-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(218, 165, 32, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 20px;
    padding: 1.5rem 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(218, 165, 32, 0.2);
  }

  .wisdom-title-container {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .wisdom-icon {
    font-size: 4rem;
    background: linear-gradient(45deg, #daa520, #ffd700);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: wisdomPulse 3s ease-in-out infinite;
  }

  .wisdom-title {
    font-size: 3rem;
    font-weight: 900;
    color: #daa520;
    text-shadow: 0 0 20px rgba(218, 165, 32, 0.7);
    margin: 0;
  }

  .wisdom-subtitle {
    font-size: 1.2rem;
    color: #ffd700;
    margin: 0.5rem 0 0 0;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .wisdom-timer-container .timer-circle {
    border-color: rgba(218, 165, 32, 0.5);
    background: radial-gradient(circle, rgba(218, 165, 32, 0.2), transparent);
  }

  .wisdom-btn {
    background: linear-gradient(135deg, #daa520, #b8860b);
    border: 2px solid rgba(218, 165, 32, 0.5);
    color: #fff;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
  }

  .wisdom-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(218, 165, 32, 0.5);
  }

  .philosophers-zone {
    background: rgba(218, 165, 32, 0.1);
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
  }

  .philosopher-card {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.1));
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 15px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .philosopher-card:hover {
    transform: translateY(-5px);
    border-color: rgba(218, 165, 32, 0.7);
    box-shadow: 0 10px 25px rgba(218, 165, 32, 0.3);
  }

  .philosopher-card.wisdom-correct {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.4), rgba(255, 215, 0, 0.4));
    border-color: #daa520;
    animation: wisdomCorrect 0.8s ease-out;
  }

  .wisdom-question-zone {
    background: radial-gradient(circle, rgba(218, 165, 32, 0.1), transparent);
    border: 3px solid rgba(218, 165, 32, 0.5);
    border-radius: 25px;
    padding: 2rem;
    margin-bottom: 2rem;
    text-align: center;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .wisdom-active {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.2));
    animation: wisdomGlow 2s ease-in-out infinite;
  }

  @keyframes wisdomEnter {
    0% { opacity: 0; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
  }

  @keyframes wisdomPulse {
    0%, 100% { 
      filter: drop-shadow(0 0 10px #daa520);
      transform: scale(1);
    }
    50% { 
      filter: drop-shadow(0 0 20px #ffd700);
      transform: scale(1.05);
    }
  }

  @keyframes wisdomCorrect {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(218, 165, 32, 0.8); }
    100% { transform: scale(1); }
  }

  @keyframes wisdomGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
      border-color: rgba(218, 165, 32, 0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(218, 165, 32, 0.7);
      border-color: rgba(218, 165, 32, 0.9);
    }
  }
`;

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ±ÿ£ÿ≥
const wisdomStyle = document.createElement('style');
wisdomStyle.textContent = wisdomCSS;
document.head.appendChild(wisdomStyle);

function startWisdomChallenge() {
  console.log('üß† ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!');
  
  // Wisdom realm entrance effects
  playSoundSequence([
    'wisdom-chime',
    'ancient-bell',
    'brain-activate'
  ], 800);
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿØÿ±ÿßŸÖŸäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  const enterMessages = [
    'üß† ÿ£ÿ®Ÿàÿßÿ® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿπÿ∏ŸäŸÖÿ© ÿ™ŸÅÿ™ÿ≠ ÿ£ŸÖÿßŸÖŸÉŸÖ!',
    'üìö ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ£ŸÑŸÅ ÿ≠ŸÉŸÖÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÜŸäÿ±ÿ©!',
    'üí≠ ÿ£ŸÜŸÅÿßÿ≥ ÿßŸÑŸÅŸÑÿßÿ≥ŸÅÿ© ÿßŸÑŸÇÿØŸÖÿßÿ° ÿ™ÿ≠Ÿäÿ∑ ÿ®ŸÉŸÖ!',
    'üåü ŸÜŸàÿ± ÿßŸÑŸÖÿπÿ±ŸÅÿ© Ÿäÿ∂Ÿäÿ° ÿØÿ±Ÿàÿ®ŸÉŸÖ!',
    'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿπŸÖŸäŸÇÿ© Ÿäÿ≥ÿ™ŸÇÿ®ŸÑŸÉŸÖ!',
    'üîÆ ŸÉÿ±Ÿäÿ≥ÿ™ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© Ÿäÿ™ŸàŸáÿ¨ ÿ®ÿ≠ÿ∂Ÿàÿ±ŸÉŸÖ!',
    'üìñ ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ™ŸÉÿ™ÿ® ÿ£ÿ≥ŸÖÿßÿ°ŸÉŸÖ!'
  ];
  
  const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
  
  // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©
  createWisdomArena();
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  createWisdomAura();
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿØÿÆŸàŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üß† ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${randomEnterMessage} (${studentsCount} ÿπŸÇŸÑ ŸÖŸÅŸÉÿ± ÿ¨ÿßŸáÿ≤!)`, 'wisdom');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üí° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÅŸÉÿ±Ÿä ÿßŸÑÿπŸÖŸäŸÇ!', 'ÿßŸÑÿ£ÿπŸÖŸÇ ŸÅŸä ÿßŸÑÿ™ŸÅŸÉŸäÿ± Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'info');
  }, 2000);
  
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑŸÖŸÅŸÉÿ±ŸäŸÜ ÿßŸÑÿπÿ∏ÿßŸÖ!', 'ŸÅŸÉÿ±Ÿàÿß ÿ®ÿπŸÖŸÇ Ÿàÿ™ÿ£ŸÖŸÑ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿßÿ¨ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿü üëë', 'warning');
  }, 4000);
}

function createWisdomArena() {
  const mainApp = document.getElementById('mainApp');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
  let wisdomArena = document.getElementById('wisdomArena');
  
  if (wisdomArena) {
    // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©ÿå ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ±Ÿáÿß Ÿàÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
    wisdomArena.style.display = 'block';
    resetWisdomArena();
  } else {
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ©
    wisdomArena = document.createElement('div');
    wisdomArena.id = 'wisdomArena';
    wisdomArena.className = 'wisdom-arena';
    
    wisdomArena.innerHTML = `
      <div class="wisdom-arena-container">
        <!-- ÿ±ÿ£ÿ≥ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-header">
          <div class="wisdom-title-container">
            <div class="wisdom-icon">üß†</div>
            <div>
              <h1 class="wisdom-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©</h1>
              <p class="wisdom-subtitle">ÿ™ÿ≠ÿØŸä ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÖŸÅŸÉÿ±ÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿßÿ°</p>
            </div>
          </div>
          
          <!-- ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
          <div class="wisdom-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="wisdomTimer">10:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
          <div class="wisdom-controls">
            <button class="wisdom-btn" id="startWisdomQuestionBtn" onclick="startNewWisdomQuestion()">
              üß† ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©
            </button>
            <button class="wisdom-btn secondary" onclick="pauseWisdomChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="wisdom-btn danger" onclick="endWisdomChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ -->
        <div class="philosophers-zone">
          <div class="zone-title">üéì ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖŸÅŸÉÿ±ŸàŸÜ</div>
          <div class="philosophers-grid" id="philosophersGrid">
            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ -->
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© -->
        <div class="wisdom-question-zone">
          <div class="question-display" id="wisdomQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üí≠</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑŸÇÿßÿØŸÖ</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã</p>
            </div>
          </div>
        </div>
        
        <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-scoreboard">
          <div class="scoreboard-title">üèõÔ∏è ŸÇÿµÿ± ÿßŸÑÿ≠ŸÉŸÖÿ©</div>
          <div class="scores-container" id="wisdomScores">
            <!-- ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
          </div>
        </div>
        
        <!-- ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-effects" id="wisdomEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(wisdomArena);
  }
  
  // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
  initializePhilosophers();
  
  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  startWisdomTimer();
}

// ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
function initializePhilosophers() {
  const philosophersGrid = document.getElementById('philosophersGrid');
  philosophersGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const philosopherCard = document.createElement('div');
    philosopherCard.className = 'philosopher-card';
    philosopherCard.id = `philosopher-${index}`;
    philosopherCard.onclick = () => selectPhilosopher(index, studentName);
    
    philosopherCard.innerHTML = `
      <div class="philosopher-name">${studentName}</div>
      <div class="philosopher-score" id="wisdom-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,215,0,0.7); margin-top: 0.5rem;">ÿ¨ŸàÿßŸáÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© üíé</div>
    `;
    
    philosophersGrid.appendChild(philosopherCard);
  });
  
  updateWisdomScoreboard();
}

// ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÑŸÑÿ≠ŸÉŸÖÿ©
let wisdomTimerInterval;
let wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ

function startWisdomTimer() {
  const timerElement = document.getElementById('wisdomTimer');
  
  wisdomTimerInterval = setInterval(() => {
    wisdomTimeLeft--;
    
    const minutes = Math.floor(wisdomTimeLeft / 60);
    const seconds = wisdomTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÅŸÑÿ≥ŸÅŸäÿ© ÿØŸàÿ±Ÿäÿ©
    if (wisdomTimeLeft === 480) { // 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©
      showQuantumNotification('üí≠ 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ™ÿ£ŸÖŸÑ!', 'üåü ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ÿ™ÿ®ŸÑŸàÿ± ŸÅŸä ÿπŸÇŸàŸÑŸÉŸÖ ÿßŸÑŸÜŸäÿ±ÿ©!', 'info');
    } else if (wisdomTimeLeft === 360) { // 6 ÿØŸÇÿßÿ¶ŸÇ
      showQuantumNotification('üß† ŸÖŸÜÿ™ÿµŸÅ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üí° ÿßŸÑŸÖÿπÿ±ŸÅÿ© ÿ™ŸÜŸÖŸà ŸÖÿπ ŸÉŸÑ ÿ™ÿ£ŸÖŸÑ!', 'warning');
    } else if (wisdomTimeLeft === 240) { // 4 ÿØŸÇÿßÿ¶ŸÇ
      showQuantumNotification('üìö 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ•ŸÑŸáÿßŸÖ!', 'üéØ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÇÿ™ÿ±ÿ® ŸÖŸÜ ŸÇŸÑŸàÿ®ŸÉŸÖ!', 'battle');
    } else if (wisdomTimeLeft === 120) { // ÿØŸÇŸäŸÇÿ™ÿßŸÜ
      showQuantumNotification('üíé ÿØŸÇŸäŸÇÿ™ÿßŸÜ ÿ£ÿÆŸäÿ±ÿ™ÿßŸÜ!', 'üî• ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ŸÑŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!', 'warning');
    }
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàÿµŸàÿ™Ÿäÿ©
    if (wisdomTimeLeft <= 60 && wisdomTimeLeft > 0) {
      if (wisdomTimeLeft % 10 === 0) {
        playCosmicSound('wisdom-chime');
        createWisdomParticle();
      }
      timerElement.style.color = '#daa520';
      timerElement.parentElement.style.borderColor = '#daa520';
    }
    
    if (wisdomTimeLeft <= 0) {
      endWisdomChallenge();
    }
  }, 1000);
}

// ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ
function startNewWisdomQuestion() {
  playCosmicSound('wisdom-chime');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä
  const wisdomQuestionMessages = [
    'üí≠ ÿ≥ÿ§ÿßŸÑ ŸÅŸÑÿ≥ŸÅŸä ÿπŸÖŸäŸÇ Ÿäÿ™ÿ∑ŸÑÿ® ÿ™ÿ£ŸÖŸÑÿßŸã ÿØŸÇŸäŸÇÿßŸã!',
    'üåü ŸÅŸÉÿ±Ÿàÿß ÿ®ÿπŸÖŸÇ... ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÅŸä ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ!',
    'üß† ÿπŸÇŸàŸÑŸÉŸÖ ŸÖŸÉÿ™ÿ®ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿπÿ±ŸÅÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿ©!',
    'üí° ÿßŸÑÿ•ŸÑŸáÿßŸÖ ÿßŸÑÿ¢ŸÜ... ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©!',
    'üìö ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖŸÅÿ™Ÿàÿ≠ ÿ£ŸÖÿßŸÖŸÉŸÖ!',
    'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿπŸÖŸäŸÇÿ© Ÿäÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ!',
    'üíé ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑÿπŸÇŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÜŸäÿ±!'
  ];
  
  const randomWisdomMessage = wisdomQuestionMessages[Math.floor(Math.random() * wisdomQuestionMessages.length)];
  
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display question-active wisdom-active';
  
  questionDisplay.innerHTML = `
    <div class="wisdom-question-content">
      <div class="question-icon">ü§î</div>
      <h2>ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #daa520; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="wisdom-instruction-text">
        ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ∞Ÿä ŸäŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ÿ£Ÿà ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ ŸÑÿ•ÿπÿ∑ÿßÿ¶Ÿá ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© üíé
      </div>
      <button class="wisdom-btn" onclick="cancelWisdomQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
      </button>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  createWisdomAura();
  
  // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
  gameState.waitingForWisdomAnswer = true;
  
  // ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿπŸÑŸÖ ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('ü§î ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÜÿ¥ÿ∑', randomWisdomMessage, 'info');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ®
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑÿ≠ŸÉŸÖÿßÿ°', 'ÿ™ÿ£ŸÖŸÑŸàÿß ÿ®ÿπŸÖŸÇ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©ÿü üíé', 'warning');
  }, 1500);
}

// ÿßÿÆÿ™Ÿäÿßÿ± ÿ≠ŸÉŸäŸÖ (ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ© ÿ£Ÿà ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ)
function selectPhilosopher(index, studentName) {
  if (!gameState.waitingForWisdomAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸáŸÜÿ¶ÿ© ŸÅŸÑÿ≥ŸÅŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const wisdomCongratsMessages = [
    `üíéüß† ${studentName} ŸÅŸÉÿ± ÿ®ÿπŸÖŸÇ ŸÅŸäŸÑÿ≥ŸàŸÅ ÿ≠ŸÇŸäŸÇŸä!`,
    `üåü ${studentName} ÿ£ÿ∂ÿßÿ° ÿßŸÑÿπŸÇŸàŸÑ ÿ®ÿ≠ŸÉŸÖÿ™Ÿá ÿßŸÑŸÜŸäÿ±ÿ©!`,
    `üí≠üìö ${studentName} ŸÉÿ™ÿ® ÿµŸÅÿ≠ÿ© ÿ¨ÿØŸäÿØÿ© ŸÅŸä ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠ŸÉŸÖÿ©!`,
    `üé≠ ${studentName} ÿ£ÿØŸáÿ¥ ÿßŸÑÿ¨ŸÖŸäÿπ ÿ®ÿ™ŸÅŸÉŸäÿ±Ÿá ÿßŸÑÿπŸÖŸäŸÇ!`,
    `üí° ${studentName} ÿ£ÿ∂ÿßÿ° ÿ¥ŸÖÿπÿ© ÿßŸÑŸÖÿπÿ±ŸÅÿ© ŸÅŸä ÿßŸÑŸÇŸÑŸàÿ®!`,
    `üèõÔ∏è ${studentName} ÿ®ŸÜŸâ ŸÇÿµÿ±ÿßŸã ŸÖŸÜ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑŸÜÿ®ŸäŸÑÿ©!`,
    `üîÆ ${studentName} ŸÉÿ¥ŸÅ ÿ£ÿ≥ÿ±ÿßÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿÆŸÅŸäÿ©!`,
    `üìñ ${studentName} ŸÇÿ±ÿ£ ŸÖŸÜ ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠Ÿäÿßÿ© ÿ®ÿπŸäŸÜ ÿßŸÑÿ®ÿµŸäÿ±ÿ©!`
  ];
  
  const randomWisdomCongrats = wisdomCongratsMessages[Math.floor(Math.random() * wisdomCongratsMessages.length)];
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ŸàŸáÿ±ÿ© ÿ≠ŸÉŸÖÿ© ŸÑŸÑÿ∑ÿßŸÑÿ®
  const scoreElement = document.getElementById(`wisdom-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  const philosopherCard = document.getElementById(`philosopher-${index}`);
  philosopherCard.classList.add('wisdom-correct');
  
  setTimeout(() => {
    philosopherCard.classList.remove('wisdom-correct');
  }, 1000);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  playSoundSequence(['wisdom-chime', 'ancient-bell', 'knowledge-unlock'], 300);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿ®ÿµÿ±Ÿäÿ©
  createWisdomParticle();
  createWisdomAura();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateWisdomScoreboard();
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetWisdomQuestionZone();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('üíé ÿ•ÿ¨ÿßÿ®ÿ© ÿ≠ŸÉŸäŸÖÿ©!', randomWisdomCongrats, 'success');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑÿ¨ŸàÿßŸáÿ±
  setTimeout(() => {
    if (currentScore === 1) {
      showQuantumNotification('üåü ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${studentName} ÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ŸÜŸàŸäÿ±!`, 'info');
    } else if (currentScore === 3) {
      showQuantumNotification('üíé ÿ´ŸÑÿßÿ´ ÿ¨ŸàÿßŸáÿ±!', `${studentName} ŸäŸÜŸäÿ± ÿßŸÑÿπŸÇŸàŸÑ!`, 'warning');
    } else if (currentScore === 5) {
      showQuantumNotification('üèõÔ∏èüëë ŸÅŸäŸÑÿ≥ŸàŸÅ ÿπÿ∏ŸäŸÖ!', `${studentName} ŸäŸÇÿ™ÿ±ÿ® ŸÖŸÜ ÿπÿ±ÿ¥ ÿßŸÑÿ≠ŸÉŸÖÿ©!`, 'battle');
    } else if (currentScore >= 7) {
      showQuantumNotification('üí≠üí´ ÿπŸÇŸÑ ŸÖÿ≥ÿ™ŸÜŸäÿ±!', `${studentName} ŸÖŸÜÿßÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸàÿßŸÑŸÖÿπÿ±ŸÅÿ©!`, 'success');
    }
  }, 1000);
  
  gameState.waitingForWisdomAnswer = false;
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖŸÉŸÖŸÑÿ©
function resetWisdomArena() {
  wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ
  
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
  }
  
  gameState.waitingForWisdomAnswer = false;
  
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    if (scoreElement) {
      scoreElement.textContent = '0';
    }
  });
  
  resetWisdomQuestionZone();
  updateWisdomScoreboard();
}

function resetWisdomQuestionZone() {
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üí≠</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑŸÇÿßÿØŸÖ</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã</p>
    </div>
  `;
}

function cancelWisdomQuestion() {
  resetWisdomQuestionZone();
  gameState.waitingForWisdomAnswer = false;
  playCosmicSound('ui-back');
  
  const cancelMessages = [
    'üåô ÿßŸÑŸÑŸäŸÑ ÿ≥ŸÉÿ™ ŸàÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸáÿØÿ£ÿ™... ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±!',
    'üìö ÿßŸÑŸÉÿ™ÿßÿ® ÿ£Ÿèÿ∫ŸÑŸÇ ŸÖÿ§ŸÇÿ™ÿßŸã... ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ© ŸÇÿßÿØŸÖÿ©!',
    'üí≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÑÿ•ÿ¥ÿ±ÿßŸÇ!',
    'üïØÔ∏è ÿßŸÑÿ¥ŸÖÿπÿ© ÿßŸÜÿ∑ŸÅÿ£ÿ™... ŸÜŸàÿ± ÿ¨ÿØŸäÿØ ÿ≥Ÿäÿ∂Ÿäÿ° ŸÇÿ±Ÿäÿ®ÿßŸã!',
    'üé≠ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿ£ŸàŸÑ... ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ÿ≥ÿ™ÿπÿØ ŸÑŸÑŸÅÿµŸÑ ÿßŸÑÿ™ÿßŸÑŸä!'
  ];
  
  const randomCancelMessage = cancelMessages[Math.floor(Math.random() * cancelMessages.length)];
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ', randomCancelMessage, 'info');
}

function updateWisdomScoreboard() {
  const scoresContainer = document.getElementById('wisdomScores');
  
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  scores.sort((a, b) => b.score - a.score);
  
  scoresContainer.innerHTML = scores.map((student, position) => `
    <div class="score-item ${position === 0 ? 'first-place' : ''}" style="
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: ${position === 0 ? 'linear-gradient(135deg, rgba(218,165,32,0.3), rgba(255,215,0,0.3))' : 'rgba(255,255,255,0.1)'};
      border-radius: 10px;
      border: ${position === 0 ? '2px solid #daa520' : '1px solid rgba(255,255,255,0.2)'};
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div style="
          background: ${position === 0 ? '#daa520' : position === 1 ? '#c0c0c0' : position === 2 ? '#cd7f32' : '#666'};
          color: ${position <= 2 ? '#000' : '#fff'};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        ">
          ${position + 1}
        </div>
        <span style="color: white; font-weight: 600;">${student.name}</span>
      </div>
      <div style="color: #daa520; font-weight: 700; font-size: 1.2rem;">
        ${student.score} üíé
      </div>
    </div>
  `).join('');
}

function createWisdomAura() {
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  for (let i = 0; i < 3; i++) {
    setTimeout(() => {
      createWisdomParticle();
    }, i * 300);
  }
}

function createWisdomParticle() {
  const effectsContainer = document.getElementById('wisdomEffects');
  if (!effectsContainer) return;
  
  const particle = document.createElement('div');
  particle.style.cssText = `
    position: absolute;
    width: 20px;
    height: 20px;
    background: radial-gradient(circle, #daa520, transparent);
    border-radius: 50%;
    left: ${Math.random() * 100}%;
    top: ${Math.random() * 100}%;
    animation: wisdomFloat 4s ease-in-out;
    pointer-events: none;
    z-index: 1000;
  `;
  
  effectsContainer.appendChild(particle);
  
  setTimeout(() => {
    if (particle.parentNode) {
      particle.parentNode.removeChild(particle);
    }
  }, 4000);
}

function pauseWisdomChallenge() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
    playCosmicSound('timer-pause');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ£ŸÖŸÑ', 'ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÜÿ™ÿ∏ÿ±... ÿßÿ≥ÿ™ÿ£ŸÜŸÅ ÿπŸÜÿØŸÖÿß ÿ™ÿ¥ÿßÿ°', 'info');
  }
}

function endWisdomChallenge() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
  }
  
  playCosmicSound('wisdom-chime');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üìö ÿ≠ÿßŸÜ ŸàŸÇÿ™ ÿ¨ŸÜŸä ÿ´ŸÖÿßÿ± ÿßŸÑÿ™ÿ£ŸÖŸÑ ŸàÿßŸÑŸÖÿπÿ±ŸÅÿ©!', 'success');
  
  // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  setTimeout(() => {
    showWisdomFinalResults();
  }, 2000);
}

function showWisdomFinalResults() {
  const wisdomArena = document.getElementById('wisdomArena');
  
  const finalScores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  }).sort((a, b) => b.score - a.score);
  
  const winner = finalScores[0];
  
  wisdomArena.innerHTML = `
    <div class="final-results">
      <div class="results-container">
        <div class="victory-header">
          <div class="victory-crown">üèõÔ∏è</div>
          <h1 class="victory-title">ÿßŸÜÿ™Ÿáÿ™ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!</h1>
          <div class="wisdom-effects-final">üíéüíéüíé</div>
        </div>
        
        <div class="winner-announcement">
          <h2 style="color: #daa520; font-size: 2.5rem; margin: 1rem 0;">
            üëë ÿ≠ŸÉŸäŸÖ ÿßŸÑÿπÿµÿ±: ${winner.name}
          </h2>
          <div style="color: #ffd700; font-size: 2rem; font-weight: 700;">
            ${winner.score} ÿ¨ŸàŸáÿ±ÿ© ÿ≠ŸÉŸÖÿ© üíé
          </div>
        </div>
        
        <div class="final-scoreboard">
          <h3 style="color: #daa520; margin-bottom: 1rem;">üèõÔ∏è ŸÇÿµÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿä</h3>
          ${finalScores.map((student, index) => `
            <div class="final-score-item" style="
              display: flex;
              justify-content: space-between;
              padding: 1rem;
              margin: 0.5rem 0;
              background: ${index === 0 ? 'linear-gradient(135deg, rgba(218,165,32,0.4), rgba(255,215,0,0.4))' : 'rgba(255,255,255,0.1)'};
              border-radius: 15px;
              border: ${index === 0 ? '3px solid #daa520' : '1px solid rgba(255,255,255,0.2)'};
            ">
              <span style="color: white; font-weight: 600;">${index + 1}. ${student.name}</span>
              <span style="color: #daa520; font-weight: 700;">${student.score} üíé</span>
            </div>
          `).join('')}
        </div>
        
        <div class="results-actions">
          <button class="wisdom-btn" onclick="backToKingdomDashboard()" style="margin: 1rem;">
            üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
          </button>
          <button class="wisdom-btn secondary" onclick="startWisdomChallenge()" style="margin: 1rem;">
            üîÑ ÿ±ÿ≠ŸÑÿ© ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ©
          </button>
        </div>
      </div>
    </div>
  `;
  
  createWisdomAura();
  playSoundSequence(['wisdom-chime', 'ancient-bell', 'knowledge-unlock'], 1000);
  
  setTimeout(() => {
    showQuantumNotification('üëë ŸÅŸäŸÑÿ≥ŸàŸÅ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!', `${winner.name} ŸÜÿßŸÑ ŸÑŸÇÿ® ÿ≠ŸÉŸäŸÖ ÿßŸÑÿπÿµÿ±! üèõÔ∏èüíé`, 'success');
  }, 500);
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿØÿßŸÑÿ© ŸÑÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸÖÿßŸÑŸÉ
function activateRealm(realmType) {
  console.log('üåü ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸÖŸÑŸÉÿ©:', realmType);
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
  if (!selectedStudentsList || selectedStudentsList.length < 2) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑÿØÿÆŸàŸÑ ÿßŸÑŸÖŸÖÿßŸÑŸÉ', 'warning');
    loadClassSelection();
    return;
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  switch(realmType) {
    case 'lightning':
      startLightningChallenge();
      break;
    case 'wisdom':
      startWisdomChallenge();
      break;
    case 'battle':
      startBattleChallenge();
      break;
    case 'mystery':
      startMysteryChallenge();
      break;
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
updateSoundButton();

// ÿ™ÿ¨ÿ±ÿ®ÿ©// ...existing code...

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÖÿÆÿµÿµ ŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©
const wisdomCSS = `
  .wisdom-arena {
    position: fixed;
    top: 80px;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #1a1a2e 0%, #2d2d44 30%, #3a3a5c 60%, #4a4a6a 100%);
    overflow-y: auto;
    z-index: 1000;
    animation: wisdomEnter 1s ease-out;
  }

  .wisdom-arena-container {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
  }

  .wisdom-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(218, 165, 32, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 20px;
    padding: 1.5rem 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(218, 165, 32, 0.2);
  }

  .wisdom-title-container {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .wisdom-icon {
    font-size: 4rem;
    background: linear-gradient(45deg, #daa520, #ffd700);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: wisdomPulse 3s ease-in-out infinite;
  }

  .wisdom-title {
    font-size: 3rem;
    font-weight: 900;
    color: #daa520;
    text-shadow: 0 0 20px rgba(218, 165, 32, 0.7);
    margin: 0;
  }

  .wisdom-subtitle {
    font-size: 1.2rem;
    color: #ffd700;
    margin: 0.5rem 0 0 0;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .wisdom-timer-container .timer-circle {
    border-color: rgba(218, 165, 32, 0.5);
    background: radial-gradient(circle, rgba(218, 165, 32, 0.2), transparent);
  }

  .wisdom-btn {
    background: linear-gradient(135deg, #daa520, #b8860b);
    border: 2px solid rgba(218, 165, 32, 0.5);
    color: #fff;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(218, 165, 32, 0.3);
  }

  .wisdom-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(218, 165, 32, 0.5);
  }

  .philosophers-zone {
    background: rgba(218, 165, 32, 0.1);
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    backdrop-filter: blur(10px);
  }

  .philosopher-card {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.1));
    border: 2px solid rgba(218, 165, 32, 0.3);
    border-radius: 15px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
  }

  .philosopher-card:hover {
    transform: translateY(-5px);
    border-color: rgba(218, 165, 32, 0.7);
    box-shadow: 0 10px 25px rgba(218, 165, 32, 0.3);
  }

  .philosopher-card.wisdom-correct {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.4), rgba(255, 215, 0, 0.4));
    border-color: #daa520;
    animation: wisdomCorrect 0.8s ease-out;
  }

  .wisdom-question-zone {
    background: radial-gradient(circle, rgba(218, 165, 32, 0.1), transparent);
    border: 3px solid rgba(218, 165, 32, 0.5);
    border-radius: 25px;
    padding: 2rem;
    margin-bottom: 2rem;
    text-align: center;
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .wisdom-active {
    background: linear-gradient(135deg, rgba(218, 165, 32, 0.2), rgba(255, 215, 0, 0.2));
    animation: wisdomGlow 2s ease-in-out infinite;
  }

  @keyframes wisdomEnter {
    0% { opacity: 0; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
  }

  @keyframes wisdomPulse {
    0%, 100% { 
      filter: drop-shadow(0 0 10px #daa520);
      transform: scale(1);
    }
    50% { 
      filter: drop-shadow(0 0 20px #ffd700);
      transform: scale(1.05);
    }
  }

  @keyframes wisdomCorrect {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(218, 165, 32, 0.8); }
    100% { transform: scale(1); }
  }

  @keyframes wisdomGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
      border-color: rgba(218, 165, 32, 0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(218, 165, 32, 0.7);
      border-color: rgba(218, 165, 32, 0.9);
    }
  }
`;

// ÿ•ÿ∂ÿßŸÅÿ© CSS ŸÑŸÑÿ±ÿ£ÿ≥
const wisdomStyle = document.createElement('style');
wisdomStyle.textContent = wisdomCSS;
document.head.appendChild(wisdomStyle);

function startWisdomChallenge() {
  console.log('üß† ÿ®ÿØÿ° ÿ™ÿ≠ÿØŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!');
  
  // Wisdom realm entrance effects
  playSoundSequence([
    'wisdom-chime',
    'ancient-bell',
    'brain-activate'
  ], 800);
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ© Ÿàÿ•ÿ∏Ÿáÿßÿ± ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿØÿ±ÿßŸÖŸäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  const enterMessages = [
    'üß† ÿ£ÿ®Ÿàÿßÿ® ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿπÿ∏ŸäŸÖÿ© ÿ™ŸÅÿ™ÿ≠ ÿ£ŸÖÿßŸÖŸÉŸÖ!',
    'üìö ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ£ŸÑŸÅ ÿ≠ŸÉŸÖÿ© ÿ™ÿ±ÿ≠ÿ® ÿ®ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÜŸäÿ±ÿ©!',
    'üí≠ ÿ£ŸÜŸÅÿßÿ≥ ÿßŸÑŸÅŸÑÿßÿ≥ŸÅÿ© ÿßŸÑŸÇÿØŸÖÿßÿ° ÿ™ÿ≠Ÿäÿ∑ ÿ®ŸÉŸÖ!',
    'üåü ŸÜŸàÿ± ÿßŸÑŸÖÿπÿ±ŸÅÿ© Ÿäÿ∂Ÿäÿ° ÿØÿ±Ÿàÿ®ŸÉŸÖ!',
    'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿπŸÖŸäŸÇÿ© Ÿäÿ≥ÿ™ŸÇÿ®ŸÑŸÉŸÖ!',
    'üîÆ ŸÉÿ±Ÿäÿ≥ÿ™ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© Ÿäÿ™ŸàŸáÿ¨ ÿ®ÿ≠ÿ∂Ÿàÿ±ŸÉŸÖ!',
    'üìñ ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ™ŸÉÿ™ÿ® ÿ£ÿ≥ŸÖÿßÿ°ŸÉŸÖ!'
  ];
  
  const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
  
  // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿ™ÿ≠ÿØŸä ÿßŸÑÿ≠ŸÉŸÖÿ©
  createWisdomArena();
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿØÿÆŸàŸÑ
  createWisdomAura();
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿØÿÆŸàŸÑ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ÿ∏Ÿáÿßÿ± ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('üß† ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉŸÖ ŸÅŸä ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${randomEnterMessage} (${studentsCount} ÿπŸÇŸÑ ŸÖŸÅŸÉÿ± ÿ¨ÿßŸáÿ≤!)`, 'wisdom');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
  setTimeout(() => {
    showQuantumNotification('üí° ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑŸÅŸÉÿ±Ÿä ÿßŸÑÿπŸÖŸäŸÇ!', 'ÿßŸÑÿ£ÿπŸÖŸÇ ŸÅŸä ÿßŸÑÿ™ŸÅŸÉŸäÿ± Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'info');
  }, 2000);
  
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑŸÖŸÅŸÉÿ±ŸäŸÜ ÿßŸÑÿπÿ∏ÿßŸÖ!', 'ŸÅŸÉÿ±Ÿàÿß ÿ®ÿπŸÖŸÇ Ÿàÿ™ÿ£ŸÖŸÑ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿßÿ¨ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿü üëë', 'warning');
  }, 4000);
}

function createWisdomArena() {
  const mainApp = document.getElementById('mainApp');
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
  let wisdomArena = document.getElementById('wisdomArena');
  
  if (wisdomArena) {
    // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©ÿå ŸÅŸÇÿ∑ ÿ£ÿ∏Ÿáÿ±Ÿáÿß Ÿàÿ£ÿπÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
    wisdomArena.style.display = 'block';
    resetWisdomArena();
  } else {
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ©
    wisdomArena = document.createElement('div');
    wisdomArena.id = 'wisdomArena';
    wisdomArena.className = 'wisdom-arena';
    
    wisdomArena.innerHTML = `
      <div class="wisdom-arena-container">
        <!-- ÿ±ÿ£ÿ≥ ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-header">
          <div class="wisdom-title-container">
            <div class="wisdom-icon">üß†</div>
            <div>
              <h1 class="wisdom-title">ŸÖŸÖŸÑŸÉÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©</h1>
              <p class="wisdom-subtitle">ÿ™ÿ≠ÿØŸä ÿßŸÑÿπŸÇŸàŸÑ ÿßŸÑŸÖŸÅŸÉÿ±ÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿßÿ°</p>
            </div>
          </div>
          
          <!-- ŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
          <div class="wisdom-timer-container">
            <div class="timer-circle">
              <div class="timer-text" id="wisdomTimer">10:00</div>
              <div class="timer-label">ÿØŸÇÿßÿ¶ŸÇ</div>
            </div>
          </div>
          
          <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
          <div class="wisdom-controls">
            <button class="wisdom-btn" id="startWisdomQuestionBtn" onclick="startNewWisdomQuestion()">
              üß† ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©
            </button>
            <button class="wisdom-btn secondary" onclick="pauseWisdomChallenge()">
              ‚è∏Ô∏è ÿ•ŸäŸÇÿßŸÅ ŸÖÿ§ŸÇÿ™
            </button>
            <button class="wisdom-btn danger" onclick="endWisdomChallenge()">
              üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ™ÿ≠ÿØŸä
            </button>
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ -->
        <div class="philosophers-zone">
          <div class="zone-title">üéì ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖŸÅŸÉÿ±ŸàŸÜ</div>
          <div class="philosophers-grid" id="philosophersGrid">
            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿÆÿ™ÿßÿ±ŸäŸÜ -->
          </div>
        </div>
        
        <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© -->
        <div class="wisdom-question-zone">
          <div class="question-display" id="wisdomQuestionDisplay">
            <div class="waiting-state">
              <div class="waiting-icon">üí≠</div>
              <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑŸÇÿßÿØŸÖ</h3>
              <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã</p>
            </div>
          </div>
        </div>
        
        <!-- ŸÑŸàÿ≠ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-scoreboard">
          <div class="scoreboard-title">üèõÔ∏è ŸÇÿµÿ± ÿßŸÑÿ≠ŸÉŸÖÿ©</div>
          <div class="scores-container" id="wisdomScores">
            <!-- ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
          </div>
        </div>
        
        <!-- ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÉŸÖÿ© -->
        <div class="wisdom-effects" id="wisdomEffects"></div>
      </div>
    `;
    
    mainApp.appendChild(wisdomArena);
  }
  
  // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
  initializePhilosophers();
  
  // ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™
  startWisdomTimer();
}

// ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ≠ŸÉŸÖÿßÿ° ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ŸäŸÜ
function initializePhilosophers() {
  const philosophersGrid = document.getElementById('philosophersGrid');
  philosophersGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const philosopherCard = document.createElement('div');
    philosopherCard.className = 'philosopher-card';
    philosopherCard.id = `philosopher-${index}`;
    philosopherCard.onclick = () => selectPhilosopher(index, studentName);
    
    philosopherCard.innerHTML = `
      <div class="philosopher-name">${studentName}</div>
      <div class="philosopher-score" id="wisdom-score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,215,0,0.7); margin-top: 0.5rem;">ÿ¨ŸàÿßŸáÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© üíé</div>
    `;
    
    philosophersGrid.appendChild(philosopherCard);
  });
  
  updateWisdomScoreboard();
}

// ÿ®ÿØÿ° ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä ŸÑŸÑÿ≠ŸÉŸÖÿ©
let wisdomTimerInterval;
let wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ

function startWisdomTimer() {
  const timerElement = document.getElementById('wisdomTimer');
  
  wisdomTimerInterval = setInterval(() => {
    wisdomTimeLeft--;
    
    const minutes = Math.floor(wisdomTimeLeft / 60);
    const seconds = wisdomTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ŸÅŸÑÿ≥ŸÅŸäÿ© ÿØŸàÿ±Ÿäÿ©
    if (wisdomTimeLeft === 480) { // 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ™ÿ®ŸÇŸäÿ©
      showQuantumNotification('üí≠ 8 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ™ÿ£ŸÖŸÑ!', 'üåü ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ÿ™ÿ®ŸÑŸàÿ± ŸÅŸä ÿπŸÇŸàŸÑŸÉŸÖ ÿßŸÑŸÜŸäÿ±ÿ©!', 'info');
    } else if (wisdomTimeLeft === 360) { // 6 ÿØŸÇÿßÿ¶ŸÇ
      showQuantumNotification('üß† ŸÖŸÜÿ™ÿµŸÅ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üí° ÿßŸÑŸÖÿπÿ±ŸÅÿ© ÿ™ŸÜŸÖŸà ŸÖÿπ ŸÉŸÑ ÿ™ÿ£ŸÖŸÑ!', 'warning');
    } else if (wisdomTimeLeft === 240) { // 4 ÿØŸÇÿßÿ¶ŸÇ
      showQuantumNotification('üìö 4 ÿØŸÇÿßÿ¶ŸÇ ŸÖŸÜ ÿßŸÑÿ•ŸÑŸáÿßŸÖ!', 'üéØ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÇÿ™ÿ±ÿ® ŸÖŸÜ ŸÇŸÑŸàÿ®ŸÉŸÖ!', 'battle');
    } else if (wisdomTimeLeft === 120) { // ÿØŸÇŸäŸÇÿ™ÿßŸÜ
      showQuantumNotification('üíé ÿØŸÇŸäŸÇÿ™ÿßŸÜ ÿ£ÿÆŸäÿ±ÿ™ÿßŸÜ!', 'üî• ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ŸÑŸÑÿ™ŸÅŸÉŸäÿ± ÿßŸÑÿπŸÖŸäŸÇ!', 'warning');
    }
    
    // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàÿµŸàÿ™Ÿäÿ©
    if (wisdomTimeLeft <= 60 && wisdomTimeLeft > 0) {
      if (wisdomTimeLeft % 10 === 0) {
        playCosmicSound('wisdom-chime');
        createWisdomParticle();
      }
      timerElement.style.color = '#daa520';
      timerElement.parentElement.style.borderColor = '#daa520';
    }
    
    if (wisdomTimeLeft <= 0) {
      endWisdomChallenge();
    }
  }, 1000);
}

// ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ
function startNewWisdomQuestion() {
  playCosmicSound('wisdom-chime');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä
  const wisdomQuestionMessages = [
    'üí≠ ÿ≥ÿ§ÿßŸÑ ŸÅŸÑÿ≥ŸÅŸä ÿπŸÖŸäŸÇ Ÿäÿ™ÿ∑ŸÑÿ® ÿ™ÿ£ŸÖŸÑÿßŸã ÿØŸÇŸäŸÇÿßŸã!',
    'üåü ŸÅŸÉÿ±Ÿàÿß ÿ®ÿπŸÖŸÇ... ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÅŸä ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ!',
    'üß† ÿπŸÇŸàŸÑŸÉŸÖ ŸÖŸÉÿ™ÿ®ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿπÿ±ŸÅÿ© ŸàÿßŸÑÿ≠ŸÉŸÖÿ©!',
    'üí° ÿßŸÑÿ•ŸÑŸáÿßŸÖ ÿßŸÑÿ¢ŸÜ... ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©!',
    'üìö ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÖŸÅÿ™Ÿàÿ≠ ÿ£ŸÖÿßŸÖŸÉŸÖ!',
    'üé≠ ŸÖÿ≥ÿ±ÿ≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑÿπŸÖŸäŸÇÿ© Ÿäÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ!',
    'üíé ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑÿπŸÇŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÜŸäÿ±!'
  ];
  
  const randomWisdomMessage = wisdomQuestionMessages[Math.floor(Math.random() * wisdomQuestionMessages.length)];
  
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display question-active wisdom-active';
  
  questionDisplay.innerHTML = `
    <div class="wisdom-question-content">
      <div class="question-icon">ü§î</div>
      <h2>ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ¨ÿßŸáÿ≤!</h2>
      <p style="font-size: 1.2rem; color: #daa520; margin: 1rem 0;">
        ÿßÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑŸÉ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã ÿßŸÑÿ¢ŸÜ
      </p>
      <div class="wisdom-instruction-text">
        ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ∞Ÿä ŸäŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿ•ÿ¨ÿßÿ®ÿ© ÿ£Ÿà ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ ŸÑÿ•ÿπÿ∑ÿßÿ¶Ÿá ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© üíé
      </div>
      <button class="wisdom-btn" onclick="cancelWisdomQuestion()" style="margin-top: 1rem;">
        ‚ùå ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ
      </button>
    </div>
  `;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  createWisdomAura();
  
  // ÿ™ŸÅÿπŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ©
  gameState.waitingForWisdomAnswer = true;
  
  // ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿπŸÑŸÖ ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('ü§î ÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ≠ŸÉŸÖÿ© ŸÜÿ¥ÿ∑', randomWisdomMessage, 'info');
  
  // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ŸÅŸäÿ≤Ÿäÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ®
  setTimeout(() => {
    showQuantumNotification('üéØ ŸÑŸÑÿ≠ŸÉŸÖÿßÿ°', 'ÿ™ÿ£ŸÖŸÑŸàÿß ÿ®ÿπŸÖŸÇ! ŸÖŸÜ ÿ≥Ÿäÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¨ŸàŸáÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©ÿü üíé', 'warning');
  }, 1500);
}

// ÿßÿÆÿ™Ÿäÿßÿ± ÿ≠ŸÉŸäŸÖ (ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ© ÿ£Ÿà ÿ™ŸÅŸÉŸäÿ± ÿπŸÖŸäŸÇ)
function selectPhilosopher(index, studentName) {
  if (!gameState.waitingForWisdomAnswer) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿ®ÿØÿ° ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØ ÿ£ŸàŸÑÿßŸã', 'warning');
    return;
  }
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ™ŸáŸÜÿ¶ÿ© ŸÅŸÑÿ≥ŸÅŸäÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  const wisdomCongratsMessages = [
    `üíéüß† ${studentName} ŸÅŸÉÿ± ÿ®ÿπŸÖŸÇ ŸÅŸäŸÑÿ≥ŸàŸÅ ÿ≠ŸÇŸäŸÇŸä!`,
    `üåü ${studentName} ÿ£ÿ∂ÿßÿ° ÿßŸÑÿπŸÇŸàŸÑ ÿ®ÿ≠ŸÉŸÖÿ™Ÿá ÿßŸÑŸÜŸäÿ±ÿ©!`,
    `üí≠üìö ${studentName} ŸÉÿ™ÿ® ÿµŸÅÿ≠ÿ© ÿ¨ÿØŸäÿØÿ© ŸÅŸä ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠ŸÉŸÖÿ©!`,
    `üé≠ ${studentName} ÿ£ÿØŸáÿ¥ ÿßŸÑÿ¨ŸÖŸäÿπ ÿ®ÿ™ŸÅŸÉŸäÿ±Ÿá ÿßŸÑÿπŸÖŸäŸÇ!`,
    `üí° ${studentName} ÿ£ÿ∂ÿßÿ° ÿ¥ŸÖÿπÿ© ÿßŸÑŸÖÿπÿ±ŸÅÿ© ŸÅŸä ÿßŸÑŸÇŸÑŸàÿ®!`,
    `üèõÔ∏è ${studentName} ÿ®ŸÜŸâ ŸÇÿµÿ±ÿßŸã ŸÖŸÜ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑŸÜÿ®ŸäŸÑÿ©!`,
    `üîÆ ${studentName} ŸÉÿ¥ŸÅ ÿ£ÿ≥ÿ±ÿßÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿÆŸÅŸäÿ©!`,
    `üìñ ${studentName} ŸÇÿ±ÿ£ ŸÖŸÜ ŸÉÿ™ÿßÿ® ÿßŸÑÿ≠Ÿäÿßÿ© ÿ®ÿπŸäŸÜ ÿßŸÑÿ®ÿµŸäÿ±ÿ©!`
  ];
  
  const randomWisdomCongrats = wisdomCongratsMessages[Math.floor(Math.random() * wisdomCongratsMessages.length)];
  
  // ÿ•ÿ∂ÿßŸÅÿ© ÿ¨ŸàŸáÿ±ÿ© ÿ≠ŸÉŸÖÿ© ŸÑŸÑÿ∑ÿßŸÑÿ®
  const scoreElement = document.getElementById(`wisdom-score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸàŸÖÿ±ÿ¶Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  const philosopherCard = document.getElementById(`philosopher-${index}`);
  philosopherCard.classList.add('wisdom-correct');
  
  setTimeout(() => {
    philosopherCard.classList.remove('wisdom-correct');
  }, 1000);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿµŸàÿ™Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  playSoundSequence(['wisdom-chime', 'ancient-bell', 'knowledge-unlock'], 300);
  
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑÿ®ÿµÿ±Ÿäÿ©
  createWisdomParticle();
  createWisdomAura();
  
  // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨
  updateWisdomScoreboard();
  
  // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ≥ÿ§ÿßŸÑ
  resetWisdomQuestionZone();
  
  // ÿ•ÿ¥ÿπÿßÿ± ÿ±ÿ¶Ÿäÿ≥Ÿä ŸÖÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
  showQuantumNotification('üíé ÿ•ÿ¨ÿßÿ®ÿ© ÿ≠ŸÉŸäŸÖÿ©!', randomWisdomCongrats, 'success');
  
  // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑÿ¨ŸàÿßŸáÿ±
  setTimeout(() => {
    if (currentScore === 1) {
      showQuantumNotification('üåü ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', `${studentName} ÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ™ŸÜŸàŸäÿ±!`, 'info');
    } else if (currentScore === 3) {
      showQuantumNotification('üíé ÿ´ŸÑÿßÿ´ ÿ¨ŸàÿßŸáÿ±!', `${studentName} ŸäŸÜŸäÿ± ÿßŸÑÿπŸÇŸàŸÑ!`, 'warning');
    } else if (currentScore === 5) {
      showQuantumNotification('üèõÔ∏èüëë ŸÅŸäŸÑÿ≥ŸàŸÅ ÿπÿ∏ŸäŸÖ!', `${studentName} ŸäŸÇÿ™ÿ±ÿ® ŸÖŸÜ ÿπÿ±ÿ¥ ÿßŸÑÿ≠ŸÉŸÖÿ©!`, 'battle');
    } else if (currentScore >= 7) {
      showQuantumNotification('üí≠üí´ ÿπŸÇŸÑ ŸÖÿ≥ÿ™ŸÜŸäÿ±!', `${studentName} ŸÖŸÜÿßÿ±ÿ© ÿßŸÑÿ≠ŸÉŸÖÿ© ŸàÿßŸÑŸÖÿπÿ±ŸÅÿ©!`, 'success');
    }
  }, 1000);
  
  gameState.waitingForWisdomAnswer = false;
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖŸÉŸÖŸÑÿ©
function resetWisdomArena() {
  wisdomTimeLeft = 600; // 10 ÿØŸÇÿßÿ¶ŸÇ
  
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
  }
  
  gameState.waitingForWisdomAnswer = false;
  
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    if (scoreElement) {
      scoreElement.textContent = '0';
    }
  });
  
  resetWisdomQuestionZone();
  updateWisdomScoreboard();
}

function resetWisdomQuestionZone() {
  const questionDisplay = document.getElementById('wisdomQuestionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">üí≠</div>
      <h3>ÿßÿ≥ÿ™ÿπÿØÿßÿØ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÅŸÑÿ≥ŸÅŸä ÿßŸÑŸÇÿßÿØŸÖ</h3>
      <p>ÿßÿ∂ÿ∫ÿ∑ "ÿ≥ÿ§ÿßŸÑ ÿ≠ŸÉŸÖÿ©" ÿπŸÜÿØŸÖÿß ÿ™ŸÉŸàŸÜ ÿ¨ÿßŸáÿ≤ÿßŸã ŸÑÿ∑ÿ±ÿ≠ ÿ≥ÿ§ÿßŸÑ ÿπŸÖŸäŸÇ ÿ¥ŸÅŸàŸäÿßŸã</p>
    </div>
  `;
}

function cancelWisdomQuestion() {
  resetWisdomQuestionZone();
  gameState.waitingForWisdomAnswer = false;
  playCosmicSound('ui-back');
  
  const cancelMessages = [
    'üåô ÿßŸÑŸÑŸäŸÑ ÿ≥ŸÉÿ™ ŸàÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸáÿØÿ£ÿ™... ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ ŸÅŸä ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±!',
    'üìö ÿßŸÑŸÉÿ™ÿßÿ® ÿ£Ÿèÿ∫ŸÑŸÇ ŸÖÿ§ŸÇÿ™ÿßŸã... ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ© ŸÇÿßÿØŸÖÿ©!',
    'üí≠ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿ™ŸÜÿ™ÿ∏ÿ± ÿßŸÑŸÑÿ≠ÿ∏ÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÑÿ•ÿ¥ÿ±ÿßŸÇ!',
    'üïØÔ∏è ÿßŸÑÿ¥ŸÖÿπÿ© ÿßŸÜÿ∑ŸÅÿ£ÿ™... ŸÜŸàÿ± ÿ¨ÿØŸäÿØ ÿ≥Ÿäÿ∂Ÿäÿ° ŸÇÿ±Ÿäÿ®ÿßŸã!',
    'üé≠ ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿ£ŸàŸÑ... ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ÿ≥ÿ™ÿπÿØ ŸÑŸÑŸÅÿµŸÑ ÿßŸÑÿ™ÿßŸÑŸä!'
  ];
  
  const randomCancelMessage = cancelMessages[Math.floor(Math.random() * cancelMessages.length)];
  showQuantumNotification('‚ùå ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≥ÿ§ÿßŸÑ', randomCancelMessage, 'info');
}

function updateWisdomScoreboard() {
  const scoresContainer = document.getElementById('wisdomScores');
  
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  scores.sort((a, b) => b.score - a.score);
  
  scoresContainer.innerHTML = scores.map((student, position) => `
    <div class="score-item ${position === 0 ? 'first-place' : ''}" style="
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: ${position === 0 ? 'linear-gradient(135deg, rgba(218,165,32,0.3), rgba(255,215,0,0.3))' : 'rgba(255,255,255,0.1)'};
      border-radius: 10px;
      border: ${position === 0 ? '2px solid #daa520' : '1px solid rgba(255,255,255,0.2)'};
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div style="
          background: ${position === 0 ? '#daa520' : position === 1 ? '#c0c0c0' : position === 2 ? '#cd7f32' : '#666'};
          color: ${position <= 2 ? '#000' : '#fff'};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        ">
          ${position + 1}
        </div>
        <span style="color: white; font-weight: 600;">${student.name}</span>
      </div>
      <div style="color: #daa520; font-weight: 700; font-size: 1.2rem;">
        ${student.score} üíé
      </div>
    </div>
  `).join('');
}

function createWisdomAura() {
  // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ© ŸÑŸÑÿ≠ŸÉŸÖÿ©
  for (let i = 0; i < 3; i++) {
    setTimeout(() => {
      createWisdomParticle();
    }, i * 300);
  }
}

function createWisdomParticle() {
  const effectsContainer = document.getElementById('wisdomEffects');
  if (!effectsContainer) return;
  
  const particle = document.createElement('div');
  particle.style.cssText = `
    position: absolute;
    width: 20px;
    height: 20px;
    background: radial-gradient(circle, #daa520, transparent);
    border-radius: 50%;
    left: ${Math.random() * 100}%;
    top: ${Math.random() * 100}%;
    animation: wisdomFloat 4s ease-in-out;
    pointer-events: none;
    z-index: 1000;
  `;
  
  effectsContainer.appendChild(particle);
  
  setTimeout(() => {
    if (particle.parentNode) {
      particle.parentNode.removeChild(particle);
    }
  }, 4000);
}

function pauseWisdomChallenge() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
    wisdomTimerInterval = null;
    playCosmicSound('timer-pause');
    showQuantumNotification('‚è∏Ô∏è ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ£ŸÖŸÑ', 'ÿßŸÑÿ≠ŸÉŸÖÿ© ÿ™ŸÜÿ™ÿ∏ÿ±... ÿßÿ≥ÿ™ÿ£ŸÜŸÅ ÿπŸÜÿØŸÖÿß ÿ™ÿ¥ÿßÿ°', 'info');
  }
}

function endWisdomChallenge() {
  if (wisdomTimerInterval) {
    clearInterval(wisdomTimerInterval);
  }
  
  playCosmicSound('wisdom-chime');
  showQuantumNotification('üèÅ ÿßŸÜÿ™Ÿáÿ™ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!', 'üìö ÿ≠ÿßŸÜ ŸàŸÇÿ™ ÿ¨ŸÜŸä ÿ´ŸÖÿßÿ± ÿßŸÑÿ™ÿ£ŸÖŸÑ ŸàÿßŸÑŸÖÿπÿ±ŸÅÿ©!', 'success');
  
  // ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©
  setTimeout(() => {
    showWisdomFinalResults();
  }, 2000);
}

function showWisdomFinalResults() {
  const wisdomArena = document.getElementById('wisdomArena');
  
  const finalScores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`wisdom-score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  }).sort((a, b) => b.score - a.score);
  
  const winner = finalScores[0];
  
  wisdomArena.innerHTML = `
    <div class="final-results">
      <div class="results-container">
        <div class="victory-header">
          <div class="victory-crown">üèõÔ∏è</div>
          <h1 class="victory-title">ÿßŸÜÿ™Ÿáÿ™ ÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ŸÉŸÖÿ©!</h1>
          <div class="wisdom-effects-final">üíéüíéüíé</div>
        </div>
        
        <div class="winner-announcement">
          <h2 style="color: #daa520; font-size: 2.5rem; margin: 1rem 0;">
            üëë ÿ≠ŸÉŸäŸÖ ÿßŸÑÿπÿµÿ±: ${winner.name}
          </h2>
          <div style="color: #ffd700; font-size: 2rem; font-weight: 700;">
            ${winner.score} ÿ¨ŸàŸáÿ±ÿ© ÿ≠ŸÉŸÖÿ© üíé
          </div>
        </div>
        
        <div class="final-scoreboard">
          <h3 style="color: #daa520; margin-bottom: 1rem;">üèõÔ∏è ŸÇÿµÿ± ÿßŸÑÿ≠ŸÉŸÖÿ© ÿßŸÑŸÜŸáÿßÿ¶Ÿä</h3>
          ${finalScores.map((student, index) => `
            <div class="final-score-item" style="
              display: flex;
              justify-content: space-between;
              padding: 1rem;
              margin: 0.5rem 0;
              background: ${index === 0 ? 'linear-gradient(135deg, rgba(218,165,32,0.4), rgba(255,215,0,0.4))' : 'rgba(255,255,255,0.1)'};
              border-radius: 15px;
              border: ${index === 0 ? '3px solid #daa520' : '1px solid rgba(255,255,255,0.2)'};
            ">
              <span style="color: white; font-weight: 600;">${index + 1}. ${student.name}</span>
              <span style="color: #daa520; font-weight: 700;">${student.score} üíé</span>
            </div>
          `).join('')}
        </div>
        
        <div class="results-actions">
          <button class="wisdom-btn" onclick="backToKingdomDashboard()" style="margin: 1rem;">
            üè† ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÖŸÖŸÑŸÉÿ©
          </button>
          <button class="wisdom-btn secondary" onclick="startWisdomChallenge()" style="margin: 1rem;">
            üîÑ ÿ±ÿ≠ŸÑÿ© ÿ≠ŸÉŸÖÿ© ÿ¨ÿØŸäÿØÿ©
          </button>
        </div>
      </div>
    </div>
  `;
  
  createWisdomAura();
  playSoundSequence(['wisdom-chime', 'ancient-bell', 'knowledge-unlock'], 1000);
  
  setTimeout(() => {
    showQuantumNotification('üëë ŸÅŸäŸÑÿ≥ŸàŸÅ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ!', `${winner.name} ŸÜÿßŸÑ ŸÑŸÇÿ® ÿ≠ŸÉŸäŸÖ ÿßŸÑÿπÿµÿ±! üèõÔ∏èüíé`, 'success');
  }, 500);
}

// ÿ•ÿ∂ÿßŸÅÿ© ÿØÿßŸÑÿ© ŸÑÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸÖÿßŸÑŸÉ
function activateRealm(realmType) {
  console.log('üåü ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸÖŸÑŸÉÿ©:', realmType);
  
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∑ŸÑÿßÿ® ŸÖÿÆÿ™ÿßÿ±ŸäŸÜ
  if (!selectedStudentsList || selectedStudentsList.length < 2) {
    showQuantumNotification('‚ö†Ô∏è ÿ™ŸÜÿ®ŸäŸá', 'Ÿäÿ¨ÿ® ÿßÿÆÿ™Ÿäÿßÿ± ÿ∑ÿßŸÑÿ®ŸäŸÜ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ ŸÑÿØÿÆŸàŸÑ ÿßŸÑŸÖŸÖÿßŸÑŸÉ', 'warning');
    loadClassSelection();
    return;
  }
  
  // ÿ•ÿÆŸÅÿßÿ° ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖŸÖÿßŸÑŸÉ
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  switch(realmType) {
    case 'lightning':
      startLightningChallenge();
      break;
    case 'wisdom':
      startWisdomChallenge();
      break;
    case 'battle':
      startBattleChallenge();
      break;
    case 'mystery':
      startMysteryChallenge();
      break;
  }
}

// ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿßŸÑÿµŸàÿ™
updateSoundButton();

// ÿ™ÿ¨ÿ±ÿ®ÿ©
