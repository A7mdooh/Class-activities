<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ† Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© | Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
      --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      --dark-gradient: linear-gradient(135deg, #232526 0%, #414345 100%);
      
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --text-light: #a0aec0;
      --bg-primary: #f7fafc;
      --bg-secondary: #edf2f7;
      --border-radius: 20px;
      --shadow-light: 0 10px 25px rgba(0,0,0,0.1);
      --shadow-heavy: 0 20px 40px rgba(0,0,0,0.15);
      
      --arabic-font: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--arabic-font);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
      padding-top: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
    }

    /* ===== PARTICLES BACKGROUND ===== */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
    }

    /* ==== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ==== */
    .cosmic-control-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(255, 215, 0, 0.5);
      padding: 1rem 2rem;
      z-index: 99999;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.7);
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    .control-buttons-container {
      display: flex !important;
      justify-content: space-between;
      align-items: center;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
      height: 60px;
    }

    .app-title-cosmic {
      display: flex !important;
      align-items: center;
      gap: 1rem;
      color: white;
      visibility: visible !important;
    }

    .title-icon {
      font-size: 2rem;
      animation: cosmic-glow 2s ease-in-out infinite alternate;
    }

    .title-text {
      font-size: 1.5rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #00ffff, #ff69b4);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: cosmic-text 3s ease-in-out infinite;
    }

    .version-badge {
      background: linear-gradient(45deg, #ff6b35, #f7931e);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4);
    }

    .control-group-cosmic {
      display: flex !important;
      gap: 0.8rem;
      align-items: center;
      visibility: visible !important;
    }

    .cosmic-control-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 215, 0, 0.5);
      color: white;
      padding: 0.8rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.2rem;
      min-width: 4rem;
      height: 4rem;
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: visible !important;
      opacity: 1 !important;
      z-index: 99999;
      gap: 0.2rem;
      overflow: hidden;
    }

    .cosmic-control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .cosmic-control-btn:hover::before {
      left: 100%;
    }

    .cosmic-control-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: #ffd700;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
    }

    .cosmic-control-btn:active {
      transform: translateY(-1px) scale(1.02);
    }

    .btn-icon {
      font-size: 1.4rem;
      transition: transform 0.3s ease;
    }

    .cosmic-control-btn:hover .btn-icon {
      transform: scale(1.2);
    }

    .btn-tooltip {
      font-size: 0.7rem;
      font-weight: 600;
      opacity: 0.8;
    }

    @keyframes cosmic-glow {
      0% { text-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700; }
      100% { text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700; }
    }

    @keyframes cosmic-text {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ØªØ­Ø¯ÙŠØ« padding Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .main-header {
      margin-top: 6rem !important;
    }

    /* ==== Ù†ÙˆØ§ÙØ° Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ==== */
    .settings-modal, .stats-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 20000;
      backdrop-filter: blur(10px);
      align-items: center;
      justify-content: center;
    }

    .settings-modal.active, .stats-modal.active {
      display: flex;
    }

    .settings-content {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      border: 2px solid #ffd700;
      border-radius: 20px;
      padding: 2rem;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .stats-content {
      background: linear-gradient(135deg, #0f3460, #16537e);
      border: 2px solid #00ffff;
      border-radius: 20px;
      padding: 2rem;
      max-width: 800px;
      width: 95%;
      max-height: 85vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 255, 255, 0.3);
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    }

    .settings-title {
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0;
    }

    .close-settings {
      background: rgba(255, 69, 69, 0.2);
      border: 2px solid #ff4545;
      color: #ff4545;
      padding: 0.5rem;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .close-settings:hover {
      background: #ff4545;
      color: white;
      transform: scale(1.1);
    }

    .setting-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .setting-item {
      margin-bottom: 1rem;
      color: white;
    }

    .setting-item label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: rgba(255, 255, 255, 0.7);
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      border-color: #ffd700;
    }

    .settings-tab-btn.active {
      background: rgba(255, 215, 0, 0.3);
      color: #ffd700;
      border-color: #ffd700;
      border-bottom-color: transparent;
    }

    .settings-tab-content {
      display: none;
    }

    .settings-tab-content.active {
      display: block;
    }

    .setting-select {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    .setting-select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
    .secondary {
      background: rgba(108, 117, 125, 0.2) !important;
      border-color: #6c757d !important;
    }

    .secondary:hover {
      background: rgba(108, 117, 125, 0.4) !important;
    }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª responsive */
    @media (max-width: 768px) {
      .control-group-cosmic {
        gap: 0.4rem;
      }
      
      .cosmic-control-btn {
        min-width: 3rem;
        height: 3rem;
        padding: 0.5rem;
      }
      
      .btn-tooltip {
        display: none;
      }
      
      .title-text {
        font-size: 1.2rem;
      }
      
      .cosmic-control-header {
        padding: 0.8rem 1rem;
      }
    }

    /* ===== GLASSMORPHISM CONTAINER ===== */
    .glass-container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-heavy);
      padding: 2rem;
      margin: 1rem;
    }

    /* ===== MAIN HEADER ===== */
    .main-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
    }

    .kingdom-title {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF6347, #FF1493);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.5)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)); }
    }

    .subtitle {
      font-size: 1.2rem;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
      margin-bottom: 2rem;
    }

    /* ===== INTERACTIVE DASHBOARD ===== */
    .kingdom-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .realm-card {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(15px);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .realm-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.6s;
    }

    .realm-card:hover::before {
      left: 100%;
    }

    .realm-card:hover {
      transform: translateY(-10px) scale(1.05);
      border-color: rgba(255,255,255,0.5);
      box-shadow: 0 25px 50px rgba(0,0,0,0.2);
    }

    .realm-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      background: var(--primary-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .realm-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.5rem;
    }

    .realm-description {
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* ===== BATTLE ARENA ===== */
    .battle-arena {
      display: none;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 3rem;
      margin: 2rem 0;
      border: 2px solid rgba(255,215,0,0.5);
      position: relative;
      overflow: hidden;
    }

    .battle-arena::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
      animation: battleAura 4s linear infinite;
    }

    @keyframes battleAura {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .arena-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 10;
    }

    .challenge-timer {
      font-size: 6rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ff0000, #ff4500, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255,0,0,0.5);
      animation: timerPulse 1s ease-in-out infinite;
    }

    @keyframes timerPulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.3); }
    }

    /* ===== HOLOGRAPHIC TEAMS ===== */
    .teams-hologram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .team-hologram {
      background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(255,0,255,0.1));
      border: 2px solid rgba(0,255,255,0.3);
      border-radius: var(--border-radius);
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .team-hologram::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: holoScan 3s linear infinite;
    }

    @keyframes holoScan {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .team-avatar-3d {
      width: 120px;
      height: 120px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #ff006e, #ffbe0b, #8338ec, #3a86ff, #06ffa5, #ff006e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: avatarFloat 3s ease-in-out infinite;
      position: relative;
    }

    @keyframes avatarFloat {
      0%, 100% { transform: translateY(0px) rotateY(0deg); }
      50% { transform: translateY(-10px) rotateY(180deg); }
    }

    .team-name-glow {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-shadow: 0 0 20px #00ffff;
      margin-bottom: 1rem;
    }

    .score-crystal {
      font-size: 3rem;
      font-weight: 900;
      background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 10px rgba(255,215,0,0.8));
      animation: crystalGlow 2s ease-in-out infinite alternate;
    }

    @keyframes crystalGlow {
      0% { filter: drop-shadow(0 0 10px rgba(255,215,0,0.8)); }
      100% { filter: drop-shadow(0 0 20px rgba(255,215,0,1)); }
    }

    /* ===== NEURAL NETWORK BUTTONS ===== */
    .neural-button {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      border-radius: 50px;
      padding: 1rem 2rem;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      margin: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .neural-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: all 0.5s;
    }

    .neural-button:hover::before {
      left: 100%;
    }

    .neural-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.2);
    }

    .neural-button:active {
      transform: translateY(0);
    }

    /* ===== QUANTUM NOTIFICATIONS ===== */
    .quantum-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      color: white;
      border: 2px solid rgba(0,255,255,0.5);
      box-shadow: 0 10px 30px rgba(0,255,255,0.3);
      z-index: 10000;
      transform: translateX(400px);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 350px;
    }

    .quantum-notification.show {
      transform: translateX(0);
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: quantumSpin 2s linear infinite;
    }

    @keyframes quantumSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.2); }
      100% { transform: rotate(360deg) scale(1); }
    }

    /* ===== COSMIC EFFECTS ===== */
    .cosmic-star {
      position: fixed;
      color: #ffd700;
      font-size: 20px;
      z-index: 1000;
      pointer-events: none;
      animation: cosmicFall 4s linear forwards;
    }

    @keyframes cosmicFall {
      0% {
        transform: translateY(-50px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .cosmic-explosion {
      position: fixed;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
      animation: cosmicBlast 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes cosmicBlast {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(10);
        opacity: 0;
      }
    }

    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .kingdom-title {
        font-size: 2rem;
      }
      
      .glass-container {
        margin: 0.5rem;
        padding: 1rem;
      }
      
      .challenge-timer {
        font-size: 4rem;
      }
      
      .team-avatar-3d {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
    }

    /* ===== SELECTION PANEL STYLES ===== */
    .selection-panel {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .class-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .class-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 215, 0, 0.5);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }

    .class-card.selected {
      border-color: #ffd700;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 99, 71, 0.4));
      box-shadow: 
        0 0 25px rgba(255, 215, 0, 0.7),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
      transform: scale(1.05);
      animation: selectedPulse 2s ease-in-out infinite;
    }

    @keyframes selectedPulse {
      0%, 100% { 
        box-shadow: 
          0 0 25px rgba(255, 215, 0, 0.7),
          inset 0 0 15px rgba(255, 215, 0, 0.2);
      }
      50% { 
        box-shadow: 
          0 0 35px rgba(255, 215, 0, 0.9),
          inset 0 0 20px rgba(255, 215, 0, 0.4);
      }
    }

    .class-card h4 {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .class-card .student-count {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9rem;
    }

    .student-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .student-card:hover {
      transform: translateY(-3px);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .student-card.selected {
      border-color: #00ffff;
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.3), rgba(255, 0, 255, 0.3));
      box-shadow: 
        0 0 15px rgba(0, 255, 255, 0.5),
        inset 0 0 10px rgba(0, 255, 255, 0.2);
      transform: scale(1.02);
      animation: selectedGlow 2s ease-in-out infinite alternate;
    }

    @keyframes selectedGlow {
      0% { 
        box-shadow: 
          0 0 15px rgba(0, 255, 255, 0.5),
          inset 0 0 10px rgba(0, 255, 255, 0.2);
      }
      100% { 
        box-shadow: 
          0 0 25px rgba(0, 255, 255, 0.8),
          inset 0 0 15px rgba(0, 255, 255, 0.4);
      }
    }

    .student-card .student-name {
      color: white;
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .student-card .selection-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .student-card.selected .selection-indicator {
      background: linear-gradient(135deg, #00ffff, #ff00ff);
      color: #000;
      font-weight: bold;
      transform: scale(1.2);
      animation: checkmarkPulse 0.5s ease-out;
    }

    @keyframes checkmarkPulse {
      0% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.2); opacity: 1; }
    }

    /* ===== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© ===== */
    .settings-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .settings-icon-main {
      font-size: 3rem;
      background: linear-gradient(135deg, #ffd700, #ff6b35);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rotateIcon 3s ease-in-out infinite;
    }

    @keyframes rotateIcon {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(15deg); }
    }

    .settings-title {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .settings-subtitle {
      margin: 0.3rem 0 0 0;
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
    }

    .close-settings {
      background: linear-gradient(135deg, #ff4757, #ff3838);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
    }

    .close-settings:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.5);
    }

    .settings-tab-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      color: white;
      padding: 0.8rem 1.5rem;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 600;
      position: relative;
      overflow: hidden;
    }

    .settings-tab-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      border-color: rgba(255, 215, 0, 0.6);
      transform: translateY(-2px);
    }

    .settings-tab-btn.active {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 107, 53, 0.3));
      border-color: #ffd700;
      color: #ffd700;
      font-weight: 800;
    }

    .settings-tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .settings-tab-btn:hover::before {
      left: 100%;
    }

    .setting-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 215, 0, 0.2);
      transition: all 0.3s ease;
    }

    .setting-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 215, 0, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .setting-item label {
      display: block;
      color: #ffd700;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 1rem;
    }

    .setting-select, .setting-input {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .setting-select:focus, .setting-input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }

    .setting-select option {
      background: #1a1a2e;
      color: white;
      padding: 0.5rem;
    }

    /* ===== Ø³Ø§Ø­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø±Ù‚ ===== */
    .lightning-arena {
      position: fixed;
      top: 80px;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 30%, #16213e 60%, #0f3460 100%);
      overflow-y: auto;
      z-index: 1000;
      animation: lightningEnter 1s ease-out;
    }

    @keyframes lightningEnter {
      0% { opacity: 0; transform: scale(0.8); }
      50% { opacity: 0.7; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }

    .lightning-arena-container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    .lightning-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 20px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .lightning-title-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .lightning-icon {
      font-size: 4rem;
      background: linear-gradient(45deg, #ffff00, #00ffff);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: electricPulse 2s ease-in-out infinite;
    }

    @keyframes electricPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 10px #ffff00);
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 20px #00ffff);
        transform: scale(1.1);
      }
    }

    .lightning-title {
      font-size: 3rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 20px rgba(255, 255, 0, 0.7);
      margin: 0;
    }

    .lightning-subtitle {
      font-size: 1.2rem;
      color: #00ffff;
      margin: 0.5rem 0 0 0;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .lightning-timer-container {
      position: relative;
    }

    .timer-circle {
      width: 120px;
      height: 120px;
      border: 4px solid rgba(255, 255, 0, 0.3);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle, rgba(255, 255, 0, 0.2), transparent);
      animation: timerGlow 3s ease-in-out infinite;
      position: relative;
      overflow: hidden;
    }

    @keyframes timerGlow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        border-color: rgba(255, 255, 0, 0.3);
      }
      50% { 
        box-shadow: 0 0 40px rgba(255, 255, 0, 0.8);
        border-color: rgba(255, 255, 0, 0.7);
      }
    }

    .timer-text {
      font-size: 2.5rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
    }

    .timer-label {
      font-size: 0.9rem;
      color: #00ffff;
      margin-top: 0.2rem;
    }

    .lightning-controls {
      display: flex;
      gap: 1rem;
      flex-direction: column;
    }

    .lightning-btn {
      background: linear-gradient(135deg, #ffff00, #ffa500);
      border: 2px solid rgba(255, 255, 0, 0.5);
      color: #000;
      padding: 1rem 1.5rem;
      border-radius: 15px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(255, 255, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .lightning-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 255, 0, 0.5);
    }

    .lightning-btn.secondary {
      background: linear-gradient(135deg, #00ffff, #0099cc);
      border-color: rgba(0, 255, 255, 0.5);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    }

    .lightning-btn.danger {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      border-color: rgba(255, 107, 107, 0.5);
      box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
      color: white;
    }

    .competitors-zone {
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
    }

    .zone-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #00ffff;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .competitors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .competitor-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(0, 255, 255, 0.1));
      border: 2px solid rgba(255, 255, 0, 0.3);
      border-radius: 15px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .competitor-card:hover {
      transform: translateY(-5px);
      border-color: rgba(255, 255, 0, 0.7);
      box-shadow: 0 10px 25px rgba(255, 255, 0, 0.3);
    }

    .competitor-card.answered-correct {
      background: linear-gradient(135deg, rgba(0, 255, 0, 0.3), rgba(0, 200, 0, 0.3));
      border-color: #00ff00;
      animation: correctAnswer 0.8s ease-out;
    }

    .competitor-card.answered-wrong {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(200, 0, 0, 0.3));
      border-color: #ff0000;
      animation: wrongAnswer 0.8s ease-out;
    }

    @keyframes correctAnswer {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); box-shadow: 0 0 30px rgba(0, 255, 0, 0.7); }
      100% { transform: scale(1); }
    }

    @keyframes wrongAnswer {
      0% { transform: scale(1); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
      100% { transform: scale(1); }
    }

    .competitor-name {
      font-weight: 600;
      color: white;
      margin-bottom: 0.5rem;
    }

    .competitor-score {
      font-size: 1.5rem;
      font-weight: 900;
      color: #ffff00;
      text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
    }

    .question-zone {
      background: radial-gradient(circle, rgba(255, 255, 0, 0.1), transparent);
      border: 3px solid rgba(255, 255, 0, 0.5);
      border-radius: 25px;
      padding: 2rem;
      margin-bottom: 2rem;
      text-align: center;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .waiting-state {
      animation: waitingPulse 2s ease-in-out infinite;
    }

    @keyframes waitingPulse {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }

    .waiting-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: electricSpin 3s linear infinite;
    }

    @keyframes electricSpin {
      0% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(90deg) scale(1.1); }
      50% { transform: rotate(180deg) scale(1); }
      75% { transform: rotate(270deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    .question-active {
      background: linear-gradient(135deg, rgba(255, 255, 0, 0.2), rgba(0, 255, 255, 0.2));
      animation: questionGlow 2s ease-in-out infinite;
    }

    @keyframes questionGlow {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
        border-color: rgba(255, 255, 0, 0.5);
      }
      50% { 
        box-shadow: 0 0 40px rgba(255, 255, 0, 0.7);
        border-color: rgba(255, 255, 0, 0.9);
      }
    }

    .lightning-scoreboard {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 215, 0, 0.5);
      border-radius: 20px;
      padding: 1.5rem;
      backdrop-filter: blur(15px);
    }

    .scoreboard-title {
      font-size: 1.8rem;
      font-weight: 800;
      color: #ffd700;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
    }

    .lightning-effects {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: -1;
    }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
    .lightning-bolt {
      position: absolute;
      width: 2px;
      background: linear-gradient(to bottom, #ffff00, transparent);
      animation: lightningStrike 0.5s ease-out;
      box-shadow: 0 0 10px #ffff00;
    }

    @keyframes lightningStrike {
      0% { height: 0; opacity: 1; }
      50% { height: 100vh; opacity: 0.8; }
      100% { height: 100vh; opacity: 0; }
    }

    /* ===== TEACHER GUIDE MODAL ===== */
    .teacher-guide-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 100000;
      display: none;
      overflow-y: auto;
      padding: 2rem;
    }

    .guide-content {
      max-width: 1000px;
      margin: 0 auto;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-radius: var(--border-radius);
      padding: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.3);
    }

    .guide-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .guide-section h3 {
      color: #ffd700;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .guide-section p, .guide-section li {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .guide-section ul {
      padding-right: 1.5rem;
    }

    /* ===== ENHANCED BUTTON STYLES ===== */
    .neural-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .neural-button:disabled:hover {
      transform: none !important;
      box-shadow: none !important;
    }

    /* ===== RESPONSIVE DESIGN ENHANCEMENTS ===== */
    @media (max-width: 768px) {
      .selection-panel {
        padding: 1rem;
      }
      
      .class-grid, .students-grid {
        grid-template-columns: 1fr;
      }
      
      .guide-content {
        padding: 1rem;
      }
    }

    /* ===== LOADING SCREEN ===== */
    .cosmic-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000000, #1a1a2e, #16213e);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100000;
      transition: opacity 1s ease;
    }

    .loader-animation {
      width: 150px;
      height: 150px;
      border: 4px solid transparent;
      border-top: 4px solid #00ffff;
      border-right: 4px solid #ff00ff;
      border-radius: 50%;
      animation: cosmicSpin 2s linear infinite;
      margin-bottom: 2rem;
      position: relative;
    }

    .loader-animation::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      border: 2px solid transparent;
      border-bottom: 2px solid #ffd700;
      border-left: 2px solid #ff4500;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: cosmicSpin 1s linear infinite reverse;
    }

    @keyframes cosmicSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loader-text {
      color: #00ffff;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      animation: textPulse 2s ease-in-out infinite;
    }

    @keyframes textPulse {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    .loader-progress {
      width: 300px;
      height: 6px;
      background: rgba(255,255,255,0.2);
      border-radius: 3px;
      margin-top: 2rem;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #ff00ff, #ffd700);
      border-radius: 3px;
      width: 0%;
      transition: width 0.5s ease;
      animation: progressGlow 2s ease-in-out infinite;
    }

    @keyframes progressGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(0,255,255,0.5); }
      50% { box-shadow: 0 0 20px rgba(0,255,255,1); }
    }
  </style>
</head>
<body>
  <!-- Particles Background -->
  <div id="particles-js"></div>

  <!-- Cosmic Loading Screen -->
  <div class="cosmic-loader" id="cosmicLoader">
    <div class="loader-animation"></div>
    <div class="loader-text" id="loaderText">ğŸŒŒ ØªÙ‡ÙŠØ¦Ø© Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©...</div>
    <div class="loader-progress">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  </div>

  <!-- Main Application -->
  <div class="glass-container" id="mainApp" style="display: none;">
    <!-- Class & Student Selection Panel -->
    <div class="selection-panel" id="selectionPanel">
      <div class="glass-container" style="background: rgba(0,0,0,0.8); border: 2px solid rgba(255,215,0,0.5);">
        <!-- Ø¹Ù†ÙˆØ§Ù† Ù…Ø­Ø³Ù† Ù„Ù„ÙˆØ­Ø© -->
        <div style="position: relative; margin-bottom: 2rem;">
          <h2 style="text-align: center; color: #ffd700; font-size: 2.5rem; margin-bottom: 0.5rem;">
            ğŸ‘¥ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
          </h2>
          <p style="text-align: center; color: rgba(255,255,255,0.8); font-size: 1.1rem;">
            âš¡ Ø§Ø®ØªØ± ØµÙÙƒ ÙˆØ·Ù„Ø§Ø¨Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ù„Ø­Ù…ÙŠØ©
          </p>
        </div>
        
        <!-- Class Selection -->
        <div class="class-selection-section" style="margin-bottom: 3rem;">
          <h3 style="color: #00ffff; font-size: 1.8rem; margin-bottom: 1rem; text-align: center;">
            ğŸ« Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ
          </h3>
          <div class="class-grid" id="classGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <!-- Classes will be loaded dynamically -->
          </div>
        </div>

        <!-- Student Selection -->
        <div class="student-selection-section" id="studentSelectionSection" style="display: none;">
          <h3 style="color: #ff6347; font-size: 1.8rem; margin-bottom: 1rem; text-align: center;">
            ğŸ¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
          </h3>
          
          <!-- Selection Controls -->
          <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
            <button class="neural-button" onclick="selectAllStudents()">âœ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„</button>
            <button class="neural-button" onclick="clearAllStudents()">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒÙ„</button>
            <button class="neural-button" onclick="selectRandomStudents()">ğŸ² Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
            <button class="neural-button" onclick="quickSelectCount()">ğŸ”¢ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯</button>
          </div>

          <!-- Student Grid -->
          <div class="students-grid" id="studentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <!-- Students will be loaded dynamically -->
          </div>

          <!-- Selected Count Display -->
          <div style="text-align: center; margin-bottom: 2rem;">
            <div style="background: rgba(0,255,255,0.2); padding: 1rem; border-radius: 15px; display: inline-block;">
              <span style="color: #00ffff; font-size: 1.2rem; font-weight: 700;">
                Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†: <span id="selectedCount">0</span>
              </span>
            </div>
          </div>

          <!-- Start Game Button -->
          <div style="text-align: center;">
            <button class="neural-button" id="startGameBtn" onclick="startKingdomGame()" style="font-size: 1.3rem; padding: 1.5rem 3rem; background: linear-gradient(45deg, #ffd700, #ff6347);" disabled>
              ğŸš€ Ø¨Ø¯Ø¡ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Game Interface (initially hidden) -->
    <div class="game-interface" id="gameInterface" style="display: none;">
    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© -->
    <div class="cosmic-control-header">
        <div class="control-buttons-container">
            <div class="app-title-cosmic">
                <span class="title-icon">ğŸ°</span>
                <span class="title-text">Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</span>
                <span class="version-badge">v2.0</span>
            </div>
            <div class="control-group-cosmic">
                <button class="cosmic-control-btn" id="homeBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©">
                    <span class="btn-icon">ğŸ </span>
                    <span class="btn-tooltip">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </button>
                <button class="cosmic-control-btn" id="kingdomsBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ">
                    <span class="btn-icon">ï¿½</span>
                    <span class="btn-tooltip">Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ</span>
                </button>
                <button class="cosmic-control-btn" id="soundToggleBtn" title="Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª">
                    <span class="btn-icon">ğŸ”Š</span>
                    <span class="btn-tooltip">Ø§Ù„ØµÙˆØª</span>
                </button>
                <button class="cosmic-control-btn" id="teacherGuideBtn" title="Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…">
                    <span class="btn-icon">ğŸ“–</span>
                    <span class="btn-tooltip">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…</span>
                </button>
                <button class="cosmic-control-btn" id="settingsBtn" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©">
                    <span class="btn-icon">âš™ï¸</span>
                    <span class="btn-tooltip">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                </button>
                <button class="cosmic-control-btn" id="sessionBtn" title="Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…">
                    <span class="btn-icon">ğŸ’¾</span>
                    <span class="btn-tooltip">Ø§Ù„Ø¬Ù„Ø³Ø©</span>
                </button>
                <button class="cosmic-control-btn" id="statsBtn" title="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©">
                    <span class="btn-icon">ğŸ“Š</span>
                    <span class="btn-tooltip">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                </button>
                <button class="cosmic-control-btn" id="fullscreenBtn" title="ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">
                    <span class="btn-icon">â›¶</span>
                    <span class="btn-tooltip">Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Kingdom Header -->
    <div id="kingdomContent">
    <header class="main-header">
      <h1 class="kingdom-title">ğŸ† Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h1>
      <p class="subtitle">âš¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¨ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
      
      <!-- Real-time Stats -->
      <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 2rem;">
        <div style="text-align: center; color: white;">
          <div style="font-size: 2rem; font-weight: 900;">â±ï¸</div>
          <div>ÙˆÙ‚Øª Ø§Ù„Ø¬Ù„Ø³Ø©</div>
          <div id="sessionTime" style="font-weight: 700;">00:00</div>
        </div>
        <div style="text-align: center; color: white;">
          <div style="font-size: 2rem; font-weight: 900;">ğŸ¯</div>
          <div>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</div>
          <div id="completedChallenges" style="font-weight: 700;">0</div>
        </div>
        <div style="text-align: center; color: white;">
          <div style="font-size: 2rem; font-weight: 900;">âš¡</div>
          <div>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù‚Ø©</div>
          <div id="energyLevel" style="font-weight: 700;">100%</div>
        </div>
      </div>
    </header>

    <!-- Kingdom Dashboard -->
    <div class="kingdom-dashboard" id="kingdomDashboard">
      <!-- Lightning Challenge Realm -->
      <div class="realm-card" onclick="activateRealm('lightning')">
        <div class="realm-icon">âš¡</div>
        <h3 class="realm-title">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚</h3>
        <p class="realm-description">ØªØ­Ø¯ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙÙƒÙŠØ± ÙˆØ§Ù„Ø°ÙƒØ§Ø¡</p>
      </div>

      <!-- Wisdom Challenge Realm -->
      <div class="realm-card" onclick="activateRealm('wisdom')">
        <div class="realm-icon">ğŸ§ </div>
        <h3 class="realm-title">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø­ÙƒÙ…Ø©</h3>
        <p class="realm-description">ØªØ­Ø¯ÙŠØ§Øª ÙÙƒØ±ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø© Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹</p>
      </div>

      <!-- Team Battle Realm -->
      <div class="realm-card" onclick="activateRealm('battle')">
        <div class="realm-icon">âš”ï¸</div>
        <h3 class="realm-title">Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h3>
        <p class="realm-description">Ù…Ø¹Ø§Ø±Ùƒ Ø¬Ù…Ø§Ø¹ÙŠØ© Ù…Ù„Ø­Ù…ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙØ±Ù‚</p>
      </div>

      <!-- Mystery Realm -->
      <div class="realm-card" onclick="activateRealm('mystery')">
        <div class="realm-icon">ğŸ”®</div>
        <h3 class="realm-title">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø£Ù„ØºØ§Ø²</h3>
        <p class="realm-description">Ø£Ù„ØºØ§Ø² ØºØ§Ù…Ø¶Ø© ÙˆØªØ­Ø¯ÙŠØ§Øª Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ©</p>
      </div>
    </div>
    </div> <!-- End of kingdomContent -->



    <!-- Battle Arena -->
    <div class="battle-arena" id="battleArena">
      <div class="arena-header">
        <h2 style="color: #ffd700; font-size: 2rem; margin-bottom: 1rem;">âš”ï¸ Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ø´Ø·Ø©</h2>
        <div class="challenge-timer" id="challengeTimer">00:00</div>
        <p style="color: rgba(255,255,255,0.8); font-size: 1.1rem;">Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©!</p>
      </div>

      <!-- Teams Hologram Display -->
      <div class="teams-hologram" id="teamsHologram">
        <!-- Teams will be generated dynamically -->
      </div>

      <!-- Battle Controls -->
      <div style="text-align: center; margin-top: 2rem;">
        <button class="neural-button" onclick="startBattle()">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</button>
        <button class="neural-button" onclick="pauseBattle()">â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
        <button class="neural-button" onclick="endBattle()">ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</button>
        <button class="neural-button" onclick="resetArena()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
      </div>
    </div>

    <!-- AI Coach Panel -->
    <div class="glass-container" style="margin-top: 2rem; border: 2px solid rgba(0,255,255,0.3);">
      <h3 style="color: #00ffff; text-align: center; margin-bottom: 1rem;">ğŸ¤– Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ</h3>
      <div id="aiCoachMessages" style="min-height: 100px; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px; color: white;">
        <div style="opacity: 0.7;">Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ...</div>
      </div>
      <div style="text-align: center; margin-top: 1rem;">
        <button class="neural-button" onclick="getAITip()">ğŸ’¡ Ù†ØµÙŠØ­Ø© Ø°ÙƒÙŠØ©</button>
        <button class="neural-button" onclick="analyzePerformance()">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Teacher Guide Modal -->
  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© -->
  <div class="modal-overlay settings-modal" id="settingsModal">
      <div class="modal-content settings-content">
          <div class="modal-header settings-header">
              <div class="settings-title-container">
                  <div class="settings-icon-main">âš™ï¸</div>
                  <div>
                      <h2 class="settings-title">Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
                      <p class="settings-subtitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</p>
                  </div>
              </div>
              <button class="close-settings" onclick="closeSettingsModal()">
                  <span>âœ•</span>
              </button>
          </div>
          
          <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
          <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid rgba(255,215,0,0.3);">
              <button class="settings-tab-btn active" data-tab="game-settings">ğŸ® Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
              <button class="settings-tab-btn" data-tab="audio-settings">ğŸµ Ø§Ù„ØµÙˆØª</button>
              <button class="settings-tab-btn" data-tab="display-settings">ğŸ¨ Ø§Ù„Ø¹Ø±Ø¶</button>
              <button class="settings-tab-btn" data-tab="class-settings">ğŸ‘¥ Ø§Ù„ØµÙÙˆÙ</button>
          </div>
          
          <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
          <div class="settings-tab-content active" id="game-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ffd700; margin-bottom: 1rem;">ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                  
                  <div class="setting-item">
                      <label>ğŸ“š Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±:</label>
                      <select id="selectedClassDisplay" class="setting-select" disabled>
                          <option value="">-- Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙ --</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>â±ï¸ Ù…Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</label>
                      <select id="challengeDurationSelect" class="setting-select">
                          <option value="30">30 Ø«Ø§Ù†ÙŠØ©</option>
                          <option value="60" selected>60 Ø«Ø§Ù†ÙŠØ©</option>
                          <option value="90">90 Ø«Ø§Ù†ÙŠØ©</option>
                          <option value="120">120 Ø«Ø§Ù†ÙŠØ©</option>
                          <option value="180">180 Ø«Ø§Ù†ÙŠØ©</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸ¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</label>
                      <select id="difficultySelect" class="setting-select">
                          <option value="easy">Ø³Ù‡Ù„ ğŸŸ¢ - Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†</option>
                          <option value="medium" selected>Ù…ØªÙˆØ³Ø· ğŸŸ¡ - Ø§Ù„ØªÙˆØ§Ø²Ù† Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ</option>
                          <option value="hard">ØµØ¹Ø¨ ğŸ”´ - Ù„Ù„Ø®Ø¨Ø±Ø§Ø¡</option>
                          <option value="mixed">Ù…Ø®ØªÙ„Ø· ğŸŒˆ - ØªÙ†ÙˆØ¹ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</option>
                      </select>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸ† Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø·:</label>
                      <select id="scoringSystemSelect" class="setting-select">
                          <option value="standard" selected>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø§Ø¯ÙŠ</option>
                          <option value="bonus">Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©</option>
                          <option value="penalty">Ù†Ø¸Ø§Ù… Ø§Ù„Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</option>
                          <option value="time-based">Ù†Ø¸Ø§Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª -->
          <div class="settings-tab-content" id="audio-settings-content">
              <div class="setting-section">
                  <h3 style="color: #00ffff; margin-bottom: 1rem;">ğŸµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                  
                  <div class="setting-item">
                      <label>ğŸ”Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø§Ù…:</label>
                      <input type="range" id="masterVolumeSlider" min="0" max="100" value="50" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #ffd700; margin-top: 0.5rem;">
                          <span id="volumeDisplay">50%</span>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸ¼ Ø£ØµÙˆØ§Øª Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª:</label>
                      <input type="range" id="effectsVolumeSlider" min="0" max="100" value="70" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #00ffff; margin-top: 0.5rem;">
                          <span id="effectsVolumeDisplay">70%</span>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸµ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©:</label>
                      <input type="range" id="musicVolumeSlider" min="0" max="100" value="30" 
                             style="width: 100%; margin-top: 0.5rem;">
                      <div style="text-align: center; color: #ff69b4; margin-top: 0.5rem;">
                          <span id="musicVolumeDisplay">30%</span>
                      </div>
                  </div>
                  
                  <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                      <button class="neural-button" onclick="testAllSounds()" style="flex: 1;">
                          ğŸ¼ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
                      </button>
                      <button class="neural-button secondary" onclick="muteAllSounds()" style="flex: 1;">
                          ğŸ”‡ ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
                      </button>
                  </div>
              </div>
          </div>
          
          <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ -->
          <div class="settings-tab-content" id="display-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ff69b4; margin-bottom: 1rem;">ğŸ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©</h3>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="particlesToggle" checked> 
                          ğŸŒŒ ØªÙØ¹ÙŠÙ„ Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="animationsToggle" checked> 
                          âœ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="notificationsToggle" checked> 
                          ğŸ”” Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>
                          <input type="checkbox" id="fullscreenModeToggle"> 
                          â›¶ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                      </label>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸ¨ Ù†Ù…Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</label>
                      <select id="colorThemeSelect" class="setting-select">
                          <option value="cosmic" selected>Ø§Ù„ÙƒÙˆÙ†ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                          <option value="ocean">Ø§Ù„Ù…Ø­ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ù‚</option>
                          <option value="sunset">ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³</option>
                          <option value="forest">Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡</option>
                          <option value="royal">Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø°Ù‡Ø¨ÙŠ</option>
                      </select>
                  </div>
              </div>
          </div>
          
          <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙÙˆÙ -->
          <div class="settings-tab-content" id="class-settings-content">
              <div class="setting-section">
                  <h3 style="color: #ffd700; margin-bottom: 1rem;">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</h3>
                  
                  <div class="setting-item">
                      <label>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©:</label>
                      <div id="dataStatsDisplay" style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; margin-top: 0.5rem;">
                          <div>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ: <span id="classesCount">--</span></div>
                          <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨: <span id="totalStudentsCount">--</span></div>
                          <div>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdateTime">--</span></div>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>ğŸ”„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</label>
                      <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                          <button class="neural-button" onclick="loadClassSelection(); closeSettingsModal();" style="flex: 1;">
                              ğŸ¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙ Ø¬Ø¯ÙŠØ¯
                          </button>
                          <button class="neural-button" onclick="reloadStudentData()" style="flex: 1;">
                              ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                          </button>
                      </div>
                      <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                          <button class="neural-button secondary" onclick="exportClassData()" style="flex: 1;">
                              ï¿½ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                          </button>
                      </div>
                  </div>
                  
                  <div class="setting-item">
                      <label>âš¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹:</label>
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 0.5rem;">
                          <label><input type="checkbox" id="autoSelectAllStudents"> Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</label>
                          <label><input type="checkbox" id="randomizeStudentOrder"> ØªØ±ØªÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨</label>
                          <label><input type="checkbox" id="enableQuickStart"> Ø¨Ø¯Ø¡ Ø³Ø±ÙŠØ¹ Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø¯Ø§Ø¯</label>
                          <label><input type="checkbox" id="rememberLastSelection"> ØªØ°ÙƒØ± Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±</label>
                      </div>
                  </div>
              </div>
          </div>
          
          <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
          <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 2px solid rgba(255,215,0,0.3);">
              <button class="neural-button" onclick="saveAllSettings()" style="flex: 2; background: linear-gradient(45deg, #4facfe, #00f2fe);">
                  ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
              </button>
              <button class="neural-button secondary" onclick="resetAllSettings()" style="flex: 1;">
                  ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„
              </button>
              <button class="neural-button" onclick="exportSettings()" style="flex: 1; background: linear-gradient(45deg, #43e97b, #38f9d7);">
                  ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
              </button>
          </div>
      </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="modal-overlay stats-modal" id="statsModal">
      <div class="modal-content stats-content">
          <div class="modal-header">
              <h2 style="color: #00ffff; font-size: 1.8rem;">
                  <span>ğŸ“Š</span>
                  Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
              </h2>
              <button class="close-settings" onclick="closeStatsModal()">âœ•</button>
          </div>
          
          <div id="statsContent">
              <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
          </div>
      </div>
  </div>

  <div class="teacher-guide-modal" id="teacherGuideModal">
    <div class="guide-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h2 style="color: #ffd700; font-size: 2.5rem;">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù… - Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©</h2>
        <button class="neural-button" onclick="closeTeacherGuide()" style="background: #ff4444;">âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚</button>
      </div>

      <div class="guide-section">
        <h3>ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø´Ø§Ø·</h3>
        <p>Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ù‡ÙŠ Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù…ØªØ·ÙˆØ±Ø© ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ ØªØ­ÙÙŠØ² Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ²ÙŠØ§Ø¯Ø© Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ù… ÙÙŠ Ø§Ù„ØªØ¹Ù„Ù… Ù…Ù† Ø®Ù„Ø§Ù„:</p>
        <ul>
          <li>Ù†Ø¸Ø§Ù… Ù…Ù…Ø§Ù„ÙŠÙƒ Ù…ØªÙ†ÙˆØ¹Ø© (Ø§Ù„Ø¨Ø±Ù‚ØŒ Ø§Ù„Ø­ÙƒÙ…Ø©ØŒ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©ØŒ Ø§Ù„Ø£Ù„ØºØ§Ø²)</li>
          <li>ØªØ­Ø¯ÙŠØ§Øª ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…Ø®ØªÙ„Ù Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØ¹Ù„Ù…</li>
          <li>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· ÙˆØ¥Ù†Ø¬Ø§Ø²Ø§Øª Ù…Ø­ÙØ²</li>
          <li>Ù…Ø¯Ø±Ø¨ Ø°ÙƒÙŠ ÙŠÙ‚Ø¯Ù… Ø§Ù„Ù†ØµØ§Ø¦Ø­ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</li>
          <li>ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© ÙˆØµÙˆØªÙŠØ© ØºØ§Ù…Ø±Ø©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸš€ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¨Ø¯Ø¡</h3>
        <p><strong>Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ</strong></p>
        <ul>
          <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
          <li>Ø³ØªØ¸Ù‡Ø± Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ Ø§Ù„Ù…Ø®ØªØ§Ø±</li>
        </ul>
        
        <p><strong>Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</strong></p>
        <ul>
          <li><strong>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ„:</strong> Ù„Ø¥Ø´Ø±Ø§Ùƒ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ</li>
          <li><strong>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ:</strong> Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø§Ù„Ø³Ø±ÙŠØ¹</li>
          <li><strong>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯:</strong> Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨</li>
          <li><strong>Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±ØºÙˆØ¨ÙŠÙ†</li>
        </ul>

        <p><strong>Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø§Ø·</strong></p>
        <ul>
          <li>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª" Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø§Ø¨</li>
          <li>Ø³ØªØ¸Ù‡Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù†Ø´Ø§Ø·</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>âš”ï¸ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h3>
        
        <p><strong>âš¡ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚:</strong></p>
        <ul>
          <li>ØªØ­Ø¯ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© ØªØ±ÙƒØ² Ø¹Ù„Ù‰ Ø³Ø±Ø¹Ø© Ø§Ù„ØªÙÙƒÙŠØ±</li>
          <li>Ù…Ø¯Ø© Ù‚ØµÙŠØ±Ø© (30-60 Ø«Ø§Ù†ÙŠØ©)</li>
          <li>Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø¥Ø­Ù…Ø§Ø¡ ÙˆÙƒØ³Ø± Ø§Ù„Ø¬Ù„ÙŠØ¯</li>
        </ul>

        <p><strong>ğŸ§  Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø­ÙƒÙ…Ø©:</strong></p>
        <ul>
          <li>ØªØ­Ø¯ÙŠØ§Øª ÙÙƒØ±ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø© ØªØªØ·Ù„Ø¨ Ø§Ù„ØªØ£Ù…Ù„</li>
          <li>ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠ</li>
          <li>ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„ Ù„Ù„ØªÙÙƒÙŠØ± ÙˆØ§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©</li>
        </ul>

        <p><strong>âš”ï¸ Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©:</strong></p>
        <ul>
          <li>ØªØ­Ø¯ÙŠØ§Øª Ø¬Ù…Ø§Ø¹ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„ÙØ±Ù‚</li>
          <li>ØªØ¹Ø²ÙŠØ² Ø±ÙˆØ­ Ø§Ù„ØªØ¹Ø§ÙˆÙ† ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</li>
          <li>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· ÙˆØ·Ø§Ù‚Ø© ØªÙØ§Ø¹Ù„ÙŠ</li>
        </ul>

        <p><strong>ğŸ”® Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø£Ù„ØºØ§Ø²:</strong></p>
        <ul>
          <li>Ø£Ù„ØºØ§Ø² ÙˆÙ…Ø´Ø§ÙƒÙ„ ØªØªØ·Ù„Ø¨ Ø­Ù„ÙˆÙ„ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</li>
          <li>ØªÙ†Ù…ÙŠØ© Ù…Ù‡Ø§Ø±Ø§Øª Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª</li>
          <li>ØªØ­Ø¯ÙŠØ§Øª Ù…ØªØ¯Ø±Ø¬Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ® Ø¥Ø¯Ø§Ø±Ø© Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</h3>
        <p><strong>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ±Ù‚:</strong></p>
        <ul>
          <li>ÙŠØªÙ… ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙØ±Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†</li>
          <li>ÙƒÙ„ ÙØ±ÙŠÙ‚ Ù„Ù‡ Ø§Ø³Ù… ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù…ÙŠØ²Ø©</li>
          <li>Ù†Ø¸Ø§Ù… Ø·Ø§Ù‚Ø© ÙˆØµØ­Ø© Ù„Ù„ÙØ±Ù‚</li>
        </ul>

        <p><strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø·:</strong></p>
        <ul>
          <li><strong>Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© (â¬†ï¸):</strong> Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©</li>
          <li><strong>Ø®ØµÙ… Ù†Ù‚Ø·Ø© (â¬‡ï¸):</strong> Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù„Ø³Ù„ÙˆÙƒ ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨</li>
          <li><strong>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ©:</strong> ØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø®Ø§ØµØ©</li>
        </ul>

        <p><strong>Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©:</strong></p>
        <ul>
          <li>ØªØ­Ø¯Ø« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ø´Ø·Ø©</li>
          <li>ØªØ¶ÙŠÙ Ø¹Ù†ØµØ± Ø§Ù„Ù…ÙØ§Ø¬Ø£Ø© ÙˆØ§Ù„Ø¥Ø«Ø§Ø±Ø©</li>
          <li>ØªØ´Ù…Ù„: Ø·Ø§Ù‚Ø© Ø¥Ø¶Ø§ÙÙŠØ©ØŒ Ù†Ù‚Ø§Ø· Ù…Ø¶Ø§Ø¹ÙØ©ØŒ Ù…ÙƒØ§ÙØ¢Øª Ø®Ø§ØµØ©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ¤– Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ</h3>
        <p>ÙŠÙ‚Ø¯Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø°ÙƒÙŠ:</p>
        <ul>
          <li><strong>Ù†ØµØ§Ø¦Ø­ Ø°ÙƒÙŠØ©:</strong> ØªÙˆØ¬ÙŠÙ‡Ø§Øª Ù…ÙÙŠØ¯Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø§Ø·</li>
          <li><strong>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© Ø¹Ù† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</li>
          <li><strong>ØªØ­ÙÙŠØ² Ø¥ÙŠØ¬Ø§Ø¨ÙŠ:</strong> Ø±Ø³Ø§Ø¦Ù„ Ù…Ø­ÙØ²Ø© ÙˆÙ…Ø´Ø¬Ø¹Ø©</li>
          <li><strong>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªØ­Ø³ÙŠÙ†:</strong> Ù†ØµØ§Ø¦Ø­ Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ“Š Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h3>
        <p><strong>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong></p>
        <ul>
          <li>ÙˆÙ‚Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</li>
          <li>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</li>
          <li>Ù…Ø³ØªÙˆÙ‰ Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</li>
          <li>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø· Ù„ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©</li>
        </ul>

        <p><strong>Ù†ØµØ§Ø¦Ø­ Ù„Ù„ØªÙ‚ÙŠÙŠÙ…:</strong></p>
        <ul>
          <li>Ø±Ø§Ù‚Ø¨ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªÙØ§Ø¹Ù„Ù‡Ù…</li>
          <li>Ù„Ø§Ø­Ø¸ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ù…Ø§Ø³ ÙˆØ§Ù„Ø§Ù†Ø®Ø±Ø§Ø·</li>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙƒØ£Ø¯Ø§Ø© ØªØ­ÙÙŠØ²ÙŠØ© ÙˆÙ„ÙŠØ³ ØªÙ‚ÙŠÙŠÙ…ÙŠØ© ÙÙ‚Ø·</li>
          <li>Ø´Ø¬Ø¹ Ø§Ù„ØªØ¹Ø§ÙˆÙ† ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„Ø©</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù…Ø«Ù„</h3>
        <ul>
          <li><strong>Ø§Ù„ØªØ­Ø¶ÙŠØ±:</strong> ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ Ø§Ù„ØµÙˆØª ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„</li>
          <li><strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª:</strong> Ø®ØµØµ 5-10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„ÙƒÙ„ ØªØ­Ø¯ÙŠ</li>
          <li><strong>Ø§Ù„ØªÙ†ÙˆÙŠØ¹:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù…Ø§Ù„ÙŠÙƒ Ù…Ø®ØªÙ„ÙØ© Ù„ØªÙ†ÙˆÙŠØ¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©</li>
          <li><strong>Ø§Ù„ØªÙØ§Ø¹Ù„:</strong> Ø´Ø§Ø±Ùƒ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆÙƒÙ† Ù…ØªØ­Ù…Ø³Ø§Ù‹</li>
          <li><strong>Ø§Ù„Ù…Ø±ÙˆÙ†Ø©:</strong> ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ØµÙ</li>
          <li><strong>Ø§Ù„Ø®ØªØ§Ù…:</strong> Ø§Ø®ØªØªÙ… Ø¨ØªÙ‡Ù†Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ”§ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h3>
        <p><strong>Ù…Ø´Ø§ÙƒÙ„ Ø´Ø§Ø¦Ø¹Ø© ÙˆØ­Ù„ÙˆÙ„Ù‡Ø§:</strong></p>
        <ul>
          <li><strong>Ø¹Ø¯Ù… Ø¹Ù…Ù„ Ø§Ù„ØµÙˆØª:</strong> ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ù„ØµÙˆØª</li>
          <li><strong>Ø¨Ø·Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:</strong> ØªØ£ÙƒØ¯ Ù…Ù† Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</li>
          <li><strong>Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù studentData.json</li>
          <li><strong>Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶:</strong> Ø§Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­ Ø­Ø¯ÙŠØ« (Chrome, Firefox, Edge)</li>
        </ul>
      </div>

      <div class="guide-section">
        <h3>ğŸ¯ Ø£Ù‡Ø¯Ø§Ù ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h3>
        <p>ÙŠØ³Ø§Ø¹Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø´Ø§Ø· Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚:</p>
        <ul>
          <li>Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯Ø§ÙØ¹ÙŠØ© Ù„Ù„ØªØ¹Ù„Ù…</li>
          <li>ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ù†Ù‚Ø¯ÙŠ</li>
          <li>ØªØ¹Ø²ÙŠØ² Ø±ÙˆØ­ Ø§Ù„ÙØ±ÙŠÙ‚ ÙˆØ§Ù„ØªØ¹Ø§ÙˆÙ†</li>
          <li>ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³</li>
          <li>Ø±Ø¨Ø· Ø§Ù„ØªØ¹Ù„Ù… Ø¨Ø§Ù„Ù…ØªØ¹Ø© ÙˆØ§Ù„Ø¥Ø«Ø§Ø±Ø©</li>
          <li>ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§Øª Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª</li>
        </ul>
      </div>
    </div>
  </div>

<script>
// ===== GLOBAL VARIABLES =====
let gameState = {
  currentRealm: null,
  isActive: false,
  sessionStartTime: Date.now(),
  completedChallenges: 0,
  energyLevel: 100,
  soundEnabled: true,
  teams: [],
  battleTimer: null,
  battleDuration: 0,
  selectedClass: null,
  selectedStudents: [],
  gameStarted: false,
  waitingForAnswer: false,  // Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø±Ù‚
  hasActiveSession: false   // Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©
};

// ===== TEACHER CONVENIENCE SYSTEM =====
// Ù†Ø¸Ø§Ù… Ø±Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ù„Ù… - Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
function saveTeacherSession() {
  if (gameState.selectedClass && selectedStudentsList.length > 0) {
    const teacherSession = {
      selectedClass: gameState.selectedClass,
      selectedStudents: [...selectedStudentsList],
      timestamp: Date.now(),
      sessionId: `session_${Date.now()}`
    };
    
    localStorage.setItem('teacherActiveSession', JSON.stringify(teacherSession));
    gameState.hasActiveSession = true;
    console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…:', teacherSession);
    
    // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ù„Ù…
    showQuantumNotification('ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 
      `Ø­ÙÙØ¸Øª Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ: ${gameState.selectedClass} (${selectedStudentsList.length} Ø·Ù„Ø§Ø¨)`, 
      'success');
    
    // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø²Ø± Ø§Ù„Ø¬Ù„Ø³Ø©
    setTimeout(() => updateSessionButtonStatus(), 500);
  }
}

function loadTeacherSession() {
  const savedSession = localStorage.getItem('teacherActiveSession');
  if (savedSession) {
    try {
      const session = JSON.parse(savedSession);
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ù„ÙŠØ³Øª Ù‚Ø¯ÙŠÙ…Ø© Ø¬Ø¯Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 24 Ø³Ø§Ø¹Ø©)
      const hoursPassed = (Date.now() - session.timestamp) / (1000 * 60 * 60);
      if (hoursPassed < 24) {
        return session;
      } else {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        localStorage.removeItem('teacherActiveSession');
      }
    } catch (e) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…:', e);
    }
  }
  return null;
}

function restoreTeacherSession(session) {
  gameState.selectedClass = session.selectedClass;
  selectedStudentsList = [...session.selectedStudents];
  gameState.selectedStudents = [...session.selectedStudents];
  gameState.hasActiveSession = true;
  
  console.log('ğŸ”„ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…:', session);
  
  // Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
  showQuantumNotification('ğŸ”„ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©', 
    `Ø§Ø³ØªÙØ¹ÙŠØ¯Øª Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ: ${session.selectedClass} (${session.selectedStudents.length} Ø·Ù„Ø§Ø¨)`, 
    'info');
}

function clearTeacherSession() {
  localStorage.removeItem('teacherActiveSession');
  gameState.hasActiveSession = false;
  gameState.selectedClass = null;
  selectedStudentsList = [];
  gameState.selectedStudents = [];
  
  showQuantumNotification('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø©', 
    'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯', 
    'info');
  
  // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø²Ø± Ø§Ù„Ø¬Ù„Ø³Ø©
  setTimeout(() => updateSessionButtonStatus(), 500);
}

// Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ù…Ø¹Ù„Ù…
function showTeacherSessionOptions(savedSession) {
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
  document.getElementById('kingdomContent').style.display = 'none';
  document.getElementById('selectionPanel').style.display = 'none';
  
  // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
  let sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  if (!sessionOptionsPanel) {
    sessionOptionsPanel = document.createElement('div');
    sessionOptionsPanel.id = 'sessionOptionsPanel';
    sessionOptionsPanel.className = 'glass-container';
    mainApp.appendChild(sessionOptionsPanel);
  }
  
  sessionOptionsPanel.style.display = 'block';
  sessionOptionsPanel.innerHTML = `
    <div style="text-align: center; padding: 3rem; max-width: 600px; margin: 0 auto;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ’¾</div>
      <h2 style="color: #ffd700; margin-bottom: 1rem; font-size: 2.5rem;">
        Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ğŸ‘‹
      </h2>
      <p style="color: rgba(255,255,255,0.9); font-size: 1.3rem; margin-bottom: 2rem;">
        Ù„Ø¯ÙŠÙƒ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù…Ù† Ù‚Ø¨Ù„
      </p>
      
      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© -->
      <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3); 
                  border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">ğŸ“š Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</h3>
        <div style="display: grid; gap: 1rem; text-align: right;">
          <div>
            <strong style="color: #4facfe;">Ø§Ù„ØµÙ:</strong> 
            <span style="color: #ffd700; font-size: 1.2rem;">${savedSession.selectedClass}</span>
          </div>
          <div>
            <strong style="color: #4facfe;">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> 
            <span style="color: #ffd700; font-size: 1.2rem;">${savedSession.selectedStudents.length} Ø·Ø§Ù„Ø¨</span>
          </div>
          <div>
            <strong style="color: #4facfe;">Ø§Ù„Ø·Ù„Ø§Ø¨:</strong>
            <div style="color: rgba(255,255,255,0.9); margin-top: 0.5rem; 
                        max-height: 120px; overflow-y: auto; font-size: 0.9rem;">
              ${savedSession.selectedStudents.join(' â€¢ ')}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
      <div style="display: grid; gap: 1rem; max-width: 400px; margin: 0 auto;">
        <button class="neural-button" onclick="continueWithSavedSession()" 
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                       font-size: 1.1rem; padding: 1rem;">
          âœ… Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ÙŠÙ†
        </button>
        
        <button class="neural-button" onclick="startFreshSession()" 
                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); 
                       font-size: 1.1rem; padding: 1rem;">
          ğŸ†• Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
        
        <button class="neural-button" onclick="viewSavedStudents()" 
                style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
                       font-size: 0.9rem; padding: 0.8rem;">
          ğŸ‘€ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ÙŠÙ†
        </button>
      </div>
      
      <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem; margin-top: 2rem;">
        ğŸ’¡ Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ø³ÙŠÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø±Ø§Ø­ØªÙƒ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
      </p>
    </div>
  `;
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ©
  playCosmicSound('notification-pop');
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
  setTimeout(() => {
    showQuantumNotification('ğŸ’¾ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©!', 
      'ÙˆÙØ¬Ø¯Øª Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©. Ø§Ø®ØªØ± Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯', 
      'info');
  }, 500);
}

// Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
function continueWithSavedSession() {
  const savedSession = loadTeacherSession();
  if (savedSession) {
    restoreTeacherSession(savedSession);
    
    // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
    const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
    if (sessionOptionsPanel) {
      sessionOptionsPanel.style.display = 'none';
    }
    
    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ
    showKingdoms();
    
    // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ©
    playCosmicSound('success-chime');
    
    // Ø¥Ø´Ø¹Ø§Ø± Ø¥Ø¶Ø§ÙÙŠ
    setTimeout(() => {
      showQuantumNotification('ğŸš€ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!', 
        'ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¬Ù„Ø³ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø£ÙŠ Ù…Ù…Ù„ÙƒØ©!', 
        'success');
    }, 1000);
  } else {
    console.error('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©');
    startFreshSession();
  }
}

// Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
function startFreshSession() {
  // Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  clearTeacherSession();
  
  // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
  const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  if (sessionOptionsPanel) {
    sessionOptionsPanel.style.display = 'none';
  }
  
  // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ
  proceedToClassSelection();
  
  playCosmicSound('cosmic-click');
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ÙŠÙ†
function viewSavedStudents() {
  const savedSession = loadTeacherSession();
  if (!savedSession) return;
  
  const sessionOptionsPanel = document.getElementById('sessionOptionsPanel');
  
  sessionOptionsPanel.innerHTML = `
    <div style="text-align: center; padding: 3rem; max-width: 700px; margin: 0 auto;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ‘¥</div>
      <h2 style="color: #ffd700; margin-bottom: 2rem;">
        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
      </h2>
      
      <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3); 
                  border-radius: 15px; padding: 2rem; margin-bottom: 2rem; text-align: right;">
        <h3 style="color: #4facfe; margin-bottom: 1rem;">ğŸ“š ${savedSession.selectedClass}</h3>
        <div style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">
          ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ÙØ¸: ${new Date(savedSession.timestamp).toLocaleString('ar-SA')}
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                    gap: 1rem; margin-top: 1.5rem;">
          ${savedSession.selectedStudents.map((student, index) => `
            <div style="background: rgba(79, 172, 254, 0.1); border: 1px solid rgba(79, 172, 254, 0.3);
                        border-radius: 10px; padding: 1rem; text-align: center;">
              <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ‘¨â€ğŸ“</div>
              <div style="color: #ffd700; font-weight: bold;">${student}</div>
              <div style="color: rgba(255,255,255,0.6); font-size: 0.8rem;">Ø§Ù„Ø·Ø§Ù„Ø¨ Ø±Ù‚Ù… ${index + 1}</div>
            </div>
          `).join('')}
        </div>
      </div>
      
      <div style="display: grid; gap: 1rem; max-width: 400px; margin: 0 auto;">
        <button class="neural-button" onclick="continueWithSavedSession()" 
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø¤Ù„Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨
        </button>
        
        <button class="neural-button" onclick="showTeacherSessionOptions(loadTeacherSession())" 
                style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          â†©ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®ÙŠØ§Ø±Ø§Øª
        </button>
      </div>
    </div>
  `;
  
  playCosmicSound('cosmic-click');
}

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
function proceedToClassSelection() {
  // Show main app container
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
  }
  
  // Hide main dashboard
  document.getElementById('kingdomContent').style.display = 'none';
  
  // Show selection panel
  document.getElementById('selectionPanel').style.display = 'block';
  
  const classGrid = document.getElementById('classGrid');
  if (!classGrid) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ classGrid');
    return;
  }
  
  classGrid.innerHTML = '';
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  if (!studentData || Object.keys(studentData).length === 0) {
    console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨');
    classGrid.innerHTML = `
      <div style="text-align: center; color: #ff6b6b; padding: 2rem; grid-column: 1 / -1;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
        <h3>Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <p>Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        <button class="neural-button" onclick="reloadStudentData()" style="margin-top: 1rem;">
          ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        </button>
      </div>
    `;
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    setTimeout(() => {
      initializeEmbeddedStudentData();
      if (Object.keys(studentData).length > 0) {
        proceedToClassSelection(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      }
    }, 1000);
    return;
  }
  
  // Ø¹Ø±Ø¶ Ø§Ù„ØµÙÙˆÙ
  Object.keys(studentData).forEach(className => {
    const classCard = document.createElement('div');
    classCard.className = 'class-card';
    classCard.onclick = () => selectClass(className);
    
    classCard.innerHTML = `
      <div class="class-icon">ğŸ“š</div>
      <h3>${className}</h3>
      <p>${studentData[className].length} Ø·Ø§Ù„Ø¨</p>
      <div class="class-hover-effect"></div>
    `;
    
    classGrid.appendChild(classCard);
  });
  
  playCosmicSound('panel-slide');
}

let studentData = {};
let selectedStudentsList = [];

// ===== ENHANCED STUDENT MANAGEMENT SYSTEM =====
function loadClassSelection() {
  console.log('ğŸ“ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙÙˆÙ');
  console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªØ§Ø­Ø©:', Object.keys(studentData));
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ù…Ø¹Ù„Ù…
  const savedSession = loadTeacherSession();
  if (savedSession) {
    console.log('ğŸ’¾ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ù…Ø¹Ù„Ù…');
    
    // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù„Ù…Ø¹Ù„Ù…
    showTeacherSessionOptions(savedSession);
    return; // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†ÙÙŠØ° Ø­ØªÙ‰ ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ø¹Ù„Ù…
  }
  
  // Show main app container
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
  }
  
  // Hide main dashboard
  document.getElementById('kingdomContent').style.display = 'none';
  
  // Show selection panel
  document.getElementById('selectionPanel').style.display = 'block';
  
  const classGrid = document.getElementById('classGrid');
  if (!classGrid) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ classGrid');
    return;
  }
  
  classGrid.innerHTML = '';
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  if (!studentData || Object.keys(studentData).length === 0) {
    console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨');
    classGrid.innerHTML = `
      <div style="text-align: center; color: #ff6b6b; padding: 2rem; grid-column: 1 / -1;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
        <h3>Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <p>Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        <button class="neural-button" onclick="reloadStudentData()" style="margin-top: 1rem;">
          ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        </button>
      </div>
    `;
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    loadStudentData().then(() => {
      loadClassSelection(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    }).catch(error => {
      console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
    });
    return;
  }
  
  const classNames = Object.keys(studentData);
  console.log(`ğŸ“š ØªØ­Ù…ÙŠÙ„ ${classNames.length} ØµÙÙˆÙ:`, classNames);
  
  classNames.forEach(className => {
    const classCard = document.createElement('div');
    classCard.className = 'class-card';
    classCard.style.cursor = 'pointer';
    
    // Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø« Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø©
    classCard.addEventListener('click', function() {
      console.log('ğŸ–±ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØµÙ:', className);
      
      // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ ÙÙˆØ±ÙŠ
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = '';
      }, 150);
      
      // ØªØ£Ø«ÙŠØ± ØµÙˆØªÙŠ
      playCosmicSound('button-click', { volume: 0.3 });
      
      // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
      selectClass(className);
    });
    
    const studentCount = studentData[className].length;
    
    classCard.innerHTML = `
      <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ«</div>
      <h4 style="margin: 0; color: #ffd700;">${className}</h4>
      <div class="student-count" style="color: #00ffff; margin-top: 0.5rem;">${studentCount} Ø·Ø§Ù„Ø¨</div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª hover
    classCard.addEventListener('mouseenter', () => {
      playCosmicSound('button-hover', { volume: 0.2 });
    });
    
    classGrid.appendChild(classCard);
  });
  
  playCosmicSound('panel-slide');
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙÙˆÙ
  showQuantumNotification(
    `ğŸ“š ØªÙ… ØªØ­Ù…ÙŠÙ„ ${Object.keys(studentData).length} ØµÙÙˆÙ`,
    'Ø§Ø®ØªØ± ØµÙÙƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©',
    'success'
  );
  
  console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØµÙÙˆÙ Ø¨Ù†Ø¬Ø§Ø­');
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨
async function reloadStudentData() {
  showQuantumNotification('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', '', 'info');
  
  try {
    await loadStudentData();
    loadClassSelection();
    showQuantumNotification('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', '', 'success');
  } catch (error) {
    showQuantumNotification('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'error');
  }
}

function selectClass(className) {
  gameState.selectedClass = className;
  
  console.log('ğŸ“ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ:', className);
  
  // Update visual selection
  document.querySelectorAll('.class-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Find and select the clicked card
  const clickedCard = Array.from(document.querySelectorAll('.class-card')).find(card => 
    card.textContent.includes(className)
  );
  if (clickedCard) {
    clickedCard.classList.add('selected');
  }
  
  // Load students for selected class
  loadStudentSelection(className);
  
  // Show student selection section
  const studentSection = document.getElementById('studentSelectionSection');
  if (studentSection) {
    studentSection.style.display = 'block';
    
    // Scroll to student selection
    studentSection.scrollIntoView({ 
      behavior: 'smooth' 
    });
  }
  
  // Play selection sound
  playCosmicSound('cosmic-click');
  
  // Show success notification
  showQuantumNotification(
    `âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙ ${className}`,
    `${studentData[className]?.length || 0} Ø·Ø§Ù„Ø¨ Ù…ØªØ§Ø­`,
    'success'
  );
}

function loadStudentSelection(className) {
  console.log('ğŸ“š ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø§Ø¨ Ø§Ù„ØµÙ:', className);
  console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨:', studentData[className]);
  
  const studentsGrid = document.getElementById('studentsGrid');
  if (!studentsGrid) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ studentsGrid');
    return;
  }
  
  studentsGrid.innerHTML = '';
  
  selectedStudentsList = []; // Reset selection
  updateSelectedCount();
  
  const students = studentData[className] || [];
  
  if (students.length === 0) {
    studentsGrid.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; color: #ff6b6b; padding: 2rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù„Ù‡Ø°Ø§ Ø§Ù„ØµÙ</h3>
        <p>ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
      </div>
    `;
    return;
  }
  
  console.log(`ğŸ‘¥ ØªØ­Ù…ÙŠÙ„ ${students.length} Ø·Ø§Ù„Ø¨`);
  
  students.forEach((studentName, index) => {
    console.log(`ğŸ‘¤ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø·Ø§Ù„Ø¨: ${studentName} (Ø§Ù„ÙÙ‡Ø±Ø³: ${index})`);
    
    const studentCard = document.createElement('div');
    studentCard.className = 'student-card';
    studentCard.dataset.studentName = studentName;
    studentCard.dataset.studentIndex = index;
    
    // Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø« Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø© ÙˆÙ…ÙØµÙ„Ø©
    studentCard.addEventListener('click', function(event) {
      console.log('ğŸ–±ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨:', studentName);
      console.log('ğŸ¯ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ù‚ÙˆØ±:', this);
      event.preventDefault();
      event.stopPropagation();
      toggleStudentSelection(this, studentName);
    });
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± hover
    studentCard.addEventListener('mouseenter', function() {
      console.log('ğŸ­ Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§ÙˆØ³ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø©:', studentName);
      playCosmicSound('button-hover', { volume: 0.1 });
    });
    
    studentCard.innerHTML = `
      <div class="selection-indicator">â—‹</div>
      <div class="student-name">${studentName}</div>
    `;
    
    console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
    studentsGrid.appendChild(studentCard);
  });
  
  playCosmicSound('magic-sparkle');
  console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
}

function toggleStudentSelection(cardElement, studentName) {
  console.log('ğŸ¯ Ø¨Ø¯Ø¡ ØªØ¨Ø¯ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨:', studentName);
  console.log('ğŸ“‹ Ø¹Ù†ØµØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:', cardElement);
  
  if (!cardElement) {
    console.error('âŒ Ø¹Ù†ØµØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    return;
  }
  
  if (!studentName) {
    console.error('âŒ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    return;
  }
  
  const isSelected = cardElement.classList.contains('selected');
  console.log('ğŸ” Ù‡Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ', isSelected);
  
  const selectionIndicator = cardElement.querySelector('.selection-indicator');
  if (!selectionIndicator) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±');
    return;
  }
  
  if (isSelected) {
    // Deselect
    console.log('â– Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨');
    cardElement.classList.remove('selected');
    selectionIndicator.textContent = 'â—‹';
    selectedStudentsList = selectedStudentsList.filter(name => name !== studentName);
    playCosmicSound('button-hover');
  } else {
    // Select
    console.log('â• ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨');
    cardElement.classList.add('selected');
    selectionIndicator.textContent = 'âœ“';
    selectedStudentsList.push(studentName);
    playCosmicSound('point-earn');
  }
  
  console.log('ğŸ“Š Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†:', selectedStudentsList);
  updateSelectedCount();
  
  // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„ØªØ£ÙƒÙŠØ¯
  cardElement.style.transform = 'scale(1.05)';
  setTimeout(() => {
    cardElement.style.transform = '';
  }, 200);
}

function selectAllStudents() {
  const studentCards = document.querySelectorAll('.student-card');
  selectedStudentsList = [];
  
  studentCards.forEach(card => {
    card.classList.add('selected');
    card.querySelector('.selection-indicator').textContent = 'âœ“';
    selectedStudentsList.push(card.dataset.studentName);
  });
  
  updateSelectedCount();
  playCosmicSound('achievement-unlock');
}

function clearAllStudents() {
  const studentCards = document.querySelectorAll('.student-card');
  selectedStudentsList = [];
  
  studentCards.forEach(card => {
    card.classList.remove('selected');
    card.querySelector('.selection-indicator').textContent = 'â—‹';
  });
  
  updateSelectedCount();
  playCosmicSound('cosmic-click');
}

function selectRandomStudents() {
  clearAllStudents();
  
  const studentCards = Array.from(document.querySelectorAll('.student-card'));
  const randomCount = Math.min(8, Math.max(4, Math.floor(studentCards.length * 0.4)));
  
  // Shuffle and select random students
  const shuffled = studentCards.sort(() => 0.5 - Math.random());
  const selected = shuffled.slice(0, randomCount);
  
  selected.forEach(card => {
    card.classList.add('selected');
    card.querySelector('.selection-indicator').textContent = 'âœ“';
    selectedStudentsList.push(card.dataset.studentName);
  });
  
  updateSelectedCount();
  playSoundSequence(['cosmic-explosion', 'point-earn'], 300);
}

function quickSelectCount() {
  const studentCards = document.querySelectorAll('.student-card');
  const maxCount = studentCards.length;
  
  const count = parseInt(prompt(`ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø§Ø®ØªÙŠØ§Ø±Ù‡Ù…ØŸ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${maxCount})`, '6'));
  
  if (count && count > 0 && count <= maxCount) {
    clearAllStudents();
    
    const shuffled = Array.from(studentCards).sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, count);
    
    selected.forEach(card => {
      card.classList.add('selected');
      card.querySelector('.selection-indicator').textContent = 'âœ“';
      selectedStudentsList.push(card.dataset.studentName);
    });
    
    updateSelectedCount();
    playCosmicSound('level-up');
  }
}

function updateSelectedCount() {
  console.log('ğŸ”¢ ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†...');
  
  const countElement = document.getElementById('selectedCount');
  const startBtn = document.getElementById('startGameBtn');
  
  if (!countElement) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± Ø§Ù„Ø¹Ø¯ selectedCount');
    return;
  }
  
  if (!startBtn) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ startGameBtn');
    return;
  }
  
  const selectedCount = selectedStudentsList.length;
  console.log(`ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†: ${selectedCount}`);
  console.log('ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†:', selectedStudentsList);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
  countElement.textContent = selectedCount;
  countElement.style.transform = 'scale(1.2)';
  countElement.style.color = selectedCount > 0 ? '#00ffff' : '#ffffff';
  
  setTimeout(() => {
    countElement.style.transform = 'scale(1)';
  }, 200);
  
  // Enable/disable start button
  if (selectedCount >= 2) {
    console.log('âœ… ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ - ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ ÙƒØ§ÙÙŠ Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨');
    startBtn.disabled = false;
    startBtn.style.opacity = '1';
    startBtn.style.cursor = 'pointer';
    startBtn.style.transform = 'scale(1.05)';
    
    // Ø¥Ø´Ø¹Ø§Ø± Ø¨ØµØ±ÙŠ Ù„Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯
    showQuantumNotification(
      'ğŸ¯ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡!',
      `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedCount} Ø·Ø§Ù„Ø¨`,
      'success'
    );
  } else {
    console.log('âš ï¸ ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ - Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ ØºÙŠØ± ÙƒØ§ÙÙŠ');
    startBtn.disabled = true;
    startBtn.style.opacity = '0.5';
    startBtn.style.cursor = 'not-allowed';
    startBtn.style.transform = 'scale(1)';
    
    if (selectedCount === 1) {
      showQuantumNotification(
        'â³ Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨ Ø¢Ø®Ø±',
        'ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¥Ù„Ù‰ Ø·Ø§Ù„Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
        'info'
      );
    }
  }
  
  console.log(`ğŸ® Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡: ${startBtn.disabled ? 'Ù…Ø¹Ø·Ù„' : 'Ù…ÙØ¹Ù„'}`);
}

function startKingdomGame() {
  if (selectedStudentsList.length < 2) {
    showQuantumNotification('âš ï¸ ØªØ­Ø°ÙŠØ±', 'ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©', 'warning');
    return;
  }
  
  gameState.selectedStudents = [...selectedStudentsList];
  gameState.gameStarted = true;
  
  // ğŸ’¾ Ø­ÙØ¸ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  saveTeacherSession();
  
  // Hide selection panel and show game interface
  document.getElementById('selectionPanel').style.display = 'none';
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('gameInterface').style.display = 'block';
  
  // Generate teams from selected students
  generateTeamsFromStudents();
  
  // Play epic start sequence
  playSoundSequence([
    'royal-fanfare',
    'kingdom-enter',
    'epic-charge'
  ], 1000);
  
  showQuantumNotification(
    'ğŸ† Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¨Ø¯Ø£Øª!', 
    `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedStudentsList.length} Ù…Ø´Ø§Ø±Ùƒ Ù…Ù† ${gameState.selectedClass}`, 
    'success'
  );
  
  // Show welcome message after selection
  setTimeout(() => {
    showWelcomeMessage();
  }, 2000);
}

function generateTeamsFromStudents() {
  const studentsCount = selectedStudentsList.length;
  const teamCount = Math.min(4, Math.max(2, Math.ceil(studentsCount / 3)));
  
  gameState.teams = [];
  const teamIcons = ['ğŸ¦', 'ğŸ‰', 'ğŸ¦…', 'ğŸº', 'ğŸ¦„', 'ğŸ”¥'];
  const teamNames = ['Ù…Ø­Ø§Ø±Ø¨Ùˆ Ø§Ù„Ù†ÙˆØ±', 'ÙØ±Ø³Ø§Ù† Ø§Ù„Ø¸Ù„Ø§Ù…', 'Ø­Ù…Ø§Ø© Ø§Ù„Ø³Ù…Ø§Ø¡', 'Ø£Ø³ÙŠØ§Ø¯ Ø§Ù„Ø£Ø±Ø¶', 'Ø³Ø­Ø±Ø© Ø§Ù„Ø²Ù…Ù†', 'Ø¹Ù…Ø§Ù„Ù‚Ø© Ø§Ù„Ù‚ÙˆØ©'];
  
  // Shuffle students for random team assignment
  const shuffledStudents = [...selectedStudentsList].sort(() => 0.5 - Math.random());
  
  for (let i = 0; i < teamCount; i++) {
    const team = {
      id: i + 1,
      name: teamNames[i] || `Ø§Ù„ÙØ±ÙŠÙ‚ ${i + 1}`,
      icon: teamIcons[i] || 'â­',
      score: 0,
      energy: 100,
      members: []
    };
    
    // Assign students to teams (round robin)
    for (let j = i; j < shuffledStudents.length; j += teamCount) {
      team.members.push(shuffledStudents[j]);
    }
    
    gameState.teams.push(team);
  }
  
  console.log('Generated teams:', gameState.teams);
}

function backToSetup() {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ø´Ø§Ø·ØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ.')) {
    gameState.gameStarted = false;
    gameState.isActive = false;
    
    // Reset game state
    if (gameState.battleTimer) {
      clearInterval(gameState.battleTimer);
      gameState.battleTimer = null;
    }
    
    // Show selection panel and hide game interface
    document.getElementById('selectionPanel').style.display = 'block';
    document.getElementById('gameInterface').style.display = 'none';
    document.getElementById('battleArena').style.display = 'none';
    
    playCosmicSound('panel-slide');
  }
}

// ===== TEACHER GUIDE FUNCTIONS =====
function openTeacherGuide() {
  document.getElementById('teacherGuideModal').style.display = 'block';
  playCosmicSound('menu-open');
}

function showTeacherGuide() {
  openTeacherGuide();
}

function closeTeacherGuide() {
  document.getElementById('teacherGuideModal').style.display = 'none';
  playCosmicSound('cosmic-click');
}
let aiCoachMessages = [
  "ğŸŒŸ Ù…Ù…ØªØ§Ø²! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…ØªÙ…ÙŠØ²",
  "ğŸ’ª Ù‚ÙˆØ© Ø§Ù„ØªØ±ÙƒÙŠØ² Ù‡ÙŠ Ø³Ù„Ø§Ø­Ùƒ Ø§Ù„Ø³Ø±ÙŠ",
  "ğŸ§  ÙÙƒØ± Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù„ØªØ¬Ø¯ Ø§Ù„Ø­Ù„",
  "âš¡ Ø§Ù„Ø³Ø±Ø¹Ø© Ù…Ù‡Ù…Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø¯Ù‚Ø© Ø£Ù‡Ù…",
  "ğŸ¯ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø¯Ù ÙˆÙ„Ø§ ØªØ¯Ø¹ Ø´ÙŠØ¦Ø§Ù‹ ÙŠØ´ØªØª Ø§Ù†ØªØ¨Ø§Ù‡Ùƒ",
  "ğŸš€ Ø£Ù†Øª ØªØªÙ‚Ø¯Ù… Ø¨Ø³Ø±Ø¹Ø© Ù†Ø­Ùˆ Ø§Ù„Ù†ØµØ±",
  "ğŸ’ ÙƒÙ„ ØªØ­Ø¯Ù ØªØªØºÙ„Ø¨ Ø¹Ù„ÙŠÙ‡ ÙŠØ¬Ø¹Ù„Ùƒ Ø£Ù‚ÙˆÙ‰",
  "ğŸ”¥ Ø§Ù„Ø­Ù…Ø§Ø³ Ù‡Ùˆ ÙˆÙ‚ÙˆØ¯ Ø§Ù„Ù†Ø¬Ø§Ø­"
];

// ===== INITIALIZATION =====
window.addEventListener('load', async () => {
  await initializeKingdom();
});

function initParticles() {
  particlesJS('particles-js', {
    particles: {
      number: { value: 100 },
      color: { value: ['#00ffff', '#ff00ff', '#ffd700'] },
      shape: { type: 'circle' },
      opacity: { value: 0.6, random: true },
      size: { value: 3, random: true },
      line_linked: { enable: true, distance: 150, color: '#ffffff', opacity: 0.4, width: 1 },
      move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
    },
    interactivity: {
      detect_on: 'canvas',
      events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
      modes: { grab: { distance: 400, line_linked: { opacity: 1 } }, bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 }, repulse: { distance: 200, duration: 0.4 }, push: { particles_nb: 4 }, remove: { particles_nb: 2 } }
    },
    retina_detect: true
  });
}

async function loadStudentData() {
  try {
    const response = await fetch('../data/studentData.json');
    if (response.ok) {
      studentData = await response.json();
      console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­:', Object.keys(studentData));
    } else {
      throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
  } catch (error) {
    console.warn('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£ÙƒØ«Ø± ØªÙØµÙŠÙ„Ø§Ù‹
    studentData = {
      "Ø®Ø§Ù…Ø³ 1": [
        "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ§Ø¨ÙŠ", "ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù… Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ", 
        "Ù…Ø±ÙŠÙ… Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ", "Ø³Ø¹ÙŠØ¯ ÙŠÙˆØ³Ù Ø§Ù„Ù…Ø­Ø±Ù…ÙŠ", "Ù†ÙˆØ± Ø­Ø³Ù† Ø§Ù„Ø±ÙˆØ§Ø­ÙŠ",
        "Ø®Ø§Ù„Ø¯ Ø·Ø§Ø±Ù‚ Ø§Ù„Ø¨ÙˆØ³Ø¹ÙŠØ¯ÙŠ", "Ø¹Ø§Ø¦Ø´Ø© Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„ÙØ§Ø±Ø³ÙŠ"
      ],
      "Ø®Ø§Ù…Ø³ 2": [
        "Ø³Ø§Ø±Ø© Ø­Ø³Ù† Ø§Ù„ÙŠØ­ÙŠØ§Ø¦ÙŠ", "Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø± Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ", "Ù†ÙˆØ± Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…Ø³Ø§ÙØ±", 
        "Ø¹Ø§Ø¦Ø´Ø© Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¶Ø§Ù…Ø±ÙŠ", "Ø±Ø§Ø´Ø¯ Ø³Ø§Ù„Ù… Ø§Ù„ÙˆÙ‡ÙŠØ¨ÙŠ", "Ø²ÙŠÙ†Ø¨ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¨Ø³ÙŠ",
        "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø±ÙŠÙƒÙŠ", "Ù„Ø·ÙŠÙØ© Ù…Ø­Ù…Ø¯ Ø§Ù„ØµØ¨Ø­ÙŠ"
      ],
      "Ø³Ø§Ø¯Ø³ 1": [
        "Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø²Ø¯Ø¬Ø§Ù„ÙŠ", "Ø­Ù„ÙŠÙ…Ø© Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ", "ÙŠÙˆØ³Ù Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø®Ø±Ø¨ÙˆØ´ÙŠ",
        "Ø®Ø¯ÙŠØ¬Ø© Ø¹Ù„ÙŠ Ø§Ù„Ø­ÙˆØ³Ù†ÙŠ", "Ø·Ø§Ø±Ù‚ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø¨Ù„ÙˆØ´ÙŠ", "Ø¢Ù…Ù†Ø© Ø­Ù…ÙˆØ¯ Ø§Ù„Ø­Ø¶Ø±Ù…ÙŠ"
      ],
      "Ø³Ø§Ø¯Ø³ 2": [
        "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø³Ø§Ù„Ù… Ø§Ù„Ù„ÙŠØ«ÙŠ", "Ø±Ù‚ÙŠØ© Ù…Ø­Ù…Ø¯ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ", "Ø­Ù…Ø²Ø© Ø£Ø­Ù…Ø¯ Ø§Ù„ÙŠÙˆØ³ÙÙŠ",
        "ÙØ§Ø·Ù…Ø© Ø³ÙŠÙ Ø§Ù„Ø³Ø¹ÙŠØ¯ÙŠ", "Ø¹Ø«Ù…Ø§Ù† Ù†Ø§ØµØ± Ø§Ù„Ù‡Ø·Ø§Ù„ÙŠ", "Ø®ÙˆÙ„Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø³Ù„Ù…ÙŠ"
      ]
    };
    console.log('ğŸ“š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', Object.keys(studentData));
  }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
async function reloadStudentData() {
  console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...');
  
  try {
    showQuantumNotification('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„...', 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'info');
    
    const response = await fetch('../data/studentData.json?' + new Date().getTime());
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', Object.keys(data));
    
    studentData = data;
    
    showQuantumNotification(
      'âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­',
      `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${Object.keys(data).length} ØµÙÙˆÙ`,
      'success'
    );
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙÙˆÙ
    setTimeout(() => {
      loadClassSelection();
    }, 1000);
    
  } catch (error) {
    console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
    showQuantumNotification(
      'âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„',
      'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
      'error'
    );
  }
}

// Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Ù„Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªØ´Ø®ÙŠØµ)
function testSelectionSystem() {
  console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±...');
  
  const studentCards = document.querySelectorAll('.student-card');
  console.log(`ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${studentCards.length} Ø¨Ø·Ø§Ù‚Ø© Ø·Ø§Ù„Ø¨`);
  
  if (studentCards.length === 0) {
    console.error('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø·Ù„Ø§Ø¨ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    showQuantumNotification(
      'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±',
      'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ø·Ù„Ø§Ø¨',
      'error'
    );
    return;
  }
  
  // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„
  const firstCard = studentCards[0];
  const studentName = firstCard.dataset.studentName;
  
  console.log(`ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentName}`);
  
  // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ù†Ù‚Ø±
  firstCard.click();
  
  setTimeout(() => {
    console.log('ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:');
    console.log('- Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†:', selectedStudentsList.length);
    console.log('- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨:', selectedStudentsList);
    console.log('- Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:', firstCard.classList.contains('selected') ? 'Ù…Ø­Ø¯Ø¯Ø©' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©');
    
    const indicator = firstCard.querySelector('.selection-indicator');
    console.log('- Ù†Øµ Ø§Ù„Ù…Ø¤Ø´Ø±:', indicator ? indicator.textContent : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
    
    if (selectedStudentsList.length > 0 && firstCard.classList.contains('selected')) {
      showQuantumNotification(
        'âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¹Ù…Ù„',
        'ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­',
        'success'
      );
    } else {
      showQuantumNotification(
        'âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…',
        'ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±',
        'error'
      );
    }
  }, 500);
}

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ù…Ø© (Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†)
window.testSelectionSystem = testSelectionSystem;

// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
function ensureControlHeaderVisible() {
  console.log('ğŸ”§ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…...');
  
  const controlHeader = document.querySelector('.cosmic-control-header');
  if (!controlHeader) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ header Ø§Ù„ØªØ­ÙƒÙ…');
    return;
  }
  
  // ÙØ±Ø¶ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¹Ù†ØµØ±
  controlHeader.style.display = 'flex';
  controlHeader.style.visibility = 'visible';
  controlHeader.style.opacity = '1';
  controlHeader.style.zIndex = '99999';
  controlHeader.style.position = 'fixed';
  controlHeader.style.top = '0';
  controlHeader.style.left = '0';
  controlHeader.style.right = '0';
  
  // ÙØ­Øµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©
  const buttons = controlHeader.querySelectorAll('.cosmic-control-btn');
  console.log(`ğŸ® ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${buttons.length} Ø£Ø²Ø±Ø§Ø± ØªØ­ÙƒÙ…`);
  
  buttons.forEach((btn, index) => {
    btn.style.display = 'flex';
    btn.style.visibility = 'visible';
    btn.style.opacity = '1';
    console.log(`âœ… Ø²Ø± ${index + 1} Ù…Ø±Ø¦ÙŠ:`, btn.id || btn.textContent);
  });
  
  // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ù…Ø­ØªÙˆÙ‰ ØªØ­Øª Ø§Ù„Ø´Ø±ÙŠØ·
  document.body.style.paddingTop = '80px';
  
  console.log('âœ… ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…');
}

// ===== REALM ACTIVATION =====
function activateRealm(realmType) {
  gameState.currentRealm = realmType;
  
  createCosmicExplosion(event.target);
  
  // Enhanced realm-specific sound effects
  switch(realmType) {
    case 'lightning':
      playSoundSequence(['cosmic-portal', 'lightning-strike'], 300);
      break;
    case 'wisdom':
      playSoundSequence(['cosmic-portal', 'wisdom-chime'], 300);
      break;
    case 'battle':
      playSoundSequence(['cosmic-portal', 'war-drum'], 300);
      break;
    case 'mystery':
      playSoundSequence(['cosmic-portal', 'mystery-whisper'], 300);
      break;
  }
  
  setTimeout(() => {
    switch(realmType) {
      case 'lightning':
        // Ø±Ø³Ø§Ø¦Ù„ ØªØ±Ø­ÙŠØ¨ÙŠØ© Ø®Ø§ØµØ© Ø¨Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚
        const lightningWelcomeMessages = [
          'âš¡ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„ØµÙˆØ§Ø¹Ù‚ ÙˆØ§Ù„Ø¨Ø±Ù‚!',
          'ğŸŒ©ï¸ Ø³ØªØ®ØªØ¨Ø±ÙˆÙ† Ù‚ÙˆØ© Ø§Ù„Ø¹Ù‚ÙˆÙ„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©!',
          'ğŸ’« Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ø±Ø­Ù„Ø© Ø¹Ø¨Ø± Ø¹Ø§Ù„Ù… Ø§Ù„Ø·Ø§Ù‚Ø©!',
          'ğŸ”¥âš¡ Ø§Ù„Ù†ÙŠØ±Ø§Ù† ÙˆØ§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ ØªÙ†ØªØ¸Ø±ÙƒÙ…!',
          'âš¡ğŸ§  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ Ø§Ù„Ø®Ø§Ø±Ù‚ÙŠÙ†!'
        ];
        const randomLightningWelcome = lightningWelcomeMessages[Math.floor(Math.random() * lightningWelcomeMessages.length)];
        showQuantumNotification('âš¡ Ø¯Ø®ÙˆÙ„ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚', randomLightningWelcome, 'battle');
        setTimeout(() => startLightningChallenge(), 1000);
        break;
      case 'wisdom':
        startWisdomChallenge();
        break;
      case 'battle':
        enterBattleArena();
        break;
      case 'mystery':
        startMysteryChallenge();
        break;
    }
  }, 500);
}

function enterBattleArena() {
  document.getElementById('kingdomDashboard').style.display = 'none';
  document.getElementById('battleArena').style.display = 'block';
  
  // Epic battle arena entrance
  playCosmicSound('battle-horn', { volume: 0.8 });
  setTimeout(() => playCosmicSound('epic-charge'), 1000);
  
  showQuantumNotification('âš”ï¸ Ø¯Ø®ÙˆÙ„ Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©', 'Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©!', 'battle');
  generateTeams();
}

function generateTeams() {
  const teamsContainer = document.getElementById('teamsHologram');
  teamsContainer.innerHTML = '';
  
  // If no teams generated yet, generate from selected students
  if (gameState.teams.length === 0) {
    generateTeamsFromStudents();
  }
  
  gameState.teams.forEach(team => {
    const teamElement = document.createElement('div');
    teamElement.className = 'team-hologram';
    
    // Create members list display
    const membersDisplay = team.members.length > 0 
      ? `<div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">
           Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${team.members.slice(0, 2).join(', ')}${team.members.length > 2 ? '...' : ''}
         </div>`
      : '';
    
    teamElement.innerHTML = `
      <div class="team-avatar-3d">${team.icon}</div>
      <div class="team-name-glow">${team.name}</div>
      <div class="score-crystal" id="score-${team.id}">${team.score}</div>
      ${membersDisplay}
      <div style="margin-top: 1rem;">
        <button class="neural-button" onclick="addPointToTeam(${team.id})">â¬†ï¸ Ù†Ù‚Ø·Ø©</button>
        <button class="neural-button" onclick="removePointFromTeam(${team.id})">â¬‡ï¸ Ø®ØµÙ…</button>
      </div>
      <div style="margin-top: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
        Ø§Ù„Ø·Ø§Ù‚Ø©: <span id="energy-${team.id}">${team.energy}%</span>
      </div>
    `;
    
    teamsContainer.appendChild(teamElement);
  });
}

// ===== BATTLE SYSTEM =====
function startBattle() {
  if (gameState.isActive) return;
  
  gameState.isActive = true;
  gameState.battleDuration = 0;
  
  // Epic battle start sequence
  playSoundSequence([
    'battle-horn',
    { type: 'timer-start', options: { volume: 0.6 } },
    { type: 'epic-charge', options: { volume: 0.8 } }
  ], 800);
  
  showQuantumNotification('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©!', 'Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© Ø¨Ø¯Ø£Øª Ø§Ù„Ø¢Ù†!', 'success');
  
  gameState.battleTimer = setInterval(() => {
    gameState.battleDuration++;
    updateBattleTimer();
    
    // Random events during battle
    if (gameState.battleDuration % 30 === 0) {
      triggerRandomEvent();
    }
    
    // Countdown warning sounds
    if (gameState.battleDuration > 0 && gameState.battleDuration % 60 === 50) {
      playCosmicSound('time-warning');
    }
  }, 1000);
  
  // Start cosmic rain
  startCosmicRain();
}

function pauseBattle() {
  if (!gameState.isActive) return;
  
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  
  playCosmicSound('timer-pause');
  showQuantumNotification('â¸ï¸ Ù…Ø¹Ø±ÙƒØ© Ù…ØªÙˆÙ‚ÙØ©', 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ù…Ø¤Ù‚ØªØ§Ù‹', 'warning');
}

function endBattle() {
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  
  const winner = findWinner();
  
  // Victory sound sequence
  playSoundSequence([
    'battle-victory',
    'crown-ceremony',
    'crowd-cheer'
  ], 1000);
  
  celebrateVictory(winner);
  
  gameState.completedChallenges++;
  updateStats();
}

function resetArena() {
  gameState.isActive = false;
  clearInterval(gameState.battleTimer);
  gameState.battleDuration = 0;
  
  // Reset all teams
  gameState.teams.forEach(team => {
    team.score = 0;
    team.energy = 100;
    document.getElementById(`score-${team.id}`).textContent = '0';
    document.getElementById(`energy-${team.id}`).textContent = '100%';
  });
  
  updateBattleTimer();
  playCosmicSound('cosmic-click');
  showQuantumNotification('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©', 'info');
}

// ===== TEAM MANAGEMENT =====
function addPointToTeam(teamId) {
  const team = gameState.teams.find(t => t.id === teamId);
  if (team) {
    team.score++;
    document.getElementById(`score-${team.id}`).textContent = team.score;
    
    // Energy boost
    team.energy = Math.min(100, team.energy + 5);
    document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
    
    createCosmicStars();
    
    // Enhanced point sound effects
    if (team.score % 10 === 0) {
      playCosmicSound('perfect-score');
    } else if (team.score % 5 === 0) {
      playCosmicSound('achievement-unlock');
    } else {
      playCosmicSound('point-earn');
    }
    
    // Combo system
    const comboCount = getTeamCombo(teamId);
    if (comboCount >= 3) {
      playCosmicSound('combo-hit');
      setTimeout(() => playCosmicSound('energy-boost'), 200);
    }
    
    // Check for achievement
    if (team.score % 5 === 0) {
      showQuantumNotification('ğŸ† Ø¥Ù†Ø¬Ø§Ø²!', `${team.name} Ø­Ù‚Ù‚ ${team.score} Ù†Ù‚Ø§Ø·!`, 'achievement');
      playCosmicSound('level-up');
    }
  }
}

function removePointFromTeam(teamId) {
  const team = gameState.teams.find(t => t.id === teamId);
  if (team && team.score > 0) {
    team.score--;
    document.getElementById(`score-${team.id}`).textContent = team.score;
    
    // Energy drain
    team.energy = Math.max(0, team.energy - 3);
    document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
    
    playCosmicSound('point-lose');
  }
}

// Helper function for combo system
function getTeamCombo(teamId) {
  // Simple combo tracking (can be enhanced)
  if (!gameState.teamCombos) gameState.teamCombos = {};
  if (!gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  gameState.teamCombos[teamId]++;
  
  // Reset combo after 5 seconds
  setTimeout(() => {
    if (gameState.teamCombos[teamId]) gameState.teamCombos[teamId] = 0;
  }, 5000);
  
  return gameState.teamCombos[teamId];
}

// ===== SPECIAL EFFECTS =====
function createCosmicExplosion(element) {
  const rect = element.getBoundingClientRect();
  const explosion = document.createElement('div');
  explosion.className = 'cosmic-explosion';
  explosion.style.left = (rect.left + rect.width / 2 - 100) + 'px';
  explosion.style.top = (rect.top + rect.height / 2 - 100) + 'px';
  document.body.appendChild(explosion);
  
  setTimeout(() => explosion.remove(), 1000);
}

function createCosmicStars() {
  for (let i = 0; i < 10; i++) {
    setTimeout(() => {
      const star = document.createElement('div');
      star.className = 'cosmic-star';
      star.textContent = ['â­', 'âœ¨', 'ğŸ’«', 'ğŸŒŸ'][Math.floor(Math.random() * 4)];
      star.style.left = Math.random() * window.innerWidth + 'px';
      star.style.top = '-50px';
      document.body.appendChild(star);
      
      setTimeout(() => star.remove(), 4000);
    }, i * 100);
  }
}

function startCosmicRain() {
  const rainInterval = setInterval(() => {
    if (!gameState.isActive) {
      clearInterval(rainInterval);
      return;
    }
    
    createCosmicStars();
  }, 2000);
}

// ===== AI COACH SYSTEM =====
function getAITip() {
  const tip = aiCoachMessages[Math.floor(Math.random() * aiCoachMessages.length)];
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const tipElement = document.createElement('div');
  tipElement.style.cssText = `
    background: linear-gradient(45deg, rgba(0,255,255,0.2), rgba(255,0,255,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(0,255,255,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  tipElement.textContent = tip;
  
  messagesContainer.appendChild(tipElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Enhanced AI coach sounds
  playSoundSequence([
    'ai-beep',
    'ai-notification'
  ], 300);
}

function analyzePerformance() {
  const analysis = generatePerformanceAnalysis();
  const messagesContainer = document.getElementById('aiCoachMessages');
  
  const analysisElement = document.createElement('div');
  analysisElement.style.cssText = `
    background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,105,180,0.2));
    padding: 1rem;
    border-radius: 10px;
    margin: 0.5rem 0;
    border: 1px solid rgba(255,215,0,0.5);
    animation: fadeInUp 0.5s ease;
  `;
  analysisElement.innerHTML = analysis;
  
  messagesContainer.appendChild(analysisElement);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
  // Data processing sound sequence
  playSoundSequence([
    'scanner-beep',
    'data-process',
    'ai-notification'
  ], 500);
}

function generatePerformanceAnalysis() {
  const sessionMinutes = Math.floor((Date.now() - gameState.sessionStartTime) / 60000);
  const avgPointsPerMinute = sessionMinutes > 0 ? (getTotalPoints() / sessionMinutes).toFixed(1) : 0;
  
  return `
    ğŸ“Š <strong>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡:</strong><br>
    â±ï¸ ÙˆÙ‚Øª Ø§Ù„Ø¬Ù„Ø³Ø©: ${sessionMinutes} Ø¯Ù‚ÙŠÙ‚Ø©<br>
    ğŸ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: ${gameState.completedChallenges}<br>
    âš¡ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·/Ø¯Ù‚ÙŠÙ‚Ø©: ${avgPointsPerMinute}<br>
    ğŸ’ª ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡: ${getPerformanceRating(avgPointsPerMinute)}
  `;
}

function getPerformanceRating(avgPoints) {
  if (avgPoints >= 2) return "ğŸ”¥ Ù…Ù…ØªØ§Ø²";
  if (avgPoints >= 1) return "ğŸ’ª Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹";
  if (avgPoints >= 0.5) return "ğŸ‘ Ø¬ÙŠØ¯";
  return "ğŸ“ˆ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ø³Ù†";
}

// ===== UTILITY FUNCTIONS =====
function updateBattleTimer() {
  const minutes = Math.floor(gameState.battleDuration / 60);
  const seconds = gameState.battleDuration % 60;
  document.getElementById('challengeTimer').textContent = 
    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function startSessionTimer() {
  setInterval(() => {
    const elapsed = Math.floor((Date.now() - gameState.sessionStartTime) / 1000);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    document.getElementById('sessionTime').textContent = 
      `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }, 1000);
}

function showKingdoms() {
  console.log('ğŸ‘‘ Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ...');
  
  // Show main app container first
  const mainApp = document.getElementById('mainApp');
  if (mainApp) {
    mainApp.style.display = 'block';
    console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ');
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®Ø±Ù‰ Ø£ÙˆÙ„Ø§Ù‹
  const elementsToHide = [
    'selectionPanel', 'lightningArena', 'battleArena', 
    'gameInterface', 'wizardArena', 'mysteryArena'
  ];
  
  elementsToHide.forEach(elementId => {
    const element = document.getElementById(elementId);
    if (element) {
      element.style.display = 'none';
      console.log(`âœ… ØªÙ… Ø¥Ø®ÙØ§Ø¡ ${elementId}`);
    }
  });
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ Ø¨Ù‚ÙˆØ©
  const kingdomContent = document.getElementById('kingdomContent');
  if (kingdomContent) {
    kingdomContent.style.display = 'block';
    kingdomContent.style.visibility = 'visible';
    kingdomContent.style.opacity = '1';
    console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ kingdomContent');
  }
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ
  const kingdomDashboard = document.getElementById('kingdomDashboard');
  if (kingdomDashboard) {
    kingdomDashboard.style.display = 'grid';
    kingdomDashboard.style.visibility = 'visible';
    kingdomDashboard.style.opacity = '1';
    console.log('âœ… ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ kingdomDashboard');
  }
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  updateStats();
  console.log('ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ');
  
  // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£ÙŠ ØªØ­ÙˆÙ„Ø§Øª CSS
  document.body.style.overflow = 'auto';
}

function updateStats() {
  console.log('ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
  const challengesElement = document.getElementById('completedChallenges');
  if (challengesElement) {
    challengesElement.textContent = gameState.completedChallenges;
    console.log('âœ… Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©:', gameState.completedChallenges);
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± completedChallenges');
  }
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù‚Ø©
  gameState.energyLevel = Math.max(50, gameState.energyLevel - 5);
  const energyElement = document.getElementById('energyLevel');
  if (energyElement) {
    energyElement.textContent = gameState.energyLevel + '%';
    console.log('âœ… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ø§Ù‚Ø©:', gameState.energyLevel + '%');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± energyLevel');
  }
  
  console.log('ğŸ“Š Ø§Ù†ØªÙ‡Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
}

function getTotalPoints() {
  return gameState.teams.reduce((total, team) => total + team.score, 0);
}

function findWinner() {
  return gameState.teams.reduce((winner, team) => 
    team.score > winner.score ? team : winner
  );
}

function celebrateVictory(winner) {
  // Massive confetti celebration
  confetti({
    particleCount: 200,
    spread: 100,
    origin: { y: 0.6 },
    colors: ['#FFD700', '#FF6347', '#00FFFF', '#FF00FF']
  });
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.1, y: 0.7 }
    });
  }, 300);
  
  setTimeout(() => {
    confetti({
      particleCount: 150,
      spread: 120,
      origin: { x: 0.9, y: 0.7 }
    });
  }, 600);
  
  showQuantumNotification('ğŸ‘‘ Ø§Ù„Ù†ØµØ±!', `${winner.name} ÙØ§Ø² Ø¨Ø§Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©!`, 'victory');
  
  // Ultimate victory sound sequence
  playSoundSequence([
    'ultimate-triumph',
    'fireworks-burst',
    'golden-confetti'
  ], 1500);
  
  createCosmicStars();
}

function triggerRandomEvent() {
  const events = [
    { 
      text: 'âš¡ Ø¹Ø§ØµÙØ© ÙƒÙˆÙ†ÙŠØ©! Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±Ù‚ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø·Ø§Ù‚Ø© Ø¥Ø¶Ø§ÙÙŠØ©', 
      effect: 'energy_boost',
      sound: ['cosmic-explosion', 'energy-boost']
    },
    { 
      text: 'ğŸŒŸ Ù†Ø¬Ù… Ø³Ø§Ù‚Ø·! Ù†Ù‚Ø·Ø© Ù…Ø¶Ø§Ø¹ÙØ© Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ', 
      effect: 'double_points',
      sound: ['star-fall', 'bonus-collect']
    },
    { 
      text: 'ğŸŒ€ Ø¯ÙˆØ§Ù…Ø© Ø²Ù…Ù†ÙŠØ©! Ø§Ù„ÙˆÙ‚Øª ÙŠØªØ¨Ø§Ø·Ø£', 
      effect: 'time_slow',
      sound: ['time-warp', 'mystic-wind']
    },
    { 
      text: 'ğŸ’ ÙƒØ±ÙŠØ³ØªØ§Ù„ Ø³Ø­Ø±ÙŠ Ø¸Ù‡Ø±! Ù…ÙƒØ§ÙØ£Ø© Ø®Ø§ØµØ©', 
      effect: 'bonus_crystal',
      sound: ['crystal-ping', 'crystal-bonus']
    },
    {
      text: 'ğŸ”® Ø¨ÙˆØ§Ø¨Ø© Ø¨ÙØ¹Ø¯ÙŠØ© ÙÙØªØ­Øª! Ø·Ø§Ù‚Ø© Ø³Ø­Ø±ÙŠØ© ØªÙ…Ù„Ø£ Ø§Ù„Ø³Ø§Ø­Ø©',
      effect: 'portal_magic',
      sound: ['portal-open', 'spell-cast']
    },
    {
      text: 'ğŸ† Ø¥Ù†Ø¬Ø§Ø² Ù…Ù„ÙƒÙŠ! Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±Ù‚ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©',
      effect: 'royal_bonus',
      sound: ['royal-fanfare', 'achievement-unlock']
    }
  ];
  
  const event = events[Math.floor(Math.random() * events.length)];
  showQuantumNotification('ğŸ† Ø­Ø¯Ø« Ø®Ø§Øµ!', event.text, 'special');
  
  // Play event sound sequence
  if (event.sound) {
    playSoundSequence(event.sound, 800);
  }
  
  // Apply event effect
  switch(event.effect) {
    case 'energy_boost':
      gameState.teams.forEach(team => {
        team.energy = Math.min(100, team.energy + 20);
        document.getElementById(`energy-${team.id}`).textContent = team.energy + '%';
      });
      break;
      
    case 'double_points':
      gameState.doublePointsNext = true;
      setTimeout(() => gameState.doublePointsNext = false, 10000);
      break;
      
    case 'bonus_crystal':
      gameState.teams.forEach(team => {
        team.score += 2;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
      
    case 'portal_magic':
      gameState.teams.forEach(team => {
        team.energy = 100;
        document.getElementById(`energy-${team.id}`).textContent = '100%';
      });
      break;
      
    case 'royal_bonus':
      gameState.teams.forEach(team => {
        team.score += 1;
        document.getElementById(`score-${team.id}`).textContent = team.score;
      });
      break;
  }
}

// ===== ADVANCED SOUND SYSTEM =====
let audioContext = null;
let masterVolume = 0.7;
let soundQueue = [];
let activeSounds = new Map();

// Initialize Web Audio Context for better sound control
function initAudioSystem() {
  try {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    console.log('ğŸµ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¬Ø§Ù‡Ø²!');
  } catch (error) {
    console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ');
  }
}

function playCosmicSound(soundType, options = {}) {
  if (!gameState.soundEnabled) return;
  
  // Enhanced sound library with all kingdom sounds
  const sounds = {
    // Kingdom Core Sounds
    'kingdom-enter': '../assets/media/sounds/kingdom-sounds/kingdom-enter.mp3',
    'cosmic-portal': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'magic-sparkle': '../assets/media/sounds/kingdom-sounds/magic-sparkle.mp3',
    'royal-fanfare': '../assets/media/sounds/kingdom-sounds/royal-fanfare.mp3',
    
    // Lightning Realm Sounds
    'lightning-strike': '../assets/media/sounds/kingdom-sounds/lightning-strike.mp3',
    'electric-charge': '../assets/media/sounds/kingdom-sounds/electric-charge.mp3',
    'thunder-rumble': '../assets/media/sounds/kingdom-sounds/thunder-rumble.mp3',
    'lightning-whoosh': '../assets/media/sounds/kingdom-sounds/lightning-whoosh.mp3',
    
    // Wisdom Realm Sounds
    'wisdom-chime': '../assets/media/sounds/kingdom-sounds/wisdom-chime.mp3',
    'brain-activate': '../assets/media/sounds/kingdom-sounds/brain-activate.mp3',
    'ancient-bell': '../assets/media/sounds/kingdom-sounds/ancient-bell.mp3',
    'knowledge-unlock': '../assets/media/sounds/kingdom-sounds/knowledge-unlock.mp3',
    
    // Battle Arena Sounds
    'battle-horn': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'sword-clash': '../assets/media/sounds/kingdom-sounds/sword-clash.mp3',
    'armor-clank': '../assets/media/sounds/kingdom-sounds/armor-clank.mp3',
    'war-drum': '../assets/media/sounds/kingdom-sounds/war-drum.mp3',
    'epic-charge': '../assets/media/sounds/kingdom-sounds/epic-charge.mp3',
    'shield-block': '../assets/media/sounds/kingdom-sounds/shield-block.mp3',
    'battle-victory': '../assets/media/sounds/kingdom-sounds/battle-victory.mp3',
    
    // Mystery Realm Sounds
    'mystery-whisper': '../assets/media/sounds/kingdom-sounds/mystery-whisper.mp3',
    'crystal-ping': '../assets/media/sounds/kingdom-sounds/crystal-ping.mp3',
    'mystic-wind': '../assets/media/sounds/kingdom-sounds/mystic-wind.mp3',
    'spell-cast': '../assets/media/sounds/kingdom-sounds/spell-cast.mp3',
    'riddle-solved': '../assets/media/sounds/kingdom-sounds/riddle-solved.mp3',
    
    // AI Coach Sounds
    'ai-beep': '../assets/media/sounds/kingdom-sounds/ai-beep.mp3',
    'robot-voice': '../assets/media/sounds/kingdom-sounds/robot-voice.mp3',
    'data-process': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'ai-notification': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'scanner-beep': '../assets/media/sounds/kingdom-sounds/scanner-beep.mp3',
    
    // Points & Achievements
    'point-earn': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lose': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'combo-hit': '../assets/media/sounds/kingdom-sounds/combo-hit.mp3',
    'achievement-unlock': '../assets/media/sounds/kingdom-sounds/achievement-unlock.mp3',
    'level-up': '../assets/media/sounds/kingdom-sounds/level-up.mp3',
    'bonus-collect': '../assets/media/sounds/kingdom-sounds/bonus-collect.mp3',
    'perfect-score': '../assets/media/sounds/kingdom-sounds/perfect-score.mp3',
    
    // Special Effects & Random Events
    'cosmic-explosion': '../assets/media/sounds/kingdom-sounds/cosmic-explosion.mp3',
    'star-fall': '../assets/media/sounds/kingdom-sounds/star-fall.mp3',
    'time-warp': '../assets/media/sounds/kingdom-sounds/time-warp.mp3',
    'energy-boost': '../assets/media/sounds/kingdom-sounds/energy-boost.mp3',
    'crystal-bonus': '../assets/media/sounds/kingdom-sounds/crystal-bonus.mp3',
    'portal-open': '../assets/media/sounds/kingdom-sounds/portal-open.mp3',
    'dimensional-shift': '../assets/media/sounds/kingdom-sounds/dimensional-shift.mp3',
    
    // Celebration & Victory
    'epic-victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'crown-ceremony': '../assets/media/sounds/kingdom-sounds/crown-ceremony.mp3',
    'fireworks-burst': '../assets/media/sounds/kingdom-sounds/fireworks-burst.mp3',
    'crowd-cheer': '../assets/media/sounds/kingdom-sounds/crowd-cheer.mp3',
    'golden-confetti': '../assets/media/sounds/kingdom-sounds/golden-confetti.mp3',
    'ultimate-triumph': '../assets/media/sounds/kingdom-sounds/ultimate-triumph.mp3',
    
    // UI & Control Sounds
    'button-hover': '../assets/media/sounds/kingdom-sounds/button-hover.mp3',
    'panel-slide': '../assets/media/sounds/kingdom-sounds/panel-slide.mp3',
    'menu-open': '../assets/media/sounds/kingdom-sounds/menu-open.mp3',
    'setting-change': '../assets/media/sounds/kingdom-sounds/setting-change.mp3',
    'notification-pop': '../assets/media/sounds/kingdom-sounds/notification-pop.mp3',
    'cosmic-click': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3',
    
    // Timer & Countdown
    'countdown-tick': '../assets/media/sounds/kingdom-sounds/countdown-tick.mp3',
    'final-countdown': '../assets/media/sounds/kingdom-sounds/final-countdown.mp3',
    'time-warning': '../assets/media/sounds/kingdom-sounds/time-warning.mp3',
    'time-up': '../assets/media/sounds/kingdom-sounds/time-up.mp3',
    'timer-start': '../assets/media/sounds/kingdom-sounds/timer-start.mp3',
    'timer-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    
    // Legacy sounds fallback
    'realm-activate': '../assets/media/sounds/kingdom-sounds/cosmic-portal.mp3',
    'battle-start': '../assets/media/sounds/kingdom-sounds/battle-horn.mp3',
    'battle-pause': '../assets/media/sounds/kingdom-sounds/timer-pause.mp3',
    'point-gained': '../assets/media/sounds/kingdom-sounds/point-earn.mp3',
    'point-lost': '../assets/media/sounds/kingdom-sounds/point-lose.mp3',
    'victory': '../assets/media/sounds/kingdom-sounds/epic-victory.mp3',
    'ai-tip': '../assets/media/sounds/kingdom-sounds/ai-notification.mp3',
    'analysis': '../assets/media/sounds/kingdom-sounds/data-process.mp3',
    'reset': '../assets/media/sounds/kingdom-sounds/cosmic-click.mp3'
  };
  
  const soundPath = sounds[soundType];
  if (soundPath) {
    const audio = new Audio(soundPath);
    
    // Apply options
    audio.volume = (options.volume || masterVolume) * (gameState.soundEnabled ? 1 : 0);
    
    // Advanced sound controls
    if (options.loop) audio.loop = true;
    if (options.delay) {
      setTimeout(() => audio.play().catch(e => console.log('Sound play failed:', e)), options.delay);
    } else {
      audio.play().catch(e => console.log('Sound play failed:', e));
    }
    
    // Track active sounds
    if (options.id) {
      activeSounds.set(options.id, audio);
    }
    
    // Auto cleanup
    audio.addEventListener('ended', () => {
      if (options.id) activeSounds.delete(options.id);
    });
    
    return audio;
  }
}

// Enhanced sound control functions
function stopSound(soundId) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    audio.pause();
    audio.currentTime = 0;
    activeSounds.delete(soundId);
  }
}

function fadeOutSound(soundId, duration = 1000) {
  const audio = activeSounds.get(soundId);
  if (audio) {
    const startVolume = audio.volume;
    const fadeStep = startVolume / (duration / 50);
    
    const fadeInterval = setInterval(() => {
      audio.volume = Math.max(0, audio.volume - fadeStep);
      if (audio.volume <= 0) {
        clearInterval(fadeInterval);
        audio.pause();
        activeSounds.delete(soundId);
      }
    }, 50);
  }
}

function setMasterVolume(volume) {
  masterVolume = Math.max(0, Math.min(1, volume));
  activeSounds.forEach(audio => {
    audio.volume = masterVolume * (gameState.soundEnabled ? 1 : 0);
  });
}

// Play sound sequences
function playSoundSequence(sounds, interval = 500) {
  sounds.forEach((sound, index) => {
    setTimeout(() => {
      if (typeof sound === 'string') {
        playCosmicSound(sound);
      } else {
        playCosmicSound(sound.type, sound.options);
      }
    }, index * interval);
  });
}

function toggleSound() {
  gameState.soundEnabled = !gameState.soundEnabled;
  
  // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ…
  updateSoundButton();
  
  // Play sound toggle feedback
  if (gameState.soundEnabled) {
    setTimeout(() => playCosmicSound('setting-change'), 100);
  }
}

// ===== NOTIFICATIONS SYSTEM =====
function showQuantumNotification(title, message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = 'quantum-notification';
  
  const icons = {
    info: 'ğŸ’«',
    success: 'âœ…',
    warning: 'âš ï¸',
    error: 'âŒ',
    battle: 'âš”ï¸',
    victory: 'ğŸ‘‘',
    achievement: 'ğŸ†',
    special: 'ğŸ†'
  };
  
  // Enhanced notification sounds
  const notificationSounds = {
    info: 'notification-pop',
    success: ['notification-pop', 'magic-sparkle'],
    warning: 'time-warning',
    error: 'cosmic-click',
    battle: ['notification-pop', 'war-drum'],
    victory: ['notification-pop', 'crown-ceremony'],
    achievement: ['notification-pop', 'achievement-unlock'],
    special: ['notification-pop', 'cosmic-explosion']
  };
  
  notification.innerHTML = `
    <div class="notification-header">
      <span class="notification-icon">${icons[type] || 'ğŸ’«'}</span>
      <strong>${title}</strong>
      <button onclick="this.parentElement.parentElement.remove()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer;">Ã—</button>
    </div>
    <div>${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  // Play notification sound
  const sound = notificationSounds[type];
  if (Array.isArray(sound)) {
    playSoundSequence(sound, 300);
  } else {
    playCosmicSound(sound || 'notification-pop');
  }
  
  // Show animation
  setTimeout(() => notification.classList.add('show'), 100);
  
  // Auto remove
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 500);
  }, 5000);
}

function showWelcomeMessage() {
  // Welcome sequence with royal fanfare
  playSoundSequence([
    'kingdom-enter',
    'royal-fanfare',
    'magic-sparkle'
  ], 1000);
  
  showQuantumNotification(
    'ğŸŒŸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª!',
    'Ø§Ø³ØªØ¹Ø¯ Ù„Ø®ÙˆØ¶ Ø£Ø¹Ø¸Ù… Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙŠ Ø§Ù„ÙƒÙˆÙ†!',
    'success'
  );
}

// ===== CHALLENGE TYPES =====
function startLightningChallenge() {
  console.log('âš¡ Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚!');
  
  // Lightning realm entrance effects
  playSoundSequence([
    'lightning-strike',
    'electric-charge',
    'thunder-rumble'
  ], 600);
  
  // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚
  document.getElementById('kingdomDashboard').style.display = 'none';
  
  // Ø±Ø³Ø§Ø¦Ù„ ØªÙØ§Ø¹Ù„ÙŠØ© Ø¯Ø±Ø§Ù…ÙŠØ© Ù„Ù„Ø¯Ø®ÙˆÙ„
  const enterMessages = [
    'âš¡ Ø§Ù†ÙØªØ­Øª Ø£Ø¨ÙˆØ§Ø¨ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©!',
    'ğŸŒ©ï¸ Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ØªØ­ÙŠØ· Ø¨ÙƒÙ… Ù…Ù† ÙƒÙ„ Ø¬Ø§Ù†Ø¨!',
    'ğŸ’« Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø±Ù‚ ØªØªØ¯ÙÙ‚ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø­ÙˆÙ„ÙƒÙ…!',
    'âš¡ Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø¹Ø¸Ù…!',
    'ğŸ”¥ Ø§Ù„Ù†ÙŠØ±Ø§Ù† Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ØªØ´ØªØ¹Ù„ ÙÙŠ Ø£Ø¹ÙŠÙ†ÙƒÙ…!'
  ];
  
  const randomEnterMessage = enterMessages[Math.floor(Math.random() * enterMessages.length)];
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø§Ø­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø±Ù‚
  createLightningArena();
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© Ù„Ù„Ø¯Ø®ÙˆÙ„
  createLightningStorm();
  
  // Ø±Ø³Ø§Ù„Ø© Ø¯Ø®ÙˆÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('âš¡ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚!', `${randomEnterMessage} (${studentsCount} Ø·Ù„Ø§Ø¨ Ø¬Ø§Ù‡Ø²ÙˆÙ†!)`, 'battle');
  
  // Ø±Ø³Ø§Ø¦Ù„ ØªØ­ÙÙŠØ²ÙŠØ© Ù…ØªØªØ§Ù„ÙŠØ©
  setTimeout(() => {
    showQuantumNotification('ğŸ§ âš¡ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø°Ù‡Ù†ÙŠ Ø§Ù„Ø¨Ø±Ù‚ÙŠ!', 'Ø§Ù„Ø£Ø³Ø±Ø¹ ÙÙŠ Ø§Ù„ØªÙÙƒÙŠØ± ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©!', 'info');
  }, 2000);
  
  setTimeout(() => {
    showQuantumNotification('ğŸ¯ Ø§Ù†ØªØ¨Ù‡ÙˆØ§ Ø¬ÙŠØ¯Ø§Ù‹!', 'ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© = ØµØ§Ø¹Ù‚Ø© Ø¨Ø±Ù‚ Ù‚ÙˆÙŠØ©! âš¡', 'warning');
  }, 4000);
}

function createLightningArena() {
  const mainApp = document.getElementById('mainApp');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  let lightningArena = document.getElementById('lightningArena');
  
  if (lightningArena) {
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ ÙÙ‚Ø· Ø£Ø¸Ù‡Ø±Ù‡Ø§ ÙˆØ£Ø¹Ø¯ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰
    lightningArena.style.display = 'block';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ù…Ø¤Ù‚Øª
    resetLightningArena();
  } else {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚ Ø¬Ø¯ÙŠØ¯Ø©
    lightningArena = document.createElement('div');
    lightningArena.id = 'lightningArena';
    lightningArena.className = 'lightning-arena';
    
    lightningArena.innerHTML = `
      <div class="lightning-arena-container">
        <!-- Ø±Ø£Ø³ Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚ -->
        <div class="lightning-header">
          <div class="lightning-title-container">
            <div class="lightning-icon">âš¡</div>
            <div>
              <h1 class="lightning-title">Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚</h1>
              <p class="lightning-subtitle">ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨Ø±Ù‚ÙŠ</p>
            </div>
          </div>
          
          <!-- Ù…Ø¤Ù‚Øª Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="lightning-timer-container">
          <div class="timer-circle">
            <div class="timer-text" id="lightningTimer">60</div>
            <div class="timer-label">Ø«Ø§Ù†ÙŠØ©</div>
          </div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="lightning-controls">
          <button class="lightning-btn" id="startQuestionBtn" onclick="startNewQuestion()">
            âš¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
          </button>
          <button class="lightning-btn secondary" onclick="pauseLightningChallenge()">
            â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª
          </button>
          <button class="lightning-btn danger" onclick="endLightningChallenge()">
            ğŸ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
          </button>
        </div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ† -->
      <div class="competitors-zone">
        <div class="zone-title">ğŸ† Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙˆÙ†</div>
        <div class="competitors-grid" id="competitorsGrid">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ† -->
        </div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© -->
      <div class="question-zone">
        <div class="question-display" id="questionDisplay">
          <div class="waiting-state">
            <div class="waiting-icon">âš¡</div>
            <h3>Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</h3>
            <p>Ø§Ø¶ØºØ· "Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯" Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ø·Ø±Ø­ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø´ÙÙˆÙŠØ§Ù‹</p>
          </div>
        </div>
      </div>
      
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <div class="lightning-scoreboard">
        <div class="scoreboard-title">âš¡ Ù„ÙˆØ­Ø© Ø§Ù„ØµÙˆØ§Ø¹Ù‚</div>
        <div class="scores-container" id="lightningScores">
          <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
      </div>
      
      <!-- ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø±Ù‚ -->
      <div class="lightning-effects" id="lightningEffects"></div>
    </div>
  `;
    
    mainApp.appendChild(lightningArena);
  }
  
  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ†
  initializeCompetitors();
  
  // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
  startLightningTimer();
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ù†ÙØ³ Ø§Ù„Ø·Ù„Ø§Ø¨
function resetLightningArena() {
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
  lightningTimeLeft = 300; // 5 Ø¯Ù‚Ø§Ø¦Ù‚
  
  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ù† ÙˆØ¬Ø¯
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  gameState.waitingForAnswer = false;
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨
  selectedStudentsList.forEach((studentName, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    if (scoreElement) {
      scoreElement.textContent = '0';
    }
  });
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
  resetQuestionZone();
  
  // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  updateLightningScoreboard();
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØªÙ†Ø§ÙØ³ÙŠÙ†
function initializeCompetitors() {
  const competitorsGrid = document.getElementById('competitorsGrid');
  competitorsGrid.innerHTML = '';
  
  selectedStudentsList.forEach((studentName, index) => {
    const competitorCard = document.createElement('div');
    competitorCard.className = 'competitor-card';
    competitorCard.id = `competitor-${index}`;
    competitorCard.onclick = () => selectCompetitor(index, studentName);
    
    competitorCard.innerHTML = `
      <div class="competitor-name">${studentName}</div>
      <div class="competitor-score" id="score-${index}">0</div>
      <div style="font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">ØµÙˆØ§Ø¹Ù‚</div>
    `;
    
    competitorsGrid.appendChild(competitorCard);
  });
  
  updateLightningScoreboard();
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
let lightningTimerInterval;
let lightningTimeLeft = 300; // 5 Ø¯Ù‚Ø§Ø¦Ù‚

function startLightningTimer() {
  const timerElement = document.getElementById('lightningTimer');
  
  lightningTimerInterval = setInterval(() => {
    lightningTimeLeft--;
    
    const minutes = Math.floor(lightningTimeLeft / 60);
    const seconds = lightningTimeLeft % 60;
    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // Ø±Ø³Ø§Ø¦Ù„ ØªØ­ÙÙŠØ²ÙŠØ© Ø¯ÙˆØ±ÙŠØ©
    if (lightningTimeLeft === 240) { // 4 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…ØªØ¨Ù‚ÙŠØ©
      showQuantumNotification('â° 4 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…ØªØ¨Ù‚ÙŠØ©!', 'ğŸ”¥ Ø§Ù„Ù†Ø§Ø± Ù…Ø§ Ø²Ø§Ù„Øª Ù…Ø´ØªØ¹Ù„Ø©! Ø§Ø³ØªÙ…Ø±ÙˆØ§!', 'info');
    } else if (lightningTimeLeft === 180) { // 3 Ø¯Ù‚Ø§Ø¦Ù‚
      showQuantumNotification('âš¡ Ù†ØµÙ Ø§Ù„ÙˆÙ‚Øª Ù…Ø±!', 'ğŸ’« Ø§Ù„Ø·Ø§Ù‚Ø© ØªØ±ØªÙØ¹! Ù…Ù† Ø³ÙŠÙÙˆØ²ØŸ', 'warning');
    } else if (lightningTimeLeft === 120) { // Ø¯Ù‚ÙŠÙ‚ØªØ§Ù†
      showQuantumNotification('ğŸŒ©ï¸ Ø¯Ù‚ÙŠÙ‚ØªØ§Ù† Ù…ØªØ¨Ù‚ÙŠØªØ§Ù†!', 'ğŸ”¥âš¡ Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ØªØ­ØªØ¯Ù…! Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø§Ø³Ù…Ø©!', 'battle');
    } else if (lightningTimeLeft === 60) { // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
      showQuantumNotification('ğŸš¨ Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ø®ÙŠØ±Ø©!', 'ğŸ’¥ Ø§Ù„ÙˆÙ‚Øª ÙŠÙ†ÙØ¯! Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©!', 'error');
    }
    
    // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ© ÙˆÙ…Ø±Ø¦ÙŠØ©
    if (lightningTimeLeft <= 30 && lightningTimeLeft > 0) {
      if (lightningTimeLeft % 5 === 0) {
        playCosmicSound('countdown-tick');
        createLightningBolt();
      }
      timerElement.style.color = '#ff4757';
      timerElement.parentElement.style.borderColor = '#ff4757';
    } else if (lightningTimeLeft <= 10 && lightningTimeLeft > 0) {
      playCosmicSound('countdown-beep');
      createLightningBolt();
      timerElement.style.animation = 'urgentPulse 0.5s infinite';
      
      // Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ø£Ø®ÙŠØ±
      if (lightningTimeLeft === 10) {
        showQuantumNotification('ğŸ”Ÿ Ø¹Ø´Ø± Ø«ÙˆØ§Ù†!', 'ğŸ’¥ Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù‚Ø§Ø¯Ù…!', 'error');
      } else if (lightningTimeLeft === 5) {
        showQuantumNotification('5ï¸âƒ£ Ø®Ù…Ø³ Ø«ÙˆØ§Ù†!', 'âš¡ğŸ”¥ Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©!', 'error');
      }
    }
    
    if (lightningTimeLeft <= 0) {
      endLightningChallenge();
    }
  }, 1000);
}

// Ø¨Ø¯Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
function startNewQuestion() {
  playCosmicSound('question-start');
  
  // Ø±Ø³Ø§Ø¦Ù„ ØªØ­ÙÙŠØ²ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø³Ø¤Ø§Ù„
  const questionStartMessages = [
    'ğŸ”¥ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¨Ø±Ù‚ÙŠ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø³ÙŠØ­Ø±Ù‚ Ø§Ù„Ø¹Ù‚ÙˆÙ„!',
    'âš¡ Ø§Ù†Ø·Ù„Ù‚Øª Ø´Ø±Ø§Ø±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©!',
    'ğŸŒ©ï¸ Ø¹Ø§ØµÙØ© Ø°Ù‡Ù†ÙŠØ© Ù‚Ø§Ø¯Ù…Ø©... Ø§Ø³ØªØ¹Ø¯ÙˆØ§!',
    'ğŸ’« Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ØªÙ…Ù„Ø£ Ø§Ù„ÙØ¶Ø§Ø¡!',
    'ğŸ¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø§Ù„Ø¢Ù†... Ø§Ù„Ù„Ø­Ø¸Ø© Ø§Ù„Ø­Ø§Ø³Ù…Ø©!',
    'ğŸ”¥âš¡ Ø¯Ù…Ø§ØºÙƒÙ… Ø³ÙŠØ­ØªØ±Ù‚ Ù…Ù† Ù‚ÙˆØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„!',
    'ğŸŒŸ Ø¨Ø±ÙŠÙ‚ Ø§Ù„Ø°ÙƒØ§Ø¡ ÙŠÙ„Ù…Ø¹ ÙÙŠ Ø¹ÙŠÙˆÙ†ÙƒÙ…!'
  ];
  
  const randomQuestionMessage = questionStartMessages[Math.floor(Math.random() * questionStartMessages.length)];
  
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display question-active';
  
  questionDisplay.innerHTML = `
    <div class="question-content">
      <div class="question-icon">â“</div>
      <h2>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¬Ø§Ù‡Ø²!</h2>
      <p style="font-size: 1.2rem; color: #00ffff; margin: 1rem 0;">
        Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ø´ÙÙˆÙŠØ§Ù‹ Ø§Ù„Ø¢Ù†
      </p>
      <div class="instruction-text">
        Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø°ÙŠ ÙŠØ¬ÙŠØ¨ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ù„Ø¥Ø¹Ø·Ø§Ø¦Ù‡ ØµØ§Ø¹Ù‚Ø© âš¡
      </div>
      <button class="lightning-btn" onclick="cancelQuestion()" style="margin-top: 1rem;">
        âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„
      </button>
    </div>
  `;
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ©
  createLightningStorm();
  
  // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
  gameState.waitingForAnswer = true;
  
  // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø¹Ù„Ù… Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  showQuantumNotification('â“ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù†Ø´Ø·', randomQuestionMessage, 'info');
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø·Ù„Ø§Ø¨
  setTimeout(() => {
    showQuantumNotification('ğŸ¯ Ù„Ù„Ø·Ù„Ø§Ø¨', 'ÙÙƒØ±ÙˆØ§ Ø¨Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±Ù‚! Ù…Ù† Ø³ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§Ø¹Ù‚Ø©ØŸ âš¡', 'warning');
  }, 1500);
}

// Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ù…Ø¬ÙŠØ¨ (Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©)
function selectCompetitor(index, studentName) {
  if (!gameState.waitingForAnswer) {
    showQuantumNotification('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ¬Ø¨ Ø¨Ø¯Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
    return;
  }
  
  // Ø±Ø³Ø§Ø¦Ù„ ØªÙ‡Ù†Ø¦Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  const congratsMessages = [
    `ğŸ”¥âš¡ ${studentName} Ø§Ø´ØªØ¹Ù„ Ù…Ø«Ù„ Ø§Ù„Ø¨Ø±Ù‚!`,
    `ğŸ’« ${studentName} Ø£Ø¶Ø§Ø¡ Ø§Ù„Ø³Ù…Ø§Ø¡ Ø¨Ø°ÙƒØ§Ø¦Ù‡!`,
    `âš¡ğŸ§  Ø¹Ù‚Ù„ ${studentName} Ø£Ø³Ø±Ø¹ Ù…Ù† Ø§Ù„Ø¨Ø±Ù‚!`,
    `ğŸŒŸ ${studentName} Ù„Ù…Ø¹ ÙƒØ§Ù„Ù†Ø¬Ù… Ø§Ù„Ø³Ø§Ø·Ø¹!`,
    `ğŸ”¥ ${studentName} Ø£Ø­Ø±Ù‚ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ù‚ÙˆØ©!`,
    `âš¡ğŸ¯ ${studentName} Ø¶Ø±Ø¨ Ø§Ù„Ù‡Ø¯Ù Ø¨Ø¯Ù‚Ø© Ø§Ù„Ø¨Ø±Ù‚!`,
    `ğŸ’¥ Ø§Ù†ÙØ¬Ø§Ø± Ø°ÙƒØ§Ø¡ Ù…Ù† ${studentName}!`,
    `ğŸŒ©ï¸ ${studentName} Ø¹Ø§ØµÙØ© Ø°Ù‡Ù†ÙŠØ© Ù‚ÙˆÙŠØ©!`
  ];
  
  const randomCongratsMessage = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
  
  // Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø© Ù„Ù„Ø·Ø§Ù„Ø¨
  const scoreElement = document.getElementById(`score-${index}`);
  const currentScore = parseInt(scoreElement.textContent) + 1;
  scoreElement.textContent = currentScore;
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ø¨ØµØ±ÙŠØ© ÙˆÙ…Ø±Ø¦ÙŠØ©
  const competitorCard = document.getElementById(`competitor-${index}`);
  competitorCard.classList.add('answered-correct');
  
  setTimeout(() => {
    competitorCard.classList.remove('answered-correct');
  }, 1000);
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ©
  playSoundSequence(['correct-answer', 'lightning-strike', 'power-up'], 200);
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø±Ù‚
  createLightningBolt();
  createElectricExplosion(competitorCard);
  
  // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  updateLightningScoreboard();
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
  resetQuestionZone();
  
  // Ø¥Ø´Ø¹Ø§Ø± Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  showQuantumNotification('âš¡ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!', randomCongratsMessage, 'success');
  
  // Ø±Ø³Ø§Ø¦Ù„ Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·
  setTimeout(() => {
    if (currentScore === 1) {
      showQuantumNotification('ğŸŒŸ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚ÙˆÙŠØ©!', `${studentName} Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø±Ù‚!`, 'info');
    } else if (currentScore === 3) {
      showQuantumNotification('ğŸ”¥ Ø«Ù„Ø§Ø« ØµÙˆØ§Ø¹Ù‚!', `${studentName} ÙŠØ­ØªØ±Ù‚ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡!`, 'warning');
    } else if (currentScore === 5) {
      showQuantumNotification('âš¡ğŸ‘‘ Ù…Ù„Ùƒ Ø§Ù„Ø¨Ø±Ù‚!', `${studentName} ÙŠÙ‚ØªØ±Ø¨ Ù…Ù† Ø§Ù„Ø¹Ø±Ø´!`, 'battle');
    } else if (currentScore >= 7) {
      showQuantumNotification('ğŸŒ©ï¸ğŸ’¥ Ø¥Ø¹ØµØ§Ø± Ø°Ù‡Ù†ÙŠ!', `${studentName} Ù„Ø§ ÙŠÙÙˆÙ‚Ù!`, 'success');
    }
  }, 1000);
  
  gameState.waitingForAnswer = false;
}

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„
function cancelQuestion() {
  resetQuestionZone();
  gameState.waitingForAnswer = false;
  playCosmicSound('ui-back');
  
  // Ø±Ø³Ø§Ø¦Ù„ Ø¥Ù„ØºØ§Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  const cancelMessages = [
    'ğŸŒªï¸ Ø§Ù„Ø¹Ø§ØµÙØ© Ù‡Ø¯Ø£Øª... Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ù„ØºÙŠ!',
    'ğŸ’­ Ø§Ù„Ø£ÙÙƒØ§Ø± ØªØ¨Ø¯Ø¯Øª... Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ Ù‚Ø§Ø¯Ù…!',
    'âš¡ Ø§Ù„ØµØ§Ø¹Ù‚Ø© Ø§Ù†Ø·ÙØ£Øª... Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ù„ØªØ§Ù„ÙŠ!',
    'ğŸ¯ Ø§Ù„Ù‡Ø¯Ù ØªØºÙŠØ±... ÙØ±ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù‚Ø§Ø¯Ù…Ø©!',
    'ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø·Ø§Ù‚Ø©... Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!'
  ];
  
  const randomCancelMessage = cancelMessages[Math.floor(Math.random() * cancelMessages.length)];
  showQuantumNotification('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„', randomCancelMessage, 'info');
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„
function resetQuestionZone() {
  const questionDisplay = document.getElementById('questionDisplay');
  questionDisplay.className = 'question-display';
  
  questionDisplay.innerHTML = `
    <div class="waiting-state">
      <div class="waiting-icon">âš¡</div>
      <h3>Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</h3>
      <p>Ø§Ø¶ØºØ· "Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯" Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ø¬Ø§Ù‡Ø²Ø§Ù‹ Ù„Ø·Ø±Ø­ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø´ÙÙˆÙŠØ§Ù‹</p>
    </div>
  `;
}

// ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function updateLightningScoreboard() {
  const scoresContainer = document.getElementById('lightningScores');
  
  // Ø¬Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  const scores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0),
      index: index
    };
  });
  
  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
  scores.sort((a, b) => b.score - a.score);
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  scoresContainer.innerHTML = scores.map((student, position) => `
    <div class="score-item ${position === 0 ? 'first-place' : ''}" style="
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: ${position === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,165,0,0.3))' : 'rgba(255,255,255,0.1)'};
      border-radius: 10px;
      border: ${position === 0 ? '2px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
    ">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <div style="
          background: ${position === 0 ? '#ffd700' : position === 1 ? '#c0c0c0' : position === 2 ? '#cd7f32' : '#666'};
          color: ${position <= 2 ? '#000' : '#fff'};
          width: 30px;
          height: 30px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
        ">
          ${position + 1}
        </div>
        <span style="color: white; font-weight: 600;">${student.name}</span>
      </div>
      <div style="color: #ffff00; font-weight: 700; font-size: 1.2rem;">
        ${student.score} âš¡
      </div>
    </div>
  `).join('');
}

// Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠ Ù…Ø¤Ù‚ØªØ§Ù‹
function pauseLightningChallenge() {
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
    playCosmicSound('pause-sound');
    showQuantumNotification('â¸ï¸ ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù', 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠ Ù…Ø¤Ù‚ØªØ§Ù‹', 'info');
    
    // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ù„Ù„Ø²Ø±
    const pauseBtn = document.querySelector('.lightning-btn.secondary');
    pauseBtn.innerHTML = 'â–¶ï¸ Ù…ØªØ§Ø¨Ø¹Ø©';
    pauseBtn.onclick = resumeLightningChallenge;
  }
}

// Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ­Ø¯ÙŠ
function resumeLightningChallenge() {
  startLightningTimer();
  playCosmicSound('resume-sound');
  showQuantumNotification('â–¶ï¸ ØªÙ… Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù', 'Ø§Ø³ØªÙ…Ø± Ø§Ù„ØªØ­Ø¯ÙŠ!', 'success');
  
  // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ù„Ù„Ø²Ø±
  const pauseBtn = document.querySelector('.lightning-btn.secondary');
  pauseBtn.innerHTML = 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
  pauseBtn.onclick = pauseLightningChallenge;
}

// Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ
function endLightningChallenge() {
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
  }
  
  playCosmicSound('challenge-complete');
  
  // Ø±Ø³Ø§Ø¦Ù„ Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©
  const endMessages = [
    'ğŸŒ©ï¸ Ø¹Ø§ØµÙØ© Ø§Ù„Ø¨Ø±Ù‚ ØªÙ‡Ø¯Ø£... Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©!',
    'âš¡ğŸ’¥ Ø§Ù†Ø·ÙØ£Øª Ø§Ù„Ø´Ø±Ø§Ø±Ø§Øª... Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø¨Ø·Ù„ØŸ',
    'ğŸ”¥ Ù†Ø§Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù†Ø·ÙØ£Øª... Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ…!',
    'ğŸ’« Ø§Ù„Ù†Ø¬ÙˆÙ… ØªÙˆÙ‚ÙØª Ø¹Ù† Ø§Ù„Ù„Ù…Ø¹Ø§Ù†... Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©!',
    'ğŸ† Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ø§Ù„Ø°Ù‡Ù†ÙŠØ© Ø§Ù†ØªÙ‡Øª!'
  ];
  
  const randomEndMessage = endMessages[Math.floor(Math.random() * endMessages.length)];
  showQuantumNotification('ğŸ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠ!', randomEndMessage, 'battle');
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ­Ø¶ÙŠØ±ÙŠØ© Ù„Ù„Ù†ØªØ§Ø¦Ø¬
  setTimeout(() => {
    showQuantumNotification('ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...', 'Ø§Ø³ØªØ¹Ø¯ÙˆØ§ Ù„Ù…Ø¹Ø±ÙØ© Ù…Ù„Ùƒ Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯! ğŸ‘‘', 'info');
  }, 1000);
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
  setTimeout(() => {
    showFinalResults();
  }, 2000);
}

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
function showFinalResults() {
  const lightningArena = document.getElementById('lightningArena');
  
  // Ø¬Ù…Ø¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
  const finalScores = selectedStudentsList.map((name, index) => {
    const scoreElement = document.getElementById(`score-${index}`);
    return {
      name: name,
      score: parseInt(scoreElement ? scoreElement.textContent : 0)
    };
  }).sort((a, b) => b.score - a.score);
  
  const winner = finalScores[0];
  
  lightningArena.innerHTML = `
    <div class="final-results">
      <div class="results-container">
        <div class="victory-header">
          <div class="victory-crown">ğŸ‘‘</div>
          <h1 class="victory-title">Ø§Ù†ØªÙ‡Ù‰ ØªØ­Ø¯ÙŠ Ø§Ù„Ø¨Ø±Ù‚!</h1>
          <div class="lightning-effects-final">âš¡âš¡âš¡</div>
        </div>
        
        <div class="winner-announcement">
          <h2 style="color: #ffd700; font-size: 2.5rem; margin: 1rem 0;">
            ğŸ† Ø§Ù„ÙØ§Ø¦Ø²: ${winner.name}
          </h2>
          <div style="color: #ffff00; font-size: 2rem; font-weight: 700;">
            ${winner.score} ØµØ§Ø¹Ù‚Ø© âš¡
          </div>
        </div>
        
        <div class="final-scoreboard">
          <h3 style="color: #00ffff; margin-bottom: 1rem;">ğŸ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
          ${finalScores.map((student, index) => `
            <div class="final-score-item" style="
              display: flex;
              justify-content: space-between;
              padding: 1rem;
              margin: 0.5rem 0;
              background: ${index === 0 ? 'linear-gradient(135deg, rgba(255,215,0,0.4), rgba(255,165,0,0.4))' : 'rgba(255,255,255,0.1)'};
              border-radius: 15px;
              border: ${index === 0 ? '3px solid #ffd700' : '1px solid rgba(255,255,255,0.2)'};
              ${index === 0 ? 'animation: winnerGlow 2s ease-in-out infinite;' : ''}
            ">
              <span style="color: white; font-weight: 600;">${index + 1}. ${student.name}</span>
              <span style="color: #ffff00; font-weight: 700;">${student.score} âš¡</span>
            </div>
          `).join('')}
        </div>
        
        <div class="results-actions">
          <button class="lightning-btn" onclick="backToKingdomDashboard()" style="margin: 1rem;">
            ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ù„ÙƒØ©
          </button>
          <button class="lightning-btn secondary" onclick="startLightningChallenge()" style="margin: 1rem;">
            ğŸ”„ ØªØ­Ø¯ÙŠ Ø¬Ø¯ÙŠØ¯
          </button>
        </div>
      </div>
    </div>
  `;
  
  // ØªØ£Ø«ÙŠØ±Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ©
  createLightningStorm();
  playSoundSequence(['victory-fanfare', 'fireworks', 'applause'], 1000);
  
  // Ø±Ø³Ø§Ø¦Ù„ ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
  const winnerMessages = [
    `ğŸ”¥âš¡ ${winner.name} Ø£ØµØ¨Ø­ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ± Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø£Ø¹Ø¸Ù…!`,
    `ğŸ‘‘ğŸ’« ${winner.name} ÙŠØ±ØªØ¯ÙŠ ØªØ§Ø¬ Ù…Ù„Ùƒ Ø§Ù„Ø¨Ø±Ù‚!`,
    `ğŸŒ©ï¸ğŸ† ${winner.name} Ø³ÙŠØ¯ Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„Ø°Ù‡Ù†ÙŠØ©!`,
    `âš¡ğŸ’ ${winner.name} Ø¬ÙˆÙ‡Ø±Ø© Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¨Ø±Ù‚!`,
    `ğŸ”¥ğŸ‘‘ ${winner.name} Ø­Ø§ÙƒÙ… Ø§Ù„ØµÙˆØ§Ø¹Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯!`
  ];
  
  const randomWinnerMessage = winnerMessages[Math.floor(Math.random() * winnerMessages.length)];
  
  // Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²
  setTimeout(() => {
    showQuantumNotification('ğŸ‘‘ Ø§Ù„ÙØ§Ø¦Ø² Ø§Ù„Ù…ØªÙˆØ¬!', randomWinnerMessage, 'success');
  }, 500);
  
  // Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø­Ø³Ø¨ Ù†ØªØ§Ø¦Ø¬Ù‡Ù…
  setTimeout(() => {
    if (finalScores.length > 1) {
      const second = finalScores[1];
      showQuantumNotification('ğŸ¥ˆ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù†ÙŠ', `${second.name} Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø´Ø¬Ø§Ø¹! ğŸ—¡ï¸âš¡`, 'info');
    }
  }, 2000);
  
  setTimeout(() => {
    if (finalScores.length > 2) {
      const third = finalScores[2];
      showQuantumNotification('ğŸ¥‰ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø«', `${third.name} ÙØ§Ø±Ø³ Ø§Ù„ØµÙˆØ§Ø¹Ù‚ Ø§Ù„Ù…Ø¨Ø¯Ø¹! ğŸ›¡ï¸âš¡`, 'warning');
    }
  }, 3500);
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¹Ø§Ù…Ø©
  setTimeout(() => {
    showQuantumNotification('ğŸŒŸ Ø¬Ù…ÙŠØ¹ÙƒÙ… Ø£Ø¨Ø·Ø§Ù„!', 'ÙƒÙ„ ÙˆØ§Ø­Ø¯ Ù…Ù†ÙƒÙ… Ù„Ø¯ÙŠÙ‡ Ø´Ø±Ø§Ø±Ø© Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠØ©! Ø§Ø³ØªÙ…Ø±ÙˆØ§ ÙÙŠ Ø§Ù„ØªØ£Ù„Ù‚! âœ¨', 'battle');
  }, 5000);
}

// Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
function backToKingdomDashboard() {
  // Ø¥Ø®ÙØ§Ø¡ Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø­Ø°ÙÙ‡Ø§ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ ÙˆØ§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ†
  document.getElementById('kingdomContent').style.display = 'block';
  document.getElementById('kingdomDashboard').style.display = 'grid';
  playCosmicSound('ui-back');
  
  // Ø±Ø³Ø§Ø¦Ù„ Ø¹ÙˆØ¯Ø© Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  const returnMessages = [
    'ğŸ° Ø¹Ø¯ØªÙ… Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø¨Ø¹Ø¯ Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø¨Ø±Ù‚!',
    'ğŸ‘‘ Ø§Ù„Ù…Ù…Ù„ÙƒØ© ØªØ±Ø­Ø¨ Ø¨Ø¹ÙˆØ¯Ø© Ù…Ø­Ø§Ø±Ø¨ÙŠ Ø§Ù„Ø¨Ø±Ù‚!',
    'ğŸŒŸ Ø§Ù„Ù†Ø¬ÙˆÙ… ØªØ¶ÙŠØ¡ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…Ø¹Ø±ÙØ©!',
    'âš¡ğŸ° Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ø±Ù‚ Ù…Ø§ Ø²Ø§Ù„Øª ØªØ³Ø±ÙŠ ÙÙŠ Ø¹Ø±ÙˆÙ‚ÙƒÙ…!',
    'ğŸ­ Ø§Ù„Ù…Ø³Ø±Ø­ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!',
    'ğŸ—¡ï¸ Ø§Ù„Ø£Ø³Ù„Ø­Ø© Ø§Ù„Ø°Ù‡Ù†ÙŠØ© Ø´ÙØ­Ø°Øª... Ø£ÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ'
  ];
  
  const randomReturnMessage = returnMessages[Math.floor(Math.random() * returnMessages.length)];
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙØ¸ Ø¨Ù‡Ù…
  const studentsCount = gameState.selectedStudents ? gameState.selectedStudents.length : 0;
  showQuantumNotification('ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ù„ÙƒØ©', `${randomReturnMessage} (Ù…Ø­ØªÙØ¸ Ø¨Ù€ ${studentsCount} Ø·Ù„Ø§Ø¨)`, 'success');
  
  // Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
  setTimeout(() => {
    showQuantumNotification('ğŸ¯ Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ', 'Ø§Ø®ØªØ± Ù…Ù…Ù„ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ø³ØªÙƒØ´Ù ØªØ­Ø¯ÙŠØ§Øª Ø£Ø®Ø±Ù‰! ğŸš€', 'info');
  }, 2000);
}

// ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø¨ØµØ±ÙŠØ© Ø§Ù„Ù…Ø°Ù‡Ù„Ø©
function createLightningStorm() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  // Ø¥Ù†Ø´Ø§Ø¡ 5 ØµÙˆØ§Ø¹Ù‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  for (let i = 0; i < 5; i++) {
    setTimeout(() => {
      createLightningBolt();
    }, i * 200);
  }
}

function createLightningBolt() {
  const effectsContainer = document.getElementById('lightningEffects');
  if (!effectsContainer) return;
  
  const bolt = document.createElement('div');
  bolt.className = 'lightning-bolt';
  bolt.style.left = Math.random() * 100 + '%';
  bolt.style.animationDelay = Math.random() * 0.5 + 's';
  
  effectsContainer.appendChild(bolt);
  
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ÙŠÙ…ÙŠØ´Ù†
  setTimeout(() => {
    if (bolt.parentNode) {
      bolt.parentNode.removeChild(bolt);
    }
  }, 600);
  
  // ØµÙˆØª Ø§Ù„Ø¨Ø±Ù‚
  playCosmicSound('lightning-strike', { volume: 0.3 });
}

function createElectricExplosion(element) {
  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù†ÙØ¬Ø§Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù†ØµØ±
  const explosion = document.createElement('div');
  explosion.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,255,0,0.8), rgba(0,255,255,0.4), transparent);
    transform: translate(-50%, -50%) scale(0);
    animation: electricExplosion 0.6s ease-out;
    pointer-events: none;
    z-index: 1000;
  `;
  
  element.style.position = 'relative';
  element.appendChild(explosion);
  
  setTimeout(() => {
    if (explosion.parentNode) {
      explosion.parentNode.removeChild(explosion);
    }
  }, 600);
}

// Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„Ø§Ù†ÙØ¬Ø§Ø± Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ
const electricExplosionCSS = `
  @keyframes electricExplosion {
    0% { 
      transform: translate(-50%, -50%) scale(0);
      opacity: 1;
    }
    50% { 
      transform: translate(-50%, -50%) scale(1.5);
      opacity: 0.8;
    }
    100% { 
      transform: translate(-50%, -50%) scale(3);
      opacity: 0;
    }
  }
  
  @keyframes winnerGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }
    50% { 
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    }
  }
  
  @keyframes urgentPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  .final-results {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80vh;
    background: linear-gradient(135deg, #000428 0%, #004e92 100%);
    position: relative;
    overflow: hidden;
  }
  
  .results-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 215, 0, 0.5);
    border-radius: 25px;
    padding: 3rem;
    max-width: 600px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }
  
  .victory-header {
    margin-bottom: 2rem;
  }
  
  .victory-crown {
    font-size: 4rem;
    animation: crownBounce 2s ease-in-out infinite;
  }
  
  @keyframes crownBounce {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  .victory-title {
    font-size: 2.5rem;
    font-weight: 900;
    color: #ffd700;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
    margin: 1rem 0;
  }
  
  .lightning-effects-final {
    font-size: 2rem;
    color: #ffff00;
    animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }
  
  .winner-announcement {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
    border: 2px solid #ffd700;
    border-radius: 20px;
    padding: 2rem;
    margin: 2rem 0;
    animation: winnerGlow 2s ease-in-out infinite;
  }
  
  .final-scoreboard {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    padding: 1.5rem;
    margin: 2rem 0;
  }
  
  .results-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
`;

// Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„Ø±Ø£Ø³
const style = document.createElement('style');
style.textContent = electricExplosionCSS;
document.head.appendChild(style);

function startWisdomChallenge() {
  // Wisdom realm entrance
  playSoundSequence([
    'wisdom-chime',
    'ancient-bell',
    'brain-activate'
  ], 800);
  
  showQuantumNotification('ğŸ§  ØªØ­Ø¯ÙŠ Ø§Ù„Ø­ÙƒÙ…Ø©', 'ØªØ­Ø¯ÙŠ ÙÙƒØ±ÙŠ Ø¹Ù…ÙŠÙ‚ ÙˆÙ…Ø¹Ù‚Ø¯!', 'info');
  
  // Wisdom challenge with thinking time
  setTimeout(() => {
    playCosmicSound('knowledge-unlock');
    showQuantumNotification('ğŸ’¡ ÙÙƒØ± Ø¨Ø¹Ù…Ù‚', 'Ø§Ù„Ø­ÙƒÙ…Ø© ØªØ­ØªØ§Ø¬ Ù„Ù„ØªØ£Ù…Ù„ ÙˆØ§Ù„ØµØ¨Ø±', 'info');
  }, 3000);
}

function startMysteryChallenge() {
  // Mystery realm entrance
  playSoundSequence([
    'mystery-whisper',
    'mystic-wind',
    'spell-cast'
  ], 700);
  
  showQuantumNotification('ğŸ”® ØªØ­Ø¯ÙŠ Ø§Ù„Ø£Ù„ØºØ§Ø²', 'Ù„ØºØ² ØºØ§Ù…Ø¶ ÙŠÙ†ØªØ¸Ø± Ø­Ù„Ù‡!', 'special');
  
  // Mystery challenge with suspense
  setTimeout(() => {
    playCosmicSound('crystal-ping');
    showQuantumNotification('ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¯Ù„Ø©', 'Ø§Ù„Ø£Ù„ØºØ§Ø² ØªØ­ØªØ§Ø¬ Ù„Ø¹ÙŠÙ† Ø«Ø§Ù‚Ø¨Ø©!', 'special');
  }, 2000);
  
  setTimeout(() => {
    const solved = Math.random() > 0.5;
    if (solved) {
      playCosmicSound('riddle-solved');
      showQuantumNotification('âœ… Ø­ÙÙ„ Ø§Ù„Ù„ØºØ²!', 'Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ ÙƒØ´ÙØª Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©', 'success');
    }
  }, 8000);
}

function openSettings() {
  console.log('âš™ï¸ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
  playCosmicSound('menu-open');
  
  const settingsModal = document.getElementById('settingsModal');
  if (settingsModal) {
    settingsModal.classList.add('active');
    settingsModal.style.display = 'flex';
    
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    updateSettingsData();
    
    showQuantumNotification('âš™ï¸ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…', 'ØªÙ… ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', 'success');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
    showQuantumNotification('âŒ Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
  }
}

// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function updateSettingsData() {
  console.log('ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
  
  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  const classesCountElement = document.getElementById('classesCount');
  const totalStudentsElement = document.getElementById('totalStudentsCount');
  const lastUpdateElement = document.getElementById('lastUpdateTime');
  
  if (classesCountElement) classesCountElement.textContent = classesCount;
  if (totalStudentsElement) totalStudentsElement.textContent = totalStudents;
  if (lastUpdateElement) lastUpdateElement.textContent = new Date().toLocaleString('ar-SA');
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ Ø§Ù„Ù…Ø®ØªØ§Ø±
  const selectedClassElement = document.getElementById('selectedClassDisplay');
  if (selectedClassElement && gameState.selectedClass) {
    selectedClassElement.innerHTML = `<option value="${gameState.selectedClass}" selected>${gameState.selectedClass}</option>`;
  }
  
  console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${classesCount} ØµÙÙˆÙØŒ ${totalStudents} Ø·Ø§Ù„Ø¨`);
}

// ===== ENHANCED UI INTERACTIONS =====
// Add hover sound effects to buttons
document.addEventListener('DOMContentLoaded', () => {
  // Initialize audio system
  initAudioSystem();
  
  // Initialize control buttons
  initializeControlButtons();
  
  // Load student data first, then start with class selection
  loadStudentData().then(() => {
    loadClassSelection();
  }).catch(error => {
    console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨:', error);
    loadClassSelection(); // Try to load anyway
  });
  
  // Add hover effects to neural buttons after page load
  setTimeout(() => {
    const buttons = document.querySelectorAll('.neural-button, .realm-card');
    buttons.forEach(button => {
      button.addEventListener('mouseenter', () => {
        playCosmicSound('button-hover', { volume: 0.3 });
      });
      
      button.addEventListener('click', () => {
        playCosmicSound('cosmic-click', { volume: 0.5 });
      });
    });
  }, 1000);
});

// ===== INITIALIZATION =====
window.addEventListener('load', async () => {
  await initializeKingdom();
});

async function initializeKingdom() {
  console.log('ğŸ° Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ©...');
  
  const progressBar = document.getElementById('progressBar');
  const loaderText = document.getElementById('loaderText');
  
  // Initialize particles
  initParticles();
  
  // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙˆØ±Ø§Ù‹
  setTimeout(() => {
    ensureControlHeaderVisible();
  }, 100);
  
  // Loading sequence with sound effects
  const loadingSteps = [
    { progress: 20, text: "ï¿½ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙƒÙˆÙ†ÙŠØ©...", sound: 'cosmic-portal' },
    { progress: 40, text: "âš¡ Ø´Ø­Ù† Ù…Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...", sound: 'ai-beep' },
    { progress: 60, text: "ğŸ° Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù…Ø§Ù„ÙŠÙƒ Ø§Ù„Ø³Ø­Ø±ÙŠØ©...", sound: 'magic-sparkle' },
    { progress: 80, text: "ğŸ‘¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø±Ø¨ÙŠÙ†...", sound: 'data-process' },
    { progress: 100, text: "ğŸ‰ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¬Ø§Ù‡Ø²Ø©!", sound: 'kingdom-enter' }
  ];
  
  for (let step of loadingSteps) {
    await new Promise(resolve => setTimeout(resolve, 800));
    progressBar.style.width = step.progress + '%';
    loaderText.textContent = step.text;
    
    // Play loading sound
    if (step.sound) {
      playCosmicSound(step.sound, { volume: 0.4 });
    }
  }
  
  // Load student data with confirmation
  loaderText.textContent = "ğŸ“š ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...";
  await loadStudentData();
  
  // Confirm data loaded
  const classCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  loaderText.textContent = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${classCount} ØµÙÙˆÙ Ù…Ø¹ ${totalStudents} Ø·Ø§Ù„Ø¨`;
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  // Hide loader and show main app
  await new Promise(resolve => setTimeout(resolve, 1000));
  document.getElementById('cosmicLoader').style.opacity = '0';
  setTimeout(() => {
    document.getElementById('cosmicLoader').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    ensureControlHeaderVisible();
    
    // Additional visual confirmation
    setTimeout(() => {
      ensureControlHeaderVisible();
      initializeControlButtons(); // ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
      setupSettingsTabs(); // ØªÙØ¹ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    }, 500);
    
    // Show class selection panel initially instead of welcome message
    loadClassSelection();
    
    // Debug info
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
    
    startSessionTimer();
    // showWelcomeMessage(); // Will be shown after student selection
  }, 1000);
}

// ===== ÙˆØ¸Ø§Ø¦Ù Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠØ© =====

// Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø§Ø­Ø§Øª ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ
function hideAllArenas() {
  // Ø¥Ø®ÙØ§Ø¡ Ø³Ø§Ø­Ø© Ø§Ù„Ø¨Ø±Ù‚
  const lightningArena = document.getElementById('lightningArena');
  if (lightningArena) {
    lightningArena.style.display = 'none';
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©
  const battleArena = document.getElementById('battleArena');
  if (battleArena) {
    battleArena.style.display = 'none';
  }
  
  // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙÙˆÙ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  const selectionPanel = document.getElementById('selectionPanel');
  if (selectionPanel) {
    selectionPanel.style.display = 'none';
  }
  
  // Ø¥Ø®ÙØ§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØªÙˆØ­Ø©
  const gameInterface = document.getElementById('gameInterface');
  if (gameInterface) {
    gameInterface.style.display = 'none';
  }
  
  // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¤Ù‚ØªØ§Øª Ù†Ø´Ø·Ø©
  if (lightningTimerInterval) {
    clearInterval(lightningTimerInterval);
    lightningTimerInterval = null;
  }
  
  if (gameState.battleTimer) {
    clearInterval(gameState.battleTimer);
    gameState.battleTimer = null;
  }
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  gameState.waitingForAnswer = false;
}

// ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
function initializeControlButtons() {
  console.log('ğŸ”§ Ø¨Ø¯Ø¡ ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…...');
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‚Ø¨Ù„ Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø«
  const homeBtn = document.getElementById('homeBtn');
  if (!homeBtn) {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© homeBtn');
    return;
  } else {
    console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
  }

  // Ø²Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  homeBtn.addEventListener('click', function() {
    console.log('ğŸ  ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©!');
    playCosmicSound('ui-back');
    
    console.log('ğŸ” Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©...');
    
    // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (ØµÙØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù†Ø´Ø·Ø©)
    if (document.referrer && document.referrer !== window.location.href) {
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØµÙØ­Ø© Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„ÙŠÙ‡Ø§
      console.log('â†©ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:', document.referrer);
      window.history.back();
    } else {
      // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ ØµÙØ­Ø© Ø³Ø§Ø¨Ù‚Ø©ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©
      console.log('ğŸ  Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
      window.location.href = '../index.html';
    }
  });

  // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ
  const kingdomsBtn = document.getElementById('kingdomsBtn');
  if (kingdomsBtn) {
    kingdomsBtn.addEventListener('click', function() {
      console.log('ğŸ° ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ!');
      playCosmicSound('ui-back');
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø§Ø¨ Ù…Ø®ØªØ§Ø±ÙŠÙ†
      if ((gameState.selectedStudents && gameState.selectedStudents.length > 0) || 
          (selectedStudentsList && selectedStudentsList.length > 0)) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø§Ø¨ Ù…Ø®ØªØ§Ø±ÙŠÙ†ØŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ
        console.log('ğŸ° Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø§Ø­Ø§Øª
        hideAllArenas();
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ
        showKingdoms();
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ù…Ø¤Ù‚Øª Ø§Ù„Ø¬Ù„Ø³Ø©
        if (!gameState.sessionStartTime) {
          gameState.sessionStartTime = Date.now();
          startSessionTimer();
        }
        
        const studentsCount = gameState.selectedStudents?.length || selectedStudentsList?.length || 0;
        showQuantumNotification('ğŸ° Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù…Ø§Ù„Ùƒ', `Ù…Ø­ØªÙØ¸ Ø¨Ù€ ${studentsCount} Ø·Ù„Ø§Ø¨ - Ø§Ø®ØªØ± Ù…Ù…Ù„ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©!`, 'success');
      } else {
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø§Ø¨ØŒ Ø§Ø°Ù‡Ø¨ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙÙˆÙ
        console.log('ğŸ° Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø­Ø¯Ø¯ÙˆÙ†ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ');
        loadClassSelection();
      }
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ');
  }

  // Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØµÙˆØª
  const soundToggleBtn = document.getElementById('soundToggleBtn');
  if (soundToggleBtn) {
    soundToggleBtn.addEventListener('click', function() {
      gameState.soundEnabled = !gameState.soundEnabled;
      updateSoundButton();
      playCosmicSound('ui-click');
      showQuantumNotification(
        gameState.soundEnabled ? 'ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª' : 'ğŸ”‡ ØªÙ… ÙƒØªÙ… Ø§Ù„ØµÙˆØª',
        '', 
        'info'
      );
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØµÙˆØª');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØµÙˆØª');
  }

  // Ø²Ø± Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…
  const teacherGuideBtn = document.getElementById('teacherGuideBtn');
  if (teacherGuideBtn) {
    teacherGuideBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showTeacherGuide();
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…');
  }  // Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  const settingsBtn = document.getElementById('settingsBtn');
  if (settingsBtn) {
    settingsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSettingsModal();
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
  }

  // Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
  const sessionBtn = document.getElementById('sessionBtn');
  if (sessionBtn) {
    sessionBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showSessionManagement();
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©');
    
    // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø²Ø± Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
    updateSessionButtonStatus();
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©');
  }

  // Ø²Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
  const statsBtn = document.getElementById('statsBtn');
  if (statsBtn) {
    statsBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      showStatsModal();
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
  }

  // Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  if (fullscreenBtn) {
    fullscreenBtn.addEventListener('click', function() {
      playCosmicSound('ui-click');
      toggleFullscreen();
    });
    console.log('âœ… ØªÙ… Ø±Ø¨Ø· Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
  } else {
    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
  }
  
  console.log('ğŸ”§ Ø§Ù†ØªÙ‡Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…');
}

// ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØµÙˆØª
function updateSoundButton() {
  const soundBtn = document.getElementById('soundToggleBtn');
  const icon = soundBtn.querySelector('.btn-icon');
  icon.textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

// Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function showSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.add('active');
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  updateSettingsDisplay();
  
  // ØªÙØ¹ÙŠÙ„ Ø£ÙˆÙ„ ØªØ¨ÙˆÙŠØ¨
  showSettingsTab('game-settings');
  
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  setupSettingsTabs();
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function setupSettingsTabs() {
  const tabButtons = document.querySelectorAll('.settings-tab-btn');
  tabButtons.forEach(button => {
    button.addEventListener('click', function() {
      const tabId = this.getAttribute('data-tab');
      showSettingsTab(tabId);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ø´Ø·Ø©
      tabButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
    });
  });
}

// Ø¥Ø¸Ù‡Ø§Ø± ØªØ¨ÙˆÙŠØ¨ Ù…Ø¹ÙŠÙ†
function showSettingsTab(tabId) {
  // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  const allTabs = document.querySelectorAll('.settings-tab-content');
  allTabs.forEach(tab => tab.classList.remove('active'));
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
  const targetTab = document.getElementById(tabId + '-content');
  if (targetTab) {
    targetTab.classList.add('active');
  }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function updateSettingsDisplay() {
  // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØµÙˆØª
  document.getElementById('masterVolumeSlider').value = (gameState.masterVolume || 0.5) * 100;
  document.getElementById('volumeDisplay').textContent = Math.round((gameState.masterVolume || 0.5) * 100) + '%';
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
  document.getElementById('particlesToggle').checked = gameState.particlesEnabled !== false;
  document.getElementById('animationsToggle').checked = gameState.animationsEnabled !== false;
  document.getElementById('notificationsToggle').checked = gameState.notificationsEnabled !== false;
  
  // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙ
  updateClassDataDisplay();
  
  // Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØºÙŠÙŠØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª
  setupVolumeSliders();
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø´Ø±Ø·Ø© Ø§Ù„ØµÙˆØª
function setupVolumeSliders() {
  const masterSlider = document.getElementById('masterVolumeSlider');
  const effectsSlider = document.getElementById('effectsVolumeSlider');
  const musicSlider = document.getElementById('musicVolumeSlider');
  
  masterSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.masterVolume = volume;
    document.getElementById('volumeDisplay').textContent = this.value + '%';
    playCosmicSound('ui-click', { volume: volume });
  });
  
  effectsSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.effectsVolume = volume;
    document.getElementById('effectsVolumeDisplay').textContent = this.value + '%';
    playCosmicSound('cosmic-click', { volume: volume });
  });
  
  musicSlider.addEventListener('input', function() {
    const volume = this.value / 100;
    gameState.musicVolume = volume;
    document.getElementById('musicVolumeDisplay').textContent = this.value + '%';
  });
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ
function updateClassDataDisplay() {
  const classesCount = Object.keys(studentData).length;
  const totalStudents = Object.values(studentData).reduce((sum, students) => sum + students.length, 0);
  
  document.getElementById('classesCount').textContent = classesCount;
  document.getElementById('totalStudentsCount').textContent = totalStudents;
  document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('ar-SA');
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ Ø§Ù„Ù…Ø®ØªØ§Ø±
  const selectedClassSelect = document.getElementById('selectedClassDisplay');
  selectedClassSelect.innerHTML = '<option value="">-- Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙ --</option>';
  Object.keys(studentData).forEach(className => {
    const option = document.createElement('option');
    option.value = className;
    option.textContent = className;
    if (gameState.selectedClass === className) {
      option.selected = true;
    }
    selectedClassSelect.appendChild(option);
  });
}

// Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
function testAllSounds() {
  const soundTests = [
    'cosmic-click', 'button-hover', 'achievement', 'magic-sparkle', 
    'epic-charge', 'victory-fanfare', 'ui-back'
  ];
  
  let index = 0;
  const interval = setInterval(() => {
    if (index < soundTests.length) {
      playCosmicSound(soundTests[index], { volume: 0.3 });
      showQuantumNotification(`ğŸµ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª: ${soundTests[index]}`, '', 'info');
      index++;
    } else {
      clearInterval(interval);
      showQuantumNotification('ğŸ¼ Ø§Ù†ØªÙ‡Ù‰ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ØµÙˆØ§Øª!', '', 'success');
    }
  }, 1000);
}

// ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
function muteAllSounds() {
  gameState.soundEnabled = false;
  gameState.masterVolume = 0;
  gameState.effectsVolume = 0;
  gameState.musicVolume = 0;
  
  document.getElementById('masterVolumeSlider').value = 0;
  document.getElementById('effectsVolumeSlider').value = 0;
  document.getElementById('musicVolumeSlider').value = 0;
  
  updateSoundButton();
  showQuantumNotification('ğŸ”‡ ØªÙ… ÙƒØªÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª', '', 'info');
}

// Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function saveAllSettings() {
  const settings = {
    masterVolume: document.getElementById('masterVolumeSlider').value / 100,
    effectsVolume: document.getElementById('effectsVolumeSlider').value / 100,
    musicVolume: document.getElementById('musicVolumeSlider').value / 100,
    particlesEnabled: document.getElementById('particlesToggle').checked,
    animationsEnabled: document.getElementById('animationsToggle').checked,
    notificationsEnabled: document.getElementById('notificationsToggle').checked,
    fullscreenMode: document.getElementById('fullscreenModeToggle').checked,
    challengeDuration: document.getElementById('challengeDurationSelect').value,
    difficulty: document.getElementById('difficultySelect').value,
    scoringSystem: document.getElementById('scoringSystemSelect').value,
    colorTheme: document.getElementById('colorThemeSelect').value,
    autoSelectStudents: document.getElementById('autoSelectAllStudents').checked,
    randomizeOrder: document.getElementById('randomizeStudentOrder').checked,
    quickStart: document.getElementById('enableQuickStart').checked,
    rememberSelection: document.getElementById('rememberLastSelection').checked,
    timestamp: new Date().toISOString()
  };
  
  // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
  Object.assign(gameState, settings);
  
  // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
  localStorage.setItem('kingdomSettingsAdvanced', JSON.stringify(settings));
  
  playCosmicSound('achievement');
  showQuantumNotification('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ø´Ø·Ø© Ø§Ù„Ø¢Ù†', 'success');
  closeSettingsModal();
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function resetAllSettings() {
  if (confirm('ğŸ”„ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ\n\nØ³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©.')) {
    // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const defaultSettings = {
      masterVolume: 0.5,
      effectsVolume: 0.7,
      musicVolume: 0.3,
      particlesEnabled: true,
      animationsEnabled: true,
      notificationsEnabled: true,
      fullscreenMode: false,
      challengeDuration: 60,
      difficulty: 'medium',
      scoringSystem: 'standard',
      colorTheme: 'cosmic',
      autoSelectStudents: false,
      randomizeOrder: false,
      quickStart: false,
      rememberSelection: true
    };
    
    Object.assign(gameState, defaultSettings);
    localStorage.removeItem('kingdomSettingsAdvanced');
    
    updateSettingsDisplay();
    playCosmicSound('ui-reset');
    showQuantumNotification('ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù†Ø´Ø·Ø© Ø§Ù„Ø¢Ù†', 'info');
  }
}

// ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function exportSettings() {
  const settings = JSON.parse(localStorage.getItem('kingdomSettingsAdvanced') || '{}');
  const exportData = {
    appName: 'Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©',
    version: '2.0',
    settings: settings,
    exportDate: new Date().toISOString(),
    exportedBy: 'Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…'
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-settings-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('ğŸ“¤ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', '', 'success');
}

// ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ
function exportClassData() {
  const exportData = {
    appName: 'Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ©',
    dataType: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨',
    classes: studentData,
    statistics: {
      totalClasses: Object.keys(studentData).length,
      totalStudents: Object.values(studentData).reduce((sum, students) => sum + students.length, 0)
    },
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataBlob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(dataBlob);
  
  const link = document.createElement('a');
  link.href = url;
  link.download = `kingdom-class-data-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  playCosmicSound('achievement');
  showQuantumNotification('ğŸ“¥ ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ Ø¨Ù†Ø¬Ø§Ø­', '', 'success');
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
function closeSettingsModal() {
  const modal = document.getElementById('settingsModal');
  modal.classList.remove('active');
  modal.style.display = 'none';
  playCosmicSound('ui-back');
}

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…)
function saveSettings() {
  saveAllSettings();
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ…)
function resetSettings() {
  resetAllSettings();
}

// Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
function showSessionManagement() {
  const savedSession = loadTeacherSession();
  
  // Ø¥Ù†Ø´Ø§Ø¡ modal Ù„Ù„Ø¬Ù„Ø³Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
  let sessionModal = document.getElementById('sessionModal');
  if (!sessionModal) {
    sessionModal = document.createElement('div');
    sessionModal.id = 'sessionModal';
    sessionModal.className = 'cosmic-modal';
    document.body.appendChild(sessionModal);
  }
  
  sessionModal.innerHTML = `
    <div class="modal-overlay" onclick="closeSessionModal()"></div>
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
        <button class="modal-close" onclick="closeSessionModal()">Ã—</button>
      </div>
      <div class="modal-body">
        ${savedSession ? `
          <!-- Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
          <div style="background: rgba(79, 172, 254, 0.1); border: 2px solid rgba(79, 172, 254, 0.3);
                      border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: #4facfe; margin-bottom: 1rem;">ğŸ“ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù†Ø´Ø·Ø©</h3>
            <div style="display: grid; gap: 1rem; text-align: right;">
              <div>
                <strong style="color: #ffd700;">Ø§Ù„ØµÙ:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedClass}</span>
              </div>
              <div>
                <strong style="color: #ffd700;">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨:</strong> 
                <span style="color: white; font-size: 1.1rem;">${savedSession.selectedStudents.length} Ø·Ø§Ù„Ø¨</span>
              </div>
              <div>
                <strong style="color: #ffd700;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­ÙØ¸:</strong>
                <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                  ${new Date(savedSession.timestamp).toLocaleString('ar-SA')}
                </span>
              </div>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div style="margin-top: 1.5rem;">
              <strong style="color: #ffd700;">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸ÙˆÙ†:</strong>
              <div style="max-height: 150px; overflow-y: auto; margin-top: 0.5rem;
                          background: rgba(0,0,0,0.2); border-radius: 10px; padding: 1rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem;">
                  ${savedSession.selectedStudents.map(student => `
                    <span style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.3);
                                border-radius: 8px; padding: 0.5rem; text-align: center; font-size: 0.9rem;">
                      ${student}
                    </span>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
          
          <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
          <div style="display: grid; gap: 1rem;">
            <button class="neural-button" onclick="continueWithSavedSession(); closeSessionModal();" 
                    style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              âœ… Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
            
            <button class="neural-button" onclick="exportSession()" 
                    style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
              ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
            
            <button class="neural-button" onclick="confirmClearSession()" 
                    style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
              ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </button>
          </div>
        ` : `
          <!-- Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø© -->
          <div style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">ğŸ’¾</div>
            <h3 style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">
              Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©
            </h3>
            <p style="color: rgba(255,255,255,0.5); margin-bottom: 2rem;">
              Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨
            </p>
            
            <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.3);
                        border-radius: 15px; padding: 2rem; text-align: right;">
              <h4 style="color: #ffd700; margin-bottom: 1rem;">ğŸ’¡ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ</h4>
              <ul style="color: rgba(255,255,255,0.8); list-style: none; padding: 0;">
                <li style="margin-bottom: 0.5rem;">ğŸ¯ ÙŠØ­ÙØ¸ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
                <li style="margin-bottom: 0.5rem;">âš¡ ÙŠØ³ØªØ¹ÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</li>
                <li style="margin-bottom: 0.5rem;">ğŸ”„ ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©</li>
                <li style="margin-bottom: 0.5rem;">ğŸ® ÙŠÙˆÙØ± ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ù…Ø§Ù„Ùƒ</li>
              </ul>
            </div>
          </div>
        `}
      </div>
    </div>
  `;
  
  sessionModal.classList.add('active');
}

function closeSessionModal() {
  const sessionModal = document.getElementById('sessionModal');
  if (sessionModal) {
    sessionModal.classList.remove('active');
  }
}

function confirmClearSession() {
  if (confirm('ğŸ—‘ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ\n\nØ³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ³ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªÙŠØ§Ø±Ù‡Ù….')) {
    clearTeacherSession();
    closeSessionModal();
  }
}

function exportSession() {
  const savedSession = loadTeacherSession();
  if (savedSession) {
    const sessionData = {
      ...savedSession,
      exportDate: new Date().toISOString(),
      appVersion: '2.0'
    };
    
    const dataStr = JSON.stringify(sessionData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `kingdom-session-${savedSession.selectedClass}-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    URL.revokeObjectURL(url);
    
    showQuantumNotification('ğŸ“¤ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
  }
}

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
function updateSessionButtonStatus() {
  const sessionBtn = document.getElementById('sessionBtn');
  if (!sessionBtn) return;
  
  const savedSession = loadTeacherSession();
  const iconElement = sessionBtn.querySelector('.btn-icon');
  const tooltipElement = sessionBtn.querySelector('.btn-tooltip');
  
  if (savedSession) {
    // ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©
    iconElement.textContent = 'ğŸ’¾';
    tooltipElement.textContent = 'Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©';
    sessionBtn.style.boxShadow = '0 0 10px rgba(79, 172, 254, 0.5)';
    sessionBtn.title = `Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©: ${savedSession.selectedClass} (${savedSession.selectedStudents.length} Ø·Ù„Ø§Ø¨)`;
  } else {
    // Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø©
    iconElement.textContent = 'ğŸ’¾';
    tooltipElement.textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©';
    sessionBtn.style.boxShadow = '';
    sessionBtn.title = 'Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø¹Ù„Ù…';
  }
}

// Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function showStatsModal() {
  const modal = document.getElementById('statsModal');
  const content = document.getElementById('statsContent');
  
  content.innerHTML = `
    <div style="display: grid; gap: 1.5rem;">
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #ffd700; margin-bottom: 1rem;">ğŸ® Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨</h3>
        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨: ${gameState.totalGames || 0}</div>
        <div>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©: ${gameState.totalPoints || 0}</div>
      </div>
      
      <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px;">
        <h3 style="color: #00ffff; margin-bottom: 1rem;">ğŸ‘¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <div>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: ${gameState.selectedStudents?.length || 0}</div>
        <div>Ø§Ù„ØµÙ Ø§Ù„Ù…Ø®ØªØ§Ø±: ${gameState.selectedClass || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
      </div>
    </div>
  `;
  
  modal.classList.add('active');
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function closeStatsModal() {
  const modal = document.getElementById('statsModal');
  modal.classList.remove('active');
  playCosmicSound('ui-back');
}

// ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().then(() => {
      showQuantumNotification('â›¶ ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ù…ÙØ¹Ù„', '', 'info');
    });
  } else {
    document.exitFullscreen().then(() => {
      showQuantumNotification('â›¶ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©', '', 'info');
    });
  }
}

// Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function backToMainDashboard() {
  // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  document.getElementById('selectionPanel').style.display = 'none';
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
  document.getElementById('kingdomContent').style.display = 'block';
  
  // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¹ÙˆØ¯Ø©
  playCosmicSound('ui-back');
  
  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
  showWelcomeMessage();
  
  showQuantumNotification(
    'ğŸ° Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª',
    'Ø§Ø®ØªØ± Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©',
    'info'
  );
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
function loadSavedSettings() {
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  const advancedSettings = localStorage.getItem('kingdomSettingsAdvanced');
  if (advancedSettings) {
    const settings = JSON.parse(advancedSettings);
    Object.assign(gameState, settings);
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©');
    return;
  }
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„ØªÙˆØ§ÙÙ‚
  const oldSettings = localStorage.getItem('kingdomSettings');
  if (oldSettings) {
    const settings = JSON.parse(oldSettings);
    gameState.masterVolume = settings.masterVolume || 0.5;
    gameState.particlesEnabled = settings.particlesEnabled !== false;
    gameState.animationsEnabled = settings.animationsEnabled !== false;
    gameState.soundEnabled = settings.soundEnabled !== false;
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØªØ±Ù‚ÙŠØªÙ‡Ø§');
  } else {
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    gameState.masterVolume = 0.5;
    gameState.effectsVolume = 0.7;
    gameState.musicVolume = 0.3;
    gameState.particlesEnabled = true;
    gameState.animationsEnabled = true;
    gameState.notificationsEnabled = true;
    console.log('ğŸ“‹ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
  }
}

// ===== FINAL INITIALIZATION =====
console.log('ğŸ† Ù…Ù…Ù„ÙƒØ© Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø°ÙƒÙŠØ© - ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªÙ…Ù„!');
console.log('ğŸµ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ 61 ØªØ£Ø«ÙŠØ± ØµÙˆØªÙŠ Ø¬Ø§Ù‡Ø²!');
console.log('âš¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…Ø§Ù„ÙŠÙƒ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„!');

// Initialize the enhanced audio system
initAudioSystem();

// ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
initializeControlButtons();

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
loadSavedSettings();

// ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ØµÙˆØª
updateSoundButton();

// ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
updateSessionButtonStatus();
</script>
</body>
</html>
